(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{261:function(e,t,a){e.exports=a(458)},266:function(e,t,a){},455:function(e,t,a){},456:function(e,t,a){},457:function(e,t,a){},458:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),i=a(41),s=a.n(i),r=(a(266),a(116)),c=a(68),l=a(118),d="App/UPDATE_USER",p="App/SET_ROOM",m="App/UPDATE_ROOM",u="App/SET_CONFIG",h="App/ADD_HISTORY",v="App/ADD_MESSAGE",g="App/SET_ACTIONS",f="App/SET_HISTORY",b={user:{ID:0,sessionID:0,sessionKey:"",name:"User.0",loggedIn:!1,warning:"Please wait for login..",balance:0},room:{ID:0,name:"Room.0",screen:"LoginScreen",streamBroadcast:"Room",streamPlayback:"Room",privateUID:0,actionPrivate:!1,actionPrivateClose:!1,actionID:0,performer:"",performerID:0,welcome:"Welcome to default room!"},config:{wss:"",application:"",videoCodec:"h264",videoBitrate:"400",videoFramerae:"29.97",audioCodec:"opus",audioBitrate:"64",autoBroadcast:!1,exitURL:"https://videowhisper.com",errorURL:"https://videowhisper.com/tickets_submit.php",actionFullpage:!1,actionFullscreen:!0},messages:[],actions:[],lastMessageTimestamp:0};var S=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(a.type){case d:e=Object.assign({},t,{user:Object.assign({},t.user,a.payload.user)});break;case p:e=Object.assign({},t,{room:Object.assign({},a.payload.room)});break;case m:e=Object.assign({},t,{room:Object.assign({},t.room,a.payload.room)});break;case u:e=Object.assign({},t,{config:Object.assign({},a.payload.config)});break;case v:e=Object.assign({},t,{messages:[].concat(Object(l.a)(t.messages),[a.payload.message])});break;case h:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,messages:t.messages.concat(a.payload.messages)});break;case g:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,actions:Object(l.a)(a.payload.actions)});break;case f:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,messages:Object(l.a)(a.payload.messages)});break;default:e=Object.assign({},t)}return e},y=Object(c.b)({app:S}),C=Object(c.c)(y),k=a(17),E=a(18),M=a(19),w=a(13),O=a(20),D=a(15);var R=a(459),I=a(61),j=a(469),N=a(475),A=a(473),U=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).devMode=e.appState.devMode,a.state={tried:!1,modeServers:["videowhisper","ateom"]},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=this.state;if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen  componentDidMount",e,t,window,window.VideoWhisper),!e.user.loggedIn&&!e.user.failed){var a=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:a})}t.modeServers.forEach(e.checkMode)}},{key:"render",value:function(){var e,t=this.props;this.state;e=t.user.loggedIn?"Logged in as "+t.user.name:"Not logged in, yet. ",t.user.warning&&(e+=t.user.warning);var a=o.a.createElement("p",null," Entering the ",o.a.createElement("a",{href:"https://videowhisper.com"},"VideoWhisper.com")," HTML5 Videochat App. ");return t.appState.checked&&(t.appState.mode.status||(a=t.appState.mode.text?t.appState.mode.text:"This is server connection screen.")),o.a.createElement(A.a,null,o.a.createElement("p",null," Logged in: ",e," "),o.a.createElement("p",null," ",t.user.error," "),a)}}]),t}(n.Component),P=a(151),L=a.n(P),V=a(226),x=a(53),F=a(468),q=a(83),W=a(467),T=a(4),H=a.n(T),B=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).updateSize=function(){var e=Object(D.a)(Object(D.a)(a)).state;if(e.container){var t=e.container.clientWidth,n=e.container.clientHeight;n||(n=1);var o=t/n;a.setState({aspectRatio:o,width:t,height:n})}},a.state={container:null,width:0,height:0,aspectRatio:0,settingsActive:!0},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.updateSize(),window.addEventListener("resize",this.updateSize,!1),document.addEventListener("onfullscreenchange",this.updateSize,!1),document.addEventListener("webkitfullscreenchange",this.updateSize,!1),document.addEventListener("mozfullscreenchange",this.updateSize,!1),document.addEventListener("msfullscreenchange",this.updateSize,!1),document.addEventListener("MSFullscreenChange",this.updateSize,!1),document.addEventListener("fullscreenchange",this.updateSize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateSize),document.removeEventListener("onfullscreenchange",this.updateSize),document.removeEventListener("webkitfullscreenchange",this.updateSize),document.removeEventListener("mozfullscreenchange",this.updateSize),document.removeEventListener("msfullscreenchange",this.updateSize),document.removeEventListener("MSFullscreenChange",this.updateSize),document.removeEventListener("fullscreenchange",this.updateSize)}},{key:"onClick",value:function(e,t){var a=t.name,n=(t.value,this.state);"settings"===a&&this.setState(function(e){return{settingsActive:!n.settingsActive}})}}]),t}(n.Component),z=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).onLoadedData=function(e){var t=a.remoteVideo.current;a.devMode&&console.log("components/Video - loadeddata"),a.updateVideoSize("onLoadedData"),t.paused&&0==t.currentTime&&(console.log("components/Video loadeddata : video paused on load - try to play",t.src,e),a.videoPlay())},a.onopen=function(e){var t=this,a=this.state;this.devMode&&console.log("components/Video wsConnection.onopen wsConnection.readyState:",this.wsConnection.readyState,e,this.state),1==this.wsConnection.readyState&&(a.retrying=!1,this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.addEventListener("icecandidate",function(e){return t.icecandidate(t.peerConnection,e)}),this.peerConnection.onsignalingstatechange=this.onsignalingstatechange.bind(this),this.peerConnection.addEventListener("iceconnectionstatechange",function(e){return t.iceconnectionstatechange(t.peerConnection,e)}),this.peerConnection.addEventListener("track",this.track.bind(this)),1==this.wsConnection.readyState?this.sendPlayGetOffer():console.log("components/Video wsConnection not open for sendPlayGetOffer wsConnection.readyState:",this.wsConnection.readyState))},a.onmessage=function(e){var t=this,a=this.state;this.devMode&&console.log("components/Video wsConnection.onmessage: "+e.data);var n=JSON.parse(e.data),o=Number(n.status),i=n.command,s="";if(a.retryCount++,200!=o)s=n.statusDescription,a.available&&(504===o||514===o||a.retryCount<a.autoRetries&&"1"===this.props.config.videoAutoPlay)?1===this.wsConnection.readyState?(setTimeout(this.sendPlayGetOffer.bind(this),1500),s=s+" (retry #"+a.retryCount+")",this.setState({buttonDisabled:!0,buttonContent:"Auto Retry",connecting:!0,connected:!1})):(console.log("components/Video onmessage - wsConnection not open for sendPlayGetOffer wsConnection.readyState:",this.wsConnection.readyState),this.setState({buttonDisabled:!1,buttonContent:"Retry",connecting:!1,connected:!1})):this.stopStreamPlay(),this.setState({statusInfo:s});else{this.devMode&&console.log("wsConnection.onmessage success msgJSON",n);var r=n.streamInfo;void 0!==r&&(this.streamInfo.sessionId=r.sessionId),void 0!==n.sdp&&(this.devMode&&console.log("wsConnection.onmessage: setRemoteDescription original sdp: "+JSON.stringify(n.sdp)),this.peerConnection.setRemoteDescription(n.sdp).then(this.peerCreateAnswer.bind(this)).catch(this.errorHandler.bind(this)));var c=n.iceCandidates;if(void 0!==c)for(var l in c)this.devMode&&console.log("addIceCandidate: "+JSON.stringify(c[l])),this.peerConnection.addIceCandidate(new RTCIceCandidate(c[l])).then(function(){return t.onAddIceCandidateSuccess(t.peerConnection)},function(e){return t.onAddIceCandidateError(t.peerConnection,e)})}0=="sendResponse".localeCompare(i)&&(null!=this.wsConnection&&this.wsConnection.close(),this.wsConnection=null)},a.devMode=e.appState.devMode,a.devMode&&console.log("components/Video constructor",e),a.remoteVideo=o.a.createRef(),a.wsConnection=null,a.peerConnection=null,a.peerConnectionConfig={iceServers:[]},a.streamInfo={streamName:"",userName:""},a.userData={},a.startTime=null,a.stats={video:{timestamp:0,bandwidth:0},audio:{timestamp:0,bandwidth:0}},a.state={bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{name:"eye slash"}),"Not Streaming"),videoMuted:"muted",videoMutedMessage:"Tap for Sound",fullscreen:!1,available:!1,connected:!1,connecting:!1,autoRetries:3,statusInfo:"Connecting...",buttonContent:"Connecting",buttonDisabled:!0,videoWidth:640,videoHeight:360,videoAspectRatio:1.77,retryCount:0,retrying:!1},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"interfaceReady",value:function(){this.state,this.remoteVideo.current,this.state;"1"===this.props.config.videoAutoPlay&&this.startStreamPlay()}},{key:"updateVideoSize",value:function(e){var t=this.remoteVideo.current;this.devMode&&console.log("components/Video updateVideoSize",e,t);var a,n=this.state;if(t.videoHeight&&(n.videoWidth===t.videoWidth&&n.videoHeight===t.videoHeight||(n.videoWidth=t.videoWidth,n.videoHeight=t.videoHeight,n.videoHeight||(n.videoHeight=1),this.setState({videoWidth:t.videoWidth,videoHeight:t.videoHeight})),a=t.videoWidth/t.videoHeight,n.videoAspectRatio!==a&&this.setState({videoAspectRatio:a}),this.startTime)){var o=window.performance.now()-this.startTime;this.devMode&&console.log("components/Video updateVideoSize Remote Video playback setup time: "+o.toFixed(3)+"ms"),this.startTime=null}this.devMode&&console.log("components/Video updateVideoSize "+e,n.videoWidth,n.videoHeight,a)}},{key:"componentDidMount",value:function(){Object(x.a)(Object(w.a)(t.prototype),"componentDidMount",this).call(this),this.interfaceReady()}},{key:"componentWillUnmount",value:function(){this.stopStreamPlay(),Object(x.a)(Object(w.a)(t.prototype),"componentWillUnmount",this).call(this)}},{key:"componentWillReceiveProps",value:function(e){var t,a=this.state,n=!1;e.room.users&&(e.content?(t=e.room.users[e.content.userID],this.streamInfo.streamName=e.room.streamName):(t=e.room.users[e.room.streamUID],this.streamInfo.streamName=e.room.streamPlayback),t&&t.meta&&t.meta.connected&&t.sdate<t.meta.connectedUpdate&&(n=!0,this.streamInfo.userName=t.name));n!==a.available&&(this.setState({available:n}),n&&(a.connected||a.conecting||a.retrying||this.startStreamPlay()))}},{key:"timerStart",value:function(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),2e3),this.devMode&&console.log("components/Video timerStart")}},{key:"timerStop",value:function(){clearInterval(this.timer),this.devMode&&console.log("components/Video timerStop")}},{key:"timerTick",value:function(){var e=this;if(this.state.connected&&this.peerConnection){this.peerConnection.getReceivers().forEach(function(t){t.getStats().then(function(t){t.forEach(function(t){if("inbound-rtp"===t.type&&!t.isRemote){var a=t.kind;if(void 0===a&&(a=t.mediaType),"video"===a||"audio"===a){var n=t.timestamp-e.stats[a].timestamp;n>0&&n<5e3&&t.bytesReceived>=e.stats[a].bytesReceived&&(e.stats[a].bitrate=8*(t.bytesReceived-e.stats[a].bytesReceived)/n),e.stats[a].timestamp=t.timestamp,e.stats[a].bytesReceived=t.bytesReceived,e.stats[a].qualityLimitationReason=t.qualityLimitationReason}}})})});var t=o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{name:"wait"}),"Measuring...");(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(t=o.a.createElement("div",null,o.a.createElement(I.a,{name:"video camera"}),Math.round(this.stats.video.bitrate)," kbps ","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":""," ",this.remoteVideo.current.videoWidth,"x",this.remoteVideo.current.videoHeight,o.a.createElement(I.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps")),this.state.settingsActive&&this.setState({bitrateInfo:t})}}},{key:"render",value:function(){var e=this,t=this.state,a=this.props;this.devMode=a.appState.devMode;var n=t.videoWidth,i=t.videoHeight,s=0,r=0;t.width&&t.aspectRatio&&t.videoAspectRatio&&(t.videoAspectRatio>t.aspectRatio?(i=(n=t.width)/t.videoAspectRatio,r=(t.height-i)/2):(n=(i=t.height)*t.videoAspectRatio,s=(t.width-n)/2));var c={position:"absolute",left:s,top:r,width:n,height:i},l="";t.settingsActive&&(l=o.a.createElement("div",{className:"controlsTop"},o.a.createElement(F.a,null,o.a.createElement(q.a,{color:"black",pointing:"right"},t.statusInfo),o.a.createElement(W.a,{hidden:!0,vertical:!0}),o.a.createElement(R.a,{name:"reload",onClick:this.onClick.bind(this),loading:t.buttonDisabled,disabled:t.buttonDisabled,icon:!0,labelPosition:"right",inverted:!0},o.a.createElement(I.a,{name:"redo"}),t.buttonContent)),o.a.createElement(q.a,{color:"black"},t.connected?t.bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{name:"eye slash"}),"Not Streaming"))));var d=o.a.createElement(R.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Not Available","data-position":"bottom center"},o.a.createElement(I.a,{inverted:!0,color:"black",name:"eye slash"}));t.available&&(d=o.a.createElement(R.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Available","data-position":"bottom center"},o.a.createElement(I.a,{inverted:!0,color:"green",name:"eye"}))),t.connecting&&(d=o.a.createElement(R.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Connecting","data-position":"bottom center"},o.a.createElement(I.a,{inverted:!0,loading:!0,name:"spinner"}))),t.connected&&(d=o.a.createElement(R.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Streaming","data-position":"bottom center"},o.a.createElement(I.a,{inverted:!0,name:"eye"}))),t.connected&&!t.available&&(d=o.a.createElement(R.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Terminated","data-position":"bottom center"},o.a.createElement(I.a,{inverted:!0,color:"orange",name:"eye"})));var p=o.a.createElement(o.a.Fragment,null);return a.room.videoOffline&&(t.available||t.connected||(p=o.a.createElement("source",{src:a.room.videoOffline,type:"video/mp4"}))),o.a.createElement("div",{className:"panel",ref:function(t){return e.state.container=t}},o.a.createElement("div",{className:"backgroundVideo"},o.a.createElement("video",{style:c,id:"remoteVideo",poster:a.room.snapshot,ref:this.remoteVideo,className:"remoteVideo",muted:t.videoMuted,autoPlay:!0,loop:!0,playsInline:!0,controls:t.settingsActive,onLoadedData:this.onLoadedData,onLoadedMetadata:function(){return e.updateVideoSize("loadedmetadata")}},p)),o.a.createElement("div",{className:"controlsIcons"},d,o.a.createElement(R.a,{name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:t.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":"Toggle Controls","data-position":"bottom center"},o.a.createElement(I.a,{name:"setting"})),o.a.createElement(R.a,{name:"mute",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":t.videoMuted?"Enable Audio":"Mute","data-position":"bottom center"},o.a.createElement(I.a,{name:t.videoMuted?"volume off":"volume up"})," ",t.videoMutedMessage),o.a.createElement(R.a,{name:"fullscreen",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":"Fullscreen","data-position":"bottom center"},o.a.createElement(I.a,{name:"expand"}))),l)}},{key:"onClick",value:function(e,a){var n=a.name,o=a.value;if("reload"==n)switch(this.state.buttonContent){case"Tap to Play":this.remoteVideo.current.play(),this.state.connected?this.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:"Reload",videoMuted:"",videoMutedMessage:""}):this.state.connecting?this.setState({statusInfo:"Preview. Connecting...",videoMuted:"",videoMutedMessage:""}):this.setState({statusInfo:"Preview",buttonContent:"Reload",videoMuted:"",videoMutedMessage:""});break;case"Reload":this.stopStreamPlay(),this.setState({buttonDisabled:!0,buttonContent:"Reloading...",connecting:!0,connected:!1}),this.startStreamPlay()}if("fullscreen"==n){this.state.fullscreen;e.preventDefault(),this.requestFullscreen(this.remoteVideo.current)}"mute"==n&&(this.state.videoMuted&&(this.remoteVideo.current.muted=!1),this.setState({videoMuted:!this.state.videoMuted,videoMutedMessage:""})),Object(x.a)(Object(w.a)(t.prototype),"onClick",this).call(this,e,{name:n,value:o})}},{key:"requestFullscreen",value:function(e){var t=!0;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1),this.setState({fullscreen:t})}},{key:"wsConnect",value:function(){var e=this,t=this.props;this.streamInfo={applicationName:t.config.application,streamName:t.room.streamPlayback,sessionId:"[empty]"},this.userData={param1:"value1",videowhisper:"webrtc-playback"},this.wsConnection=new WebSocket(t.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsConnection.onmessage=this.onmessage.bind(this),this.wsConnection.onclose=function(){e.devMode&&console.log("components/Video wsConnection.onclose")},this.wsConnection.onerror=function(e){console.log("components/Video wsConnection.onerror: "+JSON.stringify(e))}}},{key:"peerCreateAnswer",value:function(){this.state;this.devMode&&console.log("components/Video peerCreateAnswer"),this.peerConnection.createAnswer().then(this.gotDescription.bind(this)).catch(this.errorHandler.bind(this))}},{key:"errorHandler",value:function(e){console.log(e)}},{key:"icecandidate",value:function(){var e=Object(V.a)(L.a.mark(function e(t,a){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.devMode&&console.log("components/Video icecandidate (gotIceCandidate):",a);try{this.onAddIceCandidateSuccess(t)}catch(n){this.onAddIceCandidateError(t,n)}case 2:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"onAddIceCandidateSuccess",value:function(e){this.devMode&&console.log("components/Video onAddIceCandidateSuccess success",e)}},{key:"onAddIceCandidateError",value:function(e,t){this.devMode&&console.log("components/Video onAddIceCandidateError failed to add ICE Candidate: ".concat(t))}},{key:"onsignalingstatechange",value:function(){var e;this.peerConnection&&(e=this.peerConnection.signalingState||this.peerConnection.readyState,this.devMode&&console.log("components/Video peerConnection state change callback, state: ".concat(e)))}},{key:"videoPlay",value:function(){var e=this,t=this.remoteVideo.current;t&&t.play().then(function(a){console.log("components/Video Autoplay started",a,t.paused,t.src),e.state.connected?e.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:"Reload",connecting:!1}):e.state.connecting?e.setState({statusInfo:"Preview. Connecting...",settingsActive:!0,buttonDisabled:!0,buttonContent:"Connecting"}):e.setState({statusInfo:"Preview",buttonDisabled:!1,buttonContent:"Reload"})},function(a){console.log("components/Video Autoplay reject:"+a,a,t.src),e.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:"Tap to Play",videoMuted:"",videoMutedMessage:""})}).catch(function(t){console.log("components/Video Autoplay error:"+t,t),e.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:"Tap to Play"})})}},{key:"iceconnectionstatechange",value:function(e,t){var a,n=this,o=this.remoteVideo.current,i=this.state;e&&(a=e.iceConnectionState,this.devMode&&console.log("components/Video iceconnectionstatechange: ".concat(e.iceConnectionState),t,o),"connected"==a&&(this.setState({connected:!0,connecting:!1}),this.videoPlay()),"disconnected"!=a&&"failed"!=a||(i.retrying||setTimeout(function(){i.retrying=!0,n.stopStreamPlay(),n.startStreamPlay(),n.setState({statusInfo:a,buttonDisabled:!0,buttonContent:"Auto Retry"})},2e3),this.setState({settingsActive:!0,connected:!1,connecting:!1})))}},{key:"track",value:function(e){this.state;var t=this.remoteVideo.current;this.devMode&&console.log("components/Video track (gotRemoteTrack) kind:"+e.track.kind+" stream:"+e.streams[0]),t.srcObject!==e.streams[0]&&(t.srcObject=e.streams[0],console.log("components/Video playback peer received remote stream"))}},{key:"sendPlayGetOffer",value:function(){console.log("components/Video sendPlayGetOffer: "+JSON.stringify(this.streamInfo),this.wsConnection.readyState),this.wsConnection&&1===this.wsConnection.readyState&&this.wsConnection.send('{"direction":"play", "command":"getOffer", "streamInfo":'+JSON.stringify(this.streamInfo)+', "userData":'+JSON.stringify(this.userData)+"}")}},{key:"startStreamPlay",value:function(){console.log("components/Video startStreamPlay"),this.state.retryCount=0,this.wsConnect(),this.timerStart()}},{key:"stopStreamPlay",value:function(){this.devMode&&console.log("components/Video stopStreamPlay"),this.timerStop();var e=this.remoteVideo.current,t=this.props;null!=this.peerConnection&&this.peerConnection.close(),this.peerConnection=null,null!=this.wsConnection&&this.wsConnection.close(),this.wsConnection=null,e&&(e.src==t.room.videoOffline&&t.room.videoOffline||(e.src="")),this.setState({buttonDisabled:!1,buttonContent:"Reload",connecting:!1,connected:!1})}},{key:"gotDescription",value:function(e){var t=this;this.peerConnection.setLocalDescription(e).then(function(){t.wsConnection.send('{"direction":"play", "command":"sendResponse", "streamInfo":'+JSON.stringify(t.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(t.userData)+"}")}).catch(function(e){console.log("components/Video gotDescription, setLocalDescription error",e)})}}]),t}(B);z.propTypes={config:H.a.object.isRequired,room:H.a.object.isRequired,appState:H.a.object.isRequired,content:H.a.object};var _=a(52),G=a(470),J=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e)))._isMounted=!1,a.bitrateOptions=function(e){var t=[];t.push({key:"bitrate-title",text:o.a.createElement("span",null,o.a.createElement("strong",null,"Video Bitrate")," ",a.state.maxBitrate?" <"+a.state.maxBitrate+"kbps":""),disabled:!0});var n=a.state.maxBitrate,i=!1;return[{value:.35,label:"Very Low"},{value:.5,label:"Low"},{value:.75,label:"Medium"},{value:1,label:"Good"},{value:1.25,label:"High"},{value:1.5,label:"Very High"}].forEach(function(a){var o=Math.round(a.value*e);o===n&&(i=!0),o<=n&&t.push({key:o,value:o,text:o+" kbps "+a.label})}),(0===t.length||!i&&1.5*e>n)&&t.push({key:n,value:n,text:n+" kbps Limit"}),t},a.onopen=function(e){var t=this;this.devMode&&console.log("components/Camera wsConnection.onopen ",this.wsConnection.readyState,e,this.state),1==this.wsConnection.readyState&&(this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.onicecandidate=this.onicecandidate,this.peerConnection.onsignalingstatechange=this.onsignalingstatechange.bind(this),this.peerConnection.oniceconnectionstatechange=this.oniceconnectionstatechange.bind(this),this.localStream.getTracks().forEach(function(e){return t.peerConnection.addTrack(e,t.localStream)}),this.peerConnection.createOffer(this.offerOptions).then(this.gotDescription.bind(this),this.errorHandler))},a.onmessage=function(e){var t=this;this.devMode&&console.log("components/Camera wsConnection.onmessage",e);this.state;var a=JSON.parse(e.data),n=Number(a.status);a.command;if(200!=n)console.log("components/Camera onmessage error sdp:",a.statusDescription),this.stopPublisher(),this.setState({buttonDisabled:!1,buttonContent:"Broadcast",statusInfo:a.statusDescription,connecting:!1,connected:!1});else{var o=a.sdp;void 0!==o&&(this.devMode&&console.log("components/Camera onmessage sdp:",a.sdp),this.peerConnection.setRemoteDescription(o).then(function(){}).catch(this.errorHandler.bind(this)));var i=a.iceCandidates;if(this.devMode&&console.log("components/Camera msgJSON iceCandidates: ",i),void 0!==i)for(var s in i)this.devMode&&console.log("components/Camera iceCandidates: "+i[s]),this.peerConnection.addIceCandidate(new RTCIceCandidate(i[s])).then(function(){return t.onAddIceCandidateSuccess(t.peerConnection)},function(e){return t.onAddIceCandidateError(t.peerConnection,e)})}},a.setMediaBitrateSDP=function(e,t,a){var n="AS",o=!1;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(o=!0),o&&(a=1e3*(a>>>0),n="TIAS");for(var i=e.split("\n"),s=-1,r=0;r<i.length;r++)if(0===i[r].indexOf("m="+t)){s=r;break}if(-1===s)return e;for(s++;0===i[s].indexOf("i=")||0===i[s].indexOf("c=");)s++;if(0===i[s].indexOf("b"))return i[s]="b="+n+":"+a,i.join("\n");var c=i.slice(0,s);return c.push("b="+n+":"+a),(c=c.concat(i.slice(s,i.length))).join("\n")},a.devMode=e.appState.devMode,a.devMode&&console.log("components/Camera constructor",e),a.wsConnection=null,a.peerConnection=null,a.peerConnectionConfig={iceServers:[]},a.localStream=null,a.streamInfo=null,a.userData=null,a.SDPOutput={},a.offerOptions={offerToReceiveAudio:1,offerToReceiveVideo:1},a.localVideo=o.a.createRef(),a.stats={video:{timestamp:0,bandwidth:0},audio:{timestamp:0,bandwidth:0}},a.videoIndex=-1,a.audioIndex=-1,a.changedBy="",a.enhanceData={},a.resolutions={"4K":{label:"4K",width:3840,height:2160,ratio:"16:9",bitrate:18e3},"1440p":{label:"1440p",width:2560,height:1440,ratio:"16:9",bitrate:9e3},"1080p":{label:"1080p",width:1920,height:1080,ratio:"16:9",bitrate:3e3},"720p":{label:"720p",width:1280,height:720,ratio:"16:9",bitrate:1800},SVGA:{label:"SVGA",width:800,height:600,ratio:"4:3",bitrate:800},"480p":{label:"480p",width:858,height:480,ratio:"16:9",bitrate:750},VGA:{label:"VGA",width:640,height:480,ratio:"4:3",bitrate:600},"360p":{label:"360p",width:640,height:360,ratio:"16:9",bitrate:500},"240p":{label:"240p",width:426,height:240,ratio:"16:9",bitrate:350},CIF:{label:"CIF",width:352,height:288,ratio:"4:3",bitrate:320},QVGA:{label:"QVGA",width:320,height:240,ratio:"4:3",bitrate:280},"180p":{label:"180p",width:320,height:180,ratio:"16:9",bitrate:240},"90p":{label:"90p",width:160,height:90,ratio:"16:9",bitrate:100}},a.state={tapRequired:!1,connected:!1,connecting:!1,settingsActive:!1,statusInfo:"Connecting...",buttonContent:"Connecting",buttonDisabled:!0,bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{name:"eye slash"}),"Not Broadcasting"),videoWidth:640,videoHeight:360,videoAspectRatio:1.77,camera:null,cameraOptions:[],videoSource:null,microphone:null,microphoneOptions:[],audioSource:null,maxBitrate:750,maxResolutionHeight:480,bitrate:600,bitrateOptions:[],resolution:"360p",resolutionOptions:[]},a.onChange=a.onChange.bind(Object(D.a)(Object(D.a)(a))),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this._isMounted=!0,Object(x.a)(Object(w.a)(t.prototype),"componentDidMount",this).call(this),this.interfaceReady()}},{key:"componentWillUnmount",value:function(){this._isMounted=!1,this.stopPublisher();this.state;this.localStream&&this.localStream.getTracks().forEach(function(e){return e.stop()}),Object(x.a)(Object(w.a)(t.prototype),"componentWillUnmount",this).call(this)}},{key:"timerStart",value:function(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),2e3)}},{key:"timerStop",value:function(){clearInterval(this.timer)}},{key:"timerTick",value:function(){var e=this;if(this.state.connected&&this.peerConnection){this.peerConnection.getSenders().forEach(function(t){t.getStats().then(function(t){t.forEach(function(t){if("outbound-rtp"===t.type&&!t.isRemote){var a=t.kind;if(void 0===a&&(a=t.mediaType),"video"===a||"audio"===a){var n=t.timestamp-e.stats[a].timestamp;n>0&&n<5e3&&t.bytesSent>=e.stats[a].bytesSent&&(e.stats[a].bitrate=8*(t.bytesSent-e.stats[a].bytesSent)/n),e.stats[a].timestamp=t.timestamp,e.stats[a].bytesSent=t.bytesSent,e.stats[a].qualityLimitationReason=t.qualityLimitationReason}}})})});var t=o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{name:"wait"}),"Measuring...");(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(t=o.a.createElement("div",null,o.a.createElement(I.a,{name:"video camera"}),Math.round(this.stats.video.bitrate)," kbps ","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":""," ",this.state.videoWidth,"x",this.state.videoHeight,o.a.createElement(I.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps")),this.state.settingsActive&&this.setState({bitrateInfo:t})}}},{key:"render",value:function(){var e,t,a=this,n=this.state,i=this.props,s=this.onChange;this.devMode=i.appState.devMode;var r=n.videoWidth,c=n.videoHeight,l=0,d=0;n.width&&n.aspectRatio&&n.videoAspectRatio&&(n.videoAspectRatio>n.aspectRatio?(c=(r=n.width)/n.videoAspectRatio,d=(n.height-c)/2):(r=(c=n.height)*n.videoAspectRatio,l=(n.width-r)/2));var p={position:"absolute",left:l,top:d,width:r,height:c},m="";n.tapRequired&&(m=o.a.createElement(F.a.Field,null,o.a.createElement(R.a,{inverted:!0,name:"tap",content:"Tap to Show",onClick:this.onClick.bind(this)}),o.a.createElement(q.a,{pointing:"left",color:"black"},"Gesture is required to show preview")));var u="";n.settingsActive&&(u=o.a.createElement("div",{className:"controlsBottom"},o.a.createElement(F.a.Field,null,o.a.createElement(G.a,(e={name:"camera",value:n.camera,onChange:s,placeholder:"Camera",selection:!0},Object(_.a)(e,"onChange",this.onChange),Object(_.a)(e,"options",n.cameraOptions),e))),o.a.createElement(F.a.Field,null,o.a.createElement(G.a,(t={name:"microphone",value:n.microphone,onChange:s,placeholder:"Microphone",selection:!0},Object(_.a)(t,"onChange",this.onChange),Object(_.a)(t,"options",n.microphoneOptions),t))),o.a.createElement(F.a.Field,null,o.a.createElement(G.a,{name:"resolution",value:n.resolution,onChange:s,placeholder:"Video Resolution",selection:!0,options:n.resolutionOptions})),o.a.createElement(F.a.Field,null,o.a.createElement(G.a,{name:"bitrate",value:n.bitrate,onChange:s,placeholder:"Video Bitrate",selection:!0,options:n.bitrateOptions})),o.a.createElement(F.a.Field,null,o.a.createElement(R.a,{inverted:!0,name:"broadcast",content:n.buttonContent,onClick:this.onClick.bind(this),disabled:n.buttonDisabled}),o.a.createElement(q.a,{pointing:"left",color:"black"},n.statusInfo)),m,o.a.createElement(q.a,{color:"black"},n.connected?n.bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{name:"eye slash"}),"Not Broadcasting"))));var h=o.a.createElement(I.a,{inverted:!0,color:"black",name:"eye slash",size:"large"});return n.connecting&&(h=o.a.createElement(I.a,{inverted:!0,loading:!0,name:"spinner",size:"large"})),n.connected&&(h=o.a.createElement(I.a,{inverted:!0,name:"eye",size:"large"})),o.a.createElement("div",{className:"panel",ref:function(e){return a.state.container=e}},o.a.createElement("div",{className:"backgroundVideo"},o.a.createElement("video",{style:p,id:"localVideo",ref:this.localVideo,className:"localVideo",autoPlay:!0,playsInline:!0,muted:!0,onLoadedMetadata:function(){a.updateVideoSize("loadedmetadata"),a.videoPlay()}})),o.a.createElement("div",{className:"controlsIcons"},h,o.a.createElement(R.a,{name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:n.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":"Toggle Controls","data-position":"bottom center"},o.a.createElement(I.a,{name:"settings"}))),u)}},{key:"onChange",value:function(e,t){var a=t.name,n=t.value;this.setState(Object(_.a)({},a,n)),this.changedBy=a,this.devMode&&console.log("components/Camera onChange",a,n,e),navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this))}},{key:"onClick",value:function(e,a){var n=a.name,o=a.value;if(this.devMode&&console.log("components/Camera onClick",n,o,e),"tap"===n&&this.videoPlay(),"broadcast"===n)switch(this.state.buttonContent){case"Broadcast":this.setState({buttonDisabled:!0,buttonContent:"Starting Broadcast...",connecting:!0,connected:!1}),this.buildStream();break;case"Stop Broadcast":this.setState({buttonDisabled:!0,buttonContent:"Ending..."}),this.stopPublisher(),this.setState({buttonDisabled:!1,buttonContent:"Broadcast",statusInfo:"Stopped Broadcast",connecting:!1,connected:!1})}Object(x.a)(Object(w.a)(t.prototype),"onClick",this).call(this,e,{name:n,value:o})}},{key:"interfaceReady",value:function(){this.state;var e=this.props;this.props.serverUpdate({task:"media",connected:!1});var t=Number(e.config.videoBitrate);t||(t=0);var a=Number(e.config.maxResolutionHeight);a||(a=0),(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&(a>480&&(a=480),a||(a=480),t>750&&(t=750),t||(t=750)),this.state.maxBitrate=t,this.state.maxResolutionHeight=a;var n=[{key:"res-title",text:o.a.createElement("span",null,o.a.createElement("strong",null,"Video Resolution"),this.state.maxResolutionHeight?" <"+this.state.maxResolutionHeight+"p":""),disabled:!0}];if(this.resolutions)for(var i in this.resolutions)(0===t||.35*this.resolutions[i].bitrate<=t)&&(0===a||this.resolutions[i].height<=a)&&n.push({key:i,value:i,text:this.resolutions[i].label+" "+this.resolutions[i].width+"x"+this.resolutions[i].height+" "+this.resolutions[i].ratio});this.setState({resolutionOptions:n,resolution:"360p",bitrateOptions:this.bitrateOptions(600),maxBitrate:t,bitrate:600,settingsActive:"1"==this.props.config.cameraControls});var s=this.props.config.cameraAutoBroadcast;this.state;if(!navigator.mediaDevices)return this.devMode&&console.log("components/Camera interfaceReady navigator.mediaDevices",navigator.mediaDevices),void this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:"Broadcast",statusInfo:"Navigator media devices not available!",connecting:!1,connected:!1});"1"==s?(navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this)),this.setState({statusInfo:"Connecting...",connecting:!0,connected:!1})):(navigator.mediaDevices.enumerateDevices().then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)),this.setState({buttonDisabled:!1,buttonContent:"Broadcast",statusInfo:"Make a selection to start!",connecting:!1,connected:!1})),this.devMode&&console.log("components/Camera interfaceReady ",t,a)}},{key:"videoPlay",value:function(){var e=this,t=this.localVideo.current,a=this.state,n=!1,o=t.play();void 0!==o&&o.catch(function(t){n=!0,console.log("components/Camera Auto play error:"+t,t),e.setState({tapRequired:!0,settingsActive:!0})}).then(function(){n||(e.setState({tapRequired:!1}),a.connected&&e.setState({settingsActive:!1}))})}},{key:"buildStream",value:function(){var e=this.state;for(var t in window.stream&&window.stream.getTracks().forEach(function(e){e.stop()}),this.localVideo.current.srcObject=null,this.resolutions)t==e.resolution&&(e.videoWidth=this.resolutions[t].width,e.videoHeight=this.resolutions[t].height,"bitrate"!==this.changedBy&&(0===e.maxBitrate||this.resolutions[t].bitrate<=e.maxBitrate?e.bitrate=this.resolutions[t].bitrate:e.bitrate=e.maxBitrate),e.bitrateOptions=this.bitrateOptions(this.resolutions[t].bitrate));var a={};"_disabled"!=e.audioSource?a.audio={deviceId:e.audioSource?{exact:e.audioSource}:void 0}:a.audio=!1,"_disabled"!=e.videoSource?a.video={deviceId:e.videoSource?{exact:e.videoSource}:void 0,width:{ideal:e.videoWidth},height:{ideal:e.videoHeight}}:a.video=!1,"_disabled"!=e.audioSource||"_disabled"!=e.videoSource?navigator.mediaDevices.getUserMedia(a).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)):console.log("Camera/buildStream NO SOURCE",e.videoSource,e.audioSource),this.devMode&&console.log("components/Camera /buildStream videoSource: ",e.videoSource,"  newAPI: ",a)}},{key:"handleError",value:function(e){console.log("components/Camera navigator.mediaDevices handleError: ",e);var t="";switch(e.name){case"OverconstrainedError":t=" ("+e.constraint+")"}this.setState({settingsActive:!0,statusInfo:"Media Error: "+e.name+t,buttonDisabled:!1,buttonContent:"Broadcast",connecting:!1,connected:!1})}},{key:"gotStream",value:function(e){return this.localVideo.current.srcObject=e,this.devMode&&console.log("components/Camera after getUserMedia",e),this.localStream=e,null!=this.localStream&&this.stopPublisher(),this.startPublisher(),navigator.mediaDevices.enumerateDevices()}},{key:"startPublisher",value:function(){this.devMode&&console.log("components/Camera startPublisher",this.props),this.wsConnect(),this.timerStart()}},{key:"stopPublisher",value:function(){this.timerStop(),null!=this.peerConnection&&this.peerConnection.close(),this.peerConnection=null,null!=this.wsConnection&&this.wsConnection.close(),this.wsConnection=null,this.devMode&&console.log("stopPublisher")}},{key:"gotDevices",value:function(e){for(var t=this.state,a=[{key:"cam-title",text:o.a.createElement("span",null,"Select ",o.a.createElement("strong",null,"Camera"),":"),disabled:!0},{text:"No Camera",value:"_disabled"}],n=[{key:"mic-title",text:o.a.createElement("span",null,"Select ",o.a.createElement("strong",null,"Microphone"),":"),disabled:!0}],i=!1,s=!1,r=0;r!==e.length;++r){var c=e[r],l={value:c.deviceId};"audioinput"===c.kind?(l.text=c.label||"microphone ".concat(n.length+1),n.push(l),t.microphone||(t.microphone=c.deviceId),c.deviceId===t.microphone&&(s=!0)):"videoinput"===c.kind&&(l.text=c.label||"camera ".concat(a.length+1),a.push(l),t.camera||(t.camera=c.deviceId),c.deviceId===t.camera&&(i=!0))}(i||"_disabled"===t.camera)&&(t.videoSource=t.camera),(s||"_disabled"===t.microphone)&&(t.audioSource=t.microphone),t.camera===t.videoSource&&t.microphone===t.audioSource||i&&s||(this.devMode&&console.log("components/Camera gotDevices: deviceID changed videoValid:"+t.camera+" videoSelected: "+t.microphone+" audioValid:"+s),this.setState({settingsActive:!0,statusInfo:"Media DeviceID changed: Please select again!",buttonDisabled:!1,buttonContent:"Broadcast"})),this.devMode&&console.log("gotDevices: verified videoSource: "+t.videoSource+" changed videoValid: "+i),this._isMounted&&this.setState({cameraOptions:a,microphoneOptions:n})}},{key:"gotDevicesPublish",value:function(e){this.gotDevices(e),this.buildStream()}},{key:"updateVideoSize",value:function(e){var t,a=this.localVideo.current,n=this.state;a.videoHeight&&(n.videoWidth===a.videoWidth&&n.videoHeight===a.videoHeight||(n.videoWidth=a.videoWidth,n.videoHeight=a.videoHeight,n.videoHeight||(n.videoHeight=1)),t=a.videoWidth/a.videoHeight,n.videoAspectRatio!==t&&this.setState({videoAspectRatio:t}))}},{key:"wsConnect",value:function(){var e=this.props,t=(this.state,this.localStream.getVideoTracks()),a=this.localStream.getAudioTracks();t.length>0&&this.devMode&&console.log("components/Camera wsConnect Using Video device: ".concat(t[0].label)),a.length>0&&this.devMode&&console.log("components/Camera wsConnect Using Audio device: ".concat(a[0].label)),this.streamInfo={applicationName:e.config.application,streamName:e.room.streamBroadcast,sessionId:"[empty]"},this.userData={param1:"value1",videowhisper:"webrtc-broadcast"},this.devMode&&console.log("components/Camera wsConnect",this.streamInfo,this.userData,this.props,this.state),this.wsConnection=new WebSocket(e.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsConnection.onmessage=this.onmessage.bind(this),this.wsConnection.onclose=function(){this.devMode&&console.log("components/Camera wsConnection.onclose")},this.wsConnection.onerror=function(e){console.log("components/Camera wsConnection.onerror: ",e)}}},{key:"onAddIceCandidateSuccess",value:function(e){this.devMode&&console.log("components/Camera AddIceCandidate success.",e)}},{key:"onAddIceCandidateError",value:function(e){console.log("components/Camera Failed to add Ice Candidate: ".concat(e.toString()))}},{key:"gotDescription",value:function(e){var t=this,a=this.props,n=this.state;this.devMode&&console.log("components/Camera gotDescription: original",e),this.enhanceData={},void 0!==a.config.audioBitrate&&(this.enhanceData.audioBitrate=Number(a.config.audioBitrate)),void 0!==n.bitrate&&(this.enhanceData.videoBitrate=Number(n.bitrate)),void 0!==a.videoFrameRate&&(this.enhanceData.videoFrameRate=Number(a.videoFrameRate)),e.sdp=this.enhanceSDP(e.sdp,this.enhanceData),this.peerConnection||console.log("gotDescription: Error no this.peerConnection",n),this.peerConnection.setLocalDescription(e).then(function(){t.wsConnection.send('{"direction":"publish", "command":"sendOffer", "streamInfo":'+JSON.stringify(t.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(t.userData)+"}")}).catch(function(e){console.log("components/Camera gotDescription, setLocalDescription error",e),t.setState({statusInfo:"Stream setup error: Retry!",settingsActive:!0,buttonDisabled:!1,buttonContent:"Broadcast",connecting:!1,connected:!1})})}},{key:"addAudio",value:function(e,t){var a=e.split(/\r\n/),n="",o=!1;for(var i in a){var s=a[i];s.length<=0||(n+=s,n+="\r\n",0=="a=rtcp-mux".localeCompare(s)&&0==o&&(n+=t,o=!0))}return n}},{key:"addVideo",value:function(e,t){var a=e.split(/\r\n/),n="",o=!1,i=!1;for(var s in a){(r=a[s]).length<=0||(r.includes("a=rtcp-rsize")&&(i=!0),r.includes("a=rtcp-mux")&&!0)}for(var s in a){var r;n+=r=a[s],n+="\r\n",0=="a=rtcp-rsize".localeCompare(r)&&0==o&&1==i&&(n+=t,o=!0),0=="a=rtcp-mux".localeCompare(r)&&1==o&&0==i&&(n+=t,o=!0),0=="a=rtcp-mux".localeCompare(r)&&0==o&&0==i&&(o=!0)}return n}},{key:"enhanceSDP",value:function(e,t){var a,n=this.props.config,o=e.split(/\r\n/),i="header",s=!1,r="";if(!e.includes("THIS_IS_SDPARTA")||n.videoCodec.includes("VP9")){for(var c in o){if(!((p=o[c]).length<=0))this.checkLine(p)&&(r+=p,r+="\r\n")}r=this.addAudio(r,this.deliverCheckLine(n.audioCodec,"audio")),o=(e=r=this.addVideo(r,this.deliverCheckLine(n.videoCodec,"video"))).split(/\r\n/),r=""}var l=!1,d=!1;for(var c in o){var p;if(!((p=o[c]).length<=0))if(0!=p.indexOf("m=audio")||-1==this.audioindex)if(0!=p.indexOf("m=video")||-1==this.videoIndex){if(r+=p,0===p.indexOf("m=audio")?(i="audio",s=!1):0===p.indexOf("m=video")?(i="video",s=!1):0==p.indexOf("a=rtpmap")&&(i="bandwidth",s=!1),(0===p.indexOf("a=mid:")||0==p.indexOf("a=rtpmap"))&&!s)if(0=="audio".localeCompare(i))void 0!==t.audioBitrate&&(r+="\r\nb=CT:"+t.audioBitrate,r+="\r\nb=AS:"+t.audioBitrate),s=!0;else if(0=="video".localeCompare(i))void 0!==t.videoBitrate&&(r+="\r\nb=CT:"+t.videoBitrate,r+="\r\nb=AS:"+t.videoBitrate,void 0!==t.videoFrameRate&&(r+="\r\na=framerate:"+t.videoFrameRate)),s=!0;else if(0=="bandwidth".localeCompare(i)){var m;if(null!==(m=this.getrtpMapID(p))){var u=m[2].toLowerCase();0!="vp9".localeCompare(u)&&0!="vp8".localeCompare(u)&&0!="h264".localeCompare(u)&&0!="red".localeCompare(u)&&0!="ulpfec".localeCompare(u)&&0!="rtx".localeCompare(u)||void 0===t.videoBitrate||l||(r+="\r\na=fmtp:"+m[1]+" x-google-min-bitrate=64;x-google-start-bitrate="+t.videoBitrate+";x-google-max-bitrate="+t.videoBitrate,l=!0),0!="opus".localeCompare(u)&&0!="isac".localeCompare(u)&&0!="g722".localeCompare(u)&&0!="pcmu".localeCompare(u)&&0!="pcma".localeCompare(u)&&0!="cn".localeCompare(u)||void 0===t.audioBitrate||d||(r+="\r\na=fmtp:"+m[1]+" x-google-min-bitrate=16;x-google-start-bitrate="+t.audioBitrate+";x-google-max-bitrate="+t.audioBitrate,d=!0)}}r+="\r\n"}else r+=(a=p.split(" "))[0]+" "+a[1]+" "+a[2]+" "+this.videoIndex+"\r\n";else r+=(a=p.split(" "))[0]+" "+a[1]+" "+a[2]+" "+this.audioindex+"\r\n"}return void 0!==t.videoBitrate&&t.videoBitrate>0&&(r=this.setMediaBitrateSDP(r,"video",t.videoBitrate)),void 0!==t.audioBitrate&&t.audioBitrate>0&&(r=this.setMediaBitrateSDP(r,"audio",t.audioBitrate)),this.devMode&&console.log("components/Camera Resulting SDP: ",t.videoBitrate,t.audioBitrate," "+r),r}},{key:"deliverCheckLine",value:function(e,t){var a="";for(var n in this.SDPOutput){var o=this.SDPOutput[n];if(a+=n,o.includes(e)){if(e.includes("VP9")||e.includes("VP8")){var i="",s=o.split(/\r\n/);for(var r in s){var c=s[r];-1===c.indexOf("transport-cc")&&-1===c.indexOf("goog-remb")&&-1===c.indexOf("nack")&&(i+=c,i+="\r\n")}return t.includes("audio")&&(this.audioindex=n),t.includes("video")&&(this.videoIndex=n),i}return t.includes("audio")&&(this.audioindex=n),t.includes("video")&&(this.videoIndex=n),o}}return a}},{key:"checkLine",value:function(e){if(e.startsWith("a=rtpmap")||e.startsWith("a=rtcp-fb")||e.startsWith("a=fmtp")){var t=e.split(":");if(t.length>1){var a=t[1].split(" ");if(!isNaN(a[0])&&!a[1].startsWith("http")&&!a[1].startsWith("ur")){var n=this.SDPOutput[a[0]];return n||(n=""),n+=e+"\r\n",this.SDPOutput[a[0]]=n,!1}}}return!0}},{key:"getrtpMapID",value:function(e){var t=new RegExp("a=rtpmap:(\\d+) (\\w+)/(\\d+)"),a=e.match(t);return a&&a.length>=3?a:null}},{key:"errorHandler",value:function(e){this.devMode&&console.log("components/Camera ",e)}},{key:"onicecandidate",value:function(e){null!=e.candidate&&this.devMode&&console.log("components/Camera gotIceCandidate: "+JSON.stringify({ice:e.candidate}))}},{key:"onsignalingstatechange",value:function(){var e;this.peerConnection&&(e=this.peerConnection.signalingState||this.peerConnection.readyState,this.devMode&&console.log("components/Camera peerConnection state change callback, state: ".concat(e)),this.setState({statusInfo:"Peer connection signaling: "+e}))}},{key:"oniceconnectionstatechange",value:function(){var e,t=this,a=this.props;this.peerConnection&&(e=this.peerConnection.iceConnectionState,this.devMode&&console.log("components/Camera peerConnection ICE connection state change: ".concat(e)),this.setState({statusInfo:"Peer connection state: "+e}),"completed"!==e&&"connected"!==e||(this.setState({settingsActive:!1,buttonDisabled:!1,buttonContent:"Stop Broadcast",connecting:!1,connected:!0,bitrateInfo:o.a.createElement(I.a,{name:"clock"})}),a.serverUpdate({task:"media",connected:!0}),this.peerConnection&&this.peerConnection.getSenders().forEach(function(e){if(e.track){var a=e.getParameters();a.encodings||(a.encodings=[{}]),"audio"==e.track.kind&&t.enhanceData.audioBitrate&&(a.encodings[0].maxBitrate=1e3*t.enhanceData.audioBitrate),"video"==e.track.kind&&t.enhanceData.videoBitrate&&(a.encodings[0].maxBitrate=1e3*t.enhanceData.videoBitrate),e.setParameters(a),t.devMode&&console.log("components/Camera oniceconnectionstatechange ",e.track.kind,a)}})),"failed"!==e&&"disconnected"!==e&&"closed"!==e||(this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:"Broadcast",connecting:!1,connected:!1,bitrateInfo:o.a.createElement(I.a,{name:"eye slash"})}),a.serverUpdate({task:"media",connected:!1})))}}]),t}(B);J.propTypes={appState:H.a.object.isRequired,config:H.a.object.isRequired,room:H.a.object.isRequired,serverUpdate:H.a.func.isRequired};var K=a(466),Q=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).onSubmit=function(e){if(e.preventDefault(),a.devMode&&console.log("ChatInput onSubmit",a.state),a.state){var t=a.state.message;if(0!==t.length){switch(t){case"/vws dev":a.props.appStateUpdate({devMode:!0}),console.log("components/ChatInput devMode Enabled",a.state)}var n={userID:a.props.user.ID,userName:a.props.user.name,userAvatar:a.props.user.avatar,notification:!1,text:t,time:(new Date).valueOf(),ID:(new Date).valueOf()};a.props.sendMessage(n),a.setState({message:""})}}},a.devMode=e.appState.devMode,a.state={message:"",container:null},a.onChange=a.onChange.bind(Object(D.a)(Object(D.a)(a))),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){}},{key:"onChange",value:function(e){var t=e.target,a="checkbox"===t.type?t.checked:t.value,n=t.name;this.setState(Object(_.a)({},n,a))}},{key:"render",value:function(){var e=this,t=this.props,a=this.onSubmit,n=this.state,i=this.onChange;return o.a.createElement("div",{className:"panel",style:{backgroundColor:t.appState.backgroundColor},ref:function(t){return e.state.container=t}},o.a.createElement("div",{className:"controlsBottom"},o.a.createElement(F.a,{onSubmit:a,className:t.appState.className},o.a.createElement(K.a,{size:"small",fluid:!0,label:t.user.name,action:"Submit",focus:!0,name:"message",value:n.message,onChange:i,type:"text",placeholder:"Type your message"}))))}}]),t}(n.Component),Y=a(251),Z=function(e){function t(){return Object(k.a)(this,t),Object(M.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props.message,t=e.userID===this.props.userID,a=e.notification,n=this.props.previousUser===e.userID,i=e.time-this.props.previousTime<6e4,s=e.userAvatar?o.a.createElement(Y.a,{src:e.userAvatar,avatar:!0,verticalAlign:"top"}):"",r=new Date(e.time),c=r.toLocaleDateString()+" at "+r.toLocaleTimeString(),l="chatMessage "+(a?"notification":"user")+" "+(t?"own ":"")+(e.automated?"automated":""),d=n||a?"":o.a.createElement("strong",null," ",s," ",e.userName," (",e.userID,")"),p=n&&i?"":o.a.createElement("i",null,c),m=d||p?o.a.createElement(o.a.Fragment,null,d," ",p,":",o.a.createElement("br",null)):"",u="";return e.image&&(u=o.a.createElement(Y.a,{src:e.image,size:"mini",rounded:!0,verticalAlign:"middle"})),o.a.createElement("li",{className:l,key:e.ID},m,u,o.a.createElement("label",null,e.text.split("\n").map(function(e,t){return o.a.createElement("div",{key:t},e)})))}}]),t}(n.Component),X=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).onScroll=function(){Object(D.a)(Object(D.a)(a)).refs.messageList.scrollTop},a.scrollToBottom=function(){var e=a.refs.messageList,t=e.scrollHeight-e.clientHeight;s.a.findDOMNode(e).scrollTop=t>0?t:0},a.devMode=e.appState.devMode,a.state={container:null},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e,t=this,a=this.props,n=this.onScroll,i=0,s=0;return e=a.messages.length>0?o.a.createElement("ul",{className:"chatMessageList",ref:"messageList",onScroll:n},a.messages.map(function(e){var t=o.a.createElement(Z,{userID:a.user.ID,message:e,key:e.ID,previousUser:i,previousTime:s});return i=e.userID,s=e.time,t})):o.a.createElement("ul",{className:"chatMessageList",ref:"messageList",onScroll:n},o.a.createElement("li",{className:"chatMessage",key:"0"},o.a.createElement("span",null,"No Messages."))),o.a.createElement("div",{className:"panel",style:{backgroundColor:a.appState.backgroundColor},ref:function(e){return t.state.container=e}},o.a.createElement("div",{className:"controls"},e))}}]),t}(n.Component),$=a(476),ee=a(477),te=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).privateModalClose=function(){return a.setState({privateModalShow:!1})},a.fullscreenModalClose=function(){return a.setState({fullscreenRecommended:!0})},a.handleFullscreenChange=function(e){var t=!1;(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(t=!0),a.setState({fullscreen:t})},a.toHHMMSS=function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),n=e-3600*t-60*a;return t<10&&(t="0"+t),a<10&&(a="0"+a),n<10&&(n="0"+n),t+":"+a+":"+n},a.state={fullpage:!1,fullscreenRecommended:!1,fullscreen:!1,tipsOpen:!1,privateModalShow:!1,privateLoading:!1,requestModalShow:!1,requestDetails:"Details for request modal: No action meta info!",requestAction:{ID:0},displayTime:"00:00"},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"updateTime",value:function(e){this.setState({displayTime:this.toHHMMSS(Math.floor(e/1e3))})}},{key:"onClick",value:function(e,t){var a=t.name,n=t.value;console.log("components/Actions onClick",a,n,e);var o,i=this.state,s=this.props;switch(a){case"fullpage":this.state.fullpage=!i.fullpage,this.setState({fullpage:this.state.fullpage}),this.fullpage();break;case"darkMode":s.appStateUpdate({darkMode:!s.appState.darkMode});break;case"fullscreenRecommended":s.config.actionFullpage&&(this.setState({fullpage:!0}),this.fullpage());case"fullscreen":if(this.state.fullscreenRecommended=!0,i.fullscreen)this.exitFullscreen();else{var r=document.getElementById("videowhisperVideochat");this.requestFullscreen(r)}break;case"tip":if("undefined"===typeof n)break;var c=parseInt(n);if(s.room.tips&&s.room.tipOptions.length>0&&s.room.tipOptions.length>c){var l=s.room.tipOptions[c];s.serverUpdate({task:"tip",tip:l,tipsURL:s.room.tipsURL,targetID:s.room.performerID}),this.setState({tipsOpen:!1}),console.log("components/Actions sending tip",l,c)}break;case"next":s.serverUpdate({task:"next",targetID:s.room.performerID});break;case"private":this.setState({privateModalShow:!0});break;case"privateClose":o={action:"privateRequest",ID:s.room.actionID,privateUID:s.room.privateUID,status:7},s.serverUpdate({task:"interaction-close",interaction:o});break;case"privateRequest":this.setState({privateLoading:!0,privateModalShow:!1});var d={userName:s.user.name};o={action:"privateRequest",userID:s.user.ID,roomID:s.room.ID,targetID:s.room.performerID,meta:d},s.serverUpdate({task:"interaction",interaction:o});break;case"declineRequest":this.setState({requestModalShow:!1}),o={ID:i.requestAction.ID,answer:0,status:2},s.serverUpdate({task:"interaction-answer",interaction:o});break;case"acceptRequest":this.setState({requestModalShow:!1}),o={ID:i.requestAction.ID,answer:1,status:2},s.serverUpdate({task:"interaction-answer",interaction:o});break;default:console.log("components/Actions onClick UNHANDLED",a,n,e)}}},{key:"fullpage",value:function(){var e=document.getElementById("videowhisperVideochat");this.state.fullpage?(e.style.position="fixed",e.style.top="0",e.style.left="0"):e.style.position="absolute",console.log("components/Actions fullpage",this.state.fullpage,e.style.position)}},{key:"componentDidMount",value:function(){document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("msfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("MSFullscreenChange",this.handleFullscreenChange,!1),document.addEventListener("fullscreenchange",this.handleFullscreenChange,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullscreenChange),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullscreenChange),document.removeEventListener("fullscreenchange",this.handleFullscreenChange)}},{key:"requestFullscreen",value:function(e){var t=!0;this.state.fullscreen=t,e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1,this.state.fullscreen=!1),this.setState({fullscreen:t})}},{key:"exitFullscreen",value:function(){this.setState({fullscreen:!1}),(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.log("components/Actions Fullscreen API is not supported."))}},{key:"componentDidUpdate",value:function(e){e.actions!==this.props.actions&&this.processActions()}},{key:"processActions",value:function(){var e=this,t=this.props,a=this.state;t.actions.length>0&&t.actions.forEach(function(n){if(n)if(n.userID===t.user.ID){if("privateRequest"===n.action){if(3===n.status&&1===n.answer){n={ID:a.requestAction.ID,status:5};t.serverUpdate({task:"interaction-confirm",interaction:n})}n.status>=3&&n.status<7&&n.answer}}else if("privateRequest"===n.action){if(n.status<2&&(a.requestModalShow=!0,n.meta&&e.setState({requestDetails:'User "'+n.meta.userName+'" requested a private session.'}),a.requestAction=n),2===n.status&&1===n.answer){n={ID:a.requestAction.ID,status:3};t.serverUpdate({task:"interaction-answer",interaction:n})}n.status>=3&&n.status<7&&n.answer}})}},{key:"componentWillReceiveProps",value:function(e){}},{key:"render",value:function(){var e=this,t=this.props,a=this.state,n=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,i=[];if(n||a.fullscreenRecommended||window.innerWidth<800&&i.push(o.a.createElement(j.a,{key:"recommendFullscreen",closeIcon:!0,open:!0,onClose:this.fullscreenModalClose,size:"small"},o.a.createElement(N.a,{icon:"star",content:"FullScreen Recommended"}),o.a.createElement(j.a.Content,null,o.a.createElement("h3",null,"When available space is small, fullscreen is recommended to access interface more easily.")),o.a.createElement(j.a.Actions,null,o.a.createElement(R.a,{color:"orange",onClick:this.fullscreenModalClose},o.a.createElement(I.a,{name:"remove"})," Nevermind"),o.a.createElement(R.a,{color:"green",name:"fullscreenRecommended",onClick:this.onClick.bind(this)},o.a.createElement(I.a,{name:"expand"})," Go Fullscreen")))),i.push(o.a.createElement(R.a,{className:t.appState.className,size:"small",key:"balance",name:"balance",as:"div",labelPosition:"right"},o.a.createElement(R.a,{className:t.appState.className,size:"small",color:"green",target:"_balance",href:t.config.balanceURL},o.a.createElement(I.a,{name:"money"}),"Wallet"),o.a.createElement(q.a,{className:t.appState.className,as:"a",color:t.appState.darkMode?"black":"grey",pointing:"left",target:"_balance",href:t.config.balanceURL},t.user.balance))),t.room.tips&&t.room.tipOptions.length>0){var s=0,r=o.a.createElement(o.a.Fragment,null,t.room.tipOptions.map(function(a,n){if("TIP"===a.tag&&"custom"!==a.attributes.AMOUNT)return s++,o.a.createElement($.a.Column,{className:t.appState.className,key:"tip"+n,textAlign:"center"},o.a.createElement(N.a,{as:"h4",className:t.appState.className},o.a.createElement(Y.a,{src:t.room.tipsURL+a.attributes.IMAGE,size:"mini",rounded:!0,verticalAlign:"middle"})," ",a.attributes.AMOUNT),o.a.createElement("b",null,a.attributes.LABEL),o.a.createElement("br",null),a.attributes.NOTE,o.a.createElement(A.a,{basic:!0,className:t.appState.className},o.a.createElement(R.a,{compact:!0,className:t.appState.className,size:"small",color:"olive",name:"tip",value:n,onClick:e.onClick.bind(e)},"Tip")))}));i.push(o.a.createElement(ee.a,{className:t.appState.className,key:"tipsPopup",trigger:o.a.createElement(R.a,{className:t.appState.className,size:"small",key:"tipsButton",name:"tipsButton",color:"olive"}," ",o.a.createElement(I.a,{name:"box"})," Tip"),flowing:!0,hoverable:!0,open:this.state.tipsOpen,onOpen:function(){return e.setState({tipsOpen:!0})},onClose:function(){return e.setState({tipsOpen:!1})}},o.a.createElement($.a,{className:t.appState.className,centered:!0,divided:!0,columns:s},r)))}if(t.room.actionPrivate&&i.push(o.a.createElement(R.a,{className:t.appState.className,size:"small",key:"private",name:"private",color:"orange",loading:a.privateLoading,disabled:a.privateLoading,onClick:this.onClick.bind(this),"data-tooltip":"Request Private 2 Way Videochat"}," ",o.a.createElement(I.a,{name:"star"})," Request Private")),t.room.actionPrivateClose&&i.push(o.a.createElement(R.a,{className:t.appState.className,size:"small",key:"privateClose",name:"privateClose",color:"red",onClick:this.onClick.bind(this)}," ",o.a.createElement(I.a,{name:"window close"})," Close Private")),i.push(o.a.createElement(j.a,{key:"privateModal",closeIcon:!0,open:a.privateModalShow,onClose:this.privateModalClose,size:"small"},o.a.createElement(N.a,{icon:"star",content:"Request Private Show"}),o.a.createElement(j.a.Content,null,o.a.createElement("h3",null,"Request Private Show with ",t.room.performer)),o.a.createElement(j.a.Actions,null,o.a.createElement(R.a,{color:"red",onClick:this.privateModalClose},o.a.createElement(I.a,{name:"remove"})," Nevermind"),o.a.createElement(R.a,{color:"green",name:"privateRequest",onClick:this.onClick.bind(this),loading:a.privateLoading,disabled:a.privateLoading},o.a.createElement(I.a,{name:"star"})," Request")))),i.push(o.a.createElement(j.a,{key:"requestModal",open:a.requestModalShow,closeOnEscape:!1,closeOnDimmerClick:!1,size:"small"},o.a.createElement(N.a,{icon:"star",content:"Answer Private Show Request"}),o.a.createElement(j.a.Content,null,o.a.createElement("h3",null,a.requestDetails)),o.a.createElement(j.a.Actions,null,o.a.createElement(R.a,{color:"red",name:"declineRequest",onClick:this.onClick.bind(this)},o.a.createElement(I.a,{name:"remove"})," Decline"),o.a.createElement(R.a,{color:"green",name:"acceptRequest",onClick:this.onClick.bind(this)},o.a.createElement(I.a,{name:"star"})," Accept")))),t.room.next&&i.push(o.a.createElement(R.a,{className:t.appState.className,icon:!0,size:"small",key:"next",name:"next",color:"teal","data-tooltip":"Next: Random Videochat Room",onClick:this.onClick.bind(this),disabled:t.appState.roomLoading},"Next ",o.a.createElement(I.a,{name:"arrow right"}))),n||t.config.actionFullscreen&&i.push(o.a.createElement(R.a,{className:t.appState.className,icon:!0,size:"small",floated:"right",key:"fullscreen",name:"fullscreen",color:"grey","data-tooltip":a.fullscreen?"Exit Fullscreen":"Enter Fullscreen",onClick:this.onClick.bind(this)},o.a.createElement(I.a,{name:a.fullscreen?"compress":"expand"}))),t.config.actionFullpage&&i.push(o.a.createElement(R.a,{className:t.appState.className,icon:!0,size:"small",floated:"right",key:"fullpage",name:"fullpage",color:"grey","data-tooltip":a.fullpage?"Zoom Out of Full Page":"Zoom Into Full Page",onClick:this.onClick.bind(this)},o.a.createElement(I.a,{name:a.fullpage?"zoom-out":"zoom-in"}))),i.push(o.a.createElement(R.a,{className:t.appState.className,icon:!0,size:"small",floated:"right",key:"darkMode",name:"darkMode",color:t.appState.darkMode?"yellow":"grey","data-tooltip":t.appState.darkMode?"Lights On":"Dark Mode",onClick:this.onClick.bind(this)},o.a.createElement(I.a,{name:t.appState.darkMode?"sun":"moon"}))),!t.appState.checked||t.appState.checked&&t.appState.mode.text){var c=t.appState.tooltip;t.appState.mode&&t.appState.mode.text&&(c=t.appState.mode.text),i.push(o.a.createElement(R.a,{className:t.appState.className,size:"small",floated:"right",key:"videowhisper",name:"videowhisper",color:"blue",target:"_videowhisper",href:"https://videowhisper.com/tickets_submit.php","data-tooltip":c},o.a.createElement(I.a,{name:"eye"})," Free"))}return i.push(o.a.createElement(R.a,{className:t.appState.className,size:"small",floated:"right",key:"time",name:"time",as:"div",labelPosition:"right"},o.a.createElement(R.a,{className:t.appState.className,size:"small",color:"yellow"},o.a.createElement(I.a,{name:"time"})),o.a.createElement(q.a,{className:t.appState.className,as:"a",color:t.appState.darkMode?"black":"grey",pointing:"left"},a.displayTime))),o.a.createElement("div",{className:"panel",style:{backgroundColor:t.appState.backgroundColor},ref:function(t){return e.state.container=t}},o.a.createElement("div",{className:"controlsBottom"},i))}}]),t}(n.Component),ae=function(e){function t(){return Object(k.a)(this,t),Object(M.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return this.componentActions=o.a.createRef(),o.a.createElement("div",{className:"layoutWay2",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layVideo"},o.a.createElement(z,{appState:e.appState,config:e.config,room:e.room})),o.a.createElement("div",{className:"layCamera"},o.a.createElement(J,{appState:e.appState,config:e.config,room:e.room,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layHistory"},o.a.createElement(X,{appState:e.appState,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"layActions"},o.a.createElement(te,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"laySend"},o.a.createElement(Q,{appState:e.appState,appStateUpdate:e.appStateUpdate,user:e.user,sendMessage:e.sendMessage})))}}]),t}(n.Component),ne=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).componentActions=o.a.createRef(),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return o.a.createElement("div",{className:"layoutBroadcast",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layCamera"},o.a.createElement(J,{appState:e.appState,config:e.config,room:e.room,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layActions"},o.a.createElement(te,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layHistory"},o.a.createElement(X,{appState:e.appState,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(Q,{appState:e.appState,appStateUpdate:e.appStateUpdate,user:e.user,sendMessage:e.sendMessage})))}}]),t}(n.Component),oe=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).componentActions=o.a.createRef(),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return o.a.createElement("div",{className:"layoutPlayback",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layVideo"},o.a.createElement(z,{appState:e.appState,config:e.config,room:e.room})),o.a.createElement("div",{className:"layActions"},o.a.createElement(te,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layHistory"},o.a.createElement(X,{appState:e.appState,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(Q,{appState:e.appState,appStateUpdate:e.appStateUpdate,user:e.user,sendMessage:e.sendMessage})))}}]),t}(n.Component),ie=function(e){function t(e){var a;return Object(k.a)(this,t),console.log("containers/Media constructor",e),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).state={mediaWidth:0,mediaHeight:1,mediaStyle:{position:"absolute",width:"100%",height:"100%"},mediaAspectRatio:1},a.devMode=e.appState.devMode,a.mediaContent=o.a.createRef(),a.extensionsImg=["jpg","jpeg","jfif","pjpeg","pjp","gif","ico","cur","bmp","png","svg"],a.extensionsVideo=["mp4"],a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"updateMediaSize",value:function(e){var t=this.state;t.mediaHeight||(t.mediaHeight=1),t.mediaAspectRatio=t.mediaWidth/t.mediaHeight;var a=t.mediaWidth,n=t.mediaHeight,o=0,i=0;t.width&&t.aspectRatio&&t.mediaAspectRatio&&(t.mediaAspectRatio>t.aspectRatio?(a=t.width,n/=t.mediaAspectRatio,i=(t.height-n)/2):(a=(n=t.height)*t.mediaAspectRatio,o=(t.width-a)/2));var s={position:"absolute",left:o,top:i,width:a,height:n,border:"solid 1px #555"};this.setState({mediaStyle:s}),this.devMode&&console.log("containers/Media updateMediaSize",e,t.aspectRatio,s)}},{key:"onImgLoad",value:function(e){var t=e.target;this.state.mediaWidth=t.naturalWidth,this.state.mediaHeight=t.naturalHeight,this.devMode&&console.log("containers/Media onImgLoad",t.naturalWidth,t.naturalHeight),this.updateMediaSize("img")}},{key:"onVideoLoadedMetadata",value:function(e){var t=e.target;this.state.mediaWidth=t.videoWidth,this.state.mediaHeight=t.videoHeight,this.devMode&&console.log("containers/Media onVideoLoadedMetadata",t.videoWidth,t.videoHeight),this.updateMediaSize("video")}},{key:"render",value:function(){var e=this,t=this.state,a=this.props,n=o.a.createElement(A.a,{className:a.appState.className},a.placement," - No Content.");if(a.placement&&a.appState.media){var i=a.appState.media[a.placement];if(i)switch(i.type){case"stream":case"video":n=o.a.createElement(z,{appState:a.appState,config:a.config,room:a.room,content:i});break;case"file":this.extensionsImg.includes(i.ext)&&(n=o.a.createElement("img",{style:t.mediaStyle,ref:this.mediaContent,onLoad:this.onImgLoad.bind(this),src:i.url})),this.extensionsVideo.includes(i.ext)&&(n=o.a.createElement("video",{style:t.mediaStyle,ref:this.mediaContent,onLoadedMetadata:this.onVideoLoadedMetadata.bind(this),controls:!0,autoplay:!0,loop:!0},o.a.createElement("source",{src:i.url,type:"video/mp4"})));break;default:n=o.a.createElement(A.a,{className:a.appState.className},"Unknown type: ",i.type)}}return o.a.createElement("div",{className:"panel",ref:function(t){return e.state.container=t}},n)}}]),t}(B);ie.propTypes={placement:H.a.string.isRequired,appState:H.a.object.isRequired,user:H.a.object.isRequired,config:H.a.object.isRequired,room:H.a.object.isRequired};var se=a(472),re=function(e){function t(){return Object(k.a)(this,t),Object(M.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return o.a.createElement("div",{className:"layoutChat",key:"layoutChat",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layHistory"},o.a.createElement(X,{appState:e.appState,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(Q,{appState:e.appState,appStateUpdate:e.appStateUpdate,user:e.user,sendMessage:e.sendMessage})))}}]),t}(n.Component),ce=a(471),le=a(50),de=a.n(le),pe=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).userClick=function(e){return function(t,n){if(console.log("components/User userClick",e,n,t),e&&n.action)switch(n.action){case"profile":var o={file:e.url};window.open(o.file);break;case"presentation":a.props.serverUpdate({task:"user_presentation",userID:e.userID,placement:n.placement})}}},a.state={},a.devMode=e.appState.devMode,a.data=[],a.scrollableRef=o.a.createRef(),e.room.users&&(a.data=e.room.users),a.devMode&&console.log("components/Users constructor room:",e.room),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){console.log("components/Users componentWillUnmount")}},{key:"shouldComponentUpdate",value:function(e,t){return de.a.isEqual(e.room.users,this.props.room.users)||(this.data=e.room.users),!0}},{key:"render",value:function(){var e,t,a=this.props;this.state;this.devMode=a.appState.devMode;var n=[];if(t=this.props.room.usersMenu?o.a.createElement(A.a,{className:a.appState.className},"Users Menu"):"",this.data){for(var i in this.data)if(this.data.hasOwnProperty(i)){var s=this.data[i];if(s&&s.userName){var r=[];if(r.push({key:"usermenuProfile_"+i,onClick:this.userClick(s),icon:"address card",text:"Profile",action:"profile"}),this.props.room.usersPresentation)for(var c in this.props.appState.media)r.push({key:"usermenuPresentation_"+c+i,onClick:this.userClick(s),icon:"pointing left",text:"Show: "+c,action:"presentation",placement:c});var l=o.a.createElement(G.a,{compact:!0,key:"usermenu"+i,text:s.userName,options:r,className:a.appState.className}),d=o.a.createElement(o.a.Fragment,null,o.a.createElement(Y.a,{src:s.avatar,rounded:!0,size:"mini",verticalAlign:"middle"}),s.userID===a.room.performerID?o.a.createElement(I.a,{name:"star"}):"",s.meta.connected?o.a.createElement(I.a,{name:"video"}):"",l);n.push(o.a.createElement(ce.a.Row,{key:"userRow"+i},o.a.createElement(ce.a.Cell,null,d)))}}}else n=o.a.createElement(ce.a.Row,{key:"No_Users"},o.a.createElement(ce.a.Cell,{colSpan:"1",warning:!0},"No users."));return e=o.a.createElement(ce.a,{celled:!0,selectable:!0,sortable:!0,key:"User_Pane",className:a.appState.className},o.a.createElement(ce.a.Body,null,n)),o.a.createElement("div",{className:"layoutList",key:"layoutList",style:{backgroundColor:a.appState.backgroundColor}},o.a.createElement("div",{className:"layScrollable",key:"layScrollable",ref:this.scrollableRef},e),o.a.createElement("div",{className:"layMenu"},t))}}]),t}(B);pe.propTypes={appState:H.a.object.isRequired,user:H.a.object.isRequired,config:H.a.object.isRequired,room:H.a.object.isRequired,serverUpdate:H.a.func.isRequired};var me=a(250),ue=a(248),he=a.n(ue),ve=a(115),ge=a.n(ve),fe=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).handleSort=function(e){return function(){a.sortBy(e,!1)}},a.fileClick=function(e){return function(t,n){if(console.log("components/Files fileClick",e,n,t),e&&n.action)switch(n.action){case"open":var o={file:e.url};window.open(o.file);break;case"delete":a.props.serverUpdate({task:"file_delete",file_name:e.name});break;case"presentation":a.props.serverUpdate({task:"file_presentation",file_name:e.name,placement:n.placement})}}},a.onDrop=function(e){var t=Object(D.a)(Object(D.a)(a)).props;if(t.config.serverURL){var n=he.a.post(t.config.serverURL);n.field("task","file_upload"),n.field("VideoWhisper[userID]",t.user.ID),n.field("VideoWhisper[sessionID]",t.user.sessionID),n.field("VideoWhisper[sessionKey]",t.user.sessionKey),t.room.ID?(n.field("VideoWhisper[roomID]",t.room.ID),n.field("VideoWhisper[privateUID]",t.room.privateUID)):console.log("components/Files onDrop room",t.room,t.user,t.config.serverURL);var o=[];e.forEach(function(e){n.attach(e.name,e,e.name),o.push(e.name)}),n.field("files[]",o),n.then(a.uploadCompleted.bind(Object(D.a)(Object(D.a)(a)))),console.log("components/Files onDrop",e,n),a.setState({uploading:!0})}else console.log("components/Files onDrop missing serverURL",t.config.serverURL,t.config)},a.state={column:null,data:null,direction:null,uploading:!1},a.devMode=e.appState.devMode,a.scrollableRef=o.a.createRef(),a.fileInputRef=o.a.createRef(),e.room.files&&(a.state.data=e.room.files),a.devMode&&console.log("components/Files constructor room:",e.room),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"sortBy",value:function(e,t){t&&(this.state.column=null,this.state.direction=null);var a=this.state,n=a.column,o=a.data,i=a.direction;if(o){var s="age"==e?"time":e;console.log("components/Files handleSort",e,s,i,t),n===e?this.setState({data:"descending"===i?de.a.sortBy(o,[s]):de.a.sortBy(o,[s]).reverse(),direction:"ascending"===i?"descending":"ascending"}):this.setState({column:e,data:de.a.sortBy(o,[s]).reverse(),direction:"descending"})}}},{key:"componentDidMount",value:function(){this.sortBy("age",!0)}},{key:"componentWillUnmount",value:function(){console.log("components/Files  componentWillUnmount")}},{key:"shouldComponentUpdate",value:function(e,t){return de.a.isEqual(e.room.files,this.props.room.files)||(this.state.data=e.room.files,this.sortBy("age",!0)),!0}},{key:"uploadCompleted",value:function(e){console.log("components/Files uploadCompleted",e),this.props.serverUpdate({task:"update",update:"files"}),this.setState({uploading:!1})}},{key:"render",value:function(){var e,t,a,n=this,i=this.props,s=this.state,r=this.state,c=r.column,l=r.data,d=r.direction;return a=this.props.room.filesUpload?o.a.createElement(me.a,{onDrop:this.onDrop},function(e){var t=e.getRootProps,a=e.getInputProps;return o.a.createElement(A.a,{className:i.appState.className},o.a.createElement("div",t(),o.a.createElement("input",a()),o.a.createElement("p",null,o.a.createElement(I.a,{name:"upload",loading:s.uploading})," ",s.uploading?"Uploading. Please wait...":"Upload: Drag 'n' drop files here, or click to select files")))}):"",t=l?l.map(function(e){var t=[];if(t.push({key:"filemenuOpen_"+e.name,onClick:n.fileClick(e),icon:"file",text:"Open",action:"open"}),n.props.room.filesDelete&&t.push({key:"filemenuDelete_"+e.name,onClick:n.fileClick(e),icon:"trash",text:"Delete",action:"delete"}),n.props.room.filesPresentation)for(var a in n.props.appState.media)t.push({key:"filemenuPresentation_"+a+e.name,onClick:n.fileClick(e),icon:"pointing left",text:"Show: "+a,action:"presentation",placement:a});var s=o.a.createElement(G.a,{key:"filemenu"+e.name,text:e.name,options:t,className:i.appState.className});return o.a.createElement(ce.a.Row,{key:e.name},o.a.createElement(ce.a.Cell,null,s),o.a.createElement(ce.a.Cell,null,e.size),o.a.createElement(ce.a.Cell,null,e.age))}):o.a.createElement(ce.a.Row,{key:"No_Files"},o.a.createElement(ce.a.Cell,{colSpan:"3",warning:!0},"No files.")),e=o.a.createElement(ce.a,{celled:!0,selectable:!0,striped:!0,sortable:!0,key:"File_Pane",className:i.appState.className},o.a.createElement(ce.a.Header,null,o.a.createElement(ce.a.Row,null,o.a.createElement(ce.a.HeaderCell,{sorted:"name"===c?d:null,onClick:this.handleSort("name")},"Name"),o.a.createElement(ce.a.HeaderCell,{sorted:"size"===c?d:null,onClick:this.handleSort("size")},"Size"),o.a.createElement(ce.a.HeaderCell,{sorted:"age"===c?d:null,onClick:this.handleSort("age")},"Age"))),o.a.createElement(ce.a.Body,null,t)),o.a.createElement("div",{className:"layoutList",key:"layoutList",style:{backgroundColor:i.appState.backgroundColor}},o.a.createElement("div",{className:"layScrollable",key:"layScrollable",ref:this.scrollableRef},e),o.a.createElement("div",{className:"layMenu"},a))}}]),t}(B);fe.propTypes={appState:H.a.object.isRequired,user:H.a.object.isRequired,config:H.a.object.isRequired,room:H.a.object.isRequired,serverUpdate:H.a.func.isRequired};var be=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).state={},a.devMode=e.appState.devMode,a.devMode&&console.log("components/Presentation constructor room:",e.room),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Presentation  componentWillUnmount")}},{key:"removeMedia",value:function(e,t){var a=t.name,n=t.value;this.devMode&&console.log("components/Presentation removeMedia",a,n,e),this.props.serverUpdate({task:"presentation_remove",placement:n})}},{key:"render",value:function(){var e=this.props,t=[];if(e.appState.media)for(var a in e.appState.media){var n=e.appState.media[a],i="";if("stream"===n.type){var s=this.props.room.users[n.userID];s?s.meta&&(s.meta.connected||(i="Not Broadcasting")):i="Not Available"}t.push(o.a.createElement("div",{key:"presentationPlacement"+a},n.default?o.a.createElement(q.a,{pointing:"right"},"Default"):o.a.createElement(R.a,{className:e.appState.className,size:"tiny",compact:!0,key:"removeMedia"+a,name:"removeMedia"+a,value:a,color:"red",onClick:this.removeMedia.bind(this)}," ",o.a.createElement(I.a,{name:"window close"}),"Remove"),o.a.createElement("b",null,a),": ",n.type," ",o.a.createElement("i",null,n.name)," ",i))}return o.a.createElement("div",{className:"layScrollable",key:"layPresentation",style:{backgroundColor:e.appState.backgroundColor},ref:this.scrollableRef},o.a.createElement(A.a,{className:e.appState.className},"Room ",o.a.createElement("b",null,e.room.name),": Media Displayed",t))}}]),t}(B);be.propTypes={appState:H.a.object.isRequired,user:H.a.object.isRequired,config:H.a.object.isRequired,room:H.a.object.isRequired,serverUpdate:H.a.func.isRequired};var Se=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).devMode=e.appState.devMode,a.devMode&&console.log("containers/Tabs constructor",e),a.state={menus:[],panes:[],selected:""},a.updatePanes(e),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentWillReceiveProps",value:function(e){this.props.room&&!this.props.room.panelCamera&&e.room.panelCamera&&(this.state.selected="Camera"),this.updatePanes(e)}},{key:"componentWillUnmount",value:function(){this.devMode&&console.log("containers/Tabs componentWillUnmount")}},{key:"updatePanes",value:function(e){var t=[],a=[],n="";this.state.selected||(this.state.selected="Chat");var i=this.state;n="Chat",t.push({key:n,active:i.selected==n,name:n}),a.push(o.a.createElement("div",{key:"paneChat",className:i.selected==n?"paneActive":"paneInactive"},o.a.createElement(re,{appState:e.appState,appStateUpdate:e.appStateUpdate,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage}))),e.room.panelCamera&&(n="Camera",t.push({key:n,active:i.selected==n,name:n}),a.push(o.a.createElement("div",{key:"paneCamera",className:i.selected==n?"paneActive":"paneInactive"},o.a.createElement(J,{appState:e.appState,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelUsers&&(n="Users",t.push({key:n,active:i.selected==n,name:n}),i.selected==n&&a.push(o.a.createElement("div",{key:"paneUsers",className:i.selected==n?"paneActive":"paneInactive"},o.a.createElement(pe,{appState:e.appState,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelFiles&&(n="Files",t.push({key:n,active:i.selected==n,name:n}),i.selected==n&&a.push(o.a.createElement("div",{key:"paneFiles",className:i.selected==n?"paneActive":"paneInactive"},o.a.createElement(fe,{appState:e.appState,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelPresentation&&(n="Presentation",t.push({key:n,active:i.selected==n,name:n}),i.selected==n&&a.push(o.a.createElement("div",{key:"panePresentation",className:i.selected==n?"paneActive":"paneInactive"},o.a.createElement(be,{appState:e.appState,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "))),this.state.menus=t,this.state.panes=a}},{key:"onClick",value:function(e,t){this.devMode&&console.log("containers/Tabs onClick",t),this.state.selected!=t.name&&(this.state.selected=t.name,this.updatePanes(this.props),this.setState({selected:t.name}))}},{key:"render",value:function(){var e=this.state,t=this.props;return o.a.createElement("div",{className:"layoutTabs",style:{backgroundColor:t.appState.backgroundColor}},o.a.createElement("div",{className:"layMenu"},o.a.createElement(se.a,{className:t.appState.className,items:e.menus,onItemClick:this.onClick.bind(this)})),o.a.createElement("div",{className:"layPane"},e.panes))}}]),t}(B);Se.propTypes={appState:H.a.object.isRequired,appStateUpdate:H.a.func.isRequired,user:H.a.object.isRequired,config:H.a.object.isRequired,room:H.a.object.isRequired,fetchHistory:H.a.func.isRequired,sendMessage:H.a.func.isRequired,serverUpdate:H.a.func.isRequired};var ye=function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).componentActions=o.a.createRef(),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){console.log("containers/CollaborationScreen componentWillUnmount")}},{key:"render",value:function(){var e=this.props;return o.a.createElement("div",{className:"layoutCollaboration",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layVideo"},o.a.createElement(ie,{appState:e.appState,config:e.config,room:e.room,user:e.user,placement:"Main"})),o.a.createElement("div",{className:"layActions"},o.a.createElement(te,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layTabs"},o.a.createElement(Se,{appState:e.appState,appStateUpdate:e.appStateUpdate,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})))}}]),t}(n.Component),Ce=a(154),ke=a.n(Ce),Ee=(a(455),a(456),a(457),function(e){function t(e){var a;return Object(k.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).devMode=!1,a.devModeTimer=!0,a.axiosConfig={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},a.checkMode=function(e){Object(D.a)(Object(D.a)(a)).state;var t=Object(D.a)(Object(D.a)(a));a.devMode&&console.log("VideoWhisper/containers/App checkMode:",e),ke.a.post("https://"+e+".com/l.php?j=1&pn=HTML5+Videochat&ps=Web&pu="+escape(window.location.href)+"&u="+escape(window.location.href)+"&pv="+a.version,ge.a.stringify(null),a.axiosConfig).then(function(e){t.modeProcess(e)}).catch(a.modeError.bind(Object(D.a)(Object(D.a)(a))))},a.updateMedia=function(){var e=Object(D.a)(Object(D.a)(a)).props,t=Object(D.a)(Object(D.a)(a)).state;e.room.media&&(t.media=e.room.media),t.media.Main||(t.media.Main={}),e.room.streamUID&&(t.media.Main.type||(t.media.Main.type="stream",t.media.Main.userID=e.room.streamUID,t.media.Main.stream=e.room.streamPlayback,t.media.Main.name=e.room.performer,t.media.Main.default=!0)),a.setState({media:t.media}),a.devMode&&console.log("VideoWhisper/containers/App updateMedia",e.room.media,t.media)},a.retrieveParameters=function(){var e=Object(D.a)(Object(D.a)(a)),t=e.state,n=e.devMode,o=window.VideoWhisper;o||n?(n&&(o||(o={serverURL:"https://demo.paidvideochat.com/wp-admin/admin-ajax.php?action=vmls_app"})),o&&(t.serverURL=o.serverURL),a.devMode&&console.log("VideoWhisper/containers/App retrieveParameters",o,n,t)):a.setState({error:"Missing VideoWhisper parameters!",errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})},a.serverUpdate=function(e){var t=Object(D.a)(Object(D.a)(a)).state;if(t.serverURL||a.retrieveParameters(),t.serverURL){e||(e={});var n=Object(D.a)(Object(D.a)(a)).props;if(n.user.loggedIn){var o={userID:n.user.ID,sessionID:n.user.sessionID,sessionKey:n.user.sessionKey,roomID:n.room.ID,privateUID:n.room.privateUID,roomActionID:n.room.actionID,alreadyUpdating:a.state.serverUpdating};e.VideoWhisper=o,e.lastMessage=n.lastMessageTimestamp}var i=Object(D.a)(Object(D.a)(a));a.state.serverUpdating&&console.log("containers/App serverUpdate WARNING: Already Updating",a.state.serverUpdating),"next"==e.task&&a.setState({roomLoading:!0}),a.setState({serverUpdating:!0}),ke.a.post(a.state.serverURL,ge.a.stringify(e),a.axiosConfig).then(function(e){i.serverProcess(e)}).catch(a.serverError.bind(Object(D.a)(Object(D.a)(a))))}else a.devMode&&console.log("VideoWhisper/containers/App serverUpdate : missing serverURL",t,a.devMode)},a.sendMessage=function(e){a.serverUpdate({task:"message",message:e}),a.devMode&&console.log("VideoWhisper/containers/App sendMessage:",e,a.props)},a.fetchHistory=function(){var e=Object(D.a)(Object(D.a)(a)).props;a.serverUpdate({});var t={userID:-1,userName:"Test",text:"Test History",time:(new Date).valueOf(),ID:(new Date).valueOf()};e.addHistory(new Array(t),(new Date).valueOf()),a.devMode&&console.log("VideoWhisper/containers/App fetchHistory",e,e.messages)},a.componentScreen=o.a.createRef(),a.timeLocal=0,a.version="1.6",a.state={devMode:a.devMode,media:{Main:{}},darkMode:!1,className:"",backgroundColor:"#EEEEEE",error:"",warning:"",timerOn:!1,timeInterval:8500,serverURL:"",serverUpdating:!1,mode:null,checked:!1,tooltip:"Free Mode: This limited functionality is provided for free. Contact VideoWhisper.com to enable full mode.",roomLoading:!0},a.timerTimeStart=Date.now(),a.appStateUpdate=a.appStateUpdate.bind(Object(D.a)(Object(D.a)(a))),a.devMode&&console.log("VideoWhisper/containers/App constructor",e,a.state),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"appStateUpdate",value:function(e){this.devMode&&console.log("VideoWhisper/containers/App appStateUpdate",e),this.setState(e)}},{key:"timerStart",value:function(){this.devMode&&!this.devModeTimer||(this.timer=setInterval(this.timerTick.bind(this),this.state.timeInterval),this.timerLocal=setInterval(this.timerTickLocal.bind(this),1e3),this.setState({timerOn:!0}))}},{key:"timerStop",value:function(){clearInterval(this.timer),clearInterval(this.timerLocal),this.setState({timerOn:!1})}},{key:"timerTick",value:function(){this.state.serverUpdating||this.serverUpdate({task:"tick"});var e=Date.now()-this.timerTimeStart;this.state.time=e,this.timeLocal=e}},{key:"timerTickLocal",value:function(){this.timeLocal=Date.now()-this.timerTimeStart,this.componentScreen.current&&this.componentScreen.current.componentActions&&this.componentScreen.current.componentActions.current.updateTime(this.timeLocal)}},{key:"modeProcess",value:function(e){this.setState({mode:e.data,checked:!0}),this.devMode&&console.log("VideoWhisper/containers/App modeProcess:",e,this.state),2==this.state.mode.status&&this.setState({error:"Lincese Error: "+this.state.mode.message,errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})}},{key:"modeError",value:function(e){console.log("VideoWhisper/containers/App checkMode Error:",e),this.setState({error:"License activation error!",errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})}},{key:"serverProcess",value:function(e){var t=this.state;this.setState({serverUpdating:!1});var a=e.data;if(this.devMode&&"tick"!==a.task&&console.log("containers/App serverProcess",e),a.VideoWhisper){if(a.error&&(console.log("VideoWhisper/containers/App serverProcess Error",a.error),this.timerStop(),this.setState({error:a.error})),a.warning&&(this.devMode&&console.log("VideoWhisper/containers/App serverProcess Warning",a.warning),this.setState({warning:a.warning}),"next"===a.task&&this.setState({roomLoading:!1})),a.user&&(a.user.loggedIn?a.config&&(this.props.setConfig(a.config),this.timerStart()):(a.user.failed=!0,a.user.warning="Login failed!"),this.props.setUser(a.user)),a.room){this.props.setRoom(a.room),this.setState({roomLoading:!1});var n=[],o="";if(!t.checked||t.checked&&t.mode.text){var i=t.tooltip;t.mode&&t.mode.text&&(i=t.mode.text),o="",t.mode&&t.mode.image&&(o=t.mode.image),n.push({userID:-1,userName:"VideoWhisper.com",notification:!0,text:i,image:o,time:(new Date).valueOf()-1,ID:(new Date).valueOf()-1})}o="",this.props.room.welcomeImage&&(o=this.props.room.welcomeImage),n.push({userID:-1,userName:"WelcomeNotification",notification:!0,text:this.props.room.welcome,image:o,time:(new Date).valueOf(),ID:(new Date).valueOf()}),this.props.setHistory(n,0),this.updateMedia()}a.roomUpdate&&(this.props.updateRoom(a.roomUpdate),a.roomUpdate.media&&this.updateMedia()),a.messages&&a.messages.length>0&&this.props.addHistory(a.messages,a.timestamp),a.actions&&a.actions.length>0&&this.props.setActions(a.actions,a.timestamp)}else console.log("VideoWhisper/containers/App serverProcess Error VW Check",a.VideoWhisper)}},{key:"serverError",value:function(e){console.log("containers/App serverUpdate Error:",e),this.setState({error:"Web request error!"})}},{key:"componentDidMount",value:function(){this.devMode&&console.log("VideoWhisper/containers/App componentDidMount",this.props)}},{key:"onClick",value:function(e,t){var a=t.name,n=t.value;switch(this.devMode&&console.log("VideoWhisper/containers/App onClick",a,n,e),a){case"closeError":this.setState({error:"",errorMore:"",errorURL:""}),this.timerStart();break;case"closeWarning":this.setState({warning:"",warningMore:"",warningURL:""});break;default:this.devMode&&console.log("VideoWhisper/containers/App onClick UNHANDLED",a,n,e)}}},{key:"screenRouter",value:function(){var e=this.sendMessage,t=this.fetchHistory,a=this.props,n=this.serverUpdate,i=this.state,s=this.checkMode,r="LoginScreen";switch(a.user.loggedIn&&(r=a.room.screen?a.room.screen:"Way2Screen",this.devMode&&this.devScreen&&(r=this.devScreen)),r){case"LoginScreen":return o.a.createElement(U,{ref:this.componentScreen,user:a.user,serverUpdate:n,checkMode:s,appState:i,appStateUpdate:this.appStateUpdate,key:"screen"});case"BroadcastScreen":return o.a.createElement(ne,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:i,appStateUpdate:this.appStateUpdate,fetchHistory:t,sendMessage:e,serverUpdate:n,key:"screen"});case"PlaybackScreen":return o.a.createElement(oe,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:i,appStateUpdate:this.appStateUpdate,fetchHistory:t,sendMessage:e,serverUpdate:n,key:"screen"});case"Way2Screen":return o.a.createElement(ae,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:i,appStateUpdate:this.appStateUpdate,fetchHistory:t,sendMessage:e,serverUpdate:n,key:"screen"});case"CollaborationScreen":return o.a.createElement(ye,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:i,appStateUpdate:this.appStateUpdate,fetchHistory:t,sendMessage:e,serverUpdate:n,key:"screen"})}}},{key:"preRender",value:function(){var e=this.state;e.darkMode?(e.className="inverted",e.backgroundColor="#333333"):(e.className="",e.backgroundColor="#EEEEEE")}},{key:"render",value:function(){this.preRender();var e=this.state,t=this.props,a=[];if(""!==e.error){var n="";e.errorMore&&(n=o.a.createElement(R.a,{color:"orange",name:"more",target:"_more",href:e.errorURL},o.a.createElement(I.a,{name:"help"}),e.errorMore)),a.push(o.a.createElement(j.a,{key:"error",open:!0,size:"small"},o.a.createElement(N.a,{icon:"warning sign",content:"Error"}),o.a.createElement(j.a.Content,null,this.state.error),o.a.createElement(j.a.Actions,null,n,o.a.createElement(R.a,{color:"blue",name:"closeError",onClick:this.onClick.bind(this)},o.a.createElement(I.a,{name:"check"})," Ignore"),o.a.createElement(R.a,{color:"green",name:"exitError",target:"_top",href:t.config.exitURL},"Exit ",o.a.createElement(I.a,{name:"arrow right"})))))}if(""!==e.warning){n="";e.warningMore&&(n=o.a.createElement(R.a,{color:"orange",name:"more",target:"_more",href:e.warningURL},o.a.createElement(I.a,{name:"help"}),e.warningMore)),a.push(o.a.createElement(j.a,{key:"warning",open:!0,size:"small"},o.a.createElement(N.a,{icon:"warning sign",content:"Warning"}),o.a.createElement(j.a.Content,null,this.state.warning),o.a.createElement(j.a.Actions,null,n,o.a.createElement(R.a,{color:"green",name:"closeWarning",onClick:this.onClick.bind(this)},o.a.createElement(I.a,{name:"check"})," OK"))))}return a.push(this.screenRouter()),o.a.createElement("div",{id:"appContainer",style:{backgroundColor:this.state.backgroundColor}},a)}}]),t}(o.a.Component)),Me=Object(r.b)(function(e){return{config:e.app.config,user:e.app.user,room:e.app.room,messages:e.app.messages,actions:e.app.actions,lastMessageTimestamp:e.app.lastMessageTimestamp}},function(e){return this.devMode&&console.log("VideoWhisper/containers/App mapDispatchToProps",e),{setUser:function(t){return e(function(e){return{type:d,payload:{user:e}}}(t))},setConfig:function(t){return e(function(e){return{type:u,payload:{config:e}}}(t))},setRoom:function(t){return e(function(e){return{type:p,payload:{room:e}}}(t))},updateRoom:function(t){return e(function(e){return{type:m,payload:{room:e}}}(t))},addMessage:function(t){return e(function(e){return{type:v,payload:{message:e}}}(t))},addHistory:function(t,a){return e(function(e,t){return{type:h,payload:{messages:e,timestamp:t}}}(t,a))},setActions:function(t,a){return e(function(e,t){return{type:g,payload:{actions:e,timestamp:t}}}(t,a))},setHistory:function(t,a){return e(function(e,t){return{type:f,payload:{messages:e,timestamp:t}}}(t,a))}}})(Ee);window.store=C;var we=o.a.createElement(r.a,{store:C},o.a.createElement(Me,null));s.a.render(we,document.getElementById("videowhisperVideochat"))}},[[261,1,2]]]);