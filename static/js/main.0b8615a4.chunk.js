(this.webpackJsonpvideowhisper=this.webpackJsonpvideowhisper||[]).push([[0],{301:function(e,t,a){e.exports=a(534)},306:function(e,t,a){},311:function(e,t,a){},531:function(e,t,a){},532:function(e,t,a){},533:function(e,t,a){},534:function(e,t,a){"use strict";a.r(t);var s=a(0),o=a.n(s),n=a(39),i=a.n(n),r=(a(306),a(119)),c=a(64);const l={user:{ID:0,sessionID:0,sessionKey:"",name:"User.0",loggedIn:!1,warning:"Please wait for login..",balance:0},room:{ID:0,name:"Room.0",screen:"LoginScreen",streamBroadcast:"Room",streamPlayback:"Room",privateUID:0,actionPrivate:!1,actionPrivateClose:!1,actionID:0,performer:"",performerID:0,welcome:"Welcome to default room!"},config:{wss:"",application:"",videoCodec:"h264",videoBitrate:"400",videoFramerae:"29.97",audioCodec:"opus",audioBitrate:"64",autoBroadcast:!1,exitURL:"https://videowhisper.com",errorURL:"https://videowhisper.com/tickets_submit.php",actionFullpage:!1,actionFullscreen:!0,loaded:!1},messages:[],actions:[],lastMessageTimestamp:0};var p=function(e=l,t={}){var a;switch(t.type){case"App/UPDATE_USER":a=Object.assign({},e,{user:Object.assign({},e.user,t.payload.user)});break;case"App/SET_ROOM":a=Object.assign({},e,{room:Object.assign({},t.payload.room)});break;case"App/UPDATE_ROOM":a=Object.assign({},e,{room:Object.assign({},e.room,t.payload.room)});break;case"App/SET_CONFIG":a=Object.assign({},e,{config:Object.assign({},t.payload.config)});break;case"App/ADD_MESSAGE":a=Object.assign({},e,{messages:[...e.messages,t.payload.message]});break;case"App/ADD_HISTORY":a=Object.assign({},e,{lastMessageTimestamp:t.payload.timestamp,messages:e.messages.concat(t.payload.messages)});break;case"App/SET_ACTIONS":a=Object.assign({},e,{lastMessageTimestamp:t.payload.timestamp,actions:[...t.payload.actions]});break;case"App/SET_HISTORY":a=Object.assign({},e,{lastMessageTimestamp:t.payload.timestamp,messages:[...t.payload.messages]});break;default:a=Object.assign({},e)}return a};var d=Object(c.b)({app:p});var m=Object(c.c)(d);var h=a(535),u=a(56),g=a(547),v=a(552),f=(a(311),a(551));class S extends s.Component{constructor(e){super(e),this.txt=e=>{const t=this.props;return e in t.config.text?t.config.text[e]:e},this.devMode=e.appState.devMode,this.state={loggedin:!1,modeServers:["videowhisper","videowhispers","ateom"]}}componentDidMount(){const e=this.props,t=this.state;if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen componentDidMount",e.appState.parametersRetrieved,e.appState.checkWait,e,t,window,window.VideoWhisper),!t.loggedin&&e.appState.parametersRetrieved&&!e.user.loggedIn&&!e.user.failed&&!e.appState.checkWait){const t=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:t}),this.state.loggedin=!0}this.devMode?setTimeout(()=>t.modeServers.forEach(e.checkMode),3e3):t.modeServers.forEach(e.checkMode)}componentDidUpdate(e,t,a){if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen componentDidUpdate parametersRetrieved checkWait loggedin",e.appState.parametersRetrieved,e.appState.checkWait,t.loggedin),!t.loggedin&&e.appState.parametersRetrieved&&!e.user.loggedIn&&!e.user.failed&&!e.appState.checkWait){const t=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:t}),this.state.loggedin=!0}}render(){const e=this.props;this.state;let t;t=e.user.loggedIn?"Logged in as "+e.user.name:"Not logged in, yet. ",e.user.warning&&(t+=e.user.warning);var a=o.a.createElement("p",null," Entering the ",o.a.createElement("a",{href:"https://videowhisper.com"},"VideoWhisper.com")," HTML5 Videochat App");return(e.appState.whitelabel||!e.appState.parametersRetrieved&&!e.appState.error)&&(a=o.a.createElement("p",null,"Entering Videochat")),e.appState.checked&&(e.appState.mode.status||(a=e.appState.mode.text?e.appState.mode.text:"This is server connection screen."),e.appState.whitelabel&&e.appState.whitelabel!=e.appState.mode.whitelabel&&(a=o.a.createElement("p",null,"Whitelabel license required to start ",o.a.createElement("a",{href:"https://videowhisper.com"},"VideoWhisper.com")," HTML5 Videochat application in whitelabel mode.",o.a.createElement("br",null),o.a.createElement("a",{href:"https://videowhisper.com/tickets_submit.php"},"Contact Support")," for details!"))),o.a.createElement(f.a,{className:e.appState.className},o.a.createElement("p",null," Logged in: ",t," "),o.a.createElement("p",null," ",e.user.error," "),a)}}var b=a(546),E=a(86),C=a(548),y=a(2),k=a.n(y);class M extends s.Component{constructor(e){super(e),this.txt=e=>{const t=this.props;return e in t.config.text?t.config.text[e]:e},this.updateSize=()=>{var e=this.state;if(e.container){let t=e.container.clientWidth,a=e.container.clientHeight;a||(a=1);const s=t/a;this.setState({aspectRatio:s,width:t,height:a})}this.devMode&&console.log("components/Panel containerResized",e)},this.state={container:null,width:0,height:0,aspectRatio:0,settingsActive:!0},this.devMode=e.appState.devMode}componentDidMount(){this.updateSize(),window.addEventListener("resize",this.updateSize,!1),document.addEventListener("onfullscreenchange",this.updateSize,!1),document.addEventListener("webkitfullscreenchange",this.updateSize,!1),document.addEventListener("mozfullscreenchange",this.updateSize,!1),document.addEventListener("msfullscreenchange",this.updateSize,!1),document.addEventListener("MSFullscreenChange",this.updateSize,!1),document.addEventListener("fullscreenchange",this.updateSize,!1)}componentWillUnmount(){window.removeEventListener("resize",this.updateSize),document.removeEventListener("onfullscreenchange",this.updateSize),document.removeEventListener("webkitfullscreenchange",this.updateSize),document.removeEventListener("mozfullscreenchange",this.updateSize),document.removeEventListener("msfullscreenchange",this.updateSize),document.removeEventListener("MSFullscreenChange",this.updateSize),document.removeEventListener("fullscreenchange",this.updateSize)}static getDerivedStateFromProps(e,t){if(t.container){let a=t.container.clientWidth,s=t.container.clientHeight;if(s||(s=1),t.width!==a||t.height!==s){const o={aspectRatio:a/s,width:a,height:s};return e.appState.devMode&&console.log("components/Panel getDerivedStateFromProps size update",o,t),o}}return null}onClick(e,{name:t,value:a}){const s=this.state;"settings"===t&&this.setState(e=>({settingsActive:!s.settingsActive})),this.devMode&&console.log("components/Panel onClick ",t,a,e,s)}}class x extends M{constructor(e){super(e),this._isMounted=!1,this.bitrateOptions=e=>{var t=[];t.push({key:"bitrate-title",text:o.a.createElement("span",null,o.a.createElement("strong",null,"Video Bitrate")," ",this.state.maxBitrate?" <"+this.state.maxBitrate+"kbps":""),disabled:!0});var a=this.state.maxBitrate;let s=!1;return[{value:.35,label:"Very Low"},{value:.5,label:"Low"},{value:.75,label:"Medium"},{value:1,label:"Good"},{value:1.25,label:"High"},{value:1.5,label:"Very High"}].forEach(o=>{var n=Math.round(o.value*e);n===a&&(s=!0),n<=a&&t.push({key:n,value:n,text:n+" kbps "+o.label})}),(0===t.length||!s&&1.5*e>a)&&t.push({key:a,value:a,text:a+" kbps Limit"}),t},this.onopen=function(e){if(this.devMode&&console.log("components/Camera wsConnection.onopen ",this.wsConnection.readyState,e,this.state),this.wsMessaged=!1,this.props.appStateUpdate({wsOpen:!0,wsComponent:"Camera onopen"}),1!=this.wsConnection.readyState)return;this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.onicecandidate=this.onicecandidate,this.peerConnection.onsignalingstatechange=this.onsignalingstatechange.bind(this),this.peerConnection.oniceconnectionstatechange=this.oniceconnectionstatechange.bind(this);if(this.localStream.getAudioTracks().forEach(e=>this.peerConnection.addTrack(e,this.localStream)),!this.audioInterface){this.localStream.getVideoTracks().forEach(e=>this.peerConnection.addTrack(e,this.localStream))}this.peerConnection.createOffer(this.offerOptions).then(this.gotDescription.bind(this),this.errorHandler),this.devMode&&console.log("components/Camera wsConnection.onopen setting wsMessagedCheck"),setTimeout(()=>this.wsMessagedCheck(),6e3)},this.wsMessagedCheck=()=>{this.devMode&&console.log("components/Camera wsConnection wsMessagedCheck",this.wsMessaged),this.wsMessaged||(this.setState({buttonDisabled:!1,buttonContent:this.txt("Broadcast"),statusInfo:"Websocked did not reply"}),console.log("components/Camera wsMessagedCheck","Websocked did not reply with ice candidates",this.wsConnection),this.retryIfTimeoutSet||this.retryIfTimeout())},this.onmessage=e=>{this.wsMessaged=!0,this.devMode&&console.log("components/Camera wsConnection.onmessage",e);var t=JSON.parse(e.data),a=Number(t.status);t.command;if(200!=a)console.log("components/Camera wsConnection.onmessage error sdp:",t.statusDescription),this.stopPublisher(),this.setState({buttonDisabled:!1,buttonContent:this.txt("Broadcast"),statusInfo:t.statusDescription,connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"}),this.retriesLeft=0;else{var s=t.sdp;void 0!==s&&(this.devMode&&console.log("components/Camera wsConnection.onmessage 200 sdp:",t.sdp),this.peerConnection.setRemoteDescription(s).then(()=>{}).catch(this.errorHandler.bind(this)));var o=t.iceCandidates;if(this.devMode&&console.log("components/Camera wsConnection msgJSON iceCandidates: ",o),void 0!==o){for(var n in o)this.devMode&&console.log("components/Camera wsConnection iceCandidate: "+o[n]),this.peerConnection.addIceCandidate(new RTCIceCandidate(o[n])).then(()=>this.onAddIceCandidateSuccess(this.peerConnection),e=>this.onAddIceCandidateError(this.peerConnection,e));null!=this.wsConnection&&this.wsConnection.close()}}},this.setMediaBitrateSDP=(e,t,a)=>{let s="AS",o=!1;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(o=!0),o&&(a=1e3*(a>>>0),s="TIAS"),a=Math.round(a);for(var n=e.split("\n"),i=-1,r=0;r<n.length;r++)if(0===n[r].indexOf("m="+t)){i=r;break}if(-1===i)return e;for(i++;0===n[i].indexOf("i=")||0===n[i].indexOf("c=");)i++;if(0===n[i].indexOf("b"))return n[i]="b="+s+":"+a,n.join("\n");var c=n.slice(0,i);return c.push("b="+s+":"+a),c=c.concat(n.slice(i,n.length)),this.devMode&&console.log("components/Camera setMediaBitrateSDP",t,a,c.join("\n")),c.join("\n")},this.devMode=e.appState.devMode,this.devMode&&console.log("components/Camera constructor",e),this.audioInterface=!1,e.cameraConfig&&(this.audioInterface=e.cameraConfig.audioInterface),this.tChecked=!1,this.retriesLeft=5,this.retryTimeout=5500,this.retryIfTimeoutSet=!1,this.wsConnection=null,this.peerConnection=null,this.peerConnectionConfig={iceServers:[],optional:[{googSuspendBelowMinBitrate:!1,googImprovedWifiBwe:!0}]},this.localStream=null,this.streamInfo=null,this.userData=null,this.SDPOutput={},this.offerOptions={offerToReceiveAudio:1,offerToReceiveVideo:1},this.localVideo=o.a.createRef(),this.stats={video:{timestamp:0,bandwidth:0},audio:{timestamp:0,bandwidth:0}},this.videoIndex=-1,this.audioIndex=-1,this.changedBy="",this.enhanceData={},this.tWarn="",this.resolutions={"4K":{label:"4K",width:3840,height:2160,ratio:"16:9",bitrate:12e3},"1440p":{label:"1440p",width:2560,height:1440,ratio:"16:9",bitrate:6e3},"1080p":{label:"1080p",width:1920,height:1080,ratio:"16:9",bitrate:3e3},"720p":{label:"720p",width:1280,height:720,ratio:"16:9",bitrate:1800},SVGA:{label:"SVGA",width:800,height:600,ratio:"4:3",bitrate:800},"480p":{label:"480p",width:858,height:480,ratio:"16:9",bitrate:750},VGA:{label:"VGA",width:640,height:480,ratio:"4:3",bitrate:600},"360p":{label:"360p",width:640,height:360,ratio:"16:9",bitrate:400},"240p":{label:"240p",width:426,height:240,ratio:"16:9",bitrate:220},CIF:{label:"CIF",width:352,height:288,ratio:"4:3",bitrate:200},QVGA:{label:"QVGA",width:320,height:240,ratio:"4:3",bitrate:180},"180p":{label:"180p",width:320,height:180,ratio:"16:9",bitrate:160},"90p":{label:"90p",width:160,height:90,ratio:"16:9",bitrate:100}},this.state={packetLoss:!1,revealed:!0,tapRequired:!1,connected:!1,connecting:!1,settingsActive:!1,statusInfo:"Connecting...",buttonContent:"Connecting",buttonDisabled:!0,bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"eye slash"}),"Detecting"),videoWidth:640,videoHeight:360,videoAspectRatio:1.77,camera:null,cameraOptions:[],videoSource:null,microphone:null,microphoneOptions:[],audioSource:null,maxBitrate:750,maxResolutionHeight:480,bitrate:600,bitrateOptions:[],resolution:"360p",resolutionOptions:[]},this.onChange=this.onChange.bind(this)}componentDidMount(){this.devMode&&console.log("components/Camera componentDidMount"),this._isMounted=!0,super.componentDidMount(),this.interfaceReady()}componentWillUnmount(){this.devMode&&console.log("components/Camera componentWillUnmount"),this.props.serverUpdate({task:"media",connected:!1}),this._isMounted=!1,this.stopPublisher();this.state;this.localStream&&this.localStream.getTracks().forEach(e=>e.stop()),super.componentWillUnmount()}timerStart(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.packetsLost=0,this.stats.audio.packetsLost=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),2500),this.setState({packetLoss:!1})}timerStop(){clearInterval(this.timer),this.setState({packetLoss:!1})}timerTick(){if(this.props.appState.publishRequired&&(this.state.connected||"1"==this.props.config.cameraAutoBroadcast)&&(this.devMode&&console.log("components/Camera timerTick publishRequired"),this.props.appStateUpdate({publishRequired:!1}),this.setState({buttonDisabled:!0,buttonContent:this.txt("Closing")}),this.stopPublisher(),this.setState({buttonDisabled:!0,buttonContent:this.txt("Restarting Broadcast"),statusInfo:this.txt("Restarting Broadcast"),connecting:!0,connected:!1}),this.buildStream()),this.state.connected&&this.peerConnection){this.peerConnection.getSenders().forEach(e=>{e.getStats().then(e=>{e.forEach(e=>{this.devMode&&e.packetsLost>0&&console.log("components/Camera packetsLost ",e.packetsLost,e);var t=e.kind;if(void 0===t&&(t=e.mediaType),"remote-inbound-rtp"==e.type&&(this.stats[t].packetsLost=e.packetsLost,this.stats[t].roundTripTime=e.roundTripTime,this.stats[t].jitter=e.jitter,this.stats[t].timestampRemote=e.timestamp),"outbound-rtp"===e.type&&!e.isRemote&&("video"===t||"audio"===t)){var a=e.timestamp-this.stats[t].timestamp;a>0&&a<6e3&&e.bytesSent>=this.stats[t].bytesSent&&(this.stats[t].bitrate=8*(e.bytesSent-this.stats[t].bytesSent)/a),this.stats[t].timestamp=e.timestamp,this.stats[t].bytesSent=e.bytesSent,this.stats[t].qualityLimitationReason=e.qualityLimitationReason}})})});var e="";this.audioInterface||this.props.room.audioOnly||this.props.appState.audioMode||"Way2Screen"==this.props.appState.screen&&this.props.appState.revealMode&&!this.props.appState.revealed||(e=o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"video camera"}),Math.round(this.stats.video.bitrate)," kbps","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":"",this.stats.video.roundTripTime>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"clock"}),this.stats.video.roundTripTime," "):"",this.stats.video.jitter>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"circle notch"}),Math.round(1e3*(this.stats.video.jitter+Number.EPSILON))/1e3," jitter "):"",this.stats.video.packetsLost>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"exclamation circle"}),this.stats.video.packetsLost," packets lost "):"",o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"expand"}),this.state.videoWidth,"x",this.state.videoHeight," "),o.a.createElement("br",null))),this.connectionInfo=o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"broken chain"}),"Socket Not Connected"),this.wsConnection&&(this.connectionInfo=o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"chain"}),this.wsConnection.readyState)),this.peerInfo=o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"stop circle"}),"Peer Not Connected"),this.peerConnection&&(this.peerInfo=o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"play circle"}),this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState));var t=o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"wait"}),"Measuring...");(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(t=o.a.createElement("div",null,e,o.a.createElement(u.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps","none"!==this.stats.audio.qualityLimitationReason&&void 0!==this.stats.audio.qualityLimitationReason?"(limited: "+this.stats.audio.qualityLimitationReason+")":"",this.stats.audio.roundTripTime>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"clock"}),this.stats.audio.roundTripTime," "):"",this.stats.audio.jitter>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"circle notch"}),Math.round(1e3*(this.stats.audio.jitter+Number.EPSILON))/1e3," jitter "):"",this.stats.audio.packetsLost>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"exclamation circle"}),this.stats.audio.packetsLost," packets lost "):"",o.a.createElement("br",null),this.connectionInfo," ",this.peerInfo)),(this.state.settingsActive||this.audioInterface)&&this.setState({bitrateInfo:t}),(this.stats.audio.packetsLost||this.stats.video.packetsLost)&&(this.state.packetLoss||this.setState({packetLoss:!0}))}}render(){const e=this.state,t=this.props,a=this.onChange;this.devMode=t.appState.devMode;var s={};if(!this.audioInterface){let t=e.videoWidth,a=e.videoHeight,o=0,n=0;e.width&&e.aspectRatio&&e.videoAspectRatio&&(e.videoAspectRatio>e.aspectRatio?(t=e.width,a=t/e.videoAspectRatio,n=(e.height-a)/2):(a=e.height,t=a*e.videoAspectRatio,o=(e.width-t)/2)),s={position:"absolute",left:o,top:n,width:t,height:a}}var n="";e.tapRequired&&(n=o.a.createElement(b.a.Field,null,o.a.createElement(h.a,{inverted:!0,name:"tap",content:"Tap to Show",onClick:this.onClick.bind(this)}),o.a.createElement(E.a,{pointing:"left",color:"black"},"Gesture is required to show preview")));var i="",r="",c="microphone";this.audioInterface||t.room.audioOnly||t.appState.audioMode||"Way2Screen"==t.appState.screen&&t.appState.revealMode&&!t.appState.revealed||(c="video",i=o.a.createElement(b.a.Field,null,o.a.createElement(C.a,{className:"inverted tiny",name:"camera",value:e.camera,onChange:a,placeholder:"Camera",selection:!0,onChange:this.onChange,options:e.cameraOptions})),r=o.a.createElement(o.a.Fragment,null,o.a.createElement(b.a.Field,null,o.a.createElement(C.a,{className:"inverted tiny",name:"resolution",value:e.resolution,onChange:a,placeholder:"Video Resolution",selection:!0,options:e.resolutionOptions})),o.a.createElement(b.a.Field,null,o.a.createElement(C.a,{className:"inverted tiny",name:"bitrate",value:e.bitrate,onChange:a,placeholder:"Video Bitrate",selection:!0,options:e.bitrateOptions})))),this.tChecked||this.updateBitrates();var l="";e.settingsActive?(this.connectionInfo=o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"broken chain"}),"Socket Not Connected"),this.wsConnection&&(this.connectionInfo=o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"chain"}),this.wsConnection.readyState)),this.peerInfo=o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"stop circle"}),"Peer Not Connected"),this.peerConnection&&(this.peerInfo=o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"play circle"}),this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState)),l=o.a.createElement("div",{className:"controlsBottom"},o.a.createElement(E.a,{size:"tiny",color:"black"},this.tWarn),i,o.a.createElement(b.a.Field,null,o.a.createElement(C.a,{key:"microphone",className:"inverted tiny",name:"microphone",value:e.microphone,onChange:a,placeholder:"Microphone",selection:!0,onChange:this.onChange,options:e.microphoneOptions})),r,o.a.createElement(b.a.Field,null,o.a.createElement(h.a,{inverted:!0,name:"broadcast",content:e.buttonContent,onClick:this.onClick.bind(this),disabled:e.buttonDisabled}),o.a.createElement(E.a,{pointing:"left",color:"black"},e.statusInfo)),n,o.a.createElement(E.a,{color:"black"},e.connected?e.bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:("microphone"==c?"microphone":"eye")+" slash"}),"Not Broadcasting ",this.connectionInfo," ",this.peerInfo," ")))):this.tWarn.length>0&&(l=o.a.createElement("div",{className:"controlsBottom"},o.a.createElement(E.a,{size:"tiny",pointing:"left",color:"black"},this.tWarn)));var p="";e.packetLoss&&(p=o.a.createElement("span",{"data-tooltip":this.txt("Packet Loss: Upload Connection Issue"),"data-position":"left center"},o.a.createElement(u.a,{inverted:!0,name:"exclamation circle",size:"large"})));var d=o.a.createElement(u.a,{inverted:!0,color:"black",name:("microphone"==c?"microphone":"eye")+" slash",size:"large"});return e.connecting&&(d=o.a.createElement(u.a,{inverted:!0,loading:!0,name:"spinner",size:"large"})),e.connected&&(d=o.a.createElement(u.a,{inverted:!0,name:c,size:"large"})),this.audioInterface?o.a.createElement("div",{className:"panel",style:{backgroundColor:t.appState.backgroundColor},ref:e=>this.state.container=e},o.a.createElement(b.a,null,o.a.createElement(b.a.Group,{inline:!0},o.a.createElement(b.a.Field,{inline:!0},o.a.createElement(u.a,{inverted:t.appState.darkMode,name:"microphone"})),o.a.createElement(b.a.Field,{inline:!0},o.a.createElement(h.a,{inverted:t.appState.darkMode,size:"small",name:"broadcast",content:e.buttonContent,onClick:this.onClick.bind(this),disabled:e.buttonDisabled}),o.a.createElement(E.a,{pointing:"left",color:"black"},e.statusInfo)),o.a.createElement(b.a.Field,{inline:!0},o.a.createElement(C.a,{size:"small",key:"microphone",className:t.appState.className,name:"microphone",value:e.microphone,onChange:a,placeholder:"Microphone",selection:!0,onChange:this.onChange,options:e.microphoneOptions})),o.a.createElement(b.a.Field,{inline:!0},p),o.a.createElement(b.a.Field,{inline:!0},o.a.createElement(E.a,{size:"tiny"},e.connected?e.bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:("microphone"==c?"microphone":"eye")+" slash"}),"Not Broadcasting ",this.connectionInfo," ",this.peerInfo," ")))))):o.a.createElement("div",{className:"panel",ref:e=>this.state.container=e},o.a.createElement("div",{className:"backgroundVideo"},o.a.createElement("video",{poster:t.config.cameraSnapshot?t.config.cameraSnapshot:t.room.snapshot,style:s,id:"localVideo",ref:this.localVideo,className:"localVideo",autoPlay:!0,playsInline:!0,muted:!0,onLoadedMetadata:()=>{this.updateVideoSize("loadedmetadata"),this.videoPlay()}})),o.a.createElement("div",{className:"controlsIcons"},p,d,o.a.createElement(h.a,{name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:e.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":"Toggle Controls","data-position":"left center"},o.a.createElement(u.a,{name:"settings"}))),l)}onChange(e,{name:t,value:a}){this.setState({[t]:a}),this.changedBy=t,this.devMode&&console.log("components/Camera onChange",t,a,e),navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this))}onClick(e,{name:t,value:a}){const s=this.txt;if(this.devMode&&console.log("components/Camera onClick",t,a,e),"tap"===t&&this.videoPlay(),"broadcast"===t)switch(this.state.buttonContent){case s("Broadcast"):this.retriesLeft=5,this.setState({buttonDisabled:!0,buttonContent:s("Starting Broadcast"),statusInfo:s("Starting Broadcast"),connecting:!0,connected:!1}),this.buildStream();break;case s("Stop Broadcast"):this.retriesLeft=0,this.setState({buttonDisabled:!0,buttonContent:s("Ending"),statusInfo:s("Ending")}),this.stopPublisher(),this.setState({buttonDisabled:!1,buttonContent:s("Broadcast"),statusInfo:s("Stopped Broadcast"),connecting:!1,connected:!1})}super.onClick(e,{name:t,value:a})}retryIfTimeout(){if(this.devMode)return console.log("components/Camera retryIfTimeout skipped on devMode"),void(this.retryIfTimeoutSet=!1);this.state.connected||this.retriesLeft>0&&(this.retriesLeft--,this.stopPublisher(),this.setState({buttonDisabled:!0,buttonContent:this.txt("Auto Retry"),statusInfo:this.txt("Auto Retry"),connecting:!0,connected:!1}),this.buildStream()),this.retryIfTimeoutSet=!1}updateBitrates(){const e=this.props;if(this.bitrate=Number(e.config.bitrate),this.bitrate||(this.bitrate=750),this.resolutionHeight=Number(e.config.resolutionHeight),this.resolutionHeight||(this.resolutionHeight=480),this.videoBitrate=Number(e.config.videoBitrate),this.maxBitrate=Number(e.config.maxBitrate),this.videoBitrate<this.maxBitrate&&(this.maxBitrate=this.videoBitrate),this.maxBitrate||(this.maxBitrate=0),this.maxResolutionHeight=Number(e.config.maxResolutionHeight),this.maxResolutionHeight||(this.maxResolutionHeight=0),this.tWarn="",(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&(this.resolutionHeight>480&&(this.resolutionHeight=480),this.bitrate>750&&(this.bitrate=750),this.maxResolutionHeight>480&&(this.maxResolutionHeight=480),this.maxResolutionHeight||(this.maxResolutionHeight=480),this.maxBitrate>750&&(this.maxBitrate=750),this.maxBitrate||(this.maxBitrate=750),this.bitrate>this.maxBitrate&&(this.bitrate=this.maxBitrate),this.resolutionHeight>this.maxResolutionHeight&&(this.resolutionHeight=this.maxResolutionHeight),this.tWarn="Free Mode: Broadcasting Bitrate & Resolution Limited"),this.state.maxBitrate=this.maxBitrate,this.state.maxResolutionHeight=this.maxResolutionHeight,this.resolutionOptions=[{key:"res-title",text:o.a.createElement("span",null,o.a.createElement("strong",null,this.txt("Video Resolution")),this.state.maxResolutionHeight?" <"+this.state.maxResolutionHeight+"p":""),disabled:!0}],this.resolutions)for(var t in this.resolutions)(0===this.maxBitrate||.35*this.resolutions[t].bitrate<=this.maxBitrate)&&(0===this.maxResolutionHeight||this.resolutions[t].height<=this.maxResolutionHeight)&&this.resolutionOptions.push({key:t,value:t,text:this.resolutions[t].label+" "+this.resolutions[t].width+"x"+this.resolutions[t].height+" "+this.resolutions[t].ratio});this.state.resolutionOptions=this.resolutionOptions,this.state.bitrateOptions=this.bitrateOptions(this.bitrate),this.state.resolution=this.resolutionHeight.toString()+"p",this.state.maxBitrate=this.maxBitrate,this.state.bitrate=this.bitrate,e.appState.checked&&(this.tChecked=!0)}interfaceReady(){this.state;this.props;setTimeout(()=>this.props.serverUpdate({task:"media",connected:!1}),500),this.updateBitrates(),this.setState({resolutionOptions:this.resolutionOptions,resolution:this.resolutionHeight.toString()+"p",bitrateOptions:this.bitrateOptions(this.bitrate),maxBitrate:this.maxBitrate,bitrate:this.bitrate,settingsActive:"1"==this.props.config.cameraControls});const e=this.props.config.cameraAutoBroadcast,t=this.txt;if(!navigator.mediaDevices)return this.devMode&&console.log("components/Camera interfaceReady navigator.mediaDevices",navigator.mediaDevices),void this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:t("Broadcast"),statusInfo:"Navigator media devices not available!",connecting:!1,connected:!1});if("1"!=e||this.props.appState.external){var a=t("Make a selection to start!");this.props.appState.external&&(a=t("External broadcast detected.")),navigator.mediaDevices.enumerateDevices().then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)),this.setState({buttonDisabled:!1,buttonContent:t("Broadcast"),statusInfo:a,connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"off"})}else navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this)),this.setState({statusInfo:"Connecting...",connecting:!0,connected:!1}),this.props.appStateUpdate({cameraStatus:"pending"});this.devMode&&console.log("components/Camera interfaceReady ",e,this.maxBitrate,this.maxResolutionHeight)}videoPlay(){const e=this.localVideo.current;var t=this.state,a=!1,s=e.play();void 0!==s&&s.catch(e=>{a=!0,console.log("components/Camera Auto play error:"+e,e),this.setState({tapRequired:!0,settingsActive:!0})}).then(()=>{a||(this.setState({tapRequired:!1}),t.connected&&this.setState({settingsActive:!1}))})}buildStream(){if(this._isMounted){var e=this.state,t=this.props;for(var a in window.stream&&window.stream.getTracks().forEach(e=>{e.stop()}),this.audioInterface||(this.localVideo.current.srcObject=null),this.resolutions)a==e.resolution&&(e.videoWidth=this.resolutions[a].width,e.videoHeight=this.resolutions[a].height,"bitrate"!==this.changedBy&&(0===e.maxBitrate||this.resolutions[a].bitrate<=e.maxBitrate?e.bitrate=this.resolutions[a].bitrate:e.bitrate=e.maxBitrate),e.bitrateOptions=this.bitrateOptions(this.resolutions[a].bitrate));var s={};"_disabled"!=e.audioSource?s.audio={deviceId:e.audioSource?{ideal:e.audioSource}:void 0}:s.audio=!1,this.audioInterface||t.room.audioOnly||t.appState.audioMode||"Way2Screen"==t.appState.screen&&t.appState.revealMode&&!t.appState.revealed?s.video=!1:"_disabled"!=e.videoSource?s.video={deviceId:e.videoSource?{ideal:e.videoSource}:void 0,width:{ideal:e.videoWidth},height:{ideal:e.videoHeight}}:s.video=!1,"_disabled"!=e.audioSource||"_disabled"!=e.videoSource?navigator.mediaDevices.getUserMedia(s).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)):console.log("Camera/buildStream NO SOURCE",e.videoSource,e.audioSource),this.devMode&&console.log("components/Camera /buildStream videoSource: ",e.videoSource,"  constraints=",s,t.appState)}else console.log("components/Camera buildStream not mounted")}handleError(e){if(console.log("components/Camera navigator.mediaDevices handleError: ",e," this._isMounted="+this._isMounted),this._isMounted){var t="";switch(e.name){case"OverconstrainedError":t=" ("+e.constraint+")"}this.setState({settingsActive:!0,statusInfo:"Media Error: "+e.name+t,buttonDisabled:!1,buttonContent:this.txt("Broadcast"),connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"}),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||console.log("components/Camera navigator.mediaDevices handleError - enumerateDevices() - not supported"),navigator.mediaDevices.enumerateDevices().then((function(e){e.forEach((function(e){console.log("components/Camera navigator.mediaDevices handleError enumerateDevices "+e.kind+": "+e.label+" id = "+e.deviceId)}))})).catch((function(e){console.log("components/Camera navigator.mediaDevices handleError enumerateDevices error: "+e.name+": "+e.message)}))}}gotStream(e){return this.audioInterface||(this.localVideo.current.srcObject=e),this.devMode&&console.log("components/Camera after getUserMedia",e),this.localStream=e,null!=this.localStream&&this.stopPublisher(),this.startPublisher(),navigator.mediaDevices.enumerateDevices()}startPublisher(){this.devMode&&console.log("components/Camera startPublisher",this.props),this.wsConnect(),this.timerStart()}stopPublisher(){this.timerStop(),null!=this.peerConnection&&this.peerConnection.close(),null!=this.wsConnection&&this.wsConnection.close(),this.devMode&&console.log("stopPublisher")}gotDevices(e){var t=this.state,a=[{key:"cam-title",text:o.a.createElement("span",null,"Select ",o.a.createElement("strong",null,"Camera"),":"),disabled:!0},{text:"No Camera",value:"_disabled"}],s=[{key:"mic-title",text:o.a.createElement("span",null,"Select ",o.a.createElement("strong",null,"Microphone"),":"),disabled:!0}];let n=!1,i=!1;for(let o=0;o!==e.length;++o){const c=e[o];var r={value:c.deviceId};"audioinput"===c.kind?(r.text=c.label||"microphone ".concat(s.length+1),s.push(r),t.microphone||(t.microphone=c.deviceId),c.deviceId===t.microphone&&(i=!0)):"videoinput"===c.kind&&(r.text=c.label||"camera ".concat(a.length+1),a.push(r),t.camera||(t.camera=c.deviceId),c.deviceId===t.camera&&(n=!0))}(n||"_disabled"===t.camera)&&(t.videoSource=t.camera),(i||"_disabled"===t.microphone)&&(t.audioSource=t.microphone),t.camera===t.videoSource&&t.microphone===t.audioSource||n&&i||(this.devMode&&console.log("components/Camera gotDevices: deviceID changed videoValid:"+t.camera+" videoSelected: "+t.microphone+" audioValid:"+i),this.setState({settingsActive:!0,statusInfo:"Media DeviceID changed: Please select again!",buttonDisabled:!1,buttonContent:this.txt("Broadcast")})),this.devMode&&console.log("gotDevices: verified videoSource: "+t.videoSource+" changed videoValid: "+n),this._isMounted&&this.setState({cameraOptions:a,microphoneOptions:s})}gotDevicesPublish(e){this.gotDevices(e),this.buildStream()}updateVideoSize(e){const t=this.localVideo.current;var a=this.state;let s;t.videoHeight&&(a.videoWidth===t.videoWidth&&a.videoHeight===t.videoHeight||(a.videoWidth=t.videoWidth,a.videoHeight=t.videoHeight,a.videoHeight||(a.videoHeight=1)),s=t.videoWidth/t.videoHeight,a.videoAspectRatio!==s&&this.setState({videoAspectRatio:s}))}wsConnect(){const e=this.props;this.state;if(this.props.appState.wsOpen)return this.devMode&&console.log("components/Camera wsConnection websocket busy, retrying later",this.props.appState.wsComponent),this.wsConnection&&this.wsConnection.close(),void setTimeout(()=>this.wsConnect(),1e3);this.props.appStateUpdate({wsOpen:!0,wsComponent:"Camera"}),this.SDPOutput={};var t=null;this.audioInterface||(t=this.localStream.getVideoTracks());const a=this.localStream.getAudioTracks();this.audioInterface||t.length>0&&this.devMode&&console.log("components/Camera wsConnect Using Video device: ".concat(t[0].label)),a.length>0&&this.devMode&&console.log("components/Camera wsConnect Using Audio device: ".concat(a[0].label)),this.streamInfo={applicationName:e.config.application,streamName:e.room.streamBroadcast,sessionId:"[empty]"},this.userData={param1:"value1",videowhisper:"webrtc-broadcast"},this.devMode&&console.log("components/Camera wsConnect","_isMounted="+this._isMounted,this.streamInfo,this.userData,this.props,this.state),this.wsConnection&&(console.log("components/Camera wsConnect previous websocket (close)",this.wsConnection),this.wsConnection.close()),this.wsConnection=new WebSocket(e.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsMessaged=!1,this.wsConnection.onmessage=e=>this.onmessage(e),this.wsConnection.onclose=()=>{this.devMode&&console.log("components/Camera wsConnection.onclose"),this.props.appStateUpdate({wsOpen:!1})},this.wsConnection.onerror=e=>{console.log("components/Camera wsConnection.onerror: ",e),this.props.appStateUpdate({cameraStatus:"error"}),this.wsConnection.close(),this.props.appStateUpdate({wsOpen:!1}),this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:this.txt("Broadcast"),connecting:!1,connected:!1,bitrateInfo:o.a.createElement(u.a,{name:"eye slash"})})}}onAddIceCandidateSuccess(e){this.devMode&&console.log("components/Camera onAddIceCandidateSuccess success.",e)}onAddIceCandidateError(e){console.log("components/Camera onAddIceCandidateError: ".concat(e.toString()))}gotDescription(e){const t=this.props,a=this.state,s=this.txt;this.devMode&&console.log("components/Camera gotDescription: original",e,this.wsConnection),this.enhanceData={},void 0!==t.config.audioBitrate&&(this.enhanceData.audioBitrate=Number(t.config.audioBitrate)),void 0!==a.bitrate&&(this.enhanceData.videoBitrate=Number(a.bitrate)),void 0!==t.videoFrameRate&&(this.enhanceData.videoFrameRate=Number(t.videoFrameRate)),e.sdp=this.enhanceSDP(e.sdp,this.enhanceData),this.peerConnection||console.log("components/Camera gotDescription: Error no this.peerConnection",a),this.peerConnection.setLocalDescription(e).then(()=>{this.wsConnection.send('{"direction":"publish", "command":"sendOffer", "streamInfo":'+JSON.stringify(this.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(this.userData)+"}")}).catch(t=>{console.log("components/Camera gotDescription, setLocalDescription error, description.sdp",t,e.sdp),this.setState({statusInfo:"Stream setup error: Retry!",settingsActive:!0,buttonDisabled:!1,buttonContent:s("Broadcast"),connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"})})}addAudio(e,t){var a=e.split(/\r\n/),s="",o=!1;for(var n in a){var i=a[n];i.length<=0||(s+=i,s+="\r\n",0=="a=rtcp-mux".localeCompare(i)&&0==o&&(s+=t,o=!0))}return s}addVideo(e,t){var a=e.split(/\r\n/),s="",o=!1,n=!1;for(var i in a){(r=a[i]).length<=0||(r.includes("a=rtcp-rsize")&&(n=!0),r.includes("a=rtcp-mux")&&!0)}for(var i in a){var r;s+=r=a[i],s+="\r\n",0=="a=rtcp-rsize".localeCompare(r)&&0==o&&1==n&&(s+=t,o=!0),0=="a=rtcp-mux".localeCompare(r)&&1==o&&0==n&&(s+=t,o=!0),0=="a=rtcp-mux".localeCompare(r)&&0==o&&0==n&&(o=!0)}return s}enhanceSDP(e,t){const a=this.props.config;var s,o=e.split(/\r\n/),n="header",i=!1,r="";if(!e.includes("THIS_IS_SDPARTA")||a.videoCodec.includes("VP9")){for(var c in o){if(!((d=o[c]).length<=0))if(!d.includes("urn:3gpp:video-orientation"))this.checkLine(d)&&(r+=d,r+="\r\n")}r=this.addAudio(r,this.deliverCheckLine(a.audioCodec,"audio")),o=(e=r=this.addVideo(r,this.deliverCheckLine(a.videoCodec,"video"))).split(/\r\n/),r=""}var l=!1,p=!1;for(var c in o){var d;if(!((d=o[c]).length<=0))if(0!=d.indexOf("m=audio")||-1==this.audioindex)if(0!=d.indexOf("m=video")||-1==this.videoIndex){if(r+=d,0===d.indexOf("m=audio")?(n="audio",i=!1):0===d.indexOf("m=video")?(n="video",i=!1):0==d.indexOf("a=rtpmap")&&(n="bandwidth",i=!1),(0===d.indexOf("a=mid:")||0==d.indexOf("a=rtpmap"))&&!i)if(0=="audio".localeCompare(n))void 0!==t.audioBitrate&&(r+="\r\nb=CT:"+t.audioBitrate,r+="\r\nb=AS:"+t.audioBitrate),i=!0;else if(0=="video".localeCompare(n))void 0!==t.videoBitrate&&(r+="\r\nb=CT:"+t.videoBitrate,r+="\r\nb=AS:"+t.videoBitrate,void 0!==t.videoFrameRate&&(r+="\r\na=framerate:"+t.videoFrameRate)),i=!0;else if(0=="bandwidth".localeCompare(n)){var m;if(null!==(m=this.getrtpMapID(d))){var h=m[2].toLowerCase();0!="vp9".localeCompare(h)&&0!="vp8".localeCompare(h)&&0!="h264".localeCompare(h)&&0!="red".localeCompare(h)&&0!="ulpfec".localeCompare(h)&&0!="rtx".localeCompare(h)||void 0===t.videoBitrate||l||(r+="\r\na=fmtp:"+m[1]+" x-google-min-bitrate=64000;x-google-start-bitrate="+1250*t.videoBitrate+";x-google-max-bitrate="+1250*t.videoBitrate,l=!0),0!="opus".localeCompare(h)&&0!="isac".localeCompare(h)&&0!="g722".localeCompare(h)&&0!="pcmu".localeCompare(h)&&0!="pcma".localeCompare(h)&&0!="cn".localeCompare(h)||void 0===t.audioBitrate||p||(r+="\r\na=fmtp:"+m[1]+" x-google-min-bitrate=16000;x-google-start-bitrate="+1250*t.audioBitrate+";x-google-max-bitrate="+1250*t.audioBitrate,p=!0)}}r+="\r\n"}else r+=(s=d.split(" "))[0]+" "+s[1]+" "+s[2]+" "+this.videoIndex+"\r\n";else r+=(s=d.split(" "))[0]+" "+s[1]+" "+s[2]+" "+this.audioindex+"\r\n"}void 0!==t.audioBitrate&&t.audioBitrate>0&&(r=this.setMediaBitrateSDP(r,"audio",t.audioBitrate)),void 0!==t.videoBitrate&&t.videoBitrate>0&&(r=this.setMediaBitrateSDP(r,"video",t.videoBitrate));if(navigator.userAgent.toLowerCase().indexOf("safari/")>-1)r=r.replace(/UDP\/TLS\/RTP\/SAVPF/gi,"RTP/SAVPF");return this.devMode&&console.log("components/Camera Resulting SDP: "+r,a.videoCodec,t.videoBitrate,a.audioCodec,t.audioBitrate),r}deliverCheckLine(e,t){var a="";for(var s in this.SDPOutput){var o=this.SDPOutput[s];if(a+=s,o.includes(e)){if(e.includes("VP9")||e.includes("VP8")){var n="",i=o.split(/\r\n/);for(var r in i){var c=i[r];-1===c.indexOf("transport-cc")&&-1===c.indexOf("goog-remb")&&-1===c.indexOf("nack")&&(n+=c,n+="\r\n")}return t.includes("audio")&&(this.audioindex=s),t.includes("video")&&(this.videoIndex=s),n}return t.includes("audio")&&(this.audioindex=s),t.includes("video")&&(this.videoIndex=s),o}}return a}checkLine(e){if(e.startsWith("a=rtpmap")||e.startsWith("a=rtcp-fb")||e.startsWith("a=fmtp")){var t=e.split(":");if(t.length>1){var a=t[1].split(" ");if(!isNaN(a[0])&&!a[1].startsWith("http")&&!a[1].startsWith("ur")){var s=this.SDPOutput[a[0]];return s||(s=""),s+=e+"\r\n",this.SDPOutput[a[0]]=s,!1}}}return!0}getrtpMapID(e){var t=new RegExp("a=rtpmap:(\\d+) (\\w+)/(\\d+)"),a=e.match(t);return a&&a.length>=3?a:null}errorHandler(e){this.devMode&&console.log("components/Camera ",e)}onicecandidate(e){null!=e.candidate&&this.devMode&&console.log("components/Camera gotIceCandidate: "+JSON.stringify({ice:e.candidate}))}onsignalingstatechange(){const e=this.txt;let t;this.peerConnection&&(t=this.peerConnection.signalingState,this.devMode&&console.log("components/Camera onsignalingstatechange state, peerConnection, wsConnection  ".concat(t),this.peerConnection.signalingState,this.peerConnection.readyState,this.peerConnection,this.wsConnection),"have-local-offer"==t&&"new"==this.peerConnection.iceConnectionState&&(this.setState({buttonDisabled:!1,buttonContent:e("Stop Broadcast"),statusInfo:e("Broadcasting")}),this.props.appStateUpdate({cameraStatus:"pending"}),this.retryIfTimeoutSet||(setTimeout(()=>this.retryIfTimeout(),this.retryTimeout),this.retryIfTimeoutSet=!0)))}oniceconnectionstatechange(){const e=this.props,t=this.txt;let a;this.peerConnection&&(a=this.peerConnection.iceConnectionState,this.devMode&&console.log("components/Camera oniceconnectionstatechange peerConnection.iceConnectionState ".concat(a),this.peerConnection.iceConnectionState,this.peerConnection.iceGatheringState,this.peerConnection.readyState),"completed"!==a&&"connected"!==a||(this.setState({settingsActive:!1,buttonDisabled:!1,buttonContent:t("Stop Broadcast"),statusInfo:t("Broadcasting"),connecting:!1,connected:!0,bitrateInfo:o.a.createElement(u.a,{name:"clock"})}),e.serverUpdate({task:"media",connected:!0}),e.appStateUpdate({publishRequired:!1,cameraStatus:"live"}),this.peerConnection&&this.peerConnection.getSenders().forEach(e=>{if(e.track){var t=e.getParameters();t.encodings||(t.encodings=[{}]),"audio"==e.track.kind&&this.enhanceData.audioBitrate&&(t.encodings[0].maxBitrate=1e3*this.enhanceData.audioBitrate),"video"==e.track.kind&&this.enhanceData.videoBitrate&&(t.encodings[0].maxBitrate=1e3*this.enhanceData.videoBitrate),e.setParameters(t),this.devMode&&console.log("components/Camera oniceconnectionstatechange ",e.track.kind,t)}})),"failed"!==a&&"disconnected"!==a&&"closed"!==a||(this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:t("Broadcast"),statusInfo:a,connecting:!1,connected:!1,bitrateInfo:o.a.createElement(u.a,{name:"eye slash"})}),e.serverUpdate({task:"media",connected:!1}),e.appStateUpdate({cameraStatus:"off"})))}}x.propTypes={appState:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired,user:k.a.object.isRequired,serverUpdate:k.a.func.isRequired,appStateUpdate:k.a.func.isRequired,cameraConfig:k.a.object};a(408);var w=a(289),U=a(274),I=a(544),D=a(291);class R extends s.Component{constructor(e){super(e),this.txt=e=>{const t=this.props;return t.config&&e in t.config.text?t.config.text[e]:e},this.onSubmit=e=>{e.preventDefault();const t=this.props,a=this.state;if(this.devMode&&console.log("ChatInput onSubmit",this.state),!this.state)return;const s=this.state.message;if(0!==s.length){switch(s){case"/vws dev":t.appStateUpdate({devMode:!0}),console.log("components/ChatInput devMode Enabled",this.state)}var o={userID:t.user.ID,userName:t.user.name,userAvatar:t.user.avatar,notification:!1,text:s,time:(new Date).valueOf(),mentionMessage:0,mentionUser:"",ID:(new Date).valueOf()};0!=t.appState.chatMentionMessage&&("message"!=a.mention&&"replyat"!=a.mention||(o.mentionMessage=t.appState.chatMentionMessage)),""!=t.appState.chatMentionUser&&("user"!=a.mention&&"replyat"!=a.mention||(o.mentionUser=t.appState.chatMentionUser)),t.sendMessage(o),this.setState({message:""}),t.appStateUpdate({chatMentionMessage:0,chatMentionUser:""})}},this.emojiModalClose=()=>this.setState({emojiModalShow:!1}),this.onEmojiButton=()=>{this.setState({emojiModalShow:!0})},this.addEmoji=e=>{this.devMode&&console.log("components/ChatInput addEmoji",e);var t=this.state.message;e&&e.native&&(t+=e.native),this.setState({emojiModalShow:!1,message:t})},this.onMentionChange=(e,t)=>{this.devMode&&console.log("components/ChatInput onMentionChange",t),"cancel"==t.value?this.props.appStateUpdate({chatMentionMessage:0,chatMentionUser:""}):this.setState({mention:t.value})},this.devMode=e.appState.devMode,this.state={message:"",mention:"replyat",container:null,emojiModalShow:!1},this.inputRef=o.a.createRef(),this.onChange=this.onChange.bind(this)}componentDidMount(){}onChange(e){const t=e.target;var a="checkbox"===t.type?t.checked:t.value;const s=t.name;"message"==s&&(a=Object(U.checkText)(a)),this.setState({[s]:a})}render(){const e=this.props,t=this.onSubmit,a=this.state,s=this.onChange,n=this.txt;var i;i=o.a.createElement(g.a,{key:"emojiModal",closeIcon:!0,open:a.emojiModalShow,onClose:this.emojiModalClose,size:"small",basic:e.appState.darkMode},o.a.createElement(v.a,{icon:"smile",content:n("Emoji")}),o.a.createElement(g.a.Content,null,o.a.createElement(w.a,{onSelect:this.addEmoji,darkMode:e.appState.darkMode,native:!0,perLine:16})),o.a.createElement(g.a.Actions,null,o.a.createElement(h.a,{inverted:e.appState.darkMode,color:"red",onClick:this.emojiModalClose},o.a.createElement(u.a,{name:"remove"})," ",n("Nevermind"))));var r="";if(0!=e.appState.chatMentionMessage||""!=e.appState.chatMentionUser){const t=[{key:1,text:o.a.createElement(u.a,{name:"arrow up"}),value:"message"},{key:2,text:o.a.createElement(u.a,{name:"at"}),value:"user"},{key:3,text:o.a.createElement(u.a,{name:"reply"}),value:"replyat"},{key:4,text:o.a.createElement(u.a,{name:"close"}),value:"cancel"}];r=o.a.createElement(C.a,{className:e.appState.className,compact:!0,inline:!0,options:t,defaultValue:a.mention,selection:!0,onChange:this.onMentionChange})}return o.a.createElement("div",{className:"panel",style:{backgroundColor:e.appState.backgroundColor},ref:e=>this.state.container=e},o.a.createElement("div",{className:"controlsBottom"},o.a.createElement(b.a,{onSubmit:t,className:e.appState.className},o.a.createElement(b.a.Group,{inline:!0,unstackable:!0},o.a.createElement(I.a,{inverted:e.appState.darkMode,attached:"left",fluid:!0,focus:!0,name:"message",value:a.message,onChange:s,type:"text",placeholder:n("Type your message")},o.a.createElement(D.a,{src:e.user.avatar,verticalAlign:"middle",avatar:!0,"data-tooltip":e.user.name})," ",o.a.createElement("label",null,o.a.createElement("small",null,e.user.name),"\xa0"),o.a.createElement("div",{style:{zIndex:4}},r),o.a.createElement(h.a,{compact:!0,icon:!0,type:"button",color:"yellow","data-tooltip":n("Emoticons"),onClick:this.onEmojiButton,inverted:e.appState.darkMode},o.a.createElement(u.a,{name:"smile"})),o.a.createElement("input",{ref:this.inputRef}),o.a.createElement(h.a,{compact:!0,primary:!0,icon:!0,type:"submit","data-tooltip":n("Send"),inverted:e.appState.darkMode},o.a.createElement(u.a,{name:"send"})))))),i)}}class N extends s.Component{render(){const e=this.props,t=e.message,a=t.userID===e.userID,s=t.notification,n=e.previousUser===t.userID,i=t.time-e.previousTime<6e4;var r=t.userAvatar?o.a.createElement(D.a,{src:t.userAvatar,avatar:!0,verticalAlign:"middle"}):"";const c=new Date(t.time),l=c.toLocaleDateString()+" at "+c.toLocaleTimeString();var p="chatMessage "+(e.darkMode?"dark ":"")+(s?"notification":"user")+" "+(a?"own ":"")+(t.automated?"automated":""),d=n||s?"":o.a.createElement("strong",null," ",r," ",t.userName," (",t.userID,")"),m=n&&i?"":o.a.createElement("i",null,l),g=d||m?o.a.createElement(o.a.Fragment,null,d," ",m,":",o.a.createElement("br",null)):"",v="";return t.image&&(v=o.a.createElement(D.a,{src:t.image,size:"mini",rounded:!0,verticalAlign:"middle"})),o.a.createElement("li",{className:p,key:t.ID,ref:e.messageRef},g,v,0!=t.mentionMessage&&void 0!=t.mentionMessage?o.a.createElement(h.a,{"data-tooltip":e.txt("Scrool to Message"),onClick:a=>e.messageScroll(a,t.mentionMessage),size:"tiny",className:e.darkMode?"inverted ":"",target:"_blank",compact:!0,icon:!0}," ",o.a.createElement(u.a,{name:"arrow up",size:"small"})," "):"",""!=t.mentionUser&&void 0!=t.mentionUser?o.a.createElement("span",null," @",t.mentionUser,o.a.createElement("br",null)):"",o.a.createElement("label",{id:"m"+t.ID,onClick:a=>e.messageClick(a,t.ID,t.userName)},t.text.split("\n").map((e,t)=>o.a.createElement("div",{key:t},e)),t.url?o.a.createElement(h.a,{className:e.darkMode?"inverted ":"",target:"_blank",href:t.url,compact:!0,icon:!0},o.a.createElement(u.a,{name:"linkify"})):""))}}class A extends s.Component{constructor(e){super(e),this.txt=e=>{const t=this.props;return t.config&&e in t.config.text?t.config.text[e]:e},this.onScroll=()=>{this.refs.messageList.scrollTop},this.scrollToBottom=()=>{const e=this.refs.messageList,t=e.scrollHeight-e.clientHeight;i.a.findDOMNode(e).scrollTop=t>0?t:0},this.messageClick=(e,t,a)=>{this.devMode&&console.log("components/ChatHistory messageClick",t,a,this.devMode,e),e.stopPropagation();const s=this.props;s.appState.chatMentionMessage==t&&s.appState.chatMentionUser==a||s.appStateUpdate({chatMentionMessage:t,chatMentionUser:a})},this.messageScroll=(e,t)=>{this.devMode&&console.log("components/ChatHistory messageScroll",t,this.messageRefs[t]),e.stopPropagation(),this.messageRefs&&this.messageRefs[t]&&this.messageRefs[t].current&&this.messageRefs[t].current.scrollIntoView({behavior:"smooth",block:"start"})},this.devMode=e.appState.devMode,this.messageRefs={},this.state={container:null}}componentDidMount(){}componentDidUpdate(){this.scrollToBottom()}render(){const e=this.props,t=this.onScroll;this.devMode=e.appState.devMode;var a=!1;let s;(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&(a=!0);var n=0,i=0,r=0;return this.messageRefs={},s=e.messages.length>0?o.a.createElement("ul",{className:"chatMessageList",ref:"messageList",onScroll:t},e.messages.map(t=>{a&&t.modeText&&(t.text=e.appState.tooltip,t.url=e.appState.tooltipURL,t.image=e.appState.tooltipImage),this.messageRefs[t.ID]||(this.messageRefs[t.ID]=o.a.createRef());const s=o.a.createElement(N,{txt:this.txt,messageRef:this.messageRefs[t.ID],messageClick:this.messageClick,messageScroll:this.messageScroll,darkMode:e.appState.darkMode,userID:e.user.ID,message:t,key:t.ID,previousUser:n,previousTime:i});return n=t.userID,i=t.time,t.modeText&&!a||r===t.ID?"":(r=t.ID,s)})):o.a.createElement("ul",{className:"chatMessageList",ref:"messageList",onScroll:t},o.a.createElement("li",{className:"chatMessage",key:"0"},o.a.createElement("span",null,"No Messages."))),o.a.createElement("div",{className:"panel",style:{backgroundColor:e.appState.backgroundColor},ref:e=>this.state.container=e},o.a.createElement("div",{className:"controls"},s))}}var L=a(550),T=a(553),P=a(554);class O extends s.Component{constructor(e){super(e),this.txt=e=>{const t=this.props;return e in t.config.text?t.config.text[e]:e},this.privateModalClose=()=>this.setState({privateModalShow:!1}),this.fullscreenModalClose=()=>this.setState({fullscreenRecommended:!0}),this.handleFullscreenChange=e=>{var t=!1;(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(t=!0),this.setState({fullscreen:t})},this.toHHMMSS=function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),s=e-3600*t-60*a;return t<10&&(t="0"+t),a<10&&(a="0"+a),s<10&&(s="0"+s),t+":"+a+":"+s},this.state={tipLast:0,fullpage:!1,fullscreenRecommended:!1,fullscreen:!1,tipsOpen:!1,privateModalShow:!1,privateLoading:!1,requestModalShow:!1,requestDetails:"Details for request modal: No action meta info!",requestAction:{ID:0},displayTime:"00:00"},this.devMode=e.appState.devMode}updateTime(e){this.setState({displayTime:this.toHHMMSS(Math.floor(e/1e3))})}onClick(e,{name:t,value:a}){const s=this.state,o=this.props;var n;switch(this.devMode&&console.log("components/Actions onClick",t,a,e,"props:",o),t){case"fullpage":this.state.fullpage=!s.fullpage,this.setState({fullpage:this.state.fullpage}),this.fullpage();break;case"sfx":var i=!o.appState.sfx;i&&o.appSfx("message",null,!0),o.appStateUpdate({sfx:i}),o.serverUpdate({task:"options",name:"h5v_sfx",value:i});break;case"darkMode":var r=!o.appState.darkMode;o.appStateUpdate({darkMode:r}),o.serverUpdate({task:"options",name:"h5v_dark",value:r});break;case"fullscreenRecommended":o.config.actionFullpage&&(this.setState({fullpage:!0}),this.fullpage());case"fullscreen":if(this.state.fullscreenRecommended=!0,s.fullscreen)this.exitFullscreen();else{const e=document.getElementById("videowhisperVideochat");this.requestFullscreen(e)}break;case"tip":if("undefined"===typeof a)break;const l=parseInt(a);if(o.room.tips&&o.room.tipOptions.length>0&&o.room.tipOptions.length>l){const e=o.room.tipOptions[l];o.serverUpdate({task:"tip",tip:e,tipsURL:o.room.tipsURL,targetID:o.room.performerID}),this.setState({tipsOpen:!1,tipLast:Date.now()}),console.log("components/Actions sending tip",e,l)}break;case"next":o.serverUpdate({task:"next",targetID:o.room.performerID});break;case"party_return":o.serverUpdate({task:"party_return"});break;case"party_leave":o.serverUpdate({task:"party_leave"});break;case"reveal":o.appStateUpdate({revealed:!0,publishRequired:!0});break;case"private":this.setState({privateModalShow:!0});break;case"privateClose":n={action:"privateRequest",ID:o.room.actionID,privateUID:o.room.privateUID,status:7},o.serverUpdate({task:"interaction-close",interaction:n});break;case"privateRequest":this.setState({privateLoading:!0,privateModalShow:!1});var c={userName:o.user.name};n={action:"privateRequest",userID:o.user.ID,roomID:o.room.ID,targetID:o.room.performerID,meta:c},o.serverUpdate({task:"interaction",interaction:n});break;case"declineRequest":this.setState({requestModalShow:!1}),n={ID:s.requestAction.ID,answer:0,status:2},o.serverUpdate({task:"interaction-answer",interaction:n});break;case"acceptRequest":this.setState({requestModalShow:!1}),n={ID:s.requestAction.ID,answer:1,status:2},o.serverUpdate({task:"interaction-answer",interaction:n});break;default:console.log("components/Actions onClick UNHANDLED",t,a,e)}}fullpage(){const e=document.getElementById("videowhisperVideochat");this.state.fullpage?(e.style.position="fixed",e.style.top="0",e.style.left="0"):e.style.position="absolute",console.log("components/Actions fullpage",this.state.fullpage,e.style.position)}componentDidMount(){document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("msfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("MSFullscreenChange",this.handleFullscreenChange,!1),document.addEventListener("fullscreenchange",this.handleFullscreenChange,!1)}componentWillUnmount(){document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullscreenChange),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullscreenChange),document.removeEventListener("fullscreenchange",this.handleFullscreenChange)}requestFullscreen(e){var t=!0;this.state.fullscreen=t,e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1,this.state.fullscreen=!1),this.setState({fullscreen:t})}exitFullscreen(){this.setState({fullscreen:!1}),(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.log("components/Actions Fullscreen API is not supported."))}componentDidUpdate(e){e.actions!==this.props.actions&&this.processActions()}processActions(){const e=this.props,t=this.state;e.actions.length>0&&e.actions.forEach(a=>{if(a)if(a.userID===e.user.ID){if("privateRequest"===a.action){if(3===a.status&&1===a.answer){a={ID:t.requestAction.ID,status:5};e.serverUpdate({task:"interaction-confirm",interaction:a})}a.status>=3&&a.status<7&&a.answer}}else if("privateRequest"===a.action){if(a.status<2&&e.room.privateUID!==a.userID&&(e.appSfx("call"),t.requestModalShow=!0,a.meta&&this.setState({requestDetails:'User "'+a.meta.userName+'" requested starting a private call.'}),t.requestAction=a),2===a.status&&1===a.answer){a={ID:t.requestAction.ID,status:3};e.serverUpdate({task:"interaction-answer",interaction:a})}a.status>=3&&a.status<7&&a.answer}})}componentWillReceiveProps(e){}render(){const e=this.props,t=this.state,a=this.txt,s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;var n=[];if(s||t.fullscreenRecommended||window.innerWidth<800&&n.push(o.a.createElement(g.a,{key:"recommendFullscreen",closeIcon:!0,open:!0,onClose:this.fullscreenModalClose,size:"small"},o.a.createElement(v.a,{icon:"star",content:"FullScreen Recommended"}),o.a.createElement(g.a.Content,null,o.a.createElement("h3",null,"When available space is small, fullscreen is recommended to access interface more easily.")),o.a.createElement(g.a.Actions,null,o.a.createElement(h.a,{color:"orange",onClick:this.fullscreenModalClose},o.a.createElement(u.a,{name:"remove"})," Nevermind"),o.a.createElement(h.a,{color:"green",name:"fullscreenRecommended",onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:"expand"})," Go Fullscreen")))),e.config.siteMenu){var i=[],r=[],c=null;e.config.siteMenu.forEach(t=>{t.parentID?r.push(o.a.createElement(C.a.Item,{key:t.ID,href:t.url,target:"_blank"}," ",t.title," ")):(r.length?(i.push(o.a.createElement(C.a,{className:e.appState.className,item:!0,key:c.ID,text:c.title},o.a.createElement(C.a.Menu,null,r))),r=[]):c&&i.push(o.a.createElement(L.a.Item,{key:c.ID,href:c.url,target:"_blank"}," ",c.title," ")),c=t)}),n.push(o.a.createElement(T.a,{className:e.appState.className,key:"siteMenu",trigger:o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small"},o.a.createElement(u.a,{name:"align justify"})),flowing:!0,hoverable:!0},o.a.createElement(L.a,{vertical:!0,className:e.appState.className},o.a.createElement(L.a.Item,{header:!0},a("Site Menu")),i)))}if(n.push(o.a.createElement(h.a,{className:e.appState.className,size:"small",key:"balance",name:"balance",as:"div",labelPosition:"right"},o.a.createElement(h.a,{className:e.appState.className,size:"small",color:"green",target:"_balance",href:e.config.balanceURL},o.a.createElement(u.a,{name:"money"})),o.a.createElement(E.a,{className:e.appState.className,as:"a",color:e.appState.darkMode?"black":"grey",pointing:"left",target:"_balance",href:e.config.balanceURL},e.user.balance))),e.room.tips&&e.room.tipOptions.length>0){var l=0;const s=o.a.createElement(o.a.Fragment,null,e.room.tipOptions.map((t,s)=>{if("TIP"===t.tag&&"custom"!==t.attributes.AMOUNT)return l++,o.a.createElement(P.a.Column,{className:e.appState.className,key:"tip"+s,textAlign:"center"},o.a.createElement(v.a,{as:"h4",className:e.appState.className},t.attributes.IMAGE?o.a.createElement(D.a,{src:e.room.tipsURL+t.attributes.IMAGE,size:"mini",rounded:!0,verticalAlign:"middle"}):""," ",t.attributes.AMOUNT),o.a.createElement("b",null,t.attributes.LABEL),o.a.createElement("div",null,t.attributes.NOTE),o.a.createElement("div",null,o.a.createElement(h.a,{compact:!0,className:e.appState.className,size:"small",color:"olive",name:"tip",value:s,onClick:this.onClick.bind(this)},a("Gift"))))}));n.push(o.a.createElement(T.a,{className:e.appState.className,key:"tipsPopup",trigger:o.a.createElement(h.a,{className:e.appState.className,size:"small",key:"tipsButton",name:"tipsButton",color:"olive",disabled:Date.now()-t.tipLast<5e3}," ",o.a.createElement(u.a,{name:"box"})," ",a("Gifts")),flowing:!0,hoverable:!0,open:this.state.tipsOpen,onOpen:()=>this.setState({tipsOpen:!0}),onClose:()=>this.setState({tipsOpen:!1})},o.a.createElement(P.a,{className:e.appState.className,stackable:!0,centered:!0,divided:!0,columns:l,style:{overflow:"auto",maxHeight:180,maxWidth:480}},s)))}var p=!0,d=a("Request Private 2 Way Videochat Show");if(e.room.actionPrivateDisable)d=a("Performer Disabled Private Requests");else if(e.room.actionPrivateBusy)d=a("Performer is Busy in Private");else if(e.room.users){e.room.users[e.room.performerID]?p=!1:d=a("Performer is Not Online")}if(e.room.actionPrivate&&n.push(o.a.createElement("span",{key:"private","data-tooltip":d},o.a.createElement(h.a,{className:e.appState.className,size:"small",name:"private",color:"orange",loading:t.privateLoading,disabled:t.privateLoading||p,onClick:this.onClick.bind(this)}," ",o.a.createElement(u.a,{name:"star"})," ",a("Request Private")))),e.room.actionPrivateClose&&n.push(o.a.createElement(h.a,{className:e.appState.className,size:"small",key:"privateClose",name:"privateClose",color:"red",onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:"window close"})," ",a("Close Private"))),n.push(o.a.createElement(g.a,{key:"privateModal",closeIcon:!0,open:t.privateModalShow,onClose:this.privateModalClose,size:"small"},o.a.createElement(v.a,{icon:"star",content:a("Request Private 2 Way Videochat Show")}),o.a.createElement(g.a.Content,null,o.a.createElement("h3",null,e.room.performer)),o.a.createElement(g.a.Actions,null,o.a.createElement(h.a,{color:"red",onClick:this.privateModalClose},o.a.createElement(u.a,{name:"remove"})," ",a("Nevermind")),o.a.createElement(h.a,{color:"green",name:"privateRequest",onClick:this.onClick.bind(this),loading:t.privateLoading,disabled:t.privateLoading},o.a.createElement(u.a,{name:"star"})," ",a("Request Private"))))),n.push(o.a.createElement(g.a,{key:"requestModal",open:t.requestModalShow,closeOnEscape:!1,closeOnDimmerClick:!1,size:"small"},o.a.createElement(v.a,{icon:"star",content:"Answer Private Show Request"}),o.a.createElement(g.a.Content,null,o.a.createElement("h3",null,t.requestDetails)),o.a.createElement(g.a.Actions,null,o.a.createElement(h.a,{color:"red",name:"declineRequest",onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:"remove"})," ",a("Decline")),o.a.createElement(h.a,{color:"green",name:"acceptRequest",onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:"star"})," ",a("Accept"))))),e.room.next&&n.push(o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",key:"next",name:"next",color:"teal","data-tooltip":a("Next: Random Videochat Room"),onClick:this.onClick.bind(this),disabled:e.appState.roomLoading},a("Next")," ",o.a.createElement(u.a,{name:"arrow right"}))),e.room.partyHost?n.push(o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",key:"party_return",name:"party_return",color:"teal","data-tooltip":a("Return Party to Start Room"),onClick:this.onClick.bind(this),disabled:e.appState.roomLoading},a("Return")," ",o.a.createElement(u.a,{name:"arrow circle left"}))):e.room.party&&n.push(o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",key:"party_leave",name:"party_leave",color:"teal","data-tooltip":a("Leave Party"),onClick:this.onClick.bind(this),disabled:e.appState.roomLoading},a("Leave")," ",o.a.createElement(u.a,{name:"close"}))),e.appState.revealMode&&!e.appState.audioMode&&!e.room.audioOnly&&!e.appState.revealed&&"Way2Screen"==e.appState.screen){var m=e.appState.revealWarmup-e.appState.screenTime,f=!0;m<=0?(m="",f=!1):m=o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"clock"})," ",m," "),n.push(o.a.createElement("span",{"data-tooltip":a("Reveal Webcam")},o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",key:"reveal",name:"reveal",color:"olive",onClick:this.onClick.bind(this),disabled:f},o.a.createElement(u.a,{name:"video"})," ",a("Reveal")," ",m)))}if(s||e.config.actionFullscreen&&n.push(o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",floated:"right",key:"fullscreen",name:"fullscreen",color:"grey","data-tooltip":t.fullscreen?a("Exit Fullscreen"):a("Enter Fullscreen"),onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:t.fullscreen?"compress":"expand"}))),e.config.actionFullpage&&n.push(o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",floated:"right",key:"fullpage",name:"fullpage",color:"grey","data-tooltip":t.fullpage?"Zoom Out of Full Page":"Zoom Into Full Page",onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:t.fullpage?"zoom-out":"zoom-in"}))),n.push(o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",floated:"right",key:"sfx",name:"sfx",color:e.appState.sfxError?"red":e.appState.sfx?"green":"yellow","data-tooltip":e.appState.sfxError?a("Tap to Play"):e.appState.sfx?a("Sfx On"):a("Sfx Off"),onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:e.appState.sfxError?"deaf":e.appState.sfx?"bell":"bell slash"}))),n.push(o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",floated:"right",key:"darkMode",name:"darkMode",color:e.appState.darkMode?"yellow":"grey","data-tooltip":e.appState.darkMode?a("Lights On"):a("Dark Mode"),onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:e.appState.darkMode?"sun":"moon"}))),(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&n.push(o.a.createElement(h.a,{className:e.appState.className,size:"small",floated:"right",key:"videowhisper",name:"videowhisper",color:"blue",target:"_videowhisper",href:e.appState.tooltipURL,"data-tooltip":e.appState.tooltip},o.a.createElement(u.a,{name:"eye"})," Free")),n.push(o.a.createElement(h.a,{className:e.appState.className,size:"small",floated:"right",key:"time",name:"time",as:"div",labelPosition:"right"},o.a.createElement(h.a,{className:e.appState.className,size:"small",color:"yellow"},o.a.createElement(u.a,{name:"time"})),o.a.createElement(E.a,{className:e.appState.className,as:"a",color:e.appState.darkMode?"black":"grey",pointing:"left"},t.displayTime))),e.room.actionButtons)for(var S in e.room.actionButtons){var b=e.room.actionButtons[S];n.push(o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",floated:b.floated,key:b.name,name:b.name,color:b.color,target:"_"+b.target,href:b.url,"data-tooltip":b.tooltip},o.a.createElement(u.a,{name:b.icon})," ",b.text))}return o.a.createElement("div",{className:"panel",style:{backgroundColor:e.appState.backgroundColor},ref:e=>this.state.container=e},o.a.createElement("div",{className:"controlsBottom"},n))}}class V extends s.Component{constructor(e){super(e),this.componentActions=o.a.createRef()}render(){const e=this.props;return o.a.createElement("div",{className:"layoutBroadcast",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layCamera"},o.a.createElement(x,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layHistory"},o.a.createElement(A,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(R,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}class q extends s.Component{constructor(e){super(e),this.componentActions=o.a.createRef()}render(){const e=this.props;return o.a.createElement("div",{className:"layoutBroadcastAudio",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layHistory"},o.a.createElement(A,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(R,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})),o.a.createElement("div",{className:"layCamera"},o.a.createElement(x,{cameraConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})))}}var W=a(171),F=a.n(W),B=a(286),H=a(545);class z extends M{constructor(e){super(e),this.onLoadedData=e=>{const t=this.remoteVideo.current;this.devMode&&console.log("components/Video - loadeddata"),this.updateVideoSize("onLoadedData"),t.paused&&0==t.currentTime&&(console.log("components/Video loadeddata : video paused on load - try to play",t.src,e),this.videoPlay())},this.onopen=function(e){var t=this.state;this.devMode&&console.log("components/Video wsConnection.onopen wsConnection.readyState:",this.wsConnection.readyState,e,this.state),this.props.appStateUpdate({wsOpen:!0,wsComponent:"Video onopen"}),1==this.wsConnection.readyState&&(t.retrying=!1,this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.addEventListener("icecandidate",e=>this.icecandidate(this.peerConnection,e)),this.peerConnection.onsignalingstatechange=e=>this.onsignalingstatechange(e),this.peerConnection.addEventListener("iceconnectionstatechange",e=>this.iceconnectionstatechange(this.peerConnection,e)),this.peerConnection.addEventListener("track",this.track.bind(this)),this.wsConnection?1==this.wsConnection.readyState?this.sendPlayGetOffer():console.log("components/Video wsConnection not open for sendPlayGetOffer wsConnection.readyState:",this.wsConnection.readyState):console.log("components/Video wsConnection not available"))},this.onmessage=function(e){var t=this.state;this.devMode&&console.log("components/Video onmessage",e);var a=JSON.parse(e.data),s=Number(a.status),o=a.command;let n="";if(t.retryCount++,200!=s)n=a.statusDescription,t.available&&(504===s||514===s||t.retryCount<t.autoRetries&&"1"===this.props.config.videoAutoPlay)?1===this.wsConnection.readyState?(this.devMode&&console.log("components/Video onmessage - Not ready: scheduling sendPlayGetOffer",s,n),setTimeout(this.sendPlayGetOffer.bind(this),2500),n=n+" (retry #"+t.retryCount+")",this.setState({buttonDisabled:!0,buttonContent:"Auto Retry",statusInfo:n,connecting:!0,connected:!1})):(console.log("components/Video onmessage - wsConnection Not open for sendPlayGetOffer wsConnection.readyState:",this.wsConnection.readyState),this.setState({buttonDisabled:!1,buttonContent:"Retry",statusInfo:n,connecting:!1,connected:!1})):this.stopStreamPlay(),this.setState({statusInfo:n});else{this.devMode&&console.log("components/Video onmessage 200 msgJSON",a);var i=a.streamInfo;void 0!==i&&(this.state.streamInfo.sessionId=i.sessionId),void 0!==a.sdp&&(this.devMode&&console.log("components/Video onmessage: setRemoteDescription sdp: "+JSON.stringify(a.sdp)),this.peerConnection.setRemoteDescription(a.sdp).then(this.peerCreateAnswer.bind(this)).catch(this.errorHandler.bind(this)));var r=a.iceCandidates;if(void 0!==r)for(var c in r)this.devMode&&console.log("addIceCandidate: "+JSON.stringify(r[c])),this.peerConnection.addIceCandidate(new RTCIceCandidate(r[c])).then(()=>this.onAddIceCandidateSuccess(this.peerConnection),e=>this.onAddIceCandidateError(this.peerConnection,e));0=="sendResponse".localeCompare(o)&&null!=this.wsConnection&&this.wsConnection.close()}},this.devMode=e.appState.devMode,this._isMounted=!1,this.devMode&&console.log("components/Video constructor",e),this.audioInterface=!1,e.videoConfig&&(this.audioInterface=e.videoConfig.audioInterface),this.playStarted=!1,this.retriesLeft=5,this.retryTimeout=5e3,this.retryIfTimeoutSet=!1,this.wsWaited=0,this.remoteVideo=o.a.createRef(),this.wsConnection=null,this.peerConnection=null,this.peerConnectionConfig={iceServers:[]},this.userData={},this.startTime=null,this.stats={video:{timestamp:0,bandwidth:0},audio:{timestamp:0,bandwidth:0}},this.state={packetLoss:!1,streamInfo:{applicationName:e.config.application,streamName:e.room.streamPlayback,userName:e.room.performer,sessionId:"[empty]"},panelType:"Video",meta:e.meta,bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"eye slash"}),"Detecting"),videoMuted:"muted",videoMutedMessage:"Tap for Sound",fullscreen:!1,available:!1,connected:!1,connecting:!1,autoRetries:3,statusInfo:"Connecting...",buttonContent:"Connecting",buttonDisabled:!0,videoWidth:640,videoHeight:360,videoAspectRatio:1.77,retryCount:0,retrying:!1}}interfaceReady(){var e=this.props,t=this.state;this.streamInfoReset(),this.devMode&&console.log("components/Video - interfaceReady",t.streamInfo),("1"===e.config.videoAutoPlay||t.available)&&this.startStreamPlay()}updateVideoSize(e){var t=this.remoteVideo.current;this.devMode&&console.log("components/Video updateVideoSize",e,t);var a=this.state;let s;if(t.videoHeight&&(a.videoWidth===t.videoWidth&&a.videoHeight===t.videoHeight||(a.videoWidth=t.videoWidth,a.videoHeight=t.videoHeight,a.videoHeight||(a.videoHeight=1),this.setState({videoWidth:t.videoWidth,videoHeight:t.videoHeight})),s=t.videoWidth/t.videoHeight,a.videoAspectRatio!==s&&this.setState({videoAspectRatio:s}),this.startTime)){const e=window.performance.now()-this.startTime;this.devMode&&console.log("components/Video updateVideoSize Remote Video playback setup time: "+e.toFixed(3)+"ms"),this.startTime=null}this.devMode&&console.log("components/Video updateVideoSize "+e,a.videoWidth,a.videoHeight,s)}componentDidMount(){this.devMode&&console.log("components/Video componentDidMount"),this._isMounted=!0,super.componentDidMount(),this.interfaceReady()}componentWillUnmount(){this.devMode&&console.log("components/Video stopStreamPlay"),this._isMounted=!1,this.stopStreamPlay(),super.componentWillUnmount()}static getDerivedStateFromProps(e,t){var a,s={};s.streamInfo=t.streamInfo;var o=!1;return e.room.users&&(e.content?(a=e.room.users[e.content.userID])&&(s.streamInfo.streamName=e.content.stream):(a=e.room.users[e.room.streamUID])&&(s.streamInfo.streamName=e.room.streamPlayback),a&&a.meta&&a.meta.connected&&a.sdate<a.meta.connectedUpdate&&(o=!0),a&&(s.streamInfo.userName=a.userName)),o!==t.available?(s.available=o,e.appState.devMode&&console.log("components/Video - getDerivedStateFromProps nowAvailable",s,a),s):null}componentDidUpdate(e,t,a){const s=this.state;s.available&&(s.connected||s.connecting||s.retrying||(this.devMode&&console.log("components/Video - componentDidUpdate: startStreamPlay"),this.startStreamPlay()))}timerStart(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.packetsLost=0,this.stats.audio.packetsLost=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),2500),this.devMode&&console.log("components/Video timerStart"),this.setState({packetLoss:!1})}timerStop(){clearInterval(this.timer),this.devMode&&console.log("components/Video timerStop"),this.setState({packetLoss:!1})}timerTick(){if(!this._isMounted)return;if(!this.state.connected)return;if(!this.peerConnection)return;this.peerConnection.getReceivers().forEach(e=>{e.getStats().then(e=>{e.forEach(e=>{this.devMode&&e.packetsLost&&e.packetsLost>0&&console.log("components/Video packetsLost ",e.packetsLost,e);var t=e.kind;if(void 0===t&&(t=e.mediaType),"inbound-rtp"==e.type&&(this.stats[t].packetsLost=e.packetsLost,this.stats[t].roundTripTime=e.roundTripTime,this.stats[t].jitter=e.jitter,this.stats[t].timestampRemote=e.timestamp),"inbound-rtp"===e.type&&!e.isRemote&&("video"===t||"audio"===t)){var a=e.timestamp-this.stats[t].timestamp;a>0&&a<6e3&&e.bytesReceived>=this.stats[t].bytesReceived&&(this.stats[t].bitrate=8*(e.bytesReceived-this.stats[t].bytesReceived)/a),this.stats[t].timestamp=e.timestamp,this.stats[t].bytesReceived=e.bytesReceived,this.stats[t].qualityLimitationReason=e.qualityLimitationReason}})})});var e=o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"video"}),Math.round(this.stats.video.bitrate)," kbps","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":"",this.stats.video.roundTripTime>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"clock"}),this.stats.video.roundTripTime," "):"",this.stats.video.jitter>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"circle notch"}),Math.round(1e3*(this.stats.video.jitter+Number.EPSILON))/1e3," jitter "):"",this.stats.video.packetsLost>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"exclamation circle"}),this.stats.video.packetsLost," packets lost "):"",o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"expand"}),this.remoteVideo.current.videoWidth,"x",this.remoteVideo.current.videoHeight," "),o.a.createElement("br",null));(this.props.room.audioOnly||this.audioInterface)&&(e="");o.a.Fragment,u.a;this.wsConnection&&(o.a.Fragment,u.a,this.wsConnection.readyState);o.a.Fragment,u.a;this.peerConnection&&(o.a.Fragment,u.a,this.peerConnection.iceConnectionState,this.peerConnection.iceGatheringState,this.peerConnection.signalingState);let t=o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"wait"}),"Measuring...");(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(t=o.a.createElement("div",null,e,o.a.createElement(u.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps","none"!==this.stats.audio.qualityLimitationReason&&void 0!==this.stats.audio.qualityLimitationReason?"(limited: "+this.stats.audio.qualityLimitationReason+")":"",this.stats.audio.roundTripTime>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"clock"}),this.stats.audio.roundTripTime," "):"",this.stats.audio.jitter>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"circle notch"}),Math.round(1e3*(this.stats.audio.jitter+Number.EPSILON))/1e3," jitter "):"",this.stats.audio.packetsLost>0?o.a.createElement(o.a.Fragment,null," ",o.a.createElement(u.a,{name:"exclamation circle"}),this.stats.audio.packetsLost," packets lost "):"",o.a.createElement("br",null),this.connectionInfo," ",this.peerInfo)),(this.state.settingsActive||this.audioInterface)&&this.setState({bitrateInfo:t}),(this.stats.audio.packetsLost||this.stats.video.packetsLost)&&(this.state.packetLoss||this.setState({packetLoss:!0}))}render(){const e=this.state,t=this.props,a=this.txt;this.devMode=t.appState.devMode;var s={};if(!this.audioInterface){if(e.container){let t=e.container.clientWidth,a=e.container.clientHeight;if(e.width!==t||e.height!==a){a||(a=1);const e=t/a;this.state.aspectRatio=e,this.state.width=t,this.state.height=a,this.devMode&&console.log("components/Video - render: container size update")}}let t=e.videoWidth,a=e.videoHeight,o=0,n=0;e.width&&e.aspectRatio&&e.videoAspectRatio&&(e.videoAspectRatio>e.aspectRatio?(t=e.width,a=t/e.videoAspectRatio,n=(e.height-a)/2):(a=e.height,t=a*e.videoAspectRatio,o=(e.width-t)/2)),s={position:"absolute",left:o,top:n,width:t,height:a}}var n="eye";(t.room.audioOnly||this.audioInterface)&&(n="microphone");var i="";e.settingsActive&&(i=o.a.createElement("div",{className:"controlsTop"},o.a.createElement(b.a,null,o.a.createElement(E.a,{color:"black",pointing:"right"},e.statusInfo),o.a.createElement(H.a,{hidden:!0,vertical:!0}),o.a.createElement(h.a,{name:"reload",onClick:this.onClick.bind(this),loading:e.buttonDisabled,disabled:e.buttonDisabled,icon:!0,labelPosition:"right",inverted:!0},o.a.createElement(u.a,{name:"redo"}),e.buttonContent)),o.a.createElement(E.a,{color:"black"},o.a.createElement(u.a,{name:"user"}),e.streamInfo.userName," ",e.connected?e.bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"eye slash"}),"Not Streaming"))));var r="";e.packetLoss&&(r=o.a.createElement("span",{"data-tooltip":this.txt("Packet Loss: Download Connection Issue"),"data-position":"left center"},o.a.createElement(u.a,{inverted:!0,name:"exclamation circle",size:"large"})));var c=o.a.createElement(h.a,{name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Not Available","data-position":"bottom center"},o.a.createElement(u.a,{inverted:!0,color:"black",name:n+" slash"}));e.available&&(c=o.a.createElement(h.a,{name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Available","data-position":"bottom center"},o.a.createElement(u.a,{inverted:!0,color:"green",name:n}))),e.connecting&&(c=o.a.createElement(h.a,{name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Connecting","data-position":"bottom center"},o.a.createElement(u.a,{inverted:!0,loading:!0,name:"spinner"}))),e.connected&&(c=o.a.createElement(h.a,{name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Streaming","data-position":"bottom center"},o.a.createElement(u.a,{inverted:!0,name:n}))),e.connected&&!e.available&&(c=o.a.createElement(h.a,{name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Terminated","data-position":"bottom center"},o.a.createElement(u.a,{inverted:!0,color:"orange",name:n})));var l=o.a.createElement(o.a.Fragment,null);return t.room.videoOffline&&(e.available||e.connected||(l=o.a.createElement("source",{src:t.room.videoOffline,type:"video/mp4"}))),this.audioInterface?o.a.createElement("div",{className:"panel",ref:e=>this.state.container=e},o.a.createElement(b.a,null,o.a.createElement(b.a.Group,{inline:!0},o.a.createElement(b.a.Field,{inline:!0},o.a.createElement(u.a,{inverted:t.appState.darkMode,name:"volume up"})),o.a.createElement(b.a.Field,null,o.a.createElement(h.a,{name:"mute",size:"small",inverted:t.appState.darkMode,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":e.videoMuted?a("Enable Audio"):a("Mute"),"data-position":"bottom center"},o.a.createElement(u.a,{name:e.videoMuted?"volume off":"volume up"})," ",e.videoMutedMessage)),o.a.createElement(b.a.Field,null,o.a.createElement("audio",{style:{borderRadius:"3px",padding:"2px",margin:"2px"},id:"remoteVideo",poster:t.room.snapshot,ref:this.remoteVideo,className:"remoteVideo",muted:e.videoMuted,autoPlay:!0,loop:!0,playsInline:!0,onLoadedData:this.onLoadedData})),o.a.createElement(b.a.Field,null,o.a.createElement(h.a,{size:"small",name:"reload",onClick:this.onClick.bind(this),loading:e.buttonDisabled,disabled:e.buttonDisabled,icon:!0,labelPosition:"right",inverted:t.appState.darkMode},o.a.createElement(u.a,{name:"redo"}),e.buttonContent)),o.a.createElement(b.a.Field,{inline:!0},r),o.a.createElement(b.a.Field,{inline:!0},o.a.createElement(E.a,{size:"tiny"},o.a.createElement(u.a,{name:"user"}),e.streamInfo.userName," ",e.connected?e.bitrateInfo:o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{name:"eye slash"}),"Not Streaming")))))):o.a.createElement("div",{className:"panel",ref:e=>this.state.container=e},o.a.createElement("div",{className:"backgroundVideo"},o.a.createElement("video",{style:s,id:"remoteVideo",poster:t.room.snapshot,ref:this.remoteVideo,className:"remoteVideo",muted:e.videoMuted,autoPlay:!0,loop:!0,playsInline:!0,controls:e.settingsActive,onLoadedData:this.onLoadedData,onLoadedMetadata:()=>this.updateVideoSize("loadedmetadata")},l)),o.a.createElement("div",{className:"controlsIcons"},r,c,o.a.createElement(h.a,{name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:e.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":a("Toggle Controls"),"data-position":"bottom center"},o.a.createElement(u.a,{name:"setting"})),o.a.createElement(h.a,{name:"mute",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":e.videoMuted?a("Enable Audio"):a("Mute"),"data-position":"bottom center"},o.a.createElement(u.a,{name:e.videoMuted?"volume off":"volume up"})," ",e.videoMutedMessage),o.a.createElement(h.a,{name:"fullscreen",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":a("Enter Fullscreen"),"data-position":"bottom center"},o.a.createElement(u.a,{name:"expand"}))),i)}onClick(e,{name:t,value:a}){const s=this.txt;if("reload"==t)switch(this.state.buttonContent){case s("Tap to Play"):this.remoteVideo.current.play(),this.state.connected?this.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:"Reload",videoMuted:"",videoMutedMessage:""}):this.state.connecting?this.setState({statusInfo:"Preview. Connecting...",videoMuted:"",videoMutedMessage:""}):this.setState({statusInfo:"Preview",buttonContent:s("Reload"),videoMuted:"",videoMutedMessage:""});break;case s("Reload"):this.setState({buttonDisabled:!0,buttonContent:s("Reloading"),connecting:!0,connected:!1}),this.stopStreamPlay(),this.startStreamPlay()}if("fullscreen"==t){this.state.fullscreen;e.preventDefault(),this.requestFullscreen(this.remoteVideo.current)}"mute"==t&&(this.state.videoMuted&&(this.remoteVideo.current.muted=!1),this.setState({videoMuted:!this.state.videoMuted,videoMutedMessage:""})),super.onClick(e,{name:t,value:a})}retryIfTimeout(){this.state.connected||this.playStarted||this.retriesLeft>0&&(this.devMode&&console.log("components/Video retryIfTimeout #",this.retriesLeft),this.retriesLeft--,this.stopStreamPlay(),this.setState({buttonDisabled:!0,buttonContent:"Auto Retry...",connecting:!0,connected:!1}),this.startStreamPlay()),this.retryIfTimeoutSet=!1}requestFullscreen(e){var t=!0;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1),this.setState({fullscreen:t})}streamInfoReset(){const e=this.props,t=this.state;var a;(this.state.streamInfo={applicationName:e.config.application,streamName:e.room.streamPlayback,userName:"",sessionId:"[empty]"},e.room.users)&&(e.content?(a=e.room.users[e.content.userID])&&(t.streamInfo.streamName=e.content.stream):(a=e.room.users[e.room.streamUID])&&(t.streamInfo.streamName=e.room.streamPlayback),a&&(t.streamInfo.userName=a.userName,a.meta&&a.meta.connected&&a.sdate<a.meta.connectedUpdate&&(t.available=!0)))}wsConnect(){const e=this.props;if(this.state.connected)console.log("components/Video wsConnect: already connected, skip");else{if(this.props.appState.wsOpen)return this.devMode&&console.log("components/Video wsConnect:  websocket busy, retrying later",this.props.appState.wsComponent," waited: "+this.wsWaited,this.wsConnection),this.wsConnection&&this.wsConnection.readyState<3&&(this.wsWaited>1?(this.wsConnection.close(),this.peerConnection&&this.peerConnection.close(),this.wsWaited=0):this.wsWaited++),void setTimeout(()=>this.wsConnect(),2e3);this.props.appStateUpdate({wsOpen:!0,wsComponent:"Video"}),this.userData={param1:"value1",videowhisper:"webrtc-playback"},this.wsConnection&&this.wsConnection.readyState<3&&(console.log("components/Video wsConnect previous websocket (close)",this.wsConnection),this.wsConnection.close(),this.peerConnection&&this.peerConnection.close()),this.wsConnection=new WebSocket(e.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsConnection.onmessage=e=>this.onmessage(e),this.wsConnection.onclose=()=>{this.devMode&&console.log("components/Video wsConnection.onclose"),this.props.appStateUpdate({wsOpen:!1})},this.wsConnection.onerror=e=>{console.log("components/Video ERROR wsConnection.onerror: "+JSON.stringify(e,["message","arguments","type","name"])),this.wsConnection.close(),this.props.appStateUpdate({wsOpen:!1})}}}peerCreateAnswer(){this.state;this.devMode&&console.log("components/Video peerCreateAnswer"),this.peerConnection.createAnswer().then(this.gotDescription.bind(this)).catch(this.errorHandler.bind(this))}errorHandler(e){console.log(e)}icecandidate(e,t){var a=this;return Object(B.a)(F.a.mark((function s(){return F.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:a.devMode&&console.log("components/Video icecandidate (gotIceCandidate):",t);try{a.onAddIceCandidateSuccess(e)}catch(o){a.onAddIceCandidateError(e,o)}case 2:case"end":return s.stop()}}),s)})))()}onAddIceCandidateSuccess(e){this.devMode&&console.log("components/Video onAddIceCandidateSuccess success",e)}onAddIceCandidateError(e,t){this.devMode&&console.log("components/Video onAddIceCandidateError failed to add ICE Candidate: ".concat(t))}onsignalingstatechange(){if(!this._isMounted)return;let e;this.peerConnection&&(e=this.peerConnection.signalingState,this.devMode&&console.log("components/Video onsignalingstatechange , state: ".concat(e),this.retryTimeout),"have-remote-offer"!=e&&"stable"!=e||(this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload")}),this.props.appStateUpdate({videoStatus:"pending"}),this.retryIfTimeoutSet||(setTimeout(()=>this.retryIfTimeout(),this.retryTimeout),this.retryIfTimeoutSet=!0)))}videoPlay(){const e=this.remoteVideo.current,t=this.txt;this.playStarted=!1,e&&e.play().then(a=>{this.devMode&&console.log("components/Video Autoplay started accept/paused/src",a,e.paused,e.src),this.playStarted=!0,this.props.appState.muted&&this.props.appStateUpdate({muted:!1}),this.state.connected?this.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:t("Reload"),connecting:!1}):this.state.connecting?this.setState({statusInfo:"Preview. Connecting...",settingsActive:!0,buttonDisabled:!0,buttonContent:"Connecting"}):this.setState({statusInfo:"Preview",buttonDisabled:!1,buttonContent:t("Reload")})},a=>{console.log("components/Video Autoplay reject:"+a,a,e.src),this.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:t("Tap to Play"),videoMuted:"",videoMutedMessage:""})}).catch(e=>{console.log("components/Video Autoplay error:"+e,e),this.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:t("Tap to Play")})})}iceconnectionstatechange(e,t){const a=this.remoteVideo.current;var s=this.state,o=this.txt;let n;e&&(n=e.iceConnectionState,this.devMode&&console.log("components/Video iceconnectionstatechange: ".concat(e.iceConnectionState),t,a),"connected"==n&&(this.setState({connected:!0,connecting:!1}),this.videoPlay()),"disconnected"!=n&&"failed"!=n||("1"===this.props.config.videoAutoPlay&&(s.retrying||setTimeout(()=>{s.retrying=!0,this.stopStreamPlay(),this.startStreamPlay(),this.setState({statusInfo:n,buttonDisabled:!0,buttonContent:o("Auto Retry")})},3300)),this.setState({settingsActive:!0,connected:!1,connecting:!1,buttonDisabled:!1,buttonContent:o("Reload")})))}track(e){this.state;var t=this.remoteVideo.current;this.devMode&&console.log("components/Video peer track (gotRemoteTrack) kind:"+e.track.kind+" stream:"+e.streams[0]),t.srcObject!==e.streams[0]&&(t.srcObject=e.streams[0],this.devMode&&console.log("components/Video peer track: playback peer received new remote stream"))}sendPlayGetOffer(){this.devMode&&console.log("components/Video sendPlayGetOffer: "+JSON.stringify(this.state.streamInfo),"wsConnection:",this.wsConnection),this.state.connected&&this.playStarted&&this.devMode&&console.log("components/Video sendPlayGetOffer: playStarted skip"),this.wsConnection&&1===this.wsConnection.readyState&&this.wsConnection.send('{"direction":"play", "command":"getOffer", "streamInfo":'+JSON.stringify(this.state.streamInfo)+', "userData":'+JSON.stringify(this.userData)+"}"),this.setState({statusInfo:"Starting Playback",buttonDisabled:!1,buttonContent:this.txt("Reload")}),this.retryIfTimeoutSet||(setTimeout(()=>this.retryIfTimeout(),this.retryTimeout),this.retryIfTimeoutSet=!0)}startStreamPlay(){this.devMode&&console.log("components/Video startStreamPlay"),this.state.retryCount=0,this.wsWaited=0,this.state.connecting=!0,this.wsConnect(),this.timerStart()}stopStreamPlay(){this.devMode&&console.log("components/Video stopStreamPlay"),this.timerStop();var e=this.remoteVideo.current,t=this.props;this.peerConnection&&this.peerConnection.close(),this.wsConnection&&this.wsConnection.close(),e&&(e.src==t.room.videoOffline&&t.room.videoOffline||(e.src="")),this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload"),connecting:!1,connected:!1}),this.playStarted=!1}gotDescription(e){this.devMode&&console.log("components/Video gotDescription sdp"+JSON.stringify({sdp:e})),this.peerConnection.setLocalDescription(e).then(()=>{this.wsConnection.send('{"direction":"play", "command":"sendResponse", "streamInfo":'+JSON.stringify(this.state.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(this.userData)+"}")}).catch(e=>{console.log("components/Video gotDescription, setLocalDescription error",e)})}}z.propTypes={config:k.a.object.isRequired,room:k.a.object.isRequired,appState:k.a.object.isRequired,appStateUpdate:k.a.func.isRequired,content:k.a.object,meta:k.a.string,videoConfig:k.a.object};class j extends s.Component{constructor(e){super(e),this.componentActions=o.a.createRef()}render(){const e=this.props;return o.a.createElement("div",{className:"layoutPlayback",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layVideo"},o.a.createElement(z,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room})),o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layHistory"},o.a.createElement(A,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(R,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}class _ extends s.Component{constructor(e){super(e),this.componentActions=o.a.createRef()}render(){const e=this.props;return o.a.createElement("div",{className:"layoutPlaybackAudio",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layHistory"},o.a.createElement(A,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(R,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})),o.a.createElement("div",{className:"layVideo"},o.a.createElement(z,{videoConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room})),o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})))}}class G extends s.Component{render(){const e=this.props;return this.componentActions=o.a.createRef(),o.a.createElement("div",{className:"layoutWay2",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layVideo"},o.a.createElement(z,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room})),o.a.createElement("div",{className:"layCamera"},o.a.createElement(x,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layHistory"},o.a.createElement(A,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"laySend"},o.a.createElement(R,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}class J extends s.Component{render(){const e=this.props;return this.componentActions=o.a.createRef(),o.a.createElement("div",{className:"layoutWay2Audio",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layVideo"},o.a.createElement(z,{videoConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room})),o.a.createElement("div",{className:"layCamera"},o.a.createElement(x,{cameraConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layHistory"},o.a.createElement(A,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"laySend"},o.a.createElement(R,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}var K=a(121),Y=a.n(K);class Q extends M{constructor(e){super(e),this.playerError=e=>{console.log("containers/Media playerError",e)},this.state={placement:e.placement,meta:e.meta,panelType:"Media",mediaWidth:0,mediaHeight:1,mediaStyle:{position:"absolute",width:"100%",height:"100%"},mediaAspectRatio:1},this.devMode=e.appState.devMode,this.mediaContent=o.a.createRef(),this.extensionsImg=["jpg","jpeg","jfif","pjpeg","pjp","gif","ico","cur","bmp","png","svg"],this.extensionsVideo=["mp4","webm","ogg"],this.extensionsAudio=["mp3"],this.devMode&&console.log("containers/Media constructor",e)}updateMediaSize(e){var t=this.state;t.mediaHeight||(t.mediaHeight=1),t.mediaAspectRatio=t.mediaWidth/t.mediaHeight;let a=t.mediaWidth,s=t.mediaHeight,o=0,n=0;t.width&&t.aspectRatio&&t.mediaAspectRatio&&(t.mediaAspectRatio>t.aspectRatio?(a=t.width,s=a/t.mediaAspectRatio,n=(t.height-s)/2):(s=t.height,a=s*t.mediaAspectRatio,o=(t.width-a)/2));let i={position:"absolute",left:o,top:n,width:a,height:s,border:"solid 1px #555"};this.setState({mediaStyle:i}),this.devMode&&console.log("containers/Media updateMediaSize",e,t.aspectRatio,t.mediaAspectRatio,i,t)}onImgLoad({target:e}){this.state.mediaWidth=e.naturalWidth,this.state.mediaHeight=e.naturalHeight,this.devMode&&console.log("containers/Media onImgLoad",e.naturalWidth,e.naturalHeight),this.updateMediaSize("img")}onVideoLoadedMetadata({target:e}){this.state.mediaWidth=e.videoWidth,this.state.mediaHeight=e.videoHeight,this.devMode&&console.log("containers/Media onVideoLoadedMetadata",e.videoWidth,e.videoHeight),this.updateMediaSize("video")}render(){const e=this.state,t=this.props;var a=o.a.createElement(f.a,{className:t.appState.className},t.placement," / ",t.type," - No Content.");if(t.placement&&t.appState.media){var s=t.appState.media[t.placement];if(s)switch(s.placement=t.meta+" "+t.placement,s.type){case"user":if(t.room.users){var n,i=!1;(n=t.content?t.room.users[s.userID]:t.room.users[t.room.streamUID])&&n.meta&&n.meta.external&&(i=!0,n.meta.connected&&n.meta.connectedUpdate>n.meta.external&&(i=!1)),i&&(a=n.hls?o.a.createElement(Y.a,{style:e.mediaStyle,ref:this.mediaContent,url:n.hls,muted:t.appState.muted,playing:!0,controls:!0,playsinline:!0,width:"100%",height:"100%",onError:this.playerError.bind(this)}):o.a.createElement(f.a,{className:t.appState.className,className:t.appState.className},t.placement," - HLS not available for user #",s.userID)),i||(a=o.a.createElement(z,{appState:t.appState,appStateUpdate:t.appStateUpdate,config:t.config,room:t.room,content:s,meta:t.meta}))}break;case"stream":case"video":a=o.a.createElement(z,{appState:t.appState,appStateUpdate:t.appStateUpdate,config:t.config,room:t.room,content:s,meta:t.meta});break;case"file":a=this.extensionsImg.includes(s.ext)?o.a.createElement("img",{style:e.mediaStyle,ref:this.mediaContent,onLoad:this.onImgLoad.bind(this),src:s.url}):this.extensionsVideo.includes(s.ext)||this.extensionsAudio.includes(s.ext)?o.a.createElement(Y.a,{style:e.mediaStyle,ref:this.mediaContent,url:s.url,playing:!0,controls:!0,playsinline:!0,loop:!0,onError:this.playerError.bind(this),width:"100%",height:"100%"}):o.a.createElement(f.a,{className:t.appState.className},this.txt("File"),": ",o.a.createElement("b",null,s.name)," (",s.userName,")",o.a.createElement(H.a,null)," ",o.a.createElement(h.a,{className:t.appState.className,icon:!0,labelPosition:"right",target:"_blank",href:s.url}," ",this.txt("Open")," ",o.a.createElement(u.a,{size:"large",name:"folder open"})," ")," ");break;case"hls":a=o.a.createElement(Y.a,{url:s.url,playing:!0});break;case"empty":a=o.a.createElement(f.a,{className:t.appState.className},o.a.createElement(v.a,null,t.placement,": Empty Content Area")," Room owner can assign content or adjust number of content areas.");break;default:a=o.a.createElement(f.a,{className:t.appState.className},t.placement," - Unknown type: ",s.type," / ",t.type)}}return o.a.createElement("div",{className:"panel",ref:e=>this.state.container=e},a)}}Q.propTypes={placement:k.a.string.isRequired,meta:k.a.string.isRequired,type:k.a.string.isRequired,appState:k.a.object.isRequired,appStateUpdate:k.a.func.isRequired,user:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired};class Z extends M{constructor(e){super(e),this.state={panelType:"Multimedia"},this.devMode=e.appState.devMode,this.mediaItems=1,this.devMode&&console.log("containers/Multimedia constructor",e)}render(){const e=this.state,t=this.props;var a=[],s=Object.keys(this.props.appState.media).length,n=0;for(var i in this.props.appState.media){var r=t.appState.media[t.placement],c="none";if(r&&(c=r.type),"user"==c&&t.room.users){var l=t.room.users[r.userID],p=!1;l&&l.meta&&l.meta.external&&(p=!0,l.meta.connected&&l.meta.connectedUpdate>l.meta.external&&(p=!1)),p&&(c="hls")}a.push(o.a.createElement("div",{className:"slot"+n,key:"slot_"+i},o.a.createElement(Q,{appState:t.appState,appStateUpdate:t.appStateUpdate,config:t.config,room:t.room,user:t.user,placement:i,type:c,meta:n+"/"+s}))),n++}this.mediaItems=n;var d="V";e.aspectRatio>1.77&&(d="H");var m="panel split0";return this.mediaItems>1&&(m="panel split"+d+this.mediaItems),o.a.createElement("div",{className:m,ref:e=>this.state.container=e},a)}}Z.propTypes={appState:k.a.object.isRequired,appStateUpdate:k.a.func.isRequired,user:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired};class X extends s.Component{render(){const e=this.props;return o.a.createElement("div",{className:"layoutChat",key:"layoutChat",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layHistory"},o.a.createElement(A,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(R,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}class $ extends M{constructor(e){super(e),this.copyToClipboard=e=>{console.log("components/Broadcast copyToClipboard",e.target.value),e.target.select(),navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(e.target.value)},this.state={},this.devMode=e.appState.devMode,this.devMode&&console.log("components/Broadcast constructor room:",e.room)}componentWillUnmount(){this.devMode&&console.log("components/Broadcast componentWillUnmount")}onClick(e,{name:t,value:a}){this.devMode&&console.log("components/Broadcast onClick",t,a,e);this.state,this.props;switch(t){case"closed":this.props.serverUpdate({task:"external",external:!1})}}render(){const e=this.props,t=this.txt;var a=[];if(e.room.broadcastSettings){for(var s in e.room.broadcastSettings)if("meta"!==s){var n=e.room.broadcastSettings[s],i=[];for(var r in n.fields){var c=n.fields[r];switch(c.type){case"text":i.push(o.a.createElement(b.a.Field,{key:c.name},o.a.createElement("label",null,c.description),o.a.createElement(I.a,{fluid:!0,readOnly:!0,onClick:this.copyToClipboard,iconPosition:"left",defaultValue:c.value},o.a.createElement(u.a,{name:"copy"}),o.a.createElement("input",null)),o.a.createElement("br",null),o.a.createElement("small",null,c.details)));break;case"link":i.push(o.a.createElement(b.a.Field,{key:c.name},o.a.createElement(h.a,{className:e.appState.className,size:"small",name:c.name,color:c.color?c.color:"blue",target:"_blank",href:c.url},o.a.createElement(u.a,{name:c.icon?c.icon:"cloud download"})," ",c.description),o.a.createElement("br",null),o.a.createElement("small",null,c.details)))}}a.push(o.a.createElement("div",{key:s},o.a.createElement(v.a,{className:e.appState.className,as:"h4"},n.name),n.details,o.a.createElement(H.a,null),o.a.createElement(b.a,{className:e.appState.className},i),o.a.createElement(H.a,{hidden:!0})))}}else a.push(o.a.createElement("p",null,"No broadcast settings available"));var l="User list not available.",p=!1;if(e.room.users){var d;e.room?(d=e.room.users[e.user.ID],l="User info available."):l="Not in user list.";var m=t("Not Available");d&&d.meta&&d.meta.external&&(m="Started",p=!0,d.meta.connected&&d.meta.connectedUpdate>d.meta.externalUpdate&&(p=!1,m="Web Broadcast More Recent")),p&&(l=d.hls?t("Streaming"):"HLS not available."),p||(l=m)}const g=p?o.a.createElement("div",{key:"closed"}," ",o.a.createElement(h.a,{className:e.appState.className,icon:!0,size:"small",name:"closed",color:"red",onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:"close"})," ",t("Closed"))," ",o.a.createElement("small",null,t("Use after ending external broadcast, to faster restore web based webcam interface."))," "):"";return o.a.createElement("div",{className:"layoutScrollable",key:"layoutBroadcastScroll",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layScrollable",key:"layBroadcast",ref:this.scrollableRef},o.a.createElement(f.a,{className:e.appState.className},o.a.createElement(v.a,{className:e.appState.className,as:"h4"},t("External Broadcast")),o.a.createElement(E.a,{color:p?"green":"yellow"},l),g,o.a.createElement("small",null,o.a.createElement("br",null),e.room.broadcastSettings.meta.description?e.room.broadcastSettings.meta.description:t("External Broadcast")),o.a.createElement(H.a,null),a)))}}$.propTypes={appState:k.a.object.isRequired,user:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired,serverUpdate:k.a.func.isRequired};var ee=a(549),te=a(31),ae=a.n(te);class se extends M{constructor(e){super(e),this.userClick=e=>(t,a)=>{if(console.log("components/User userClick",e,a,t),e&&a.action)switch(a.action){case"profile":const t={file:e.url};window.open(t.file);break;case"presentation":this.props.serverUpdate({task:"user_presentation",userID:e.userID,userName:e.userName,placement:a.placement});break;case"kick":this.props.serverUpdate({task:"user_kick",userID:e.userID,userName:e.userName});break;case"ban":this.props.serverUpdate({task:"user_ban",userID:e.userID,userName:e.userName})}},this.state={},this.devMode=e.appState.devMode,this.data=[],this.usersLeft=[],this.usersJoined=[],this.userCount=0,this.scrollableRef=o.a.createRef(),e.room.users&&(this.data=ae.a.sortBy(e.room.users,"order")),this.devMode&&console.log("components/Users constructor room:",e.room)}componentDidMount(){}componentWillUnmount(){console.log("components/Users componentWillUnmount")}shouldComponentUpdate(e,t){return ae.a.isEqual(e.room.users,this.props.room.users)||(this.data=ae.a.sortBy(e.room.users,"order")),!0}render(){const e=this.props,t=(this.state,this.txt);var a,s;this.devMode=e.appState.devMode;var n=[],i=0;if(s=this.props.room.usersMenu?o.a.createElement(f.a,{className:e.appState.className},"Users Menu"):"",this.data){for(var r in this.data)if(this.data.hasOwnProperty(r)){var c=this.data[r];if(c&&c.userName&&!c.hide){i++;var l=[];if(l.push({key:"usermenuProfile_"+r,onClick:this.userClick(c),icon:"address card",text:t("Profile"),action:"profile"}),this.props.room.usersPresentation)for(var p in this.props.appState.media)l.push({key:"usermenuPresentation_"+p+r,onClick:this.userClick(c),icon:"pointing left",text:t("Show")+": "+p,action:"presentation",placement:p});let a=o.a.createElement(C.a,{compact:!0,key:"usermenu"+r,text:c.userName,options:l,className:e.appState.className});this.props.room.usersModerator&&(l.push({key:"usermenuKick_"+r,onClick:this.userClick(c),icon:"sign-out",text:t("Kick"),action:"kick"}),l.push({key:"usermenuBan_"+r,onClick:this.userClick(c),icon:"ban",text:t("Ban"),action:"ban"}));var d=o.a.createElement(o.a.Fragment,null,o.a.createElement(D.a,{src:c.avatar,rounded:!0,size:"mini",verticalAlign:"middle"}),c.userID===e.room.performerID?o.a.createElement(u.a,{name:"star"}):"",c.meta.connected?o.a.createElement(u.a,{name:"video"}):"",a);n.push(o.a.createElement(ee.a.Row,{key:"userRow"+r},o.a.createElement(ee.a.Cell,null,d)))}}}else n=o.a.createElement(ee.a.Row,{key:"No_Users"},o.a.createElement(ee.a.Cell,{colSpan:"1",warning:!0},"No users."));return a=o.a.createElement(ee.a,{celled:!0,selectable:!0,sortable:!0,key:"User_Pane",className:e.appState.className},o.a.createElement(ee.a.Body,null,n)),this.userCount=i,o.a.createElement("div",{className:"layoutList",key:"layoutList",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layScrollable",key:"layScrollable",ref:this.scrollableRef},a),o.a.createElement("div",{className:"layMenu"},s))}componentDidUpdate(e,t,a){}}se.propTypes={appState:k.a.object.isRequired,appStateUpdate:k.a.func.isRequired,appSfx:k.a.func.isRequired,user:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired,serverUpdate:k.a.func.isRequired};var oe=a(290),ne=a(288),ie=a.n(ne);class re extends M{constructor(e){super(e),this.handleSort=e=>()=>{this.sortBy(e,!1)},this.fileClick=e=>(t,a)=>{if(console.log("components/Files fileClick",e,a,t),e&&a.action)switch(a.action){case"open":const t={file:e.url};window.open(t.file);break;case"delete":this.props.serverUpdate({task:"file_delete",file_name:e.name});break;case"presentation":this.props.serverUpdate({task:"file_presentation",file_name:e.name,placement:a.placement})}},this.onDrop=e=>{const t=this.props;if(!t.config.serverURL)return void console.log("components/Files onDrop missing serverURL",t.config.serverURL,t.config);const a=ie.a.post(t.config.serverURL);a.field("task","file_upload"),a.field("VideoWhisper[userID]",t.user.ID),a.field("VideoWhisper[sessionID]",t.user.sessionID),a.field("VideoWhisper[sessionKey]",t.user.sessionKey),t.room.ID?(a.field("VideoWhisper[roomID]",t.room.ID),a.field("VideoWhisper[privateUID]",t.room.privateUID)):console.log("components/Files onDrop room",t.room,t.user,t.config.serverURL);var s=[];e.forEach(e=>{a.attach(e.name,e,e.name),s.push(e.name)}),a.field("files[]",s),a.then(this.uploadCompleted.bind(this)),console.log("components/Files onDrop",e,a),this.setState({uploading:!0})},this.state={column:null,data:null,direction:null,uploading:!1},this.devMode=e.appState.devMode,this.scrollableRef=o.a.createRef(),this.fileInputRef=o.a.createRef(),e.room.files&&(this.state.data=e.room.files),this.devMode&&console.log("components/Files constructor room:",e.room)}sortBy(e,t){t&&(this.state.column=null,this.state.direction=null);const a=this.state,s=a.column,o=a.data,n=a.direction;if(!o)return;const i="age"==e?"time":e;console.log("components/Files handleSort",e,i,n,t),s===e?this.setState({data:"descending"===n?ae.a.sortBy(o,[i]):ae.a.sortBy(o,[i]).reverse(),direction:"ascending"===n?"descending":"ascending"}):this.setState({column:e,data:ae.a.sortBy(o,[i]).reverse(),direction:"descending"})}componentDidMount(){this.sortBy("age",!0)}componentWillUnmount(){console.log("components/Files  componentWillUnmount")}shouldComponentUpdate(e,t){return ae.a.isEqual(e.room.files,this.props.room.files)||(this.state.data=e.room.files,this.sortBy("age",!0)),!0}uploadCompleted(e){console.log("components/Files uploadCompleted",e),this.props.serverUpdate({task:"update",update:"files"}),this.setState({uploading:!1})}render(){const e=this.props,t=this.state,a=this.txt;var s,n,i,r=this.state,c=r.column,l=r.data,p=r.direction;return i=this.props.room.filesUpload?o.a.createElement(oe.a,{onDrop:this.onDrop},({getRootProps:s,getInputProps:n})=>o.a.createElement(f.a,{className:e.appState.className},o.a.createElement("div",s(),o.a.createElement("input",n()),o.a.createElement("p",null,o.a.createElement(u.a,{name:"upload",loading:t.uploading})," ",t.uploading?a("Uploading. Please wait..."):a("Upload: Drag and drop files here, or click to select files"))))):"",n=l?l.map(t=>{let s=[];if(s.push({key:"filemenuOpen_"+t.name,onClick:this.fileClick(t),icon:"file",text:a("Open"),action:"open"}),this.props.room.filesDelete&&s.push({key:"filemenuDelete_"+t.name,onClick:this.fileClick(t),icon:"trash",text:a("Delete"),action:"delete"}),this.props.room.filesPresentation)for(var n in this.props.appState.media)s.push({key:"filemenuPresentation_"+n+t.name,onClick:this.fileClick(t),icon:"pointing left",text:a("Show")+": "+n,action:"presentation",placement:n});var i=o.a.createElement(C.a,{key:"filemenu"+t.name,text:t.name,options:s,className:e.appState.className});return o.a.createElement(ee.a.Row,{key:t.name},o.a.createElement(ee.a.Cell,null,i),o.a.createElement(ee.a.Cell,null,t.size),o.a.createElement(ee.a.Cell,null,t.age))}):o.a.createElement(ee.a.Row,{key:"No_Files"},o.a.createElement(ee.a.Cell,{colSpan:"3",warning:!0},"No files.")),s=o.a.createElement(ee.a,{celled:!0,selectable:!0,striped:!0,sortable:!0,key:"File_Pane",className:e.appState.className},o.a.createElement(ee.a.Header,null,o.a.createElement(ee.a.Row,null,o.a.createElement(ee.a.HeaderCell,{sorted:"name"===c?p:null,onClick:this.handleSort("name")},a("Name")),o.a.createElement(ee.a.HeaderCell,{sorted:"size"===c?p:null,onClick:this.handleSort("size")},a("Size")),o.a.createElement(ee.a.HeaderCell,{sorted:"age"===c?p:null,onClick:this.handleSort("age")},a("Age")))),o.a.createElement(ee.a.Body,null,n)),o.a.createElement("div",{className:"layoutList",key:"layoutList",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layScrollable",key:"layScrollable",ref:this.scrollableRef},s),o.a.createElement("div",{className:"layMenu"},i))}}re.propTypes={appState:k.a.object.isRequired,user:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired,serverUpdate:k.a.func.isRequired};class ce extends M{constructor(e){super(e),this.state={},this.devMode=e.appState.devMode,this.devMode&&console.log("components/Presentation constructor room:",e.room)}componentWillUnmount(){this.devMode&&console.log("components/Presentation  componentWillUnmount")}removeMedia(e,{name:t,value:a}){this.devMode&&console.log("components/Presentation removeMedia",t,a,e),this.props.serverUpdate({task:"presentation_remove",placement:a})}render(){const e=this.props,t=this.txt;var a=[];if(e.appState.media)for(var s in e.appState.media){var n=e.appState.media[s];let i="";if("stream"===n.type){let e=this.props.room.users[n.userID];e?e.meta&&(e.meta.connected||(i="Not Broadcasting")):i="Not Available"}a.push(o.a.createElement("div",{key:"presentationPlacement"+s},n.default?o.a.createElement(E.a,{pointing:"right"},t("Default")):"empty"===n.type?o.a.createElement(E.a,{pointing:"right"},t("Empty")):o.a.createElement(h.a,{className:e.appState.className,size:"tiny",compact:!0,key:"removeMedia"+s,name:"removeMedia"+s,value:s,color:"red",onClick:this.removeMedia.bind(this)}," ",o.a.createElement(u.a,{name:"window close"}),"Remove"),o.a.createElement("b",null,s),": ",n.type," ",o.a.createElement("i",null,n.name)," ",i))}return o.a.createElement("div",{className:"layScrollable",key:"layPresentation",style:{backgroundColor:e.appState.backgroundColor},ref:this.scrollableRef},o.a.createElement(f.a,{className:e.appState.className},o.a.createElement(v.a,{className:e.appState.className,as:"h4"},t("Media Displayed"),": ",e.room.name),o.a.createElement(H.a,null),a))}}ce.propTypes={appState:k.a.object.isRequired,user:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired,serverUpdate:k.a.func.isRequired};var le=a(543);class pe extends M{constructor(e){super(e),this.state={panelType:"Options",time:0,updating:!1},this.devMode=e.appState.devMode,this.devMode&&console.log("components/Options constructor room:",e.room)}componentWillUnmount(){this.devMode&&console.log("components/Options componentWillUnmount")}static getDerivedStateFromProps(e,t){return e.room.options&&e.room.options.meta&&e.room.options.meta.time>t.time?(e.appState.devMode&&console.log("components/Options getDerivedStateFromProps",t),pe.propsToOptions(e)):null}static propsToOptions(e){var t={};if(e.room.options)for(var a in e.room.options)if("meta"!==a){var s=e.room.options[a];for(var o in s.fields){var n=s.fields[o];n&&n.name&&(t[n.name]=n.value)}}return e.room.options&&e.room.options.meta&&(t.time=e.room.options.meta.time),t.updating=!1,e.appState.devMode&&console.log("components/Options propsToOptions",t),t}onChange(e,t){const a="checkbox"===t.type?t.checked:t.value,s=t.name;this.devMode&&console.log("Components/Options onChange",s,a,t),this.props.serverUpdate({task:"options",name:s,value:a}),s&&this.setState({[s]:a,updating:!0})}render(){const e=this.props,t=this.state;var a=[];if(e.room.options){for(var s in e.room.options)if("meta"!==s){var n=e.room.options[s],i=[];for(var r in n.fields){var c=n.fields[r];switch(c.type){case"toggle":i.push(o.a.createElement(b.a.Field,{key:c.name},o.a.createElement("label",null,c.description),o.a.createElement(le.a,{name:c.name,"data-position":"right center",toggle:!0,disabled:t.updating,checked:t[c.name],onChange:(e,t)=>this.onChange(e,t)}),o.a.createElement("br",null),o.a.createElement("small",null,c.details)));break;case"dropdown":i.push(o.a.createElement(b.a.Group,{key:c.name},o.a.createElement(b.a.Field,null,o.a.createElement("label",null,c.description),o.a.createElement(C.a,{name:c.name,selection:!0,compact:!0,className:e.appState.className,"data-position":"right center",value:t[c.name],disabled:t.updating,options:c.options,onChange:(e,t)=>this.onChange(e,t)}),o.a.createElement("br",null),o.a.createElement("small",null,c.details))));break;default:i.push(o.a.createElement("p",{key:"noFields"},c.name," Unknown Type: ",c.type))}}a.push(o.a.createElement("div",{key:s},o.a.createElement(v.a,{className:e.appState.className,as:"h4"},n.name),o.a.createElement(H.a,null),o.a.createElement(b.a,{className:e.appState.className},i),o.a.createElement(H.a,{hidden:!0})))}}else a.push(o.a.createElement("p",null,"No options"));return o.a.createElement("div",{className:"layoutScrollable",key:"layoutOptionsScroll",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layScrollable",key:"layOptions",ref:this.scrollableRef},o.a.createElement(f.a,{className:e.appState.className},a)))}}pe.propTypes={appState:k.a.object.isRequired,user:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired,serverUpdate:k.a.func.isRequired};class de extends M{constructor(e){super(e),this.devMode=e.appState.devMode,this.devMode&&console.log("containers/Tabs constructor",e),this.state={menus:[],panes:[],selected:""},this.updatePanes(e)}static getDerivedStateFromProps(e,t){return e.room&&!t.selected&&e.room.panelCamera?{selected:"Cam"}:null}componentWillUnmount(){this.devMode&&console.log("containers/Tabs componentWillUnmount")}updatePanes(e){const t=this.state,a=this.txt;var s=[],n=[],i="";if(this.state.selected||(this.state.selected=a("Chat")),e.appState.publishRequired&&e.room.panelCamera&&(this.state.selected=a("Cam")),e.appState.external&&this.state.selected==a("Cam")&&(this.state.selected=a("Broadcast")),this.state.selected==a("Chat")&&this.props.appState.chatNew&&this.props.appStateUpdate({chatNew:!1}),i=a("Chat"),s.push({key:i,active:t.selected==i,name:i,content:o.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":o.a.createElement(u.a,{name:"chat"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",this.props.appState.chatNew?o.a.createElement(u.a,{size:"tiny",name:"star",color:"green"}):"")}),n.push(o.a.createElement("div",{key:"paneChat",className:t.selected==i?"paneActive":"paneInactive"},o.a.createElement(X,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage}))),!e.room.textOnly&&e.room.panelCamera&&!e.appState.external){var r="video";i=a("Cam"),(e.room.audioOnly||e.appState.audioMode)&&(i=a("Mic"),r="microphone",this.state.selected==a("Cam")&&(this.state.selected=a("Mic")));const c={off:o.a.createElement(u.a,{size:"tiny",name:"stop"}),pending:o.a.createElement(u.a,{size:"tiny",color:"orange",name:"sync"}),live:o.a.createElement(u.a,{size:"tiny",color:"green",name:"circle"}),error:o.a.createElement(u.a,{size:"tiny",color:"red",name:"exclamation triangle"})}[e.appState.cameraStatus];s.push({key:i,active:t.selected==i,name:i,content:o.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":o.a.createElement(u.a,{name:r}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",c)}),n.push(o.a.createElement("div",{key:"paneCamera",className:t.selected==i?"paneActive":"paneInactive"},o.a.createElement(x,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})))}e.room.textOnly||e.room.panelBroadcast&&(i=a("Broadcast"),s.push({key:i,active:t.selected==i,name:i,content:o.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":o.a.createElement(u.a,{name:"rss"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i)}),t.selected==i&&n.push(o.a.createElement("div",{key:"paneBroadcast",className:t.selected==i?"paneActive":"paneInactive"},o.a.createElement($,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelUsers&&(i=a("Users"),s.push({key:i,active:t.selected==i,name:i,content:o.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":o.a.createElement(u.a,{name:"users"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",o.a.createElement(E.a,{className:e.appState.className,size:"tiny",pointing:"left"},e.appState.userCount))}),t.selected==i&&n.push(o.a.createElement("div",{key:"paneUsers",className:t.selected==i?"paneActive":"paneInactive"},o.a.createElement(se,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelFiles&&(i=a("Files"),s.push({key:i,active:t.selected==i,name:i,content:o.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":o.a.createElement(u.a,{name:"file"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i)}),t.selected==i&&n.push(o.a.createElement("div",{key:"paneFiles",className:t.selected==i?"paneActive":"paneInactive"},o.a.createElement(re,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelPresentation&&(i=a("Presentation"),s.push({key:i,active:t.selected==i,name:i,content:o.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":o.a.createElement(u.a,{name:"hand point left"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i)}),t.selected==i&&n.push(o.a.createElement("div",{key:"panePresentation",className:t.selected==i?"paneActive":"paneInactive"},o.a.createElement(ce,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "))),e.room.panelOptions&&(i=a("Options"),s.push({key:i,active:t.selected==i,name:i,content:o.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":o.a.createElement(u.a,{name:"settings"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i)}),t.selected==i&&n.push(o.a.createElement("div",{key:"paneOptions",className:t.selected==i?"paneActive":"paneInactive"},o.a.createElement(pe,{appState:e.appState,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "))),this.state.menus=s,this.state.panes=n}onClick(e,t){this.devMode&&console.log("containers/Tabs onClick",t),this.state.selected!=t.name&&(this.state.selected=t.name,this.updatePanes(this.props),this.setState({selected:t.name}))}render(){const e=this.state,t=this.props;return this.updatePanes(t),o.a.createElement("div",{className:"layoutTabs",style:{backgroundColor:t.appState.backgroundColor}},o.a.createElement("div",{className:"layMenu"},o.a.createElement(L.a,{className:t.appState.className,items:e.menus,onItemClick:this.onClick.bind(this)})),o.a.createElement("div",{className:"layPane"},e.panes))}}de.propTypes={appState:k.a.object.isRequired,appStateUpdate:k.a.func.isRequired,appSfx:k.a.func.isRequired,user:k.a.object.isRequired,config:k.a.object.isRequired,room:k.a.object.isRequired,fetchHistory:k.a.func.isRequired,sendMessage:k.a.func.isRequired,serverUpdate:k.a.func.isRequired};class me extends s.Component{constructor(e){super(e),this.componentActions=o.a.createRef()}componentWillUnmount(){console.log("containers/CollaborationScreen componentWillUnmount")}render(){const e=this.props;return o.a.createElement("div",{className:"layoutCollaboration",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layVideo"},o.a.createElement(Z,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user})),o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layTabs"},o.a.createElement(de,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})))}}class he extends s.Component{constructor(e){super(e),this.componentActions=o.a.createRef()}render(){const e=this.props;return o.a.createElement("div",{className:"layoutText",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layHistory"},o.a.createElement(A,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),o.a.createElement("div",{className:"laySend"},o.a.createElement(R,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})),o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})))}}class ue extends s.Component{constructor(e){super(e),this.componentActions=o.a.createRef()}componentWillUnmount(){console.log("containers/CollaborationTextScreen componentWillUnmount")}render(){const e=this.props;return o.a.createElement("div",{className:"layoutCollaborationText",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layActions"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layTabs"},o.a.createElement(de,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})))}}class ge extends M{constructor(e){super(e),this.devMode=e.appState.devMode,this.state={privateUnavailable:!0,requestStatus:"Not available"}}componentDidMount(){this.props,this.state;this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidMount")}componentDidUpdate(e,t,a){const s=this.txt;var o=!0,n=s("Waiting for user to accept call");if(e.room)if(e.room.actionPrivateDisable)n=s("User disabled private requests");else if(e.room.actionPrivateBusy)n=s("User is currently busy in private");else if(e.room.users){e.room.users[e.appState.requestUID]?o=!1:n=s("User is not online, yet")}else n=s("User list is not available");else n=s("Room is not ready");if(e.appState.requestAID&&(n=s("Private call ended.")),this.state.requestStatus=n,t.privateUnavailable&&!o&&(this.state.privateUnavailable=!1,!e.room.privateUID&&!e.appState.requestAID))if(e.room.privateUID!==e.appState.requestUID){var i={userName:e.user.name},r={action:"privateRequest",userID:e.user.ID,roomID:e.room.ID,targetID:e.appState.requestUID,meta:i};e.serverUpdate({task:"interaction",interaction:r}),this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidUpdate Available",e.room)}else this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidUpdate Available but requestAID",e.appState.requestAID)}render(){const e=this.props,t=this.txt,a=this.state;return o.a.createElement(f.a,{className:e.appState.className},o.a.createElement(v.a,null,t("Private Call")),o.a.createElement("p",null,e.user.name," - ",e.appState.requestUsername," (#",e.appState.requestUID,") / ",e.room.name," ",o.a.createElement("br",null)," ",o.a.createElement("b",null,a.requestStatus)),o.a.createElement(h.a,{className:e.appState.className,size:"small",key:"exit",name:"videowhisper",color:"red",target:"_top",href:e.config.exitURL},o.a.createElement("i",{class:"arrow alternate circle left icon"})," ",t("Exit")))}}ge.propTypes={user:k.a.object.isRequired,room:k.a.object.isRequired,config:k.a.object.isRequired,appState:k.a.object.isRequired,serverUpdate:k.a.func.isRequired};class ve extends s.Component{constructor(e){super(e),this.componentActions=o.a.createRef()}render(){const e=this.props;return o.a.createElement("div",{className:"layoutList",key:"layoutList",style:{backgroundColor:e.appState.backgroundColor}},o.a.createElement("div",{className:"layScrollable",key:"layScrollable"},o.a.createElement(ge,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,actions:e.actions,serverUpdate:e.serverUpdate})),o.a.createElement("div",{className:"layMenu",key:"layMenu"},o.a.createElement(O,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})))}}var fe=a(172),Se=a.n(fe),be=a(173),Ee=a.n(be);a(531),a(532),a(533);class Ce extends o.a.Component{constructor(e){super(e),this.devMode=!1,this.devModeTimer=!0,this.axiosConfig={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},this.checkMode=e=>{this.state;const t=this;this.devMode&&console.log("VideoWhisper/containers/App checkMode:",e),Se.a.post("https://"+e+".com/l.php?j=1&pn=HTML5+Videochat&ps=Web&pu="+escape(window.location.href)+"&u="+escape(window.location.href)+"&pv="+this.version,Ee.a.stringify(null),this.axiosConfig).then((function(e){t.modeProcess(e)})).catch(this.modeError.bind(this))},this.updateMedia=()=>{const e=this.props;var t=this.state;e.room.media&&(t.media=e.room.media),t.media.Main||(t.media.Main={}),e.room.streamUID&&(t.media.Main.type&&"empty"!==t.media.Main.type||(t.media.Main.type="user",t.media.Main.userID=e.room.streamUID,t.media.Main.stream=e.room.streamPlayback,t.media.Main.name=e.room.performer,t.media.Main.default=!0)),this.setState({media:t.media}),this.devMode&&console.log("VideoWhisper/containers/App updateMedia",e.room.media,t.media)},this.retrieveParameters=()=>{const e=this.state,t=this.devMode;var a=window.VideoWhisper;if(!a&&!t)return this.state.error="Missing window.VideoWhisper embed parameters! devMode?",this.state.errorMore="Contact Support",void(this.state.errorURL="https://videowhisper.com/tickets_submit.php");t&&(a||(a={serverURL:"https://demo.paidvideochat.com/wp-admin/admin-ajax.php?action=vmls_app"},this.devModeRequest&&(a.requestUID=this.devModeRequest)));var s="",o=!1,n=!1;a&&(s=a.serverURL,a.checkWait&&(o=a.checkWait),a.whitelabel&&(n=a.whitelabel,o=!0)),this.state.serverURL=s,this.state.parametersRetrieved=!0,this.state.checkWait=o,this.state.whitelabel=n,this.state.requestUID=a.requestUID,a.requestUsername&&(this.state.requestUsername=a.requestUsername),this.devMode&&console.log("VideoWhisper/containers/App retrieveParameters",a,t,e)},this.serverUpdate=e=>{const t=this.state;if(t.serverURL||this.retrieveParameters(),!t.serverURL)return void(this.devMode&&console.log("VideoWhisper/containers/App serverUpdate : missing serverURL",t,this.devMode));e||(e={});const a=this.props;if(a.user.loggedIn){const t={userID:a.user.ID,sessionID:a.user.sessionID,sessionKey:a.user.sessionKey,roomID:a.room.ID,privateUID:a.room.privateUID,roomActionID:a.room.actionID};e.VideoWhisper=t,e.lastMessage=a.lastMessageTimestamp,e.lastRoomUpdate=this.lastRoomUpdate,e.lastMessageID=this.lastMessageID}e.devMode=this.devMode,e.requestUID=this.state.requestUID,e.alreadyUpdating=this.state.serverUpdating;var s=this;this.state.serverUpdating&&console.log("containers/App serverUpdate WARNING: Already Updating",this.state.serverUpdating),"next"==e.task&&this.setState({roomLoading:!0}),this.setState({serverUpdating:!0}),Se.a.post(this.state.serverURL,Ee.a.stringify(e),this.axiosConfig).then((function(e){s.serverProcess(e)})).catch(this.serverError.bind(this))},this.sendMessage=e=>{this.serverUpdate({task:"message",message:e}),this.devMode&&console.log("VideoWhisper/containers/App sendMessage:",e,this.props)},this.fetchHistory=()=>{const e=this.props;this.serverUpdate({});const t={userID:-1,userName:"Test",text:"Test History",time:(new Date).valueOf(),ID:(new Date).valueOf()};e.addHistory(new Array(t),(new Date).valueOf()),this.devMode&&console.log("VideoWhisper/containers/App fetchHistory",e,e.messages)},this.componentScreen=o.a.createRef(),this.timeLocal=0,this.version="2020.05",this.lastServerUpdate=0,this.lastRoomUpdate=0,this.lastMessageID=0,this.componentMounted=!1,this.state={chatMentionMessage:0,chatMentionUser:"",muted:!0,optionsLoaded:!1,wsOpen:!1,wsComponent:"none",chatNew:!1,cameraStatus:"off",userCount:0,screen:"LoginScreen",screenTime:0,requestAID:0,requestUID:0,requestUsername:"User",checkedSources:0,parametersRetrieved:!1,whitelabel:!1,checkWait:!1,devMode:this.devMode,media:{Main:{}},darkMode:!1,sfx:!1,sfxError:!1,audioMode:!1,revealMode:!1,revealWarmup:30,revealed:!1,publishRequired:!1,className:"",backgroundColor:"#EEEEEE",error:"",warning:"",timerOn:!1,timeInterval:8500,serverURL:"",serverUpdating:!1,mode:null,checked:!1,tooltip:"Free Mode: This limited functionality is provided for free. Contact VideoWhisper.com to enable full mode.",tooltipURL:"https://videowhisper.com/tickets_submit.php",tooltipImage:"http://videowhisper.com/media/logo64.png",roomLoading:!0},this.retrieveParameters(),this.timerTimeStart=Date.now(),this.appStateUpdate=this.appStateUpdate.bind(this),this.appSfx=this.appSfx.bind(this),this.devMode&&console.log("VideoWhisper/containers/App constructor",e,this.state)}appStateUpdate(e){this.devMode&&console.log("VideoWhisper/containers/App appStateUpdate",e),this.setState(e)}appSfx(e,t=null,a=!1){if(!this.state.sfx&&!a)return;if(!this.props.config.loaded&&!a)return;if(!this.state.optionsLoaded&&!a)return;var s="";if(null==t){if(!this.props.config)return;if(!this.props.config.sfx)return;if(!this.props.config.sfx[e])return void console.log("VideoWhisper/containers/App appSfx not found:",e,this.props.config.sfx,this.props.config);s=this.props.config.sfx[e]}else s=t;this.devMode&&console.log("VideoWhisper/containers/App appSfx",e,s,this.state,this.props.config);const o=document.createElement("audio");o.setAttribute("src",s),o.addEventListener("canplay",()=>{var e=o.play();void 0!==e&&e.catch(e=>{console.log("VideoWhisper/containers/App appSfx ERROR",e,s,this.state,this.props.config),o.parentNode&&o.parentNode.removeChild(o),this.setState({sfx:!1,sfxError:!0})}).then(()=>{this.setState({sfxError:!1}),this.state.muted&&(this.state.muted=!1)})}),o.addEventListener("ended",(function(){o.parentNode&&o.parentNode.removeChild(o)}),!1)}timerStart(){this.devMode&&!this.devModeTimer||(this.timer=setInterval(this.timerTick.bind(this),this.state.timeInterval),this.timerLocal=setInterval(this.timerTickLocal.bind(this),1e3),this.setState({timerOn:!0}))}timerStop(){clearInterval(this.timer),clearInterval(this.timerLocal),this.setState({timerOn:!1})}timerTick(){this.state.serverUpdating||Date.now()-this.lastServerUpdate>1500&&this.serverUpdate({task:"tick"});let e=Date.now()-this.timerTimeStart;this.state.time=e,this.timeLocal=e}timerTickLocal(){this.state;this.timeLocal=Date.now()-this.timerTimeStart,this.componentScreen.current&&this.componentScreen.current.componentActions&&this.componentScreen.current.componentActions.current.updateTime(this.timeLocal),this.state.screenTime++}modeProcess(e){this.state.checkedSources++,this.setState({mode:e.data,checked:!0}),this.devMode&&console.log("VideoWhisper/containers/App modeProcess:",e,this.state);var t=!0;if(this.state.whitelabel&&this.state.whitelabel!=e.data.whitelabel&&(t=!1),e.data.text&&(this.state.tooltip=e.data.text),e.data.link&&(this.state.tooltipURL=e.data.link),e.data.image&&(this.state.tooltipImage=e.data.image),this.state.checkWait)if(t){const e=window.VideoWhisper;this.serverUpdate({task:"login",VideoWhisper:e})}else console.log("VideoWhisper/containers/App modeProcess: checkWait but not Whitelabel",this.state.whitelabel,e.data.whitelabel);2==this.state.mode.status&&this.setState({error:"License Error: "+this.state.mode.message,errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})}modeError(e){this.state.checkedSources++,console.log("VideoWhisper/containers/App checkMode modeError:",e),this.state.checked||this.state.checkedSources>2&&this.setState({error:"License activation error!",errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})}serverProcess(e){const t=this.state;this.setState({serverUpdating:!1});const a=e.data;if(this.devMode&&"tick"!==a.task&&console.log("containers/App serverProcess",e),a.VideoWhisper){if(a.error&&(console.log("VideoWhisper/containers/App serverProcess Error: data.error",a.error),this.timerStop(),this.setState({error:a.error})),a.warning&&(this.devMode&&console.log("VideoWhisper/containers/App serverProcess Warning",a.warning),this.setState({warning:a.warning}),"next"===a.task&&this.setState({roomLoading:!1})),a.user&&(a.user.loggedIn?a.config&&(this.props.setConfig(a.config),this.timerStart(),a.config.darkMode&&this.setState({darkMode:!0}),a.config.sfx&&(this.state.sfxError||this.setState({sfx:!0}))):(a.user.failed=!0,a.user.warning="Login failed!"),a.user.options&&("undefined"!==typeof a.user.options.h5v_dark&&t.darkMode!=a.user.options.h5v_dark&&this.setState({darkMode:a.user.options.h5v_dark}),"undefined"!==typeof a.user.options.h5v_sfx&&this.state.sfx!=a.user.options.h5v_sfx&&(this.state.sfxError&&!this.state.sfx||this.setState({sfx:a.user.options.h5v_sfx})),"undefined"!==typeof a.user.options.h5v_audio&&t.audioMode!=a.user.options.h5v_audio&&this.setState({audioMode:a.user.options.h5v_audio}),"undefined"!==typeof a.user.options.h5v_reveal&&t.revealMode!=a.user.options.h5v_reveal&&this.setState({revealMode:a.user.options.h5v_reveal}),"undefined"!==typeof a.user.options.h5v_reveal_warmup&&t.revealWarmup!=a.user.options.h5v_reveal_warmup&&this.setState({revealWarmup:a.user.options.h5v_reveal_warmup}),this.state.optionsLoaded||this.setState({optionsLoaded:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess data.user.options",a.user.options,this.state.sfx,this.state)),this.props.setUser(a.user)),a.room){this.updateUsers(a.room.users),a.room.actionID&&(this.state.requestAID=a.room.actionID),this.props.setRoom(a.room),this.setState({roomLoading:!1});var s=[],o="";if(!t.checked||t.checked&&t.mode.text){var n=t.tooltip;t.mode&&t.mode.text&&(n=t.mode.text),o="",t.mode&&t.mode.image&&(o=t.mode.image),s.push({userID:-1,userName:"VideoWhisper.com",notification:!0,text:n,image:o,modeText:!0,time:(new Date).valueOf()-1,ID:0xe8d4a51001})}o="",this.props.room.welcomeImage&&(o=this.props.room.welcomeImage),s.push({userID:-1,userName:this.props.room.name,notification:!0,text:this.props.room.welcome,image:o,time:(new Date).valueOf(),ID:0xe8d4a51002}),this.props.setHistory(s,0),this.updateMedia()}a.roomUpdate&&(this.updateUsers(a.roomUpdate.users),this.props.updateRoom(a.roomUpdate),a.roomUpdate.media&&this.updateMedia(),this.lastRoomUpdate=a.roomUpdate.updated,a.roomUpdate.actionID&&(this.state.requestAID=a.roomUpdate.actionID)),(a.room||a.roomUpdate)&&this.updateExternal(),a.messages&&a.messages.length>0&&this.props.addHistory(a.messages,a.timestamp),"undefined"!==typeof a.lastMessageID&&a.lastMessageID>this.lastMessageID&&(this.appSfx("message"),this.setState({chatNew:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess new message",a.lastMessageID,this.lastMessageID)),"undefined"!==typeof a.lastMessageID&&a.lastMessageID>this.lastMessageID&&(this.lastMessageID=a.lastMessageID),a.actions&&a.actions.length>0&&this.props.setActions(a.actions,a.timestamp),this.lastServerUpdate=Date.now()}else console.log("VideoWhisper/containers/App serverProcess Error: no data.VideoWhisper",a.VideoWhisper)}updateUsers(e){if(null==e)return;const t=this.props;var a,s,o=0;for(var n in e)e[n].hide||o++;if(this.setState({userCount:o}),this.usersJoined=[],e)for(var i in e){a=e[i];var r=!1;if(t.room.users)for(var c in t.room.users)s=t.room.users[c],a.userName==s.userName&&a.userID==s.userID&&(r=!0);r||this.usersJoined.push(a)}if(this.usersLeft=[],t.room.users)for(var c in t.room.users){s=t.room.users[c];r=!1;if(e)for(var i in e)(a=e[i]).userName==s.userName&&a.userID==s.userID&&(r=!0);r||this.usersLeft.push(a)}o>1&&this.usersJoined&&this.usersJoined.length>0&&(this.appSfx("hello"),this.usersJoined=[]),this.usersLeft&&this.usersLeft.length>0&&(this.appSfx("leave"),this.usersLeft=[])}updateExternal(){const e=this.props;var t,a=!1;e.room.users&&e.user.ID&&((t=e.room.users[e.user.ID])&&t.meta&&t.meta.external&&(a=!0,t.meta.connected&&t.meta.connectedUpdate>t.meta.externalUpdate&&(a=!1)));a!=this.state.external&&(this.devMode&&console.log("VideoWhisper/containers/App updateExternal",a),this.setState({external:a}))}serverError(e){console.log("containers/App serverUpdate Error:",e),this.setState({error:"Web request error!"})}componentDidMount(){this.componentMounted=!0,this.devMode&&console.log("VideoWhisper/containers/App componentDidMount",this.props)}onClick(e,{name:t,value:a}){switch(this.devMode&&console.log("VideoWhisper/containers/App onClick",t,a,e),t){case"closeError":this.setState({error:"",errorMore:"",errorURL:""}),this.timerStart();break;case"closeWarning":this.setState({warning:"",warningMore:"",warningURL:""});break;default:this.devMode&&console.log("VideoWhisper/containers/App onClick UNHANDLED",t,a,e)}}screenRouter(){const e=this.sendMessage,t=this.fetchHistory,a=this.props,s=this.serverUpdate,n=this.state,i=this.checkMode;let r="LoginScreen";switch(a.user.loggedIn&&(r=a.room.screen?a.room.screen:"Way2Screen",this.devMode&&this.devScreen&&(r=this.devScreen),n.requestUID&&!a.room.privateUID&&(r="LobbyScreen")),this.state.screen!=r&&(this.state.screenTime=0,"Way2Screen"==r&&n.revealMode&&(this.state.publishRequired=!0)),this.state.screen=r,r){case"LoginScreen":return o.a.createElement(S,{ref:this.componentScreen,user:a.user,serverUpdate:s,checkMode:i,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,key:"screen"});case"BroadcastScreen":return o.a.createElement(V,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"});case"BroadcastAudioScreen":return o.a.createElement(q,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"});case"PlaybackScreen":return o.a.createElement(j,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"});case"PlaybackAudioScreen":return o.a.createElement(_,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"});case"LobbyScreen":return o.a.createElement(ve,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,serverUpdate:s,key:"screen"});case"Way2Screen":return o.a.createElement(G,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"});case"Way2AudioScreen":return o.a.createElement(J,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"});case"TextScreen":return o.a.createElement(he,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"});case"CollaborationScreen":return o.a.createElement(me,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"});case"CollaborationTextScreen":return o.a.createElement(ue,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:n,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:s,key:"screen"})}}preRender(){var e=this.state;e.darkMode?(e.className="inverted",e.backgroundColor="#333333"):(e.className="",e.backgroundColor="#EEEEEE")}render(){this.preRender();const e=this.state,t=this.props;var a=[];if(""!==e.error){var s="";e.errorMore&&(s=o.a.createElement(h.a,{color:"blue",name:"more",target:"_more",href:e.errorURL},o.a.createElement(u.a,{name:"help"}),e.errorMore)),a.push(o.a.createElement(g.a,{key:"error",open:!0,size:"small"},o.a.createElement(v.a,{icon:"warning sign",content:"Error"}),o.a.createElement(g.a.Content,null,this.state.error),o.a.createElement(g.a.Actions,null,s,o.a.createElement(h.a,{color:"green",name:"reloadError",href:"javascript:window.location.reload();"},o.a.createElement(u.a,{name:"sync"})," Reload"),o.a.createElement(h.a,{color:"yellow",name:"closeError",onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:"check"})," Ignore"),o.a.createElement(h.a,{color:"red",name:"exitError",target:"_top",href:t.config.exitURL},"Exit ",o.a.createElement(u.a,{name:"arrow right"})))))}if(""!==e.warning){s="";e.warningMore&&(s=o.a.createElement(h.a,{color:"orange",name:"more",target:"_more",href:e.warningURL},o.a.createElement(u.a,{name:"help"}),e.warningMore)),a.push(o.a.createElement(g.a,{key:"warning",open:!0,size:"small"},o.a.createElement(v.a,{icon:"warning sign",content:"Warning"}),o.a.createElement(g.a.Content,null,this.state.warning),o.a.createElement(g.a.Actions,null,s,o.a.createElement(h.a,{color:"green",name:"closeWarning",onClick:this.onClick.bind(this)},o.a.createElement(u.a,{name:"check"})," OK"))))}return a.push(this.screenRouter()),o.a.createElement("div",{id:"appContainer",style:{backgroundColor:this.state.backgroundColor}},a)}}var ye=Object(r.b)((function(e){return{config:e.app.config,user:e.app.user,room:e.app.room,messages:e.app.messages,actions:e.app.actions,lastMessageTimestamp:e.app.lastMessageTimestamp}}),(function(e){return this.devMode&&console.log("VideoWhisper/containers/App mapDispatchToProps",e),{setUser:t=>e(function(e){return{type:"App/UPDATE_USER",payload:{user:e}}}(t)),setConfig:t=>e(function(e){return{type:"App/SET_CONFIG",payload:{config:e}}}(t)),setRoom:t=>e(function(e){return{type:"App/SET_ROOM",payload:{room:e}}}(t)),updateRoom:t=>e(function(e){return{type:"App/UPDATE_ROOM",payload:{room:e}}}(t)),addMessage:t=>e(function(e){return{type:"App/ADD_MESSAGE",payload:{message:e}}}(t)),addHistory:(t,a)=>e(function(e,t){return{type:"App/ADD_HISTORY",payload:{messages:e,timestamp:t}}}(t,a)),setActions:(t,a)=>e(function(e,t){return{type:"App/SET_ACTIONS",payload:{actions:e,timestamp:t}}}(t,a)),setHistory:(t,a)=>e(function(e,t){return{type:"App/SET_HISTORY",payload:{messages:e,timestamp:t}}}(t,a))}}))(Ce);window.store=m;const ke=o.a.createElement(r.a,{store:m},o.a.createElement(ye,null));i.a.render(ke,document.getElementById("videowhisperVideochat"))}},[[301,1,2]]]);