(this.webpackJsonpvideowhisper=this.webpackJsonpvideowhisper||[]).push([[0],{243:function(e,t,a){},247:function(e,t,a){},317:function(e,t){},324:function(e,t,a){},325:function(e,t,a){},326:function(e,t,a){},327:function(e,t,a){"use strict";a.r(t);var o=a(1),s=a.n(o),i=a(37),n=a.n(i),r=(a(243),a(144)),c=a(79),d=a(102),l="App/UPDATE_USER",p="App/SET_ROOM",m="App/UPDATE_ROOM",h="App/SET_CONFIG",u="App/ADD_HISTORY",v="App/ADD_MESSAGE",g="App/SET_ACTIONS",b="App/SET_HISTORY",f={user:{ID:0,sessionID:0,sessionKey:"",name:"User.0",loggedIn:!1,warning:"Please wait for login..",balance:0},room:{ID:0,name:"Room.0",screen:"LoginScreen",streamBroadcast:"Room",streamPlayback:"Room",privateUID:0,actionPrivate:!1,actionPrivateClose:!1,actionID:0,performer:"",performerID:0,welcome:"Welcome to default room!"},config:{wss:"",application:"",videoCodec:"h264",videoBitrate:"400",videoFramerae:"29.97",audioCodec:"opus",audioBitrate:"64",autoBroadcast:!1,exitURL:"https://videowhisper.com",errorURL:"https://videowhisper.com/tickets_submit.php",actionFullpage:!1,actionFullscreen:!0,loaded:!1},messages:[],actions:[],lastMessageTimestamp:0};var j=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(a.type){case l:e=Object.assign({},t,{user:Object.assign({},t.user,a.payload.user)});break;case p:e=Object.assign({},t,{room:Object.assign({},a.payload.room)});break;case m:e=Object.assign({},t,{room:Object.assign({},t.room,a.payload.room)});break;case h:e=Object.assign({},t,{config:Object.assign({},a.payload.config)});break;case v:e=Object.assign({},t,{messages:[].concat(Object(d.a)(t.messages),[a.payload.message])});break;case u:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,messages:t.messages.concat(a.payload.messages)});break;case g:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,actions:Object(d.a)(a.payload.actions)});break;case b:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,messages:Object(d.a)(a.payload.messages)});break;default:e=Object.assign({},t)}return e},S=Object(c.b)({app:j}),x=Object(c.c)(S),O=a(8),y=a(7),k=a(11),C=a(9),M=a(10);var U=a(328),w=a(76),R=a(114),I=a(352),D=a(356),N=(a(247),a(355)),A=a(0),T=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return e in t.config.text?t.config.text[e]:e},o.devMode=e.appState.devMode,o.state={loggedin:!1,modeServers:["videowhisper","videowhispers","ateom"]},o}return Object(y.a)(a,[{key:"componentDidMount",value:function(){var e=this.props,t=this.state;if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen componentDidMount",e.appState.parametersRetrieved,e.appState.checkWait,e,t,window,window.VideoWhisper),!t.loggedin&&e.appState.parametersRetrieved&&!e.user.loggedIn&&!e.user.failed&&!e.appState.checkWait){var a=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:a}),this.state.loggedin=!0}this.devMode?setTimeout((function(){return t.modeServers.forEach(e.checkMode)}),3e3):t.modeServers.forEach(e.checkMode)}},{key:"componentDidUpdate",value:function(e,t,a){if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen componentDidUpdate parametersRetrieved checkWait loggedin",e.appState.parametersRetrieved,e.appState.checkWait,t.loggedin),!t.loggedin&&e.appState.parametersRetrieved&&!e.user.loggedIn&&!e.user.failed&&!e.appState.checkWait){var o=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:o}),this.state.loggedin=!0}}},{key:"render",value:function(){var e,t=this.props;this.state;e=t.user.loggedIn?"Logged in as "+t.user.name:"Not logged in, yet. ",t.user.warning&&(e+=t.user.warning);var a=Object(A.jsxs)("p",{children:[" Entering the ",Object(A.jsx)("a",{href:"https://videowhisper.com",children:"VideoWhisper.com"})," HTML5 Videochat App"]});return(t.appState.whitelabel||!t.appState.parametersRetrieved&&!t.appState.error)&&(a=Object(A.jsx)("p",{children:"Entering Videochat"})),t.appState.checked&&(t.appState.mode.status||(a=t.appState.mode.text?t.appState.mode.text:"This is server connection screen."),t.appState.whitelabel&&t.appState.whitelabel!=t.appState.mode.whitelabel&&(a=Object(A.jsxs)("p",{children:["An extra ",Object(A.jsx)("a",{href:"https://videowhisper.com/?p=Invest#level4",children:"license"})," (2 in total) is required to start ",Object(A.jsx)("a",{href:"https://videowhisper.com",children:"VideoWhisper.com"})," HTML5 Videochat application in ",Object(A.jsx)("a",{href:"https://videowhisper.com/?p=Invest#whitelabel",children:"whitelabel mode"}),".",Object(A.jsx)("br",{}),Object(A.jsx)("a",{href:"https://videowhisper.com/tickets_submit.php",children:"Contact Support"})," for details!"]}))),Object(A.jsxs)(N.a,{className:t.appState.className,children:[Object(A.jsxs)("p",{children:[" Logged in: ",e," "]}),Object(A.jsxs)("p",{children:[" ",t.user.error," "]}),a]})}}]),a}(o.Component),L=a(146),P=a(15),V=a(68),E=a(39),W=a(351),q=a(349),F=a(2),B=a.n(F),H=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return e in t.config.text?t.config.text[e]:e},o.updateSize=function(){var e=Object(k.a)(o).state;if(e.container){var t=e.container.clientWidth,a=e.container.clientHeight;a||(a=1);var s=t/a;o.setState({aspectRatio:s,width:t,height:a})}o.devMode&&console.log("components/Panel containerResized",e)},o.state={container:null,width:0,height:0,aspectRatio:0,settingsActive:!0},o.devMode=e.appState.devMode,o}return Object(y.a)(a,[{key:"componentDidMount",value:function(){this.updateSize(),window.addEventListener("resize",this.updateSize,!1),document.addEventListener("onfullscreenchange",this.updateSize,!1),document.addEventListener("webkitfullscreenchange",this.updateSize,!1),document.addEventListener("mozfullscreenchange",this.updateSize,!1),document.addEventListener("msfullscreenchange",this.updateSize,!1),document.addEventListener("MSFullscreenChange",this.updateSize,!1),document.addEventListener("fullscreenchange",this.updateSize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateSize),document.removeEventListener("onfullscreenchange",this.updateSize),document.removeEventListener("webkitfullscreenchange",this.updateSize),document.removeEventListener("mozfullscreenchange",this.updateSize),document.removeEventListener("msfullscreenchange",this.updateSize),document.removeEventListener("MSFullscreenChange",this.updateSize),document.removeEventListener("fullscreenchange",this.updateSize)}},{key:"onClick",value:function(e,t){var a=t.name,o=t.value,s=this.state;"settings"===a&&this.setState((function(e){return{settingsActive:!s.settingsActive}})),this.devMode&&console.log("components/Panel onClick ",a,o,e,s)}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(t.container){var a=t.container.clientWidth,o=t.container.clientHeight;if(o||(o=1),t.width!==a||t.height!==o){var s={aspectRatio:a/o,width:a,height:o};return e.appState.devMode&&console.log("components/Panel getDerivedStateFromProps size update",s,t),s}}return null}}]),a}(o.Component),_=a(226),z=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e))._isMounted=!1,o.bitrateOptions=function(e){var t=[];t.push({key:"bitrate-title",text:Object(A.jsxs)("span",{children:[Object(A.jsx)("strong",{children:"Video Bitrate"})," ",o.state.maxBitrate?" <"+o.state.maxBitrate+"kbps":""]}),disabled:!0});var a=o.state.maxBitrate,s=!1;return[{value:.35,label:"Very Low"},{value:.5,label:"Low"},{value:.75,label:"Medium"},{value:1,label:"Good"},{value:1.25,label:"High"},{value:1.5,label:"Very High"}].forEach((function(o){var i=Math.round(o.value*e);i===a&&(s=!0),i<=a&&t.push({key:i,value:i,text:i+" kbps "+o.label})})),(0===t.length||!s&&1.5*e>a)&&t.push({key:a,value:a,text:a+" kbps Limit"}),t},o.onopen=function(e){var t=this;if(this.devMode&&console.log("components/Camera wsConnection.onopen ",this.wsConnection.readyState,e,this.state),this.wsMessaged=!1,this.props.appStateUpdate({wsOpen:!0,wsComponent:"Camera onopen"}),1==this.wsConnection.readyState){if(this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.onicecandidate=this.onicecandidate,this.peerConnection.onsignalingstatechange=this.onsignalingstatechange.bind(this),this.peerConnection.oniceconnectionstatechange=this.oniceconnectionstatechange.bind(this),this.peerConnection.onnegotiationneeded=this.onnegotiationneeded.bind(this),this.peerConnection.onconnectionstatechange=this.onconnectionstatechange.bind(this),this.localStream.getAudioTracks().forEach((function(e){return t.peerConnection.addTrack(e,t.localStream)})),!this.audioInterface)this.localStream.getVideoTracks().forEach((function(e){return t.peerConnection.addTrack(e,t.localStream)}));this.devMode&&console.log("components/Camera wsConnection.onopen setting wsMessagedCheck"),setTimeout((function(){return t.wsMessagedCheck()}),6e3)}},o.wsMessagedCheck=function(){o.devMode&&console.log("components/Camera wsConnection wsMessagedCheck",o.wsMessaged),o.wsMessaged||(o.setState({buttonDisabled:!1,buttonContent:o.txt("Broadcast"),statusInfo:"Websocked did not reply"}),console.log("components/Camera wsMessagedCheck","Websocked did not reply with ice candidates",o.wsConnection),o.retryIfTimeoutSet||o.retryIfTimeout())},o.onWsMessage=function(e){o.wsMessaged=!0,o.devMode&&console.log("components/Camera wsConnection.onWsMessage",e);var t=JSON.parse(e.data),a=Number(t.status);t.command;if(504===a)console.log("components/Camera wsConnection.onWsMessage status=504 New stream connecting to WSE");else if(503===a)o.retryIfBusy&&setTimeout((function(){return o.buildStream()}),2500),o.retryIfBusy=!1,console.log("components/Camera wsConnection.onWsMessage 503 error busy, retry:",a,t.statusDescription,o.retryIfBusy),o.setState({buttonDisabled:!0,buttonContent:o.txt("Auto Retry"),statusInfo:t.statusDescription,connecting:!0,connected:!1}),o.props.appStateUpdate({cameraStatus:"error"});else if(200!=a)console.log("components/Camera wsConnection.onWsMessage error sdp:",a,t.statusDescription,o.streamInfo),o.stopPublisher(),o.setState({buttonDisabled:!1,buttonContent:o.txt("Broadcast"),statusInfo:t.statusDescription,connecting:!1,connected:!1}),o.props.appStateUpdate({cameraStatus:"error"}),o.retriesLeft=0,o.retryIfBusy=!0;else{var s=t.sdp;void 0!==s&&(o.devMode&&console.log("components/Camera wsConnection.onWsMessage 200 sdp:",t.sdp),o.peerConnection.setRemoteDescription(s).then((function(){o.devMode&&console.log("components/Camera peerConnection.setRemoteDescription: ",o.peerConnection,s)})).catch((function(e){var t=s.sdp,a=t.substring(t.length-2);console.log("components/Camera peerConnection.setRemoteDescriptionError",e,t,a,"\r\n"==a)})));var i=t.iceCandidates;if(o.devMode&&console.log("components/Camera wsConnection msgJSON iceCandidates: ",i),void 0!==i){for(var n in i)o.devMode&&console.log("components/Camera wsConnection iceCandidate: ",n,i[n]),o.peerConnection.addIceCandidate(new RTCIceCandidate(i[n])).then((function(){return o.onAddIceCandidateSuccess(o.peerConnection)}),(function(e){return o.onAddIceCandidateError(o.peerConnection,e)}));null!=o.wsConnection&&o.wsConnection.close()}o.retryIfBusy=!0}},o.setMediaBitrateSDP=function(e,t,a){var s="AS",i=!1;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(i=!0),i&&(a=1e3*(a>>>0),s="TIAS"),a=Math.round(a);for(var n=e.split("\n"),r=-1,c=0;c<n.length;c++)if(0===n[c].indexOf("m="+t)){r=c;break}if(-1===r)return e;for(r++;0===n[r].indexOf("i=")||0===n[r].indexOf("c=");)r++;if(0===n[r].indexOf("b"))return n[r]="b="+s+":"+a,n.join("\n");var d=n.slice(0,r);return d.push("b="+s+":"+a),d=d.concat(n.slice(r,n.length)),o.devMode&&console.log("components/Camera setMediaBitrateSDP",t,a,d.join("\n")),d.join("\n")},o.errorHandler=function(e){o.devMode&&console.log("components/Camera",e)},o.devMode=e.appState.devMode,o.devMode&&console.log("components/Camera constructor",e),o.audioInterface=!1,e.cameraConfig&&(o.audioInterface=e.cameraConfig.audioInterface),o.tChecked=!1,o.retriesLeft=5,o.retryTimeout=5500,o.retryIfTimeoutSet=!1,o.retryIfBusy=!0,o.wsConnection=null,o.peerConnection=null,o.peerConnectionConfig={iceServers:[],optional:[{googSuspendBelowMinBitrate:!1,googImprovedWifiBwe:!0}]},o.localStream=null,o.streamInfo=null,o.userData=null,o.SDPOutput={},o.offerOptions={offerToReceiveAudio:1,offerToReceiveVideo:1},o.localVideo=s.a.createRef(),o.stats={video:{timestamp:0,bandwidth:0,bitrate:0,packetsLost:0,qualityLimitationReason:"none"},audio:{timestamp:0,bandwidth:0,bitrate:0,packetsLost:0}},o.videoIndex=-1,o.audioIndex=-1,o.changedBy="",o.enhanceData={},o.tWarn="",o.resolutions={"4K":{label:"4K",width:3840,height:2160,ratio:"16:9",bitrate:12e3},"1440p":{label:"1440p",width:2560,height:1440,ratio:"16:9",bitrate:6e3},"1080p":{label:"1080p",width:1920,height:1080,ratio:"16:9",bitrate:3e3},"720p":{label:"720p",width:1280,height:720,ratio:"16:9",bitrate:1800},SVGA:{label:"SVGA",width:800,height:600,ratio:"4:3",bitrate:800},"480p":{label:"480p",width:858,height:480,ratio:"16:9",bitrate:750},VGA:{label:"VGA",width:640,height:480,ratio:"4:3",bitrate:600},"360p":{label:"360p",width:640,height:360,ratio:"16:9",bitrate:400},"240p":{label:"240p",width:426,height:240,ratio:"16:9",bitrate:220},CIF:{label:"CIF",width:352,height:288,ratio:"4:3",bitrate:200},QVGA:{label:"QVGA",width:320,height:240,ratio:"4:3",bitrate:180},"180p":{label:"180p",width:320,height:180,ratio:"16:9",bitrate:160},"90p":{label:"90p",width:160,height:90,ratio:"16:9",bitrate:100}},o.state={screenShare:!1,audioOn:!0,videoOn:!0,hasError:!1,errorMessage:"Check JS console.",packetLoss:!1,revealed:!0,tapRequired:!1,connected:!1,connecting:!1,settingsActive:!1,statusInfo:"Connecting...",buttonContent:"Connecting",buttonDisabled:!0,bitrateInfo:Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"eye slash"}),"Detecting"]}),videoWidth:640,videoHeight:360,videoAspectRatio:1.77,camera:null,cameraOptions:[],videoSource:null,microphone:null,microphoneOptions:[],audioSource:null,maxBitrate:750,maxResolutionHeight:480,bitrate:600,bitrateOptions:[],resolution:"360p",resolutionOptions:[]},o.onChange=o.onChange.bind(Object(k.a)(o)),o}return Object(y.a)(a,[{key:"componentDidCatch",value:function(e,t){console.log("components/Camera componentDidCatch",e,t)}},{key:"componentDidMount",value:function(){this.devMode&&console.log("components/Camera componentDidMount"),this._isMounted=!0,Object(V.a)(Object(E.a)(a.prototype),"componentDidMount",this).call(this),this.interfaceReady()}},{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Camera componentWillUnmount"),this.props.serverUpdate({task:"media",connected:!1}),this._isMounted=!1,this.stopPublisher();this.state;this.localStream&&this.localStream.getTracks().forEach((function(e){return e.stop()})),Object(V.a)(Object(E.a)(a.prototype),"componentWillUnmount",this).call(this)}},{key:"timerStart",value:function(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.packetsLost=0,this.stats.audio.packetsLost=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),2500),this.setState({packetLoss:!1})}},{key:"timerStop",value:function(){clearInterval(this.timer),this.setState({packetLoss:!1})}},{key:"timerTick",value:function(){var e=this,t=0;if(this.state.connected&&this.streamInfo&&this.streamInfo.streamName!=this.props.room.streamBroadcast&&(t=1),(this.props.appState.publishRequired||t)&&(this.state.connected||"1"==this.props.config.cameraAutoBroadcast)&&(this.devMode&&console.log("components/Camera timerTick publishRequired",this.props.appState.publishRequired,t,this.streamInfo),this.props.appStateUpdate({publishRequired:!1}),this.setState({buttonDisabled:!0,buttonContent:this.txt("Closing")}),this.stopPublisher(),this.setState({buttonDisabled:!0,buttonContent:this.txt("Restarting Broadcast"),statusInfo:this.txt("Restarting Broadcast"),connecting:!0,connected:!1}),this.buildStream()),this.state.connected&&this.peerConnection){this.peerConnection.getSenders().forEach((function(t){t.getStats().then((function(t){t.forEach((function(t){var a=t.kind;if(void 0===a&&(a=t.mediaType),a&&(e.devMode&&t.packetsLost>0&&console.log("components/Camera packetsLost ",t.packetsLost,a,t),"remote-inbound-rtp"==t.type&&(e.stats[a]||(e.stats[a]={}),e.stats[a].packetsLost=t.packetsLost,e.stats[a].roundTripTime=t.roundTripTime,e.stats[a].jitter=t.jitter,e.stats[a].timestampRemote=t.timestamp),"outbound-rtp"===t.type&&!t.isRemote&&("video"===a||"audio"===a))){var o=t.timestamp-e.stats[a].timestamp;o>0&&o<6e3&&t.bytesSent>=e.stats[a].bytesSent&&(e.stats[a].bitrate=8*(t.bytesSent-e.stats[a].bytesSent)/o),e.stats[a].timestamp=t.timestamp,e.stats[a].bytesSent=t.bytesSent,e.stats[a].qualityLimitationReason=t.qualityLimitationReason}}))}))}));var a="";this.audioInterface||this.props.room.audioOnly||this.props.appState.audioMode||"Way2Screen"==this.props.appState.screen&&this.props.appState.revealMode&&!this.props.appState.revealed||(a=Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"video camera"}),Math.round(this.stats.video.bitrate)," kbps","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":"",this.stats.video.roundTripTime>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"clock"}),this.stats.video.roundTripTime," "]}):"",this.stats.video.jitter>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"circle notch"}),Math.round(1e3*(this.stats.video.jitter+Number.EPSILON))/1e3," jitter "]}):"",this.stats.video.packetsLost>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"exclamation circle"}),this.stats.video.packetsLost," packets lost "]}):"",Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"expand"}),this.state.videoWidth,"x",this.state.videoHeight," "]}),Object(A.jsx)("br",{})]})),this.connectionInfo=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"broken chain"}),"Socket Not Connected"]}),this.wsConnection&&(this.connectionInfo=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"chain"}),this.wsConnection.readyState]})),this.peerInfo=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"stop circle"}),"Peer Not Connected"]}),this.peerConnection&&(this.peerInfo=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"play circle"}),this.peerConnection.connectionState,"/",this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState]}));var o=Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"wait"}),"Measuring..."]}),s="";this.streamInfo&&this.streamInfo.streamName&&(s=this.streamInfo.streamName.split("?")[0]),(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(o=Object(A.jsxs)("div",{children:[Object(A.jsx)(w.a,{name:"user"})," ",s," ",Object(A.jsx)("br",{}),a,Object(A.jsx)(w.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps","none"!==this.stats.audio.qualityLimitationReason&&void 0!==this.stats.audio.qualityLimitationReason?"(limited: "+this.stats.audio.qualityLimitationReason+")":"",this.stats.audio.roundTripTime>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"clock"}),this.stats.audio.roundTripTime," "]}):"",this.stats.audio.jitter>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"circle notch"}),Math.round(1e3*(this.stats.audio.jitter+Number.EPSILON))/1e3," jitter "]}):"",this.stats.audio.packetsLost>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"exclamation circle"}),this.stats.audio.packetsLost," packets lost "]}):"",Object(A.jsx)("br",{}),this.connectionInfo," ",this.peerInfo]})),(this.state.settingsActive||this.audioInterface)&&this.setState({bitrateInfo:o}),(this.stats.audio.packetsLost||this.stats.video.packetsLost)&&(this.state.packetLoss||this.setState({packetLoss:!0}))}}},{key:"render",value:function(){var e,t=this;if(this.state.hasError)return Object(A.jsxs)("h1",{children:["Something went wrong: ",this.state.errorMessage," "]});var a=this.state,o=this.props,s=this.onChange;this.devMode=o.appState.devMode;var i={};if(!this.audioInterface){var n=a.videoWidth,r=a.videoHeight,c=0,d=0;a.width&&a.aspectRatio&&a.videoAspectRatio&&(a.videoAspectRatio>a.aspectRatio?(r=(n=a.width)/a.videoAspectRatio,d=(a.height-r)/2):(n=(r=a.height)*a.videoAspectRatio,c=(a.width-n)/2)),i={position:"absolute",left:c,top:d,width:n,height:r}}var l="";a.tapRequired&&(l=Object(A.jsxs)(W.a.Field,{children:[Object(A.jsx)(U.a,{inverted:!0,name:"tap",content:"Tap to Show",onClick:this.onClick.bind(this)}),Object(A.jsx)(R.a,{pointing:"left",color:"black",children:"Gesture is required to show preview"})]}));var p="",m="",h="",u="microphone";this.audioInterface||o.room.audioOnly||o.appState.audioMode||"Way2Screen"==o.appState.screen&&o.appState.revealMode&&!o.appState.revealed||(u="video","function"===typeof navigator.mediaDevices.getDisplayMedia&&(p=Object(A.jsxs)(W.a.Field,{inline:!0,children:[Object(A.jsx)(U.a,{compact:!0,inverted:o.appState.darkMode,size:"small",name:"screenShare",content:this.txt("Screen Share"),onClick:this.onClick.bind(this)})," ","_screen"==a.videoSource?Object(A.jsx)(w.a,{color:"green",name:"eye"}):""]})),a.screenShare||(m=Object(A.jsxs)(W.a.Field,{children:[Object(A.jsx)(q.a,{compact:!0,className:"inverted tiny v-select",name:"camera",value:a.camera,placeholder:"Camera",selection:!0,onChange:this.onChange,options:a.cameraOptions})," ",a.videoSource==a.camera&&"_disabled"!=a.videoSource?Object(A.jsx)(w.a,{color:"green",name:"eye"}):""," "]})),h=Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(W.a.Field,{children:Object(A.jsx)(q.a,{compact:!0,className:"inverted tiny v-select",name:"resolution",value:a.resolution,onChange:s,placeholder:"Video Resolution",selection:!0,options:a.resolutionOptions})}),Object(A.jsx)(W.a.Field,{children:Object(A.jsx)(q.a,{compact:!0,className:"inverted tiny v-select",name:"bitrate",value:a.bitrate,onChange:s,placeholder:"Video Bitrate",selection:!0,options:a.bitrateOptions})})]})),this.tChecked||this.updateBitrates();var v,g="";a.settingsActive?(this.connectionInfo=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"broken chain"}),"Socket Not Connected"]}),this.wsConnection&&(this.connectionInfo=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"chain"}),this.wsConnection.readyState]})),this.peerInfo=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"stop circle"}),"Peer Not Connected"]}),this.peerConnection&&(this.peerInfo=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"play circle"}),this.peerConnection.connectionState,"/",this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState]})),g=Object(A.jsxs)("div",{className:"controlsBottom",children:[Object(A.jsx)(R.a,{size:"tiny",color:"black",children:this.tWarn}),p,m,Object(A.jsx)(W.a.Field,{children:Object(A.jsx)(q.a,(v={compact:!0,className:"inverted tiny v-select",name:"microphone",value:a.microphone,onChange:s,placeholder:"Microphone",selection:!0},Object(P.a)(v,"onChange",this.onChange),Object(P.a)(v,"options",a.microphoneOptions),v),"microphone")}),h,Object(A.jsxs)(W.a.Field,{children:[Object(A.jsx)(U.a,{compact:!0,inverted:!0,name:"broadcast",content:a.buttonContent,onClick:this.onClick.bind(this),disabled:a.buttonDisabled}),Object(A.jsx)(R.a,{pointing:"left",color:"black",children:a.statusInfo})]}),l,Object(A.jsx)(R.a,{color:"black",children:a.connected?a.bitrateInfo:Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:("microphone"==u?"microphone":"eye")+" slash"}),"Not Broadcasting ",this.connectionInfo," ",this.peerInfo," "]})})]})):this.tWarn.length>0&&(g=Object(A.jsx)("div",{className:"controlsBottom",children:Object(A.jsx)(R.a,{size:"tiny",pointing:"left",color:"black",children:this.tWarn})}));var b="";a.packetLoss&&(b=Object(A.jsx)("span",{"data-tooltip":this.txt("Packet Loss: Upload Connection Issue"),"data-position":"left center",children:Object(A.jsx)(w.a,{inverted:!0,name:"exclamation circle",size:"large"})}));var f=Object(A.jsx)(w.a,{inverted:!0,color:"black",name:("microphone"==u?"microphone":"eye")+" slash",size:"large"});a.connecting&&(f=Object(A.jsx)(w.a,{inverted:!0,loading:!0,name:"spinner",size:"large"})),a.connected&&(f=Object(A.jsx)(w.a,{inverted:!0,name:u,size:"large"}));var j=Object(A.jsxs)(U.a,{compact:!0,name:"audioToggle",size:"small",inverted:!0,icon:!0,toggle:!0,active:a.audioOn,onClick:this.onClick.bind(this),"data-tooltip":a.audioOn?this.txt("Mute Microphone"):this.txt("Enable Microphone"),"data-position":"left center",children:[" ",Object(A.jsx)(w.a,{name:"microphone"})]}),S=Object(A.jsx)(U.a,{compact:!0,name:"videoToggle",size:"small",inverted:!0,icon:!0,toggle:!0,active:a.videoOn,onClick:this.onClick.bind(this),"data-tooltip":a.videoOn?this.txt("Hide Camera"):this.txt("Enable Camera"),"data-position":"left center",children:Object(A.jsx)(w.a,{name:"video"})});return"microphone"==u&&(S=""),this.audioInterface?Object(A.jsx)("div",{className:"panel",style:{backgroundColor:o.appState.backgroundColor},ref:function(e){return t.state.container=e},children:Object(A.jsx)(W.a,{children:Object(A.jsxs)(W.a.Group,{inline:!0,children:[Object(A.jsx)(W.a.Field,{inline:!0,children:Object(A.jsx)(w.a,{inverted:o.appState.darkMode,name:"microphone"})}),Object(A.jsx)(W.a.Field,{inline:!0,children:Object(A.jsx)(U.a,{compact:!0,inverted:o.appState.darkMode,size:"small",name:"broadcast",content:a.buttonContent,onClick:this.onClick.bind(this),disabled:a.buttonDisabled})}),Object(A.jsx)(W.a.Field,{inline:!0,children:Object(A.jsx)(q.a,(e={compact:!0,className:"v-select",size:"small"},Object(P.a)(e,"className",o.appState.className),Object(P.a)(e,"name","microphone"),Object(P.a)(e,"value",a.microphone),Object(P.a)(e,"onChange",s),Object(P.a)(e,"placeholder","Microphone"),Object(P.a)(e,"selection",!0),Object(P.a)(e,"onChange",this.onChange),Object(P.a)(e,"options",a.microphoneOptions),e),"microphone")}),Object(A.jsx)(W.a.Field,{inline:!0,children:Object(A.jsx)(R.a,{pointing:"left",color:o.appState.darkMode?"black":"grey",children:a.statusInfo})}),Object(A.jsx)(W.a.Field,{inline:!0,children:b}),Object(A.jsx)(W.a.Field,{inline:!0,children:Object(A.jsx)(R.a,{size:"tiny",children:a.connected?a.bitrateInfo:Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:("microphone"==u?"microphone":"eye")+" slash"}),"Not Broadcasting ",this.connectionInfo," ",this.peerInfo," "]})})})]})})}):Object(A.jsxs)("div",{className:"panel",ref:function(e){return t.state.container=e},children:[Object(A.jsx)("div",{className:"backgroundVideo",children:Object(A.jsx)("video",{poster:o.config.cameraSnapshot?o.config.cameraSnapshot:o.room.snapshot,style:i,id:"localVideo",ref:this.localVideo,className:"localVideo",autoPlay:!0,playsInline:!0,muted:!0,onLoadedMetadata:function(){t.updateVideoSize("loadedmetadata"),t.videoPlay()}})}),Object(A.jsxs)("div",{className:"controlsIcons",children:[b,f,j,S,Object(A.jsx)(U.a,{compact:!0,name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:a.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":"Toggle Controls","data-position":"left center",children:Object(A.jsx)(w.a,{name:"settings"})})]}),g]})}},{key:"onChange",value:function(e,t){var a=t.name,o=t.value;this.setState(Object(P.a)({},a,o)),this.changedBy=a,this.devMode&&console.log("components/Camera onChange",a,o,e),navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this))}},{key:"onClick",value:function(e,t){var o=this,s=t.name,i=t.value,n=this.txt,r=this.props,c=this.state;if(this.devMode&&console.log("components/Camera onClick",s,i,e),"screenShare"===s&&(c.screenShare?this.setState({videoSource:c.camera,screenShare:!1},(function(){return o.buildStream()})):this.setState({videoSource:"_screen",screenShare:!0},(function(){return o.buildStream()}))),"tap"===s&&this.videoPlay(),"audioToggle"===s&&this.setState({audioOn:!c.audioOn},(function(){return o.buildStream()})),"videoToggle"===s&&this.setState({videoOn:!c.videoOn},(function(){return o.buildStream()})),"broadcast"===s)switch(this.state.buttonContent){case n("Broadcast"):this.retriesLeft=5,this.setState({buttonDisabled:!0,buttonContent:n("Starting Broadcast"),statusInfo:n("Starting Broadcast"),connecting:!0,connected:!1}),this.buildStream();break;case n("Stop Broadcast"):this.retriesLeft=0,this.setState({buttonDisabled:!0,buttonContent:n("Ending"),statusInfo:n("Ending")}),this.stopPublisher(),this.setState({buttonDisabled:!1,buttonContent:n("Broadcast"),statusInfo:n("Stopped Broadcast"),connecting:!1,connected:!1}),r.serverUpdate({task:"media",connected:!1}),r.appStateUpdate({cameraStatus:"off"})}Object(V.a)(Object(E.a)(a.prototype),"onClick",this).call(this,e,{name:s,value:i})}},{key:"retryIfTimeout",value:function(){if(this.devMode)return console.log("components/Camera retryIfTimeout skipped on devMode"),void(this.retryIfTimeoutSet=!1);this.state.connected||this.retriesLeft>0&&(this.retriesLeft--,this.stopPublisher(),this.setState({buttonDisabled:!0,buttonContent:this.txt("Auto Retry"),statusInfo:this.txt("Auto Retry"),connecting:!0,connected:!1}),this.buildStream()),this.retryIfTimeoutSet=!1}},{key:"updateBitrates",value:function(){var e=this.props;if(this.bitrate=Number(e.config.bitrate),this.bitrate||(this.bitrate=750),this.resolutionHeight=Number(e.config.resolutionHeight),this.resolutionHeight||(this.resolutionHeight=480),this.videoBitrate=Number(e.config.videoBitrate),this.maxBitrate=Number(e.config.maxBitrate),this.videoBitrate<this.maxBitrate&&(this.maxBitrate=this.videoBitrate),this.maxBitrate||(this.maxBitrate=0),this.maxResolutionHeight=Number(e.config.maxResolutionHeight),this.maxResolutionHeight||(this.maxResolutionHeight=0),this.tWarn="",(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&(this.resolutionHeight>480&&(this.resolutionHeight=480),this.bitrate>750&&(this.bitrate=750),this.maxResolutionHeight>480&&(this.maxResolutionHeight=480),this.maxResolutionHeight||(this.maxResolutionHeight=480),this.maxBitrate>750&&(this.maxBitrate=750),this.maxBitrate||(this.maxBitrate=750),this.bitrate>this.maxBitrate&&(this.bitrate=this.maxBitrate),this.resolutionHeight>this.maxResolutionHeight&&(this.resolutionHeight=this.maxResolutionHeight),this.tWarn="Free Mode: Broadcasting Bitrate & Resolution Limited"),this.state.maxBitrate=this.maxBitrate,this.state.maxResolutionHeight=this.maxResolutionHeight,this.resolutionOptions=[{key:"res-title",text:Object(A.jsxs)("span",{children:[Object(A.jsx)("strong",{children:this.txt("Video Resolution")}),this.state.maxResolutionHeight?" <"+this.state.maxResolutionHeight+"p":""]}),disabled:!0}],this.resolutions)for(var t in this.resolutions)(0===this.maxBitrate||.35*this.resolutions[t].bitrate<=this.maxBitrate)&&(0===this.maxResolutionHeight||this.resolutions[t].height<=this.maxResolutionHeight)&&this.resolutionOptions.push({key:t,value:t,text:this.resolutions[t].label+" "+this.resolutions[t].width+"x"+this.resolutions[t].height+" "+this.resolutions[t].ratio});this.state.resolutionOptions=this.resolutionOptions,this.state.bitrateOptions=this.bitrateOptions(this.bitrate),this.state.resolution=this.resolutionHeight.toString()+"p",this.state.maxBitrate=this.maxBitrate,this.state.bitrate=this.bitrate,e.appState.checked&&(this.tChecked=!0)}},{key:"interfaceReady",value:function(){var e=this;this.state,this.props;setTimeout((function(){return e.props.serverUpdate({task:"media",connected:!1})}),500),this.updateBitrates(),this.setState({resolutionOptions:this.resolutionOptions,resolution:this.resolutionHeight.toString()+"p",bitrateOptions:this.bitrateOptions(this.bitrate),maxBitrate:this.maxBitrate,bitrate:this.bitrate,settingsActive:"1"==this.props.config.cameraControls});var t=this.props.config.cameraAutoBroadcast,a=this.txt;if(!navigator.mediaDevices)return this.devMode&&console.log("components/Camera interfaceReady navigator.mediaDevices",navigator.mediaDevices),void this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:a("Broadcast"),statusInfo:"Navigator media devices not available!",connecting:!1,connected:!1});if("1"!=t||this.props.appState.external){var o=a("Make a selection to start!");this.props.appState.external&&(o=a("External broadcast detected.")),navigator.mediaDevices.enumerateDevices().then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)),this.setState({buttonDisabled:!1,buttonContent:a("Broadcast"),statusInfo:o,connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"off"})}else navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this)),this.setState({statusInfo:"Connecting...",connecting:!0,connected:!1}),this.props.appStateUpdate({cameraStatus:"pending"});this.devMode&&console.log("components/Camera interfaceReady ",t,this.maxBitrate,this.maxResolutionHeight)}},{key:"videoPlay",value:function(){var e=this,t=this.localVideo.current,a=this.state,o=!1,s=t.play();void 0!==s&&s.catch((function(t){o=!0,console.log("components/Camera Auto play error:"+t,t),e.setState({tapRequired:!0,settingsActive:!0})})).then((function(){o||(e.setState({tapRequired:!1}),a.connected&&e.setState({settingsActive:!1}))}))}},{key:"composedStream",value:function(e){var t=Object(L.a)(e,2),a=t[0],o=t[1],s=new MediaStream;if(this.devMode&&console.log("components/Camera/composedStream : ",a,o,s),o.getVideoTracks().forEach((function(e){s.addTrack(e)})),o.getAudioTracks().length>0){var i=new AudioContext,n=i.createMediaStreamDestination(),r=i.createMediaStreamSource(o),c=i.createGain();if(c.gain.value=1,r.connect(c).connect(n),this.devMode&&console.log("composedStream added system audio"),a&&a.getAudioTracks().length>0){var d=i.createMediaStreamSource(a),l=i.createGain();l.gain.value=1,d.connect(l).connect(n),this.devMode&&console.log("composedStream added mic audio")}n.stream.getAudioTracks().forEach((function(e){s.addTrack(e)}))}else a.getAudioTracks().forEach((function(e){s.addTrack(e)}));return this.devMode&&console.log("components/Camera/composedStream : ",a,o,s),s}},{key:"buildStream",value:function(){var e=this;if(this._isMounted){var t=this.state,a=this.props;for(var o in window.stream&&window.stream.getTracks().forEach((function(e){e.stop()})),this.audioInterface||(this.localVideo.current.srcObject=null),this.resolutions)o==t.resolution&&(t.videoWidth=this.resolutions[o].width,t.videoHeight=this.resolutions[o].height,"bitrate"!==this.changedBy&&(0===t.maxBitrate||this.resolutions[o].bitrate<=t.maxBitrate?t.bitrate=this.resolutions[o].bitrate:t.bitrate=t.maxBitrate),t.bitrateOptions=this.bitrateOptions(this.resolutions[o].bitrate));var s={};if(t.audioOn&&"_disabled"!=t.audioSource?s.audio={deviceId:t.audioSource?{ideal:t.audioSource}:void 0}:s.audio=!1,this.audioInterface||a.room.audioOnly||a.appState.audioMode||"Way2Screen"==a.appState.screen&&a.appState.revealMode&&!a.appState.revealed?s.video=!1:t.videoOn&&"_disabled"!=t.videoSource&&!t.screenShare?s.video={deviceId:t.videoSource?{ideal:t.videoSource}:void 0,width:{ideal:t.videoWidth},height:{ideal:t.videoHeight}}:s.video=!1,"_screen"!==t.videoSource)t.audioOn&&"_disabled"!=t.audioSource&&"_screen"!=t.videoSource||t.videoOn&&"_disabled"!=t.videoSource&&!t.screenShare?navigator.mediaDevices.getUserMedia(s).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)):console.log("Camera/buildStream NO SOURCE enabled",t.videoSource,t.audioSource,t.videoOn,t.audioOn),this.devMode&&console.log("components/Camera/buildStream videoSource: ",t.videoSource,"  constraints=",s);else{var i={video:!0,audio:!0};if(navigator.mediaDevices.getDisplayMedia)if(s.audio){var n=navigator.mediaDevices.getDisplayMedia(i).catch(this.handleError.bind(this)),r=navigator.mediaDevices.getUserMedia(s).catch(this.handleError.bind(this));console.log("components/Camera/buildStrea Promise.all fc",n,r),Promise.all([r,n]).then((function(t){return e.composedStream(t)})).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this))}else navigator.mediaDevices.getDisplayMedia(i).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this));this.devMode&&console.log("components/Camera/buildStream screen videoSource: ",t.videoSource,"  constraintsScreen=",i,"  constraints=",s)}}else console.log("components/Camera buildStream not mounted")}},{key:"handleError",value:function(e){if(console.log("components/Camera navigator.mediaDevices handleError: ",e," this._isMounted="+this._isMounted),this._isMounted){var t="";if("OverconstrainedError"===e.name)t=" ("+e.constraint+")";this.setState({settingsActive:!0,statusInfo:"Media Error: "+e.name+t,buttonDisabled:!1,buttonContent:this.txt("Broadcast"),connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"}),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||console.log("components/Camera navigator.mediaDevices handleError - enumerateDevices() - not supported"),navigator.mediaDevices.enumerateDevices().then((function(e){e.forEach((function(e){console.log("components/Camera navigator.mediaDevices handleError enumerateDevices "+e.kind+": "+e.label+" id = "+e.deviceId)}))})).catch((function(e){console.log("components/Camera navigator.mediaDevices handleError enumerateDevices error: "+e.name+": "+e.message)}))}}},{key:"gotStream",value:function(e){return this.audioInterface||(this.localVideo.current.srcObject=e),this.devMode&&console.log("components/Camera/gotStream after getUserMedia",e),this.localStream=e,null!=this.localStream&&this.stopPublisher(),this.startPublisher(),navigator.mediaDevices.enumerateDevices()}},{key:"startPublisher",value:function(){this.devMode&&console.log("components/Camera startPublisher",this.props),this.wsConnect(),this.timerStart()}},{key:"stopPublisher",value:function(){this.timerStop(),null!=this.peerConnection&&this.peerConnection.close(),null!=this.wsConnection&&this.wsConnection.close(),this.devMode&&console.log("components/Camera stopPublisher",this.wsConnection,this.peerConnection)}},{key:"gotDevices",value:function(e){var t=this.state,a=[{key:"cam-title",text:Object(A.jsxs)("span",{children:["Select ",Object(A.jsx)("strong",{children:"Camera"}),":"]}),disabled:!0},{text:"No Camera",value:"_disabled"}],o=[{key:"mic-title",text:Object(A.jsxs)("span",{children:["Select ",Object(A.jsx)("strong",{children:"Microphone"}),":"]}),disabled:!0}];"function"===typeof navigator.mediaDevices.getDisplayMedia&&t.screenShare&&a.push({key:"screen",text:this.txt("Screen Share"),value:"_screen"});for(var s=!1,i=!1,n=0;n!==e.length;++n){var r=e[n],c={value:r.deviceId};"audioinput"===r.kind?(c.text=r.label||"Microphone ".concat(o.length+1),o.push(c),t.microphone||(t.microphone=r.deviceId),r.deviceId===t.microphone&&(i=!0)):"videoinput"===r.kind&&(c.text=r.label||"Camera ".concat(a.length+1),a.push(c),t.camera||(t.camera=r.deviceId),r.deviceId===t.camera&&(s=!0))}t.screenShare||(s||"_disabled"===t.camera)&&(t.videoSource=t.camera),(i||"_disabled"===t.microphone)&&(t.audioSource=t.microphone),t.camera===t.videoSource&&t.microphone===t.audioSource||s&&i||(this.devMode&&console.log("components/Camera gotDevices: deviceID changed videoValid:"+t.camera+" videoSelected: "+t.microphone+" audioValid:"+i),this.setState({settingsActive:!0,statusInfo:"Media DeviceID changed: Please select again!",buttonDisabled:!1,buttonContent:this.txt("Broadcast")})),this.devMode&&console.log("gotDevices: verified videoSource: "+t.videoSource+" changed videoValid: "+s),this._isMounted&&this.setState({cameraOptions:a,microphoneOptions:o})}},{key:"gotDevicesPublish",value:function(e){this.gotDevices(e),this.buildStream()}},{key:"updateVideoSize",value:function(e){var t,a=this.localVideo.current,o=this.state;a.videoHeight&&(o.videoWidth===a.videoWidth&&o.videoHeight===a.videoHeight||(o.videoWidth=a.videoWidth,o.videoHeight=a.videoHeight,o.videoHeight||(o.videoHeight=1)),t=a.videoWidth/a.videoHeight,o.videoAspectRatio!==t&&this.setState({videoAspectRatio:t}))}},{key:"wsConnect",value:function(){var e=this,t=this.props;this.state;if(this.props.appState.wsOpen)return this.devMode&&console.log("components/Camera wsConnection websocket busy, retrying later",this.props.appState.wsComponent),this.wsConnection&&this.wsConnection.close(),void setTimeout((function(){return e.wsConnect()}),1e3);this.props.appStateUpdate({wsOpen:!0,wsComponent:"Camera"}),this.SDPOutput={};var a=null;this.audioInterface||(a=this.localStream.getVideoTracks());var o=this.localStream.getAudioTracks();this.audioInterface||a.length>0&&this.devMode&&console.log("components/Camera wsConnect Using Video device: ".concat(a[0].label)),o.length>0&&this.devMode&&console.log("components/Camera wsConnect Using Audio device: ".concat(o[0].label)),this.streamInfo={applicationName:t.config.application,streamName:t.room.streamBroadcast,sessionId:"[empty]"},this.userData={param1:"value1",videowhisper:"webrtc-broadcast"},this.devMode&&console.log("components/Camera wsConnect","_isMounted="+this._isMounted,this.streamInfo,this.userData,this.props,this.state),this.wsConnection&&(console.log("components/Camera wsConnect previous websocket (close)",this.wsConnection),this.wsConnection.close()),this.wsConnection=new WebSocket(t.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsMessaged=!1,this.wsConnection.onmessage=function(t){return e.onWsMessage(t)},this.wsConnection.onclose=function(){e.devMode&&console.log("components/Camera wsConnection.onclose"),e.props.appStateUpdate({wsOpen:!1})},this.wsConnection.onerror=function(e){console.log("components/Camera wsConnection.onerror: ",e)}}},{key:"onnegotiationneeded",value:function(){this.devMode&&console.log("components/Camera peerConnection onnegotiationneeded"),this.peerConnection.createOffer(this.offerOptions).then(this.gotDescription.bind(this),this.errorHandler)}},{key:"onicecandidate",value:function(e){null!=e.candidate&&this.devMode&&console.log("components/Camera gotIceCandidate: "+JSON.stringify({ice:e.candidate}))}},{key:"onsignalingstatechange",value:function(){var e,t=this,a=this.txt;this.peerConnection&&(e=this.peerConnection.signalingState,this.devMode&&console.log("components/Camera onsignalingstatechange state, peerConnection, wsConnection  ".concat(e),this.peerConnection.signalingState,this.peerConnection.readyState,this.peerConnection,this.wsConnection),"have-local-offer"==e&&"new"==this.peerConnection.iceConnectionState&&(this.setState({buttonDisabled:!1,buttonContent:a("Stop Broadcast"),statusInfo:a("Broadcasting")}),this.props.appStateUpdate({cameraStatus:"pending"}),this.retryIfTimeoutSet||(setTimeout((function(){return t.retryIfTimeout()}),this.retryTimeout),this.retryIfTimeoutSet=!0)))}},{key:"connectionUpdated",value:function(e){var t=this,a=this.props,o=this.txt,s=this.state;this.devMode&&console.log("components/Camera connectionUpdated ",e,s.connected),s.connected||"connected"===e&&(this.setState({settingsActive:!1,buttonDisabled:!1,buttonContent:o("Stop Broadcast"),statusInfo:o("Broadcasting"),connecting:!1,connected:!0,bitrateInfo:Object(A.jsx)(w.a,{name:"clock"})}),a.serverUpdate({task:"media",connected:!0}),a.appStateUpdate({publishRequired:!1,cameraStatus:"live"}),this.peerConnection&&this.peerConnection.getSenders().forEach((function(e){if(e.track){var a=e.getParameters();a.encodings||(a.encodings=[{}]),"audio"==e.track.kind&&t.enhanceData.audioBitrate&&(a.encodings[0].maxBitrate=1e3*t.enhanceData.audioBitrate),"video"==e.track.kind&&t.enhanceData.videoBitrate&&(a.encodings[0].maxBitrate=1e3*t.enhanceData.videoBitrate),e.setParameters(a),t.devMode&&console.log("components/Camera connectionUpdated ",e.track.kind,a)}}))),s.connected&&("failed"!==e&&"disconnected"!==e&&"closed"!==e||(this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:o("Broadcast"),statusInfo:e,connecting:!1,connected:!1,bitrateInfo:Object(A.jsx)(w.a,{name:"eye slash"})}),a.serverUpdate({task:"media",connected:!1}),a.appStateUpdate({cameraStatus:"off"})))}},{key:"onconnectionstatechange",value:function(){var e;this.props,this.txt,this.state;this.peerConnection&&(e=this.peerConnection.connectionState,this.devMode&&console.log("components/Camera onconnectionstatechange peerConnection.onconnectionstatechange ".concat(e),this.peerConnection.iceConnectionState,this.peerConnection.iceGatheringState,this.peerConnection.readyState),this.connectionUpdated(e))}},{key:"oniceconnectionstatechange",value:function(){var e;this.props,this.txt;this.peerConnection&&(e=this.peerConnection.iceConnectionState,this.devMode&&console.log("components/Camera oniceconnectionstatechange peerConnection.iceConnectionState ".concat(e),this.peerConnection.iceConnectionState,this.peerConnection.iceGatheringState,this.peerConnection.readyState),this.connectionUpdated(e))}},{key:"onAddIceCandidateSuccess",value:function(e){this.devMode&&console.log("components/Camera onAddIceCandidateSuccess success.",e)}},{key:"onAddIceCandidateError",value:function(e,t){console.log("components/Camera onAddIceCandidateError",t,e)}},{key:"gotDescription",value:function(e){var t=this,a=this.props,o=this.state,s=this.txt;this.devMode&&console.log("components/Camera gotDescription: original",e,this.wsConnection),this.enhanceData={},void 0!==a.config.audioBitrate&&(this.enhanceData.audioBitrate=Number(a.config.audioBitrate)),void 0!==o.bitrate&&(this.enhanceData.videoBitrate=Number(o.bitrate)),void 0!==a.videoFrameRate&&(this.enhanceData.videoFrameRate=Number(a.videoFrameRate)),"_screen"!=o.videoSource&&(e.sdp=this.mungeSDPPublish(e.sdp,this.enhanceData)),this.peerConnection||console.log("components/Camera gotDescription: Error no this.peerConnection",o),this.peerConnection.setLocalDescription(e).then((function(){var a='{"direction":"publish", "command":"sendOffer", "streamInfo":'+JSON.stringify(t.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(t.userData)+"}";t.devMode&&console.log("components/Camera gotDescription > wsConnection.send after setLocalDescription ",t.wsConnection,a),t.wsConnection&&(1==t.wsConnection.readyState?t.wsConnection.send(a):console.log("components/Camera gotDescription > wsConnection.send : wsConnection not ready"))})).catch((function(a){console.log("components/Camera gotDescription, setLocalDescription error, description.sdp",a,e.sdp),t.setState({statusInfo:"Stream setup error: Retry!",settingsActive:!0,buttonDisabled:!1,buttonContent:s("Broadcast"),connecting:!1,connected:!1}),t.props.appStateUpdate({cameraStatus:"error"})}))}},{key:"addAudio",value:function(e,t){var a=e.split(/\r\n/),o="",s="",i=!1;for(var n in a){var r=a[n];r.length<=0||(0===r.indexOf("m=audio")?o="audio":0===r.indexOf("m=video")&&(o="video"),s+=r,s+="\r\n","audio"===o&&0==="a=rtcp-mux".localeCompare(r)&&!1===i&&(s+=t,i=!0))}return s}},{key:"addVideo",value:function(e,t){var a=e.split(/\r\n/),o="",s=!1,i=!1;for(var n in a){var r=a[n];r.length<=0||r.includes("a=rtcp-rsize")&&(i=!0)}for(var c in a){var d=a[c];o+=d,o+="\r\n",0==="a=rtcp-rsize".localeCompare(d)&&!1===s&&!0===i&&(o+=t,s=!0),0==="a=rtcp-mux".localeCompare(d)&&!0===s&&!1===i&&(o+=t,s=!0),0==="a=rtcp-mux".localeCompare(d)&&!1===s&&!1===i&&(s=!0)}return o}},{key:"mungeSDPPublish",value:function(e,t){this.props.config;var a=_.a.browserDetails;this.SDPOutput={};var o="42e01f",s="opus";this.videoIndex=-1,this.audioIndex=-1;var i=e.split(/\r\n/),n="header",r=!1,c="";for(var d in null!=t.videoCodec&&""!==t.videoCodec&&(o=t.videoCodec),null!=t.audioCodec&&""!==t.audioCodec&&(s=t.audioCodec),i){var l=i[d];if(!(l.length<=0))if(!l.includes("urn:3gpp:video-orientation"))this.checkLine(l)&&(c+=l,c+="\r\n")}for(var p in c=this.addAudio(c,this.deliverCheckLine(s,"audio")),e=c=this.addVideo(c,this.deliverCheckLine(o,"video")),c="",i=e.split(/\r\n/)){var m=i[p];if(!(m.length<=0)){if("chrome"===a.browser){var h=void 0;if(0===m.indexOf("m=audio")&&-1!==this.audioIndex){c+=(h=m.split(" "))[0]+" "+h[1]+" "+h[2]+" "+this.audioIndex+"\r\n";continue}if(0===m.indexOf("m=video")&&-1!==this.videoIndex){c+=(h=m.split(" "))[0]+" "+h[1]+" "+h[2]+" "+this.videoIndex+"\r\n";continue}}if(c+=m,0===m.indexOf("m=audio")?(n="audio",r=!1):0===m.indexOf("m=video")?(n="video",r=!1):0===m.indexOf("a=rtpmap")&&(n="bandwidth",r=!1),"chrome"===a.browser&&(0===m.indexOf("a=mid:")||0===m.indexOf("a=rtpmap"))&&!r)if(0==="audio".localeCompare(n))void 0!==t.audioBitrate&&(c+="\r\nb=CT:"+t.audioBitrate,c+="\r\nb=AS:"+t.audioBitrate),r=!0;else if(0==="video".localeCompare(n))void 0!==t.videoBitrate&&(c+="\r\nb=CT:"+t.videoBitrate,c+="\r\nb=AS:"+t.videoBitrate,void 0!==t.videoFrameRate&&(c+="\r\na=framerate:"+t.videoFrameRate)),r=!0;else if(0==="bandwidth".localeCompare(n)){var u=void 0;if(null!==(u=this.getrtpMapID(m))){var v=u[2].toLowerCase();0!=="vp9".localeCompare(v)&&0!=="vp8".localeCompare(v)&&0!=="h264".localeCompare(v)&&0!=="red".localeCompare(v)&&0!=="ulpfec".localeCompare(v)&&0!=="rtx".localeCompare(v)||void 0!==t.videoBitrate&&(c+="\r\na=fmtp:"+u[1]+" x-google-min-bitrate="+t.videoBitrate+";x-google-max-bitrate="+t.videoBitrate),0!=="opus".localeCompare(v)&&0!=="isac".localeCompare(v)&&0!=="g722".localeCompare(v)&&0!=="pcmu".localeCompare(v)&&0!=="pcma".localeCompare(v)&&0!=="cn".localeCompare(v)||void 0!==t.audioBitrate&&(c+="\r\na=fmtp:"+u[1]+" x-google-min-bitrate="+t.audioBitrate+";x-google-max-bitrate="+t.audioBitrate)}}if(("firefox"===a.browser||"safari"===a.browser)&&0===m.indexOf("c=IN")){if(0==="audio".localeCompare(n)){if(""!==t.audioBitrate){var g=1e3*parseInt(t.audioBitrate);c+="\r\nb=TIAS:"+(1e3*parseInt(t.audioBitrate)*.95-16e3)+"\r\n",c+="b=AS:"+g+"\r\n",c+="b=CT:"+g+"\r\n"}continue}if(0==="video".localeCompare(n)){if(""!==t.videoBitrate){var b=1e3*parseInt(t.videoBitrate);c+="\r\nb=TIAS:"+(1e3*parseInt(t.videoBitrate)*.95-16e3)+"\r\n",c+="b=AS:"+b+"\r\n",c+="b=CT:"+b+"\r\n"}continue}}c+="\r\n"}}return navigator.userAgent.toLowerCase().indexOf("safari/")>-1&&(c=c.replace(/UDP\/TLS\/RTP\/SAVPF/gi,"RTP/SAVPF")),c}},{key:"deliverCheckLine",value:function(e,t){for(var a in this.SDPOutput){var o=this.SDPOutput[a];if(o.includes(e)){if(e.includes("VP9")||e.includes("VP8")){var s="",i=o.split(/\r\n/);for(var n in i){s+=i[n],s+="\r\n"}return t.includes("audio")&&(this.audioIndex=a),t.includes("video")&&(this.videoIndex=a),s}return t.includes("audio")&&(this.audioIndex=a),t.includes("video")&&(this.videoIndex=a),o}}return""}},{key:"checkLine",value:function(e){if(e.startsWith("a=rtpmap")||e.startsWith("a=rtcp-fb")||e.startsWith("a=fmtp")){var t=e.split(":");if(t.length>1){var a=t[1].split(" ");if(!isNaN(a[0])&&!a[1].startsWith("http")&&!a[1].startsWith("ur")){var o=this.SDPOutput[a[0]];return o||(o=""),o+=e+"\r\n",this.SDPOutput[a[0]]=o,!1}}}return!0}},{key:"getrtpMapID",value:function(e){var t=new RegExp("a=rtpmap:(\\d+) (\\w+)/(\\d+)"),a=e.match(t);return a&&a.length>=3?a:null}}],[{key:"getDerivedStateFromError",value:function(e){return console.log("components/Camera getDerivedStateFromError",e),{hasError:!0,errorMessage:e.toString()}}}]),a}(H);z.propTypes={appState:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,user:B.a.object.isRequired,serverUpdate:B.a.func.isRequired,appStateUpdate:B.a.func.isRequired,cameraConfig:B.a.object};a(251);var G=a(225),J=a(221),K=a(346),Q=a(344),Y=a(227),X=a(345),Z=a(116),$=a.n(Z),ee=a(347),te=a(88),ae=a.n(te),oe=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return t.config&&e in t.config.text?t.config.text[e]:e},o.toMMSS=function(e){var t=Math.floor(e/60),a=e-60*t;return a<10&&(a="0"+a),t+":"+a},o.onChange=function(e,t){var a=t.name,s=t.value;o.state[a]!=s&&(o.setState(Object(P.a)({},a,s),(function(){o.changedBy=a,o.recordingDiscard(),navigator.mediaDevices.enumerateDevices().then(o.gotDevices.bind(Object(k.a)(o))).catch(o.handleError.bind(Object(k.a)(o)))})),o.devMode&&console.log("components/Recorder onChange",a,s,e))},o.devMode=e.appState.devMode,o._isMounted=!1,o.videoWidth=480,o.videoHeight=320,o.state={camera:null,cameraOptions:[],videoSource:null,microphone:null,microphoneOptions:[],audioSource:null,mode:"video",mediaRecorder:!1,buttonStart:!1,buttonStop:!1,buttonDiscard:!1,buttonSend:!1,statusInfo:"",uploading:!1,displayTime:"0:00"},o.info="",o.maxTime=0,o.audioPlayback=s.a.createRef(),o.videoPlayback=s.a.createRef(),o.videoPreview=s.a.createRef(),o.recorderData=null,o.mimeType="video/mp4",o.fileExtension="mp4",o.resolutions={"4K":{label:"4K",width:3840,height:2160,ratio:"16:9",bitrate:12e3},"1440p":{label:"1440p",width:2560,height:1440,ratio:"16:9",bitrate:6e3},"1080p":{label:"1080p",width:1920,height:1080,ratio:"16:9",bitrate:3e3},"720p":{label:"720p",width:1280,height:720,ratio:"16:9",bitrate:1800},SVGA:{label:"SVGA",width:800,height:600,ratio:"4:3",bitrate:800},"480p":{label:"480p",width:858,height:480,ratio:"16:9",bitrate:750},VGA:{label:"VGA",width:640,height:480,ratio:"4:3",bitrate:600},"360p":{label:"360p",width:640,height:360,ratio:"16:9",bitrate:400},"240p":{label:"240p",width:426,height:240,ratio:"16:9",bitrate:220},CIF:{label:"CIF",width:352,height:288,ratio:"4:3",bitrate:200},QVGA:{label:"QVGA",width:320,height:240,ratio:"4:3",bitrate:180},"180p":{label:"180p",width:320,height:180,ratio:"16:9",bitrate:160},"90p":{label:"90p",width:160,height:90,ratio:"16:9",bitrate:100}},o}return Object(y.a)(a,[{key:"timerStart",value:function(){this.props;this.timerTimeStart=Date.now(),this.timerLocal=setInterval(this.timerTick.bind(this),1e3)}},{key:"timerStop",value:function(){clearInterval(this.timerLocal),this.timeLocal=Date.now()-this.timerTimeStart,this.setState({displayTime:this.toMMSS(Math.floor(this.timeLocal/1e3))})}},{key:"timerTick",value:function(){this.timeLocal=Date.now()-this.timerTimeStart,this.props.appState.checked&&this.props.appState.mode.time&&(0==this.maxTime||this.maxTime>this.props.appState.mode.time)&&(this.maxTime=this.props.appState.mode.time),this.setState({displayTime:this.toMMSS(Math.floor(this.timeLocal/1e3))}),this.maxTime>0&&this.timeLocal>=1e3*this.maxTime&&this.recordingStop()}},{key:"componentDidMount",value:function(){this._isMounted=!0,this.devMode&&console.log("components/Recorder componentDidMount",this.props),this.setupInterface()}},{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Recorder componentWillUnmount"),this._isMounted=!1,this.recordingDiscard(),this.timerStop()}},{key:"setupInterface",value:function(){this.isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveOrOpenBlob||!!navigator.msSaveBlob),this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.recorderRTC=null,this.stream=null,this.setState({statusInfo:this.txt("Ready to Start")}),this.props.config.recorderMaxTime&&(this.maxTime=this.props.config.recorderMaxTime),this.props.config.recorderMode&&this.setState({mode:this.props.config.recorderMode}),this.getMedia(),this.devMode&&console.log("components/Recorder/setupInterface")}},{key:"componentDidUpdate",value:function(){}},{key:"composedStream",value:function(e){var t=Object(L.a)(e,2),a=t[0],o=t[1],s=new MediaStream;if(this.devMode&&console.log("components/Recorder/composedStream : ",a,o,s),o.getVideoTracks().forEach((function(e){s.addTrack(e)})),o.getAudioTracks().length>0){var i=new AudioContext,n=i.createMediaStreamDestination(),r=i.createMediaStreamSource(o),c=i.createGain();if(c.gain.value=1,r.connect(c).connect(n),this.devMode&&console.log("composedStream added system audio"),a&&a.getAudioTracks().length>0){var d=i.createMediaStreamSource(a),l=i.createGain();l.gain.value=1,d.connect(l).connect(n),this.devMode&&console.log("composedStream added mic audio")}n.stream.getAudioTracks().forEach((function(e){s.addTrack(e)}))}else a.getAudioTracks().forEach((function(e){s.addTrack(e)}));return this.devMode&&console.log("components/Recorder/composedStream : ",a,o,s),s}},{key:"getMedia",value:function(){var e=this,t=this.state;this.props;if(this._isMounted){var a,o;if(this.state.mediaRecorder&&"undefined"==typeof MediaRecorder&&this.setState({mediaRecorder:!1,mode:"audio"}),this.state.mediaRecorder||"undefined"==typeof MediaRecorder||this.setState({mediaRecorder:!0}),"undefined"!==typeof MediaRecorder&&"function"===typeof MediaRecorder.isTypeSupported)"audio"===this.state.mode?(a={mp3:"audio/mp4"},Object(P.a)(a,"mp3","audio/mpeg"),Object(P.a)(a,"wav","audio/wav"),Object(P.a)(a,"webm","audio/webm"),Object(P.a)(a,"ogg","audio/ogg"),o=a):o={mp4:"video/mp4",webm:"video/webm",mkv:"video/x-matroska"},this.mimeType=Object.values(o).filter(MediaRecorder.isTypeSupported)[0],this.fileExtension=Object.keys(o).find((function(t){return o[t]===e.mimeType})),this.devMode&&console.log("components/Recorder/getMedia MediaRecorder",this.mimeType,this.fileExtension,this.state.mode);for(var s in"audio"===this.state.mode?(this.mimeType||(this.mimeType="audio/mp4"),this.fileExtension||(this.fileExtension="mp3")):(this.mimeType||(this.mimeType="video/mp4"),this.fileExtension||(this.fileExtension="mp4")),this.resolutions)s==t.resolution&&(this.videoWidth=this.resolutions[s].width,this.videoHeight=this.resolutions[s].height);var i={};if("_disabled"!=t.audioSource?i.audio={deviceId:t.microphone?{ideal:t.microphone}:void 0}:i.audio=!1,!this.isEdge&&i.audio&&(i.audio.echoCancellation=!1),"_disabled"!=t.videoSource&&"audio"!=t.mode?i.video={deviceId:t.camera?{ideal:t.camera}:void 0,width:{ideal:this.videoWidth},height:{ideal:this.videoHeight}}:i.video=!1,"screen"!==t.mode)this.devMode&&console.log("components/Recorder getUserMedia:",i,this.state),navigator.mediaDevices.getUserMedia(i).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this));else{var n={video:!0,audio:!0};if(navigator.mediaDevices.getDisplayMedia)if(i.audio){var r=navigator.mediaDevices.getDisplayMedia(n).catch(this.handleError.bind(this)),c=navigator.mediaDevices.getUserMedia(i).catch(this.handleError.bind(this));console.log("components/Recorder/getMedia screen Promise.all fc",r,c),Promise.all([c,r]).then((function(t){return e.composedStream(t)})).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this))}else navigator.mediaDevices.getDisplayMedia(n).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this));else console.log("No navigator.mediaDevices.getDisplayMedia!");this.devMode&&console.log("components/Recorder/getMedia screen videoSource: ",t.videoSource,"  constraintsScreen=",n,"  constraints=",i)}}else this.devMode&&console.log("components/Recorder/getMedia not _isMounted",this._isMounted)}},{key:"gotStream",value:function(e){if(this._isMounted)return this.stream=e,"audio"!=this.state.mode&&(this.videoPreview.current.srcObject=e),this.devMode&&console.log("components/Recorder gotStream",e,this.videoPreview.current),this.setState({buttonStart:!0}),navigator.mediaDevices.enumerateDevices()}},{key:"gotDevices",value:function(e){if(this._isMounted){this.devMode&&console.log("components/Recorder gotDevices after getUserMedia",e);for(var t=this.state,a=this.props,o=[{key:"cam-title",text:Object(A.jsxs)("span",{children:["Select ",Object(A.jsx)("strong",{children:"Camera"}),":"]}),disabled:!0}],s=[{key:"mic-title",text:Object(A.jsxs)("span",{children:["Select ",Object(A.jsx)("strong",{children:"Microphone"}),":"]}),disabled:!0}],i=!1,n=!1,r=0;r!==e.length;++r){var c=e[r],d={value:c.deviceId};"audioinput"===c.kind?(d.text=c.label||"microphone ".concat(s.length+1),s.push(d),t.microphone||(t.microphone=c.deviceId),c.deviceId===t.microphone&&(n=!0)):"videoinput"===c.kind&&(d.text=c.label||"camera ".concat(o.length+1),o.push(d),t.camera||(t.camera=c.deviceId),c.deviceId===t.camera&&(i=!0))}(i||"_disabled"===t.camera)&&(t.videoSource=t.camera),(n||"_disabled"===t.microphone)&&(t.audioSource=t.microphone),t.camera===t.videoSource&&t.microphone===t.audioSource||i&&n||(console.log("components/Camera gotDevices: deviceID changed videoValid:"+t.camera+" videoSelected: "+t.microphone+" audioValid:"+n),this.setState({statusInfo:"Media DeviceID changed: Please select again!"})),this.devMode&&console.log("gotDevices: verified videoSource: "+t.videoSource+" changed videoValid: "+i);var l=!1;if((!a.appState.checked||a.appState.checked&&a.appState.mode.text)&&(l=!0,a.appState.checked&&a.appState.mode.time&&(0==this.maxTime||this.maxTime>a.appState.mode.time)&&(this.maxTime=a.appState.mode.time)),this.modeText=l,this.resolutionHeight=Number(a.config.resolutionHeight),this.resolutionHeight||(this.resolutionHeight=480),this.maxResolutionHeight=Number(a.config.maxResolutionHeight),this.maxResolutionHeight||(this.maxResolutionHeight=0),this.tWarn="",(!a.appState.checked||a.appState.checked&&a.appState.mode.text)&&(this.resolutionHeight>480&&(this.resolutionHeight=480),this.maxResolutionHeight>480&&(this.maxResolutionHeight=480),this.maxResolutionHeight||(this.maxResolutionHeight=480),this.resolutionHeight>this.maxResolutionHeight&&(this.resolutionHeight=this.maxResolutionHeight),this.tWarn="Free Mode: Limited resolution and recording time."),this.state.maxResolutionHeight=this.maxResolutionHeight,this.resolutionOptions=[{key:"res-title",text:Object(A.jsxs)("span",{children:[Object(A.jsx)("strong",{children:this.txt("Video Resolution")}),this.state.maxResolutionHeight?" <"+this.state.maxResolutionHeight+"p":""]}),disabled:!0}],this.resolutions)for(var p in this.resolutions)(0===this.maxResolutionHeight||this.resolutions[p].height<=this.maxResolutionHeight)&&this.resolutionOptions.push({key:p,value:p,text:this.resolutions[p].label+" "+this.resolutions[p].width+"x"+this.resolutions[p].height+" "+this.resolutions[p].ratio});this.state.resolutionOptions=this.resolutionOptions,t.resolution||(this.state.resolution=this.resolutionHeight.toString()+"p"),a.appState.checked&&(this.tChecked=!0),this._isMounted&&this.setState({cameraOptions:o,microphoneOptions:s})}}},{key:"handleError",value:function(e){console.log("components/Recorer getMedia handleError: ",e)}},{key:"SaveToDisk",value:function(e,t){if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var a=window.open(e,"_blank");a.document.close(),a.document.execCommand("SaveAs",!0,t||e),a.close()}}else{var o=document.createElement("a");if(o.href=e,o.download=t||"unknown",o.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(o),"function"===typeof o.click)o.click();else{o.target="_blank";var s=document.createEvent("Event");s.initEvent("click",!0,!0),o.dispatchEvent(s)}(window.URL||window.webkitURL).revokeObjectURL(o.href)}this.props.recorderStatus("fileSaved")}},{key:"getRandomString",value:function(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",a=0,o=e.length;a<o;a++)t+=e[a].toString(36);return t}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}},{key:"getFileName",value:function(e){var t=new Date;return"VideoWhisper-"+t.getFullYear()+t.getMonth()+t.getDate()+"-"+this.getRandomString()+"."+e}},{key:"uploadCompleted",value:function(e){this.devMode&&console.log("components/Recorder uploadCompleted",e),this.setState({uploading:!1,statusInfo:this.txt("Upload completed.")}),this.props.options&&"chat"==this.props.options.scenario&&this.props.serverUpdate({task:"update",update:"chat"}),this.props.recorderStatus("uploadCompleted"),"undefined"!=typeof window.VideoWhisper.recoderUploadCompleted?window.VideoWhisper.recoderUploadCompleted(this.filename):this.devMode&&console.log("components/Recorder uploadCompleted window.VideoWhisper.recoderUploadCompleted missing",typeof window.VideoWhisper.recoderUploadCompleted,window.recorderUploadCompleted,window.VideoWhisper)}},{key:"recordingStop",value:function(){var e=this;this.devMode&&console.log("components/Recorder recordingStop",this.recorderRTC),this.mediaRecorder&&this.mediaRecorder.stop(),this.recorderRTC&&this.recorderRTC.stopRecording((function(){e.recorderData=URL.createObjectURL(e.recorderRTC.getBlob()),e.devMode&&console.log("components/Recorder this.recorderData",e.recorderData),"audio"===e.state.mode?(e.audioPlayback.current.src=e.recorderData,e.audioPlayback.current.play().then((function(t){e.devMode&&console.log("components/Recorder Audio Autoplay started",t)}),(function(e){console.log("components/Recorder Audio Autoplay reject:",e)})).catch((function(e){console.log("components/Recorder Audio Autoplay error:",e)}))):(e.videoPlayback.current.src=e.recorderData,e.videoPlayback.current.play().then((function(t){e.devMode&&console.log("components/Recorder Video Autoplay started",t)}),(function(e){console.log("components/Recorder Video Autoplay reject:",e)})).catch((function(e){console.log("components/Recorder Video Autoplay error:",e)})))})),this.videoPreview.current.srcObject=null,this.stream.stop(),this.timerStop(),this.setState({buttonStart:!1,buttonStop:!1,buttonDiscard:!0,buttonSend:!0,statusInfo:this.txt("Recorded: Send, Download or Discard")})}},{key:"recordingDiscard",value:function(){var e=this;this.recorderData=null,this.stream&&this.stream.getTracks().forEach((function(t){t.stop(),e.devMode&&console.log("components/Recorder buttonDiscard closed track",t)})),this.setState({buttonStart:!0,buttonStop:!1,buttonDiscard:!1,buttonSend:!1,statusInfo:this.txt("Ready to Start"),displayTime:"0:00"}),this.getMedia()}},{key:"onClick",value:function(e,t){var a=this,o=t.name,s=t.value,i=this.state,n=this.props;switch(this.devMode&&console.log("components/Recorder onClick",o,s,e,i),o){case"buttonDetect":this.getMedia();break;case"buttonAudio":if("audio"==i.mode)break;this.setState({mode:"audio"},(function(){return a.recordingDiscard()}));break;case"buttonVideo":if(!i.mediaRecorder)break;if("video"===i.mode)break;this.setState({mode:"video"},(function(){return a.recordingDiscard()}));break;case"buttonScreen":if(!i.mediaRecorder)break;if("screen"===i.mode)break;this.setState({mode:"screen"},(function(){return a.recordingDiscard()}));break;case"buttonStart":if(this.mediaRecorder&&(this.mediaRecorder.stop(),this.mediaRecorder=null),this.recorderRTC&&(this.recorderRTC.destroy(),this.recorderRTC=null),this.filename="",this.directMediaRecorder=!1,this.directMediaRecorder)this.fileExtension="mp4",this.mimeType="video/mp4",this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:this.mimeType}),this.chunks=[],this.mediaRecorder.ondataavailable=function(e){a.chunks.push(e.data)},this.mediaRecorder.onerror=function(e){console.log("components/Recorder MediaRecorder.onerror: "+e)},this.mediaRecorder.onwarning=function(e){console.log("components/Recorder mediaRecorder.onwarning: "+e)},this.mediaRecorder.onstop=function(){a.devMode&&console.log("components/Recorder mediaRecorder.onstop");var e=new Blob(a.chunks,{type:"video/mp4"});a.chunks=[],a.recorderData=URL.createObjectURL(e),a.videoPlayback.current.src=a.recorderData,a.videoPlayback.current.play().then((function(e){a.devMode&&console.log("components/Recorder mediaRecorder Video Autoplay started",e)}),(function(e){console.log("components/Recorder mediaRecorder Video Autoplay reject:",e)})).catch((function(e){console.log("components/Recorder mediaRecorder Video Autoplay error:",e)}))},this.mediaRecorder.onstart=function(){a.devMode&&console.log("components/Recorder mediaRecorder.onstart",a.mimeType)},this.mediaRecorder.start();else{var r={type:"audio"==this.state.mode?"audio":"video",mimeType:this.mimeType,numberOfAudioChannels:this.isEdge?1:2,checkForInactiveTracks:!0,bufferSize:16384,disableLogs:!this.devMode,recorderType:$.a.MediaStreamRecorder};(this.isSafari||this.isEdge)&&"audio"===i.mode&&(r.recorderType=$.a.StereoAudioRecorder),navigator.platform&&-1===navigator.platform.toString().toLowerCase().indexOf("win")&&(r.sampleRate=48e3),this.isSafari&&(r.sampleRate=44100,r.bufferSize=4096,r.numberOfAudioChannels=2),this.recorderRTC=$()(this.stream,r),this.devMode&&console.log("components/Recorder buttonStart",r,this.recorderRTC),this.recorderRTC.startRecording()}this.timerStart(),this.setState({buttonStart:!1,buttonStop:!0,buttonDiscard:!1,buttonSend:!1,statusInfo:this.txt("Recording")+" "+this.mimeType+" ."+this.fileExtension});break;case"buttonStop":this.recordingStop();break;case"buttonDiscard":this.recordingDiscard();break;case"buttonDownload":if(this.devMode&&console.log("components/Recorder buttonDownload",this.recorderRTC),this.mediaRecorder){this.SaveToDisk(this.recorderData,this.getFileName(this.fileExtension));break}if(!this.recorderRTC||!this.recorderRTC.getBlob())break;if(this.isSafari){this.recorderRTC.getDataURL((function(e){a.SaveToDisk(e,a.getFileName(a.fileExtension))}));break}var c=this.recorderRTC.getBlob(),d=new File([c],this.getFileName(this.fileExtension),{type:this.mimeType});$.a.invokeSaveAsDialog(d);break;case"buttonSend":if(!n.config.serverURL)return void console.log("components/Recorder  missing serverURL",n.config.serverURL,n.config);var l=ae.a.post(n.config.serverURL);l.field("task","recorder_upload"),l.field("mode","audio"==this.state.mode?"audio":"video"),l.field("scenario",n.options.scenario),l.field("VideoWhisper[userID]",n.user.ID),l.field("VideoWhisper[sessionID]",n.user.sessionID),l.field("VideoWhisper[sessionKey]",n.user.sessionKey),n.room.ID?(l.field("VideoWhisper[roomID]",n.room.ID),l.field("VideoWhisper[privateUID]",n.room.privateUID)):console.log("components/Recorder missing room ID",n.room,n.user,n.config.serverURL);var p=[],m=this.getFileName(this.fileExtension);this.filename=m;c=this.recorderRTC.getBlob(),d=new File([c],m,{type:this.mimeType});l.attach(m,d,m),p.push(m),l.field("files[]",p),l.then((function(e){return a.uploadCompleted(e)})).catch((function(e){console.log("components/Recorder request error",e)})),this.devMode&&console.log("components/Recorder uploading ...",p,l),this.setState({uploading:!0,statusInfo:this.txt("Uploading. Please wait...")})}this.props.recorderStatus(o)}},{key:"render",value:function(){var e=this.props,t=this.state,a=this.txt;this.devMode=e.appState.devMode;var o=Object(A.jsxs)(U.a.Group,{children:[Object(A.jsxs)(U.a,{icon:!0,name:"buttonAudio",onClick:this.onClick.bind(this),color:"audio"==t.mode?"black":"grey","data-tooltip":a("Audio"),children:[" ",Object(A.jsx)(w.a,{name:"microphone"})," "]}),Object(A.jsxs)(U.a,{icon:!0,name:"buttonVideo",onClick:this.onClick.bind(this),color:"video"==t.mode?"black":"grey","data-tooltip":a("Video"),children:[" ",Object(A.jsx)(w.a,{name:"video",disabled:!t.mediaRecorder})," "]}),Object(A.jsxs)(U.a,{icon:!0,name:"buttonScreen",onClick:this.onClick.bind(this),color:"screen"==t.mode?"black":"grey","data-tooltip":a("Screen"),children:[" ",Object(A.jsx)(w.a,{name:"desktop",disabled:!t.mediaRecorder})," "]})]},"modeSelect");return this.props.config.recorderModeDisable&&(o=""),Object(A.jsxs)("div",{children:[o,t.mediaRecorder?"":Object(A.jsx)(R.a,{pointing:"left",color:"black",children:"Video recording is not available in this browser."}),Object(A.jsx)(ee.a,{hidden:!0}),this.isSafari&&!t.mediaRecorder?Object(A.jsxs)(N.a,{size:"small",compact:!0,className:e.appState.className,children:["How To Enable Webcam Recording in Latest Safari:",Object(A.jsx)("br",{}),"1. Show Develop menu from Safari > Preferences > Advanced menu.",Object(A.jsx)("br",{}),"2. Toggle Develop > Experimental Features > MediaRecorder menu to enable video recording.",Object(A.jsx)("br",{}),"3. Reload page to activate feature."]}):"",Object(A.jsxs)(N.a,{compact:!0,className:e.appState.className,children:[Object(A.jsxs)(U.a,{icon:!0,name:"buttonStart",onClick:this.onClick.bind(this),disabled:!t.buttonStart,color:"red","data-tooltip":a("Start"),children:[" ",Object(A.jsx)(w.a,{name:"circle"})," "]}),Object(A.jsxs)(U.a,{icon:!0,name:"buttonStop",onClick:this.onClick.bind(this),disabled:!t.buttonStop,color:"blue","data-tooltip":a("Stop"),children:[" ",Object(A.jsx)(w.a,{name:"square"})," "]}),Object(A.jsxs)(U.a,{icon:!0,name:"buttonDiscard",onClick:this.onClick.bind(this),disabled:!t.buttonDiscard,color:"orange","data-tooltip":a("Discard"),children:[" ",Object(A.jsx)(w.a,{name:"trash"})," "]}),Object(A.jsxs)(U.a,{icon:!0,name:"buttonDownload",onClick:this.onClick.bind(this),disabled:!t.buttonSend,color:"olive","data-tooltip":a("Download"),children:[" ",Object(A.jsx)(w.a,{name:"download"})," "]}),Object(A.jsxs)(U.a,{icon:!0,name:"buttonSend",onClick:this.onClick.bind(this),disabled:!t.buttonSend,color:"green",loading:t.uploading,"data-tooltip":a("Send"),children:[" ",Object(A.jsx)(w.a,{name:"send"})," "]}),this.modeText?Object(A.jsxs)(U.a,{icon:!0,name:"buttonVideoWhisper",href:e.appState.tooltipURL,"data-tooltip":e.appState.tooltip,color:"violet",children:[" ",Object(A.jsx)(w.a,{name:"eye"})," "]}):"",Object(A.jsx)(ee.a,{hidden:!0}),Object(A.jsx)(q.a,{compact:!0,className:e.appState.className+" tiny",name:"microphone",value:t.microphone,onChange:this.onChange,placeholder:"Microphone",selection:!0,options:t.microphoneOptions},"microphone"),"video"==t.mode?Object(A.jsxs)("span",{children:[Object(A.jsx)(q.a,{compact:!0,className:e.appState.className+" tiny",name:"camera",value:t.camera,onChange:this.onChange,placeholder:"Camera",selection:!0,options:t.cameraOptions},"camera"),Object(A.jsx)(q.a,{compact:!0,className:e.appState.className+" tiny",name:"resolution",value:t.resolution,onChange:this.onChange,placeholder:"Video Resolution",selection:!0,options:t.resolutionOptions}),this.tWarn?Object(A.jsx)("div",{children:Object(A.jsx)(R.a,{size:"small",color:e.appState.darkMode?"black":"grey",children:this.tWarn})}):""]}):"","audio"==t.mode||t.buttonSend?"":Object(A.jsxs)("div",{children:[Object(A.jsx)("br",{})," ",Object(A.jsx)("video",{style:{maxWidth:"100%"},id:"videoPreview",ref:this.videoPreview,autoPlay:!0,muted:!0,playsInline:!0})]})]}),Object(A.jsxs)(R.a,{color:"black",children:[t.displayTime,this.maxTime?" / "+this.toMMSS(this.maxTime):""]}),Object(A.jsx)(R.a,{color:"black",children:t.statusInfo}),Object(A.jsx)("br",{}),Object(A.jsxs)(N.a,{compact:!0,className:e.appState.className,style:{visibility:t.buttonSend?"visible":"hidden"},children:[this.txt("Recorded: Playback")," ",Object(A.jsx)("br",{}),"audio"!=t.mode?Object(A.jsx)("video",{style:{maxWidth:"100%",visibility:t.buttonSend?"visible":"hidden"},id:"videoPlayback",ref:this.videoPlayback,controls:!0,autoPlay:!0,playsInline:!0}):Object(A.jsx)("audio",{style:{maxWidth:"100%",visibility:t.buttonSend?"visible":"hidden"},id:"audioPlayback",ref:this.audioPlayback,controls:!0,autoPlay:!0,playsInline:!0}),this.isSafari?"":Object(A.jsx)("div",{children:Object(A.jsx)(R.a,{size:"small",color:e.appState.darkMode?"black":"grey",children:"Safari may not play recordings from other browsers. Record using Safari if available."})})]})]},"recorderControls")}}]),a}(o.Component),se=a(44),ie=a(29),ne=a.n(ie),re=a(145),ce=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return e in t.config.text?t.config.text[e]:e},o.onDrop=function(e){var t=Object(k.a)(o).props;if(t.config.serverURL){var a=ae.a.post(t.config.serverURL);a.field("task","file_upload"),a.field("VideoWhisper[userID]",t.user.ID),a.field("VideoWhisper[sessionID]",t.user.sessionID),a.field("VideoWhisper[sessionKey]",t.user.sessionKey),t.room.ID?(a.field("VideoWhisper[roomID]",t.room.ID),a.field("VideoWhisper[privateUID]",t.room.privateUID)):console.log("components/Files onDrop room",t.room,t.user,t.config.serverURL);var s=[];e.forEach((function(e){a.attach(e.name,e,e.name),s.push(e.name)})),a.field("files[]",s),a.then(o.uploadCompleted.bind(Object(k.a)(o))),console.log("components/Files onDrop",e,a),o.setState({uploading:!0})}else console.log("components/Files onDrop missing serverURL",t.config.serverURL,t.config)},o.state={uploading:!1},o.devMode=e.appState.devMode,o.fileInputRef=s.a.createRef(),o.devMode&&console.log("components/Files constructor room:",e.room),o}return Object(y.a)(a,[{key:"componentWillUnmount",value:function(){console.log("components/Files  componentWillUnmount")}},{key:"uploadCompleted",value:function(e){console.log("components/Files uploadCompleted",e),this.props.serverUpdate({task:"update",update:"files"}),this.setState({uploading:!1}),this.props.uploadsStatus("uploadCompleted")}},{key:"render",value:function(){var e=this.props,t=this.state,a=this.txt;return this.props.room.filesUpload?Object(A.jsx)(re.a,{onDrop:this.onDrop,children:function(o){var s=o.getRootProps,i=o.getInputProps;return Object(A.jsx)(N.a,{className:e.appState.className,children:Object(A.jsxs)("div",Object(se.a)(Object(se.a)({},s()),{},{children:[Object(A.jsx)("input",Object(se.a)({},i())),Object(A.jsxs)("p",{children:[Object(A.jsx)(w.a,{name:"upload",loading:t.uploading})," ",t.uploading?a("Uploading. Please wait..."):a("Upload: Drag and drop files here, or click to select files")]})]}))})}}):a("File upload disabled.")}}]),a}(o.Component),de=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return t.config&&e in t.config.text?t.config.text[e]:e},o.onSubmit=function(e){e.preventDefault();var t=Object(k.a)(o),a=t.props,s=t.state;if(o.devMode&&console.log("ChatInput onSubmit",o.state),o.state){var i=o.state.message;if(0!==i.length){if("/vws dev"===i)a.appStateUpdate({devMode:!0}),console.log("components/ChatInput devMode Enabled",o.state);var n={userID:a.user.ID,userName:a.user.name,userAvatar:a.user.avatar,notification:!1,text:i,language:s.language,flag:s.flag,time:(new Date).valueOf(),mentionMessage:0,mentionUser:"",ID:(new Date).valueOf()};0!=a.appState.chatMentionMessage&&("message"!=s.mention&&"replyat"!=s.mention||(n.mentionMessage=a.appState.chatMentionMessage)),""!=a.appState.chatMentionUser&&("user"!=s.mention&&"replyat"!=s.mention||(n.mentionUser=a.appState.chatMentionUser)),a.sendMessage(n),o.setState({message:""}),a.appStateUpdate({chatMentionMessage:0,chatMentionUser:""})}}},o.emojiModalClose=function(){return o.setState({emojiModalShow:!1})},o.recordModalClose=function(){return o.setState({recordModalShow:!1})},o.uploadModalClose=function(){return o.setState({uploadModalShow:!1})},o.languageModalClose=function(){return o.setState({languageModalShow:!1})},o.textModalClose=function(){return o.setState({textModalShow:!1,message:"",messageLong:""})},o.textModalSend=function(){o.setState({textModalShow:!1,message:o.state.messageLong,messageLong:""})},o.onEmojiButton=function(){return o.setState({emojiModalShow:!0})},o.onRecordButton=function(){return o.setState({recordModalShow:!0})},o.onUploadButton=function(){return o.setState({uploadModalShow:!0})},o.onLanguageButton=function(){return o.setState({languageModalShow:!0})},o.addEmoji=function(e){var t;o.devMode&&console.log("components/ChatInput addEmoji",e),o.state.textModalShow?(t=o.state.messageLong,e&&e.native&&(t+=e.native),o.setState({emojiModalShow:!1,messageLong:t})):(t=o.state.message,e&&e.native&&(t+=e.native),o.setState({emojiModalShow:!1,message:t}))},o.onMentionChange=function(e,t){o.devMode&&console.log("components/ChatInput onMentionChange",t),"cancel"==t.value?o.props.appStateUpdate({chatMentionMessage:0,chatMentionUser:""}):o.setState({mention:t.value})},o.recorderStatus=function(e){if(o.devMode&&console.log("components/ChatInput recorderStatus",e),"uploadCompleted"===e)o.recordModalClose()},o.uploadsStatus=function(e){if(o.devMode&&console.log("components/ChatInput uploadsStatus",e),"uploadCompleted"===e)o.uploadModalClose()},o.devMode=e.appState.devMode,o.state={message:"",messageLong:"",mention:"replyat",container:null,emojiModalShow:!1,recordModalShow:!1,textModalShow:!1,uploadModalShow:!1,languageModalShow:!1},o.inputRef=s.a.createRef(),o.onChange=o.onChange.bind(Object(k.a)(o)),o}return Object(y.a)(a,[{key:"componentDidMount",value:function(){}},{key:"onChange",value:function(e){var t=e.target,a="checkbox"===t.type?t.checked:t.value,o=t.name;"message"!=o&&"messageLong"!=o||(a=Object(J.checkText)(a));var s=20;this.props.config.longTextLength&&(s=this.props.config.longTextLength),"message"==o&&a.length>=s?this.setState({message:a,messageLong:a,textModalShow:!0}):this.setState(Object(P.a)({},o,a))}},{key:"language2flag",value:function(e){var t={"en-us":"us","en-gb":"gb","pt-br":"br","pt-pt":"pt",zh:"cn",ja:"jp",el:"gr",da:"dk"};return t[e]?t[e]:e}},{key:"onLanguageChange",value:function(e,t){this.devMode&&console.log("Components/ChatInput onLanguageChange",t,e),this.props.serverUpdate({task:"options",name:t.name,value:t.value}),this.setState({language:t.value,flag:this.language2flag(t.value),languageModalShow:!1}),this.props.appStateUpdate({language:t.value,flag:this.language2flag(t.value)})}},{key:"render",value:function(){var e=this,t=this.props,a=this.onSubmit,o=this.state,s=this.onChange,i=this.txt,n=!0;o.message.length>4&&(n=!1);var r="",c="",d="";this.props.room.filesUpload&&n&&(c=Object(A.jsx)(U.a,{compact:!0,icon:!0,type:"button",color:"teal","data-tooltip":i("Upload"),onClick:this.onUploadButton,inverted:t.appState.darkMode,children:Object(A.jsx)(w.a,{name:"upload"})}),r=Object(A.jsxs)(I.a,{closeIcon:!0,open:o.uploadModalShow,onClose:this.uploadModalClose,size:"small",basic:t.appState.darkMode,children:[Object(A.jsx)(D.a,{icon:"upload",content:i("Upload")}),Object(A.jsx)(I.a.Content,{children:Object(A.jsx)(ce,{appState:t.appState,appSfx:t.appSfx,user:t.user,config:t.config,room:t.room,serverUpdate:t.serverUpdate,uploadsStatus:this.uploadsStatus})}),Object(A.jsx)(I.a.Actions,{children:Object(A.jsxs)(U.a,{inverted:t.appState.darkMode,color:"red",onClick:this.uploadModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," ",i("Nevermind")]})})]},"uploadModal")),t.options&&t.options.uploadDisable&&(c="");var l=Object(A.jsxs)(I.a,{closeIcon:!0,open:o.textModalShow,onClose:this.textModalSend,size:"small",basic:t.appState.darkMode,children:[Object(A.jsx)(D.a,{icon:"text width",content:i("Long Text")}),Object(A.jsx)(I.a.Content,{children:Object(A.jsx)(W.a,{children:Object(A.jsx)(K.a,{fluid:!0,name:"messageLong",value:o.messageLong,onChange:s})})}),Object(A.jsxs)(I.a.Actions,{children:[Object(A.jsxs)(U.a,{inverted:t.appState.darkMode,type:"button",color:"yellow","data-tooltip":i("Emoticons"),onClick:this.onEmojiButton,children:[Object(A.jsx)(w.a,{name:"smile"})," ",i("Emoticons")]}),Object(A.jsxs)(U.a,{inverted:t.appState.darkMode,color:"green",onClick:this.textModalSend,children:[Object(A.jsx)(w.a,{name:"check"})," ",i("OK")]}),Object(A.jsxs)(U.a,{inverted:t.appState.darkMode,color:"red",onClick:this.textModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," ",i("Erase")]})]})]},"textModal"),p=Object(A.jsxs)(I.a,{closeIcon:!0,open:o.emojiModalShow,onClose:this.emojiModalClose,size:"small",basic:t.appState.darkMode,children:[Object(A.jsx)(D.a,{icon:"smile",content:i("Emoji")}),Object(A.jsx)(I.a.Content,{children:Object(A.jsx)(G.a,{onSelect:this.addEmoji,darkMode:t.appState.darkMode,native:!0,perLine:16})}),Object(A.jsx)(I.a.Actions,{children:Object(A.jsxs)(U.a,{inverted:t.appState.darkMode,color:"red",onClick:this.emojiModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," ",i("Nevermind")]})})]},"emojiModal"),m="",h="",u="";if(!t.config.recorderDisable&&n&&(h=Object(A.jsx)(U.a,{compact:!0,icon:!0,type:"button",color:"orange","data-tooltip":i("Record"),onClick:this.onRecordButton,inverted:t.appState.darkMode,children:Object(A.jsx)(w.a,{name:"microphone"})}),m=Object(A.jsxs)(I.a,{closeIcon:!0,open:o.recordModalShow,onClose:this.recordModalClose,size:"small",basic:t.appState.darkMode,children:[Object(A.jsx)(D.a,{icon:"file video",content:i("Record")}),Object(A.jsx)(I.a.Content,{children:Object(A.jsx)(oe,{config:t.config,user:t.user,room:t.room,appState:t.appState,appStateUpdate:t.appStateUpdate,serverUpdate:t.serverUpdate,recorderStatus:this.recorderStatus,options:{scenario:t.options?t.options.scenario:"chat"}})}),Object(A.jsx)(I.a.Actions,{children:Object(A.jsxs)(U.a,{compact:!0,inverted:t.appState.darkMode,color:"red",onClick:this.recordModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," ",i("Nevermind")]})})]},"recordModal")),t.options&&t.options.recordDisable&&(h=""),t.config.multilanguage&&n&&t.config.languages){u=Object(A.jsx)(U.a,{compact:!0,icon:!0,type:"button",color:"grey","data-tooltip":i("Language"),onClick:this.onLanguageButton,inverted:t.appState.darkMode,children:Object(A.jsx)(Q.a,{name:t.appState.flag})});var v=t.config.languages;d=Object(A.jsxs)(I.a,{closeIcon:!0,open:o.languageModalShow,onClose:this.languageModalClose,size:"small",basic:t.appState.darkMode,children:[Object(A.jsx)(D.a,{icon:"flag",content:i("Chat Language")}),Object(A.jsx)(I.a.Content,{children:Object(A.jsxs)(W.a,{children:[Object(A.jsx)(q.a,{name:v.name,selection:!0,compact:!0,fluid:!0,className:t.appState.className+" v-select","data-position":"right center",value:t.appState.language,options:v.options,flag:t.appState.flag,onChange:function(t,a){return e.onLanguageChange(t,a)}}),Object(A.jsx)("div",{children:v.details})]})})]},"languageModal")}var g="";if(0!=t.appState.chatMentionMessage||""!=t.appState.chatMentionUser){var b=[{key:1,text:Object(A.jsx)(w.a,{name:"arrow up"}),value:"message"},{key:2,text:Object(A.jsx)(w.a,{name:"at"}),value:"user"},{key:3,text:Object(A.jsx)(w.a,{name:"reply"}),value:"replyat"},{key:4,text:Object(A.jsx)(w.a,{name:"close"}),value:"cancel"}];g=Object(A.jsx)(q.a,{className:t.appState.className,compact:!0,inline:!0,options:b,defaultValue:o.mention,selection:!0,onChange:this.onMentionChange})}var f="";return n&&(f=Object(A.jsxs)("span",{children:[Object(A.jsx)(Y.a,{src:t.user.avatar,verticalAlign:"middle",avatar:!0,"data-tooltip":t.user.name})," ",Object(A.jsxs)("label",{children:[Object(A.jsxs)("small",{children:[t.user.name," ",t.options&&t.options.targetUser?Object(A.jsxs)("div",{children:[Object(A.jsx)("span",{children:Object(A.jsx)(w.a,{name:"arrow right"})}),t.options.targetUser," "]}):""," ",t.options&&t.options.price?Object(A.jsxs)("div",{children:[Object(A.jsx)("span",{children:Object(A.jsx)(w.a,{name:"money"})}),t.options.price," "]}):""]})," "]})," "]},"codeUser")),Object(A.jsxs)("div",{className:"panel",style:{backgroundColor:t.appState.backgroundColor},ref:function(t){return e.state.container=t},children:[Object(A.jsx)("div",{className:"controlsBottom",children:Object(A.jsx)(W.a,{onSubmit:a,className:t.appState.className,autoComplete:"off",children:Object(A.jsx)(W.a.Group,{inline:!0,unstackable:!0,children:Object(A.jsxs)(X.a,{inverted:t.appState.darkMode,attached:"left",fluid:!0,focus:!0,name:"message",value:o.message,onChange:s,type:"text",placeholder:i("Type your message"),children:[f,Object(A.jsx)("div",{style:{zIndex:4},children:g}),c,h,u,Object(A.jsx)(U.a,{compact:!0,icon:!0,type:"button",color:"yellow","data-tooltip":i("Emoticons"),onClick:this.onEmojiButton,inverted:t.appState.darkMode,children:Object(A.jsx)(w.a,{name:"smile"})}),Object(A.jsx)("input",{ref:this.inputRef}),Object(A.jsx)(U.a,{compact:!0,primary:!0,icon:!0,type:"submit","data-tooltip":i("Send"),inverted:t.appState.darkMode,children:Object(A.jsx)(w.a,{name:"send"})})]})})})}),p,m,l,r,d]})}}]),a}(o.Component),le=a(354),pe=a(111),me=a.n(pe),he=a(112),ue=a.n(he),ve=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).translationUpdate=function(e){e.stopPropagation();var t=Object(k.a)(o),a=t.props;t.state;if(a.appState.serverURL2){var s={};if(a.user.loggedIn){var i={userID:a.user.ID,sessionID:a.user.sessionID,sessionKey:a.user.sessionKey};s.VideoWhisper=i,s.message=a.message,s.language=a.appState.language,s.flag=a.appState.flag}s.devMode=o.devMode;var n=Object(k.a)(o);me.a.post(a.appState.serverURL2+"translate.php",ue.a.stringify(s),o.axiosConfig).then((function(e){n.translationReceived(e)})).catch((function(e){return o.translationError(e,s)})),o.setState({updating:!0})}else console.log("VideoWhisper/components/ChatMessage translationUpdate: missing serverURL2")},o.devMode=e.appState.devMode,o.state={translation:"",language:"",flag:"",updating:!1},o.axiosConfig={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},o}return Object(y.a)(a,[{key:"translationReceived",value:function(e){this.state;var t=e.data;t.translation?this.setState({translation:t.translation,language:t.language,flag:t.flag,updating:!1}):this.setState({updating:!1})}},{key:"translationError",value:function(e,t){console.log("VideoWhisper/components/ChatMessage translationError:",e,t),this.setState({updating:!1})}},{key:"render",value:function(){var e=this.props,t=this.state,a=e.message,o=a.notification,s=a.userID===e.userID&&!o,i=e.previousUser==a.userName+"#"+a.userID,n=a.time-e.previousTime<6e4,r=a.userAvatar?Object(A.jsx)(Y.a,{className:"avatar","data-tooltip":a.userName,avatar:!0,src:a.userAvatar,size:"mini",rounded:!0}):"",c=new Date(a.time),d=c.toLocaleDateString()+" at "+c.toLocaleTimeString(),l="chatMessage "+(e.darkMode?"dark ":"")+" "+(o?"notification":"user")+" "+(s?"own ":"")+" "+(a.automated?"automated":""),p=i||o?"":Object(A.jsxs)("strong",{children:[" ",r," ",a.userName]}),m=i&&n?"":Object(A.jsx)("i",{children:d}),h=p||m?Object(A.jsxs)(A.Fragment,{children:[p," ",m,":",Object(A.jsx)("br",{})]}):"",u="";a.image&&(u=Object(A.jsx)(Y.a,{src:a.image,size:"mini",rounded:!0,floated:"left",verticalAlign:"middle"})),a.picture&&(u=Object(A.jsx)(Y.a,{src:a.picture,size:"small",rounded:!0,floated:"left",verticalAlign:"middle"}));var v="";return e.config.multilanguage&&(v=a.flag?a.flag!=e.appState.flag?t.flag==e.appState.flag?Object(A.jsxs)("div",{children:[" ",Object(A.jsx)(Q.a,{name:a.flag})," ",Object(A.jsx)("br",{})," ",t.translation.split("\n").map((function(e,t){return Object(A.jsx)("div",{children:e},t)}))," ",Object(A.jsx)(Q.a,{name:t.flag})]}):e.config.translations?Object(A.jsxs)(U.a,{onClick:this.translationUpdate,compact:!0,basic:!0,size:"tiny",disabled:t.updating,loading:t.updating,className:e.darkMode?"inverted ":"",children:[Object(A.jsx)(Q.a,{name:a.flag})," \u2192 ",Object(A.jsx)(Q.a,{name:e.appState.flag})]}):Object(A.jsx)(Q.a,{name:a.flag}):Object(A.jsx)(Q.a,{name:a.flag}):""),Object(A.jsxs)("li",{className:l,ref:e.messageRef,children:[h,0!=a.mentionMessage&&void 0!=a.mentionMessage?Object(A.jsxs)(U.a,{"data-tooltip":e.txt("Scrool to Message"),onClick:function(t){return e.messageScroll(t,a.mentionMessage)},size:"tiny",className:e.darkMode?"inverted ":"",target:"_blank",compact:!0,icon:!0,children:[" ",Object(A.jsx)(w.a,{name:"arrow up",size:"small"})," "]}):"",""!=a.mentionUser&&void 0!=a.mentionUser?Object(A.jsxs)("span",{children:[" @",a.mentionUser,Object(A.jsx)("br",{})]}):"",a.video?Object(A.jsx)("div",{children:Object(A.jsx)("video",{style:{maxWidth:"75%"},src:a.video,controls:!0})}):"",a.audio?Object(A.jsx)("div",{children:Object(A.jsx)("audio",{src:a.audio,controls:!0})}):"",e.selectedID==a.ID?Object(A.jsx)("span",{children:Object(A.jsx)(w.a,{name:"arrow right"})}):"",-1==e.selectedID?Object(A.jsx)("span",{children:Object(A.jsx)(w.a,{name:"caret right"})}):"",Object(A.jsxs)("label",{className:"messageText",style:a.progressTotal?{minWidth:"45%"}:{},id:"m"+a.ID,onClick:function(t){return e.messageClick(t,a.ID,a.userName)},children:[u,a.text.split("\n").map((function(e,t){return Object(A.jsx)("div",{children:e},t)})),v,a.progressTotal?Object(A.jsx)("div",{children:Object(A.jsx)(le.a,{style:{minWidth:"40%"},className:e.darkMode?"inverted ":"",value:a.progressValue,total:a.progressTotal,indicating:!0,progress:"ratio",size:"small",children:a.progressDetails})}):"",a.url?Object(A.jsx)(U.a,{className:e.darkMode?"inverted ":"",target:"_blank",href:a.url,compact:!0,icon:!0,children:Object(A.jsx)(w.a,{name:"linkify"})}):"",a.count?Object(A.jsxs)(R.a,{children:[Object(A.jsx)(w.a,{name:"mail"})," ",a.count]}):"",a.attachmentsCount?Object(A.jsxs)(R.a,{children:[Object(A.jsx)(w.a,{name:"file"})," ",a.attachmentsCount]}):"",a.recordingsCount?Object(A.jsxs)(R.a,{children:[Object(A.jsx)(w.a,{name:"file video"})," ",a.recordingsCount]}):"",a.file_name?Object(A.jsxs)("span",{children:[" ",a.file_name," ",a.file_size," ",Object(A.jsx)(U.a,{className:e.darkMode?"inverted ":"",target:"_blank",href:a.file_url,compact:!0,icon:!0,children:Object(A.jsx)(w.a,{name:"download"})})," "]}):""]})]},a.ID)}}]),a}(o.Component),ge=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return t.config&&e in t.config.text?t.config.text[e]:e},o.onScroll=function(){Object(k.a)(o).refs.messageList.scrollTop},o.scrollToBottom=function(){var e=o.refs.messageList,t=e.scrollHeight-e.clientHeight;n.a.findDOMNode(e).scrollTop=t>0?t:0},o.messageClick=function(e,t,a){o.devMode&&console.log("components/ChatHistory messageClick",t,a,o.devMode,e),e.stopPropagation();var s=Object(k.a)(o).props;s.appState.chatMentionMessage==t&&s.appState.chatMentionUser==a||s.appStateUpdate({chatMentionMessage:t,chatMentionUser:a})},o.messageScroll=function(e,t){o.devMode&&console.log("components/ChatHistory messageScroll",t,o.messageRefs[t]),e.stopPropagation(),o.messageRefs&&o.messageRefs[t]&&o.messageRefs[t].current&&o.messageRefs[t].current.scrollIntoView({behavior:"smooth",block:"start"})},o.devMode=e.appState.devMode,o.messageRefs={},o.state={container:null},o}return Object(y.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this,t=this.props,a=this.onScroll;this.devMode=t.appState.devMode;var o,i=!1;(!t.appState.checked||t.appState.checked&&t.appState.mode.text)&&(i=!0);var n="",r=0,c=0;return this.messageRefs={},this.mIDs=[],o=t.messages.length>0?Object(A.jsx)("ul",{className:"chatMessageList",ref:"messageList",onScroll:a,children:t.messages.map((function(a){i&&a.modeText&&(a.text=t.appState.tooltip,a.url=t.appState.tooltipURL,a.image=t.appState.tooltipImage),e.messageRefs[a.ID]||(e.messageRefs[a.ID]=s.a.createRef());var o=Object(A.jsx)(ve,{config:t.config,user:t.user,appState:t.appState,txt:e.txt,messageRef:e.messageRefs[a.ID],messageClick:e.messageClick,messageScroll:e.messageScroll,darkMode:t.appState.darkMode,userID:t.user.ID,message:a,previousUser:n,previousTime:r},a.ID);return n=a.userName+"#"+a.userID,r=a.time,a.modeText&&!i||c===a.ID||e.mIDs.indexOf(a.ID)>=0?"":(c=a.ID,e.mIDs.push(c),o)}))}):Object(A.jsx)("ul",{className:"chatMessageList",ref:"messageList",onScroll:a,children:Object(A.jsx)("li",{className:"chatMessage",children:Object(A.jsx)("span",{children:"No Messages."})},"0")}),Object(A.jsx)("div",{className:"panel",style:{backgroundColor:t.appState.backgroundColor},ref:function(t){return e.state.container=t},children:Object(A.jsx)("div",{className:"controls",children:o})})}}]),a}(o.Component),be=a(350),fe=a(348),je=a(357),Se=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return e in t.config.text?t.config.text[e]:e},o.privateModalClose=function(){return o.setState({privateModalShow:!1})},o.fullscreenModalClose=function(){return o.setState({fullscreenRecommended:!0})},o.handleFullscreenChange=function(e){var t=!1;(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(t=!0),o.setState({fullscreen:t})},o.toHHMMSS=function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),o=e-3600*t-60*a;return t>0&&t<10&&(t="0"+t),a<10&&(a="0"+a),o<10&&(o="0"+o),(t?t+":":"")+a+":"+o},o.modesClick=function(e,t){var a=Object(k.a)(o).props;o.devMode&&console.log("components/Actions modesClick",t,a.room),o.setState({modesOpen:!1}),a.serverUpdate({task:"modesSet",mode:t.name})},o.streamsClick=function(e,t){var a=Object(k.a)(o).props;o.devMode&&console.log("components/Actions streamsClick",t,a.room),o.setState({streamsOpen:!1}),a.room.streamsAdmin?t.placement?a.serverUpdate({task:"streamPresentation",streamName:t.stream,streamAddress:t.address,placement:t.placement}):a.serverUpdate({task:"streamsSet",streamName:t.stream,streamAddress:t.address}):a.appStateUpdate({streamName:t.stream,streamAddress:t.address})},o.state={tipLast:0,fullpage:!1,fullscreenRecommended:!1,fullscreen:!1,tipsOpen:!1,privateModalShow:!1,privateLoading:!1,requestModalShow:!1,requestDetails:"Details for request modal: No action meta info!",requestAction:{ID:0},displayTime:"00:00"},o.devMode=e.appState.devMode,o}return Object(y.a)(a,[{key:"updateTime",value:function(e){this.setState({displayTime:this.toHHMMSS(Math.floor(e/1e3))})}},{key:"onClick",value:function(e,t){var a,o=t.name,s=t.value,i=this.state,n=this.props;switch(this.devMode&&console.log("components/Actions onClick",o,s,e,"props:",n),o){case"tipsButton":case"menuButton":i.fullscreen&&this.exitFullscreen();break;case"fullpage":var r=!i.fullpage;this.setState({fullpage:r}),this.fullpage();break;case"sfx":var c=!n.appState.sfx;c&&n.appSfx("message",null,!0),n.appStateUpdate({sfx:c}),n.serverUpdate({task:"options",name:"h5v_sfx",value:c});break;case"darkMode":var d=!n.appState.darkMode;n.appStateUpdate({darkMode:d}),n.serverUpdate({task:"options",name:"h5v_dark",value:d});break;case"pipMode":var l=!n.appState.pipMode;n.appStateUpdate({pipMode:l}),n.serverUpdate({task:"options",name:"h5v_pip",value:l});break;case"recMode":var p=!n.appState.recMode;n.appStateUpdate({recMode:p}),n.serverUpdate({task:"options",name:"stream_record_all",value:p});break;case"fullscreenRecommended":n.config.actionFullpage&&(this.setState({fullpage:!0}),this.fullpage());case"fullscreen":if(this.state.fullscreenRecommended=!0,i.fullscreen)this.exitFullscreen();else{var m=document.getElementById("videowhisperVideochat");this.requestFullscreen(m)}break;case"tip":if("undefined"===typeof s)break;var h=parseInt(s);if(n.room.tips&&n.room.tipOptions.length>0&&n.room.tipOptions.length>h){var u=n.room.tipOptions[h];n.serverUpdate({task:"tip",tip:u,tipsURL:n.room.tipsURL,targetID:n.room.performerID}),this.setState({tipsOpen:!1,tipLast:Date.now()}),console.log("components/Actions sending tip",u,h)}break;case"next":n.serverUpdate({task:"next",targetID:n.room.performerID});break;case"party_return":n.serverUpdate({task:"party_return"});break;case"party_leave":n.serverUpdate({task:"party_leave"});break;case"reveal":n.appStateUpdate({revealed:!0,publishRequired:!0});break;case"private":this.setState({privateModalShow:!0});break;case"privateClose":a={action:"privateRequest",ID:n.room.actionID,privateUID:n.room.privateUID,status:7},n.serverUpdate({task:"interaction-close",interaction:a});break;case"privateRequest":this.setState({privateLoading:!0,privateModalShow:!1});var v={userName:n.user.name};a={action:"privateRequest",userID:n.user.ID,roomID:n.room.ID,targetID:n.room.performerID,meta:v},n.serverUpdate({task:"interaction",interaction:a});break;case"declineRequest":this.setState({requestModalShow:!1}),a={ID:i.requestAction.ID,answer:0,status:2},n.serverUpdate({task:"interaction-answer",interaction:a});break;case"acceptRequest":this.setState({requestModalShow:!1}),a={ID:i.requestAction.ID,answer:1,status:2},n.serverUpdate({task:"interaction-answer",interaction:a});break;default:console.log("components/Actions onClick UNHANDLED",o,s,e)}}},{key:"fullpage",value:function(){var e=document.getElementById("videowhisperVideochat");this.state.fullpage?(e.style.position="fixed",e.style.top="0",e.style.left="0"):e.style.position="absolute",console.log("components/Actions fullpage",this.state.fullpage,e.style.position)}},{key:"componentDidMount",value:function(){document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("msfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("MSFullscreenChange",this.handleFullscreenChange,!1),document.addEventListener("fullscreenchange",this.handleFullscreenChange,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullscreenChange),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullscreenChange),document.removeEventListener("fullscreenchange",this.handleFullscreenChange)}},{key:"requestFullscreen",value:function(e){var t=!0;this.state.fullscreen=t,e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1,this.state.fullscreen=!1),this.setState({fullscreen:t})}},{key:"exitFullscreen",value:function(){this.setState({fullscreen:!1}),(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.log("components/Actions Fullscreen API is not supported."))}},{key:"componentDidUpdate",value:function(e){e.actions!==this.props.actions&&this.processActions()}},{key:"processActions",value:function(){var e=this,t=this.props,a=this.state;t.actions.length>0&&t.actions.forEach((function(o){if(o)if(o.userID===t.user.ID){if("privateRequest"===o.action){if(3===o.status&&1===o.answer){o={ID:a.requestAction.ID,status:5};t.serverUpdate({task:"interaction-confirm",interaction:o})}o.status>=3&&o.status<7&&o.answer}}else if("privateRequest"===o.action){if(o.status<2&&t.room.privateUID!==o.userID&&("function"===typeof t.appSfx&&t.appSfx("call"),a.requestModalShow=!0,o.meta&&e.setState({requestDetails:'User "'+o.meta.userName+'" requested starting a private call.'}),a.requestAction=o),2===o.status&&1===o.answer){o={ID:a.requestAction.ID,status:3};t.serverUpdate({task:"interaction-answer",interaction:o})}o.status>=3&&o.status<7&&o.answer}}))}},{key:"componentWillReceiveProps",value:function(e){}},{key:"render",value:function(){var e=this,t=this.props,a=this.state,o=this.txt,s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,i=navigator.userAgent.toLowerCase().indexOf("android")>-1,n=[];if(s||i||a.fullscreenRecommended||window.innerWidth<500&&n.push(Object(A.jsxs)(I.a,{closeIcon:!0,open:!0,onClose:this.fullscreenModalClose,size:"small",children:[Object(A.jsx)(D.a,{icon:"star",content:"FullScreen Recommended"}),Object(A.jsx)(I.a.Content,{children:Object(A.jsx)("h3",{children:"When available space is small, fullscreen is recommended to access interface more easily."})}),Object(A.jsxs)(I.a.Actions,{children:[Object(A.jsxs)(U.a,{color:"orange",onClick:this.fullscreenModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," Nevermind"]}),Object(A.jsxs)(U.a,{color:"green",name:"fullscreenRecommended",onClick:this.onClick.bind(this),children:[Object(A.jsx)(w.a,{name:"expand"})," Go Fullscreen"]})]})]},"recommendFullscreen")),t.config.siteMenu){var r=[],c=[],d=null;t.config.siteMenu.forEach((function(e){e.parentID?c.push(Object(A.jsxs)(q.a.Item,{href:e.url,target:"_blank",children:[" ",e.title," "]},e.ID)):(c.length?(r.push(Object(A.jsx)(q.a,{className:t.appState.className,item:!0,text:d.title,children:Object(A.jsx)(q.a.Menu,{children:c})},d.ID)),c=[]):d&&r.push(Object(A.jsxs)(be.a.Item,{href:d.url,target:"_blank",children:[" ",d.title," "]},d.ID)),d=e)})),n.push(Object(A.jsx)(fe.a,{className:t.appState.className,on:["hover","click"],trigger:Object(A.jsx)(U.a,{name:"menuButton",onClick:this.onClick.bind(this),compact:!0,className:t.appState.className,icon:!0,size:"small",children:Object(A.jsx)(w.a,{name:"align justify"})}),flowing:!0,hoverable:!0,children:Object(A.jsxs)(be.a,{vertical:!0,className:t.appState.className,children:[Object(A.jsx)(be.a.Item,{header:!0,children:o("Site Menu")}),r]})},"siteMenu"))}var l="";if(t.user.balance!=t.user.balancePending&&(l=Object(A.jsxs)(R.a,{"data-tooltip":o("Pending Balance"),className:t.appState.className,as:"a",color:t.appState.darkMode?"black":"grey",children:[" ",Object(A.jsx)(w.a,{name:"notched circle loading icon"})," ",t.user.balancePending]})),(t.config.balanceURL||t.user.balance)&&n.push(Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,size:"small",name:"balance",as:"div",labelPosition:"right",children:[Object(A.jsx)(U.a,{"data-tooltip":o("Wallet"),compact:!0,className:t.appState.className,size:"small",color:"green",target:"_balance",href:t.config.balanceURL,children:Object(A.jsx)(w.a,{name:"money"})}),Object(A.jsx)(R.a,{"data-tooltip":o("Balance"),className:t.appState.className,as:"a",color:t.appState.darkMode?"black":"grey",target:"_balance",href:t.config.balanceURL,children:t.user.balance}),l]},"balance")),t.room.tips&&t.room.tipOptions.length>0){var p=0,m=Object(A.jsx)(A.Fragment,{children:t.room.tipOptions.map((function(a,s){if("TIP"===a.tag&&"custom"!==a.attributes.AMOUNT)return p++,Object(A.jsxs)(je.a.Column,{className:t.appState.className,textAlign:"center",children:[Object(A.jsxs)(D.a,{as:"h4",className:t.appState.className,children:[a.attributes.IMAGE?Object(A.jsx)(Y.a,{src:t.room.tipsURL+a.attributes.IMAGE,size:"mini",rounded:!0,verticalAlign:"middle"}):""," ",a.attributes.AMOUNT]}),Object(A.jsx)("b",{children:a.attributes.LABEL}),Object(A.jsx)("div",{children:a.attributes.NOTE}),Object(A.jsx)("div",{children:Object(A.jsx)(U.a,{compact:!0,className:t.appState.className,size:"small",color:"olive",name:"tip",value:s,onClick:e.onClick.bind(e),children:o("Gift")})})]},"tip"+s)}))});n.push(Object(A.jsx)(fe.a,{className:t.appState.className,on:["hover","click"],trigger:Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,size:"small",name:"tipsButton",onClick:this.onClick.bind(this),color:"olive",disabled:Date.now()-a.tipLast<5e3,children:[" ",Object(A.jsx)(w.a,{name:"box"})," ",o("Gifts")]},"tipsButton"),flowing:!0,hoverable:!0,open:this.state.tipsOpen,onOpen:function(){return e.setState({tipsOpen:!0})},onClose:function(){return e.setState({tipsOpen:!1})},children:Object(A.jsx)(je.a,{className:t.appState.className,stackable:!0,centered:!0,divided:!0,columns:p,style:{overflow:"auto",maxHeight:180,maxWidth:480},children:m})},"tipsPopup"))}var h=!0,u=o("Request Private Session");if(t.room.actionPrivateDisable)u=o("Performer Disabled Private Requests");else if(t.room.actionPrivateBusy)u=o("Performer is Busy in Private");else if(t.room.users){(S=t.room.users[t.room.performerID])?h=!1:u=o("Performer is Not Online")}if(t.room.actionPrivate&&n.push(Object(A.jsx)("span",{"data-tooltip":u,children:Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,size:"small",name:"private",color:"orange",loading:a.privateLoading,disabled:a.privateLoading||h,onClick:this.onClick.bind(this),children:[" ",Object(A.jsx)(w.a,{name:"star"})," ",o("Private")]})},"private")),t.room.actionPrivateClose&&n.push(Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,size:"small",name:"privateClose",color:"red",onClick:this.onClick.bind(this),children:[Object(A.jsx)(w.a,{name:"window close"})," ",o("Close Private")]},"privateClose")),n.push(Object(A.jsxs)(I.a,{closeIcon:!0,open:a.privateModalShow,onClose:this.privateModalClose,size:"small",children:[Object(A.jsx)(D.a,{icon:"star",content:o("Request Private 2 Way Videochat Show")}),Object(A.jsx)(I.a.Content,{children:Object(A.jsx)("h3",{children:t.room.performer})}),Object(A.jsxs)(I.a.Actions,{children:[Object(A.jsxs)(U.a,{color:"red",onClick:this.privateModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," ",o("Nevermind")]}),Object(A.jsxs)(U.a,{color:"green",name:"privateRequest",onClick:this.onClick.bind(this),loading:a.privateLoading,disabled:a.privateLoading,children:[Object(A.jsx)(w.a,{name:"star"})," ",o("Request Private")]})]})]},"privateModal")),n.push(Object(A.jsxs)(I.a,{open:a.requestModalShow,closeOnEscape:!1,closeOnDimmerClick:!1,size:"small",children:[Object(A.jsx)(D.a,{icon:"star",content:"Answer Private Show Request"}),Object(A.jsx)(I.a.Content,{children:Object(A.jsx)("h3",{children:a.requestDetails})}),Object(A.jsxs)(I.a.Actions,{children:[Object(A.jsxs)(U.a,{color:"red",name:"declineRequest",onClick:this.onClick.bind(this),children:[Object(A.jsx)(w.a,{name:"remove"})," ",o("Decline")]}),Object(A.jsxs)(U.a,{color:"green",name:"acceptRequest",onClick:this.onClick.bind(this),children:[Object(A.jsx)(w.a,{name:"star"})," ",o("Accept")]})]})]},"requestModal")),t.room.next&&n.push(Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",name:"next",color:"teal","data-tooltip":t.room.nextTooltip?t.room.nextTooltip:o("Next: Random Videochat Room"),onClick:this.onClick.bind(this),disabled:t.appState.roomLoading,children:[o("Next")," ",Object(A.jsx)(w.a,{name:"arrow right"})]},"next")),t.room.partyHost?n.push(Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",name:"party_return",color:"teal","data-tooltip":o("Return Party to Start Room"),onClick:this.onClick.bind(this),disabled:t.appState.roomLoading,children:[o("Return")," ",Object(A.jsx)(w.a,{name:"arrow circle left"})]},"party_return")):t.room.party&&n.push(Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",name:"party_leave",color:"teal","data-tooltip":o("Leave Party"),onClick:this.onClick.bind(this),disabled:t.appState.roomLoading,children:[o("Leave")," ",Object(A.jsx)(w.a,{name:"close"})]},"party_leave")),t.appState.revealMode&&!t.appState.audioMode&&!t.room.audioOnly&&!t.appState.revealed&&"Way2Screen"==t.appState.screen){var v=t.appState.revealWarmup-t.appState.screenTime,g=!0;v<=0?(v="",g=!1):v=Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"clock"})," ",v," "]}),n.push(Object(A.jsx)("span",{"data-tooltip":o("Reveal Webcam"),children:Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",name:"reveal",color:"olive",onClick:this.onClick.bind(this),disabled:g,children:[Object(A.jsx)(w.a,{name:"video"})," ",o("Reveal")," ",v]},"reveal")}))}if(t.room.modes){var b=[];for(var f in t.room.modes){var j=t.room.modes[f];b.push(Object(A.jsxs)(be.a.Item,{name:j.name,active:t.room.mode==j.name,onClick:this.modesClick,children:[Object(A.jsx)(w.a,{name:j.icon}),j.name]},j.key))}n.push(Object(A.jsx)(fe.a,{className:t.appState.className,on:["hover","click"],trigger:Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,size:"small",name:"modesButton",onClick:this.onClick.bind(this),color:"blue","data-tooltip":t.room.mode,"data-position":"right center",children:[" ",Object(A.jsx)(w.a,{name:"users"})," ",o("Mode")]},"modesButton"),flowing:!0,hoverable:!0,open:this.state.modesOpen,onOpen:function(){return e.setState({modesOpen:!0})},onClose:function(){return e.setState({modesOpen:!1})},children:Object(A.jsx)(be.a,{className:t.appState.className,vertical:!0,children:b})},"modesPopup"))}if(t.room.streams&&(!t.appState.minMode||t.room.streamsAdmin)){var S,x=[],O=!1,y=this.txt("Webcam");if(t.room.users)(S=t.content?t.room.users[t.content.userID]:t.room.users[t.room.streamUID])&&(S.meta&&S.meta.connected&&S.sdate<S.meta.connectedUpdate&&(O=!0),y=S.userName);for(var k in x.push(Object(A.jsxs)(be.a.Item,{name:"",address:"",stream:y,active:t.room.streamsAdmin&&!t.room.streamAddress||!t.room.streamsAdmin&&t.appState.streamName&&!t.appState.streamAddress,onClick:this.streamsClick,children:[Object(A.jsx)(w.a,{name:"user"}),O?Object(A.jsx)(w.a,{size:"tiny",color:"green",name:"circle"}):Object(A.jsx)(w.a,{size:"tiny",name:"stop"}),y]},"streamsCamera")),t.room.streamsAdmin||x.push(Object(A.jsxs)(be.a.Item,{name:"",address:"",stream:"",active:!t.appState.streamName&&!t.room.streamAddress,onClick:this.streamsClick,children:[Object(A.jsx)(w.a,{name:"users"}),this.txt("Room Default")]},"streamsDefault")),t.room.streams){var C=t.room.streams[k];if(x.push(Object(A.jsxs)(be.a.Item,{name:C.name,address:C.address,stream:C.stream,active:t.room.streamsAdmin&&t.room.streamName==C.stream||!t.room.streamsAdmin&&t.appState.streamAddress==C.address||!t.room.streamsAdmin&&!t.appState.streamName&&t.room.streamAddress==C.address,onClick:this.streamsClick,children:[Object(A.jsx)(w.a,{name:"camera video"}),C.name]},C.key)),t.room.streamsAdmin&&t.room.usersPresentation)for(var M in t.appState.media)x.push(Object(A.jsxs)(be.a.Item,{name:M+C.name,address:C.address,stream:C.stream,placement:M,onClick:this.streamsClick,children:[Object(A.jsx)(w.a,{name:"pointing up"}),M,": ",C.name]},M+C.key))}n.push(Object(A.jsx)(fe.a,{className:t.appState.className,on:["hover","click"],trigger:Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,size:"small",name:"streamsButton",onClick:this.onClick.bind(this),color:"pink",children:[" ",Object(A.jsx)(w.a,{name:"video camera"})," ",o("Views")]},"streamsButton"),flowing:!0,hoverable:!0,open:this.state.streamsOpen,onOpen:function(){return e.setState({streamsOpen:!0})},onClose:function(){return e.setState({streamsOpen:!1})},children:Object(A.jsx)(be.a,{className:t.appState.className,vertical:!0,children:x})},"streamsPopup"))}if(t.appState.minMode||s||t.config.actionFullscreen&&n.push(Object(A.jsx)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",floated:"right",name:"fullscreen",color:"grey","data-tooltip":a.fullscreen?o("Exit Fullscreen"):o("Enter Fullscreen"),onClick:this.onClick.bind(this),children:Object(A.jsx)(w.a,{name:a.fullscreen?"compress":"expand"})},"fullscreen")),t.appState.minMode||t.config.actionFullpage&&n.push(Object(A.jsx)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",floated:"right",name:"fullpage",color:"grey","data-tooltip":a.fullpage?"Zoom Out of Full Page":"Zoom Into Full Page",onClick:this.onClick.bind(this),children:Object(A.jsx)(w.a,{name:a.fullpage?"zoom-out":"zoom-in"})},"fullpage")),t.appState.minMode||t.config.recordAction&&n.push(Object(A.jsx)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",floated:"right",name:"recMode",color:t.appState.recMode?"red":"black","data-tooltip":t.appState.recMode?o("Stop Recording"):o("Enable Recording"),onClick:this.onClick.bind(this),children:Object(A.jsx)(w.a,{name:t.appState.recMode?"stop":"record"})},"recMode")),t.appState.minMode||n.push(Object(A.jsx)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",floated:"right",name:"sfx",color:t.appState.sfxError?"red":t.appState.sfx?"green":"yellow","data-tooltip":t.appState.sfxError?o("Tap to Play"):t.appState.sfx?o("Sfx On"):o("Sfx Off"),onClick:this.onClick.bind(this),children:Object(A.jsx)(w.a,{name:t.appState.sfxError?"deaf":t.appState.sfx?"bell":"bell slash"})},"sfx")),t.appState.minMode||t.room.panelCamera&&n.push(Object(A.jsx)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",floated:"right",name:"pipMode",color:t.appState.pipMode?"grey":"black","data-tooltip":t.appState.pipMode?o("Disable Picture in Picture"):o("Enable Picture in Picture"),onClick:this.onClick.bind(this),children:Object(A.jsx)(w.a,{name:t.appState.pipMode?"window restore":"window maximize"})},"pipMode")),t.appState.minMode||n.push(Object(A.jsx)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",floated:"right",name:"darkMode",color:t.appState.darkMode?"yellow":"black","data-tooltip":t.appState.darkMode?o("Lights On"):o("Dark Mode"),onClick:this.onClick.bind(this),children:Object(A.jsx)(w.a,{name:t.appState.darkMode?"sun":"moon"})},"darkMode")),(!t.appState.checked||t.appState.checked&&t.appState.mode.text)&&n.push(Object(A.jsx)(U.a,{compact:!0,icon:!0,className:t.appState.className,size:"small",floated:"right",name:"videowhisper",color:"violet",target:"_videowhisper",href:t.appState.tooltipURL,"data-tooltip":t.appState.tooltip,children:Object(A.jsx)(w.a,{name:"eye"})},"videowhisper")),n.push(Object(A.jsxs)(R.a,{size:"small","data-tooltip":o("Session Duration")+(t.room.mode?": "+t.room.mode:""),className:t.appState.className,color:t.appState.darkMode?"black":"grey",children:[Object(A.jsx)(w.a,{name:"time"}),a.displayTime]},"labelDuration")),t.user.cost>0&&n.push(Object(A.jsxs)(R.a,{size:"small","data-tooltip":(t.user.other?t.user.other+": ":"")+o("Session Cost"),className:t.appState.className,color:t.appState.darkMode?"black":"grey",children:[" ",Object(A.jsx)(w.a,{name:"money"})," ",t.user.cost]},"labelCost")),t.user.earn>0&&n.push(Object(A.jsxs)(R.a,{size:"small","data-tooltip":(t.user.other?t.user.other+": ":"")+o("Session Earning"),className:t.appState.className,color:t.appState.darkMode?"black":"grey",children:[" ",Object(A.jsx)(w.a,{name:"money"})," ",t.user.earn]},"labelEarn")),t.room.actionButtons)for(var N in t.room.actionButtons){var T=t.room.actionButtons[N];n.push(Object(A.jsxs)(U.a,{compact:!0,className:t.appState.className,icon:!0,size:"small",floated:T.floated,name:T.name,color:T.color,target:"_"+T.target,href:T.url,"data-tooltip":T.tooltip,children:[Object(A.jsx)(w.a,{name:T.icon})," ",T.text]},T.name))}return Object(A.jsx)("div",{className:"panel",ref:function(t){return e.state.container=t},children:Object(A.jsx)("div",{className:"controlsBottom",children:n})})}}]),a}(o.Component),xe=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutBroadcast",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layCamera",children:Object(A.jsx)(z,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layHistory",children:Object(A.jsx)(ge,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(A.jsx)("div",{className:"laySend",children:Object(A.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),Oe=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutBroadcastAudio",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layHistory",children:Object(A.jsx)(ge,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(A.jsx)("div",{className:"laySend",children:Object(A.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layCamera",children:Object(A.jsx)(z,{cameraConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),ye=a(177),ke=a(224),Ce=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).onLoadedData=function(e){var t=o.remoteVideo.current;o.devMode&&console.log("components/Video - loadeddata"),o.updateVideoSize("onLoadedData"),t&&t.paused&&0==t.currentTime&&(console.log("components/Video loadeddata : video paused on load - try to play",t.src,e),o.videoPlay())},o.onopen=function(e){var t=this,a=this.state;this.devMode&&console.log("components/Video wsConnection.onopen wsConnection.readyState:",this.wsConnection.readyState,e,this.state),this.props.appStateUpdate({wsOpen:!0,wsComponent:"Video onopen"}),1==this.wsConnection.readyState&&(a.retrying=!1,this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.addEventListener("icecandidate",(function(e){return t.icecandidate(t.peerConnection,e)})),this.peerConnection.onconnectionstatechange=function(e){return t.onconnectionstatechange(e)},this.peerConnection.onsignalingstatechange=function(e){return t.onsignalingstatechange(e)},this.peerConnection.addEventListener("iceconnectionstatechange",(function(e){return t.iceconnectionstatechange(t.peerConnection,e)})),this.peerConnection.addEventListener("track",this.track.bind(this)),this.wsConnection?1==this.wsConnection.readyState?this.sendPlayGetOffer():console.log("components/Video wsConnection not open for sendPlayGetOffer wsConnection.readyState:",this.wsConnection.readyState):console.log("components/Video wsConnection not available"))},o.mungeSDPPlay=function(e){var t=e.split(/\r\n/),a="";for(var o in t){var s=t[o];if(0!==s.length){if(s.includes("profile-level-id")){var i=s.substr(s.indexOf("profile-level-id")+17,6),n=Number("0x"+i.substr(0,2)),r=Number("0x"+i.substr(2,2)),c=Number("0x"+i.substr(4,2));n>66&&(n=66,r=224,c=31),0===r&&(r=224);var d=("00"+n.toString(16)).slice(-2).toLowerCase()+("00"+r.toString(16)).slice(-2).toLowerCase()+("00"+c.toString(16)).slice(-2).toLowerCase();s=s.replace(i,d)}a+=s,a+="\r\n"}}return this.devMode&&console.log("components/Video mungeSDPPlay",a),a},o.onmessage=function(e){var t=this,a=this.state;this.devMode&&console.log("components/Video onmessage",e);var o=JSON.parse(e.data),s=Number(o.status),i=o.command,n="";if(a.retryCount++,200!=s)n=o.statusDescription,a.available&&(504===s||514===s||a.retryCount<a.autoRetries&&"1"===this.props.config.videoAutoPlay)?1===this.wsConnection.readyState?(this.devMode&&console.log("components/Video onmessage - Not ready: scheduling sendPlayGetOffer",s,n),setTimeout(this.sendPlayGetOffer.bind(this),1500),n=n+" (retry #"+a.retryCount+")",this.setState({buttonDisabled:!0,buttonContent:"Auto Retry",statusInfo:n,connecting:!0,connected:!1})):(console.log("components/Video onmessage - wsConnection Not open for sendPlayGetOffer wsConnection.readyState:",this.wsConnection.readyState),this.setState({buttonDisabled:!1,buttonContent:"Retry",statusInfo:n,connecting:!1,connected:!1})):this.stopStreamPlay(),this.setState({statusInfo:n});else{this.devMode&&console.log("components/Video onmessage 200 msgJSON",o);var r=o.streamInfo;void 0!==r&&(this.streamInfo.sessionId=r.sessionId),void 0!==o.sdp&&(this.devMode&&console.log("components/Video onmessage: setRemoteDescription sdp: "+JSON.stringify(o.sdp)),o.sdp.sdp=this.mungeSDPPlay(o.sdp.sdp),this.peerConnection.setRemoteDescription(o.sdp).then(this.peerCreateAnswer.bind(this)).catch(this.errorHandler.bind(this)));var c=o.iceCandidates;if(void 0!==c)for(var d in c)this.devMode&&console.log("addIceCandidate: "+JSON.stringify(c[d])),this.peerConnection.addIceCandidate(new RTCIceCandidate(c[d])).then((function(){return t.onAddIceCandidateSuccess(t.peerConnection)}),(function(e){return t.onAddIceCandidateError(t.peerConnection,e)}));0=="sendResponse".localeCompare(i)&&null!=this.wsConnection&&this.wsConnection.close()}},o.devMode=e.appState.devMode,o._isMounted=!1,o.devMode&&console.log("components/Video constructor",e),o.audioInterface=!1,e.videoConfig&&(o.audioInterface=e.videoConfig.audioInterface),o.playStarted=!1,o.retriesLeft=5,o.retryTimeout=5e3,o.retryIfTimeoutSet=!1,o.wsWaited=0,o.remoteVideo=s.a.createRef(),o.wsConnection=null,o.peerConnection=null,o.peerConnectionConfig={iceServers:[]},o.userData={},o.startTime=null,o.stats={video:{timestamp:0,bandwidth:0,bitrate:0,packetsLost:0,qualityLimitationReason:"none"},audio:{timestamp:0,bandwidth:0,bitrate:0,packetsLost:0}},o.streamInfo={applicationName:e.config.application,streamName:e.room.streamPlayback,userName:e.room.performer,sessionId:"[empty]"},o.state={gotVideo:!1,gotAudio:!1,packetLoss:!1,panelType:"Video",meta:e.meta,bitrateInfo:Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"eye slash"}),"Detecting"]}),videoMuted:"muted",videoMutedMessage:"Tap for Sound",fullscreen:!1,available:!1,connected:!1,connecting:!1,autoRetries:3,statusInfo:"Waiting...",buttonContent:"Connecting",buttonDisabled:!0,videoWidth:640,videoHeight:360,videoAspectRatio:1.77,retryCount:0,retrying:!1},o}return Object(y.a)(a,[{key:"interfaceReady",value:function(){var e=this.props,t=this.state;this.streamInfoReset(),this.devMode&&console.log("components/Video - interfaceReady",this.streamInfo),("1"===e.config.videoAutoPlay||t.available)&&this.startStreamPlay()}},{key:"updateVideoSize",value:function(e){var t=this.remoteVideo.current;this.devMode&&console.log("components/Video updateVideoSize",e,t);var a,o=this.state;if(t&&t.videoHeight&&(o.videoWidth===t.videoWidth&&o.videoHeight===t.videoHeight||(o.videoWidth=t.videoWidth,o.videoHeight=t.videoHeight,o.videoHeight||(o.videoHeight=1),this.setState({videoWidth:t.videoWidth,videoHeight:t.videoHeight})),a=t.videoWidth/t.videoHeight,o.videoAspectRatio!==a&&this.setState({videoAspectRatio:a}),this.startTime)){var s=window.performance.now()-this.startTime;this.devMode&&console.log("components/Video updateVideoSize Remote Video playback setup time: "+s.toFixed(3)+"ms"),this.startTime=null}this.devMode&&console.log("components/Video updateVideoSize "+e,o.videoWidth,o.videoHeight,a)}},{key:"componentDidMount",value:function(){this.devMode&&console.log("components/Video componentDidMount"),this._isMounted=!0,Object(V.a)(Object(E.a)(a.prototype),"componentDidMount",this).call(this),this.interfaceReady()}},{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Video stopStreamPlay"),this._isMounted=!1,this.stopStreamPlay(),Object(V.a)(Object(E.a)(a.prototype),"componentWillUnmount",this).call(this)}},{key:"componentDidUpdate",value:function(e,t,a){var o=this.state,s=this.props;if(this.devMode=s.appState.devMode,o.available&&(o.connected||o.connecting||o.retrying||(this.devMode&&console.log("components/Video - componentDidUpdate: startStreamPlay"),this.startStreamPlay())),e.room.videoOffline!=s.room.videoOffline){this.devMode&&console.log("components/Video - componentDidUpdate: props.room.videoOffline");var i=this.remoteVideo.current;i.paused||(i.pause(),i.removeAttribute("src"),i.load())}}},{key:"timerStart",value:function(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.packetsLost=0,this.stats.audio.packetsLost=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),1e3),this.devMode&&console.log("components/Video timerStart"),this.setState({packetLoss:!1})}},{key:"timerStop",value:function(){clearInterval(this.timer),this.devMode&&console.log("components/Video timerStop"),this.setState({packetLoss:!1})}},{key:"timerTick",value:function(){var e=this;if(this._isMounted){this.state;var t=this.props;if(this.devMode=t.appState.devMode,this.state.connected&&this.peerConnection){this.peerConnection.getReceivers().forEach((function(t){t.getStats().then((function(t){t.forEach((function(t){e.devMode&&t.packetsLost&&t.packetsLost>0&&console.log("components/Video packetsLost ",t.packetsLost,t);var a=t.kind;if(void 0===a&&(a=t.mediaType),a&&("inbound-rtp"==t.type&&(e.stats[a]||(e.stats[a]={}),e.stats[a].packetsLost=t.packetsLost,e.stats[a].roundTripTime=t.roundTripTime,e.stats[a].jitter=t.jitter,e.stats[a].timestampRemote=t.timestamp),"inbound-rtp"===t.type&&!t.isRemote&&("video"===a||"audio"===a))){var o=t.timestamp-e.stats[a].timestamp;o>0&&o<6e3&&t.bytesReceived>=e.stats[a].bytesReceived&&(e.stats[a].bitrate=8*(t.bytesReceived-e.stats[a].bytesReceived)/o),e.stats[a].timestamp=t.timestamp,e.stats[a].bytesReceived=t.bytesReceived,e.stats[a].qualityLimitationReason=t.qualityLimitationReason}}))}))}));var a=Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"video"}),Math.round(this.stats.video.bitrate)," kbps","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":"",this.stats.video.roundTripTime>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"clock"}),this.stats.video.roundTripTime," "]}):"",this.stats.video.jitter>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"circle notch"}),Math.round(1e3*(this.stats.video.jitter+Number.EPSILON))/1e3," jitter "]}):"",this.stats.video.packetsLost>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"exclamation circle"}),this.stats.video.packetsLost," packets lost "]}):"",Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"expand"}),this.remoteVideo.current.videoWidth,"x",this.remoteVideo.current.videoHeight," "]}),Object(A.jsx)("br",{})]});(this.props.room.audioOnly||this.audioInterface)&&(a="");var o=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"broken chain"}),"Socket Not Connected"]});this.wsConnection&&(o=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"chain"}),this.wsConnection.readyState]}));var s=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"stop circle"}),"Peer Not Connected"]});this.peerConnection&&(s=Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"play circle"}),this.peerConnection.connectionState,"/",this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState]}));var i=Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"wait"}),"Measuring..."]});(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(i=Object(A.jsxs)("div",{children:[a,Object(A.jsx)(w.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps","none"!==this.stats.audio.qualityLimitationReason&&void 0!==this.stats.audio.qualityLimitationReason?"(limited: "+this.stats.audio.qualityLimitationReason+")":"",this.stats.audio.roundTripTime>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"clock"}),this.stats.audio.roundTripTime," "]}):"",this.stats.audio.jitter>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"circle notch"}),Math.round(1e3*(this.stats.audio.jitter+Number.EPSILON))/1e3," jitter "]}):"",this.stats.audio.packetsLost>0?Object(A.jsxs)(A.Fragment,{children:[" ",Object(A.jsx)(w.a,{name:"exclamation circle"}),this.stats.audio.packetsLost," packets lost "]}):"",Object(A.jsx)("br",{}),o," ",s]})),(this.state.settingsActive||this.audioInterface)&&this.setState({bitrateInfo:i}),this.state.gotAudio&&0==this.stats.audio.bitrate&&this.setState({gotAudio:!1}),!this.state.gotAudio&&this.stats.audio.bitrate>0&&this.setState({gotAudio:!0}),this.state.gotVideo&&0==this.stats.video.bitrate&&this.setState({gotVideo:!1}),!this.state.gotVideo&&this.stats.video.bitrate>0&&this.setState({gotVideo:!0}),(this.stats.audio.packetsLost||this.stats.video.packetsLost)&&(this.state.packetLoss||this.setState({packetLoss:!0}))}}}},{key:"detectStreamChange",value:function(){var e=this.state,t=this.props;this.devMode=t.appState.devMode;var a,o=0,s=t.room.streamPlayback,i=!1;t.room.users&&(t.content?(a=t.room.users[t.content.userID])&&(s=t.content.stream):(a=t.room.users[t.room.streamUID])&&(s=t.room.streamPlayback));this.streamInfo&&this.streamInfo.streamName!=s&&(o=1),a&&a.meta&&a.meta.connected&&a.sdate<a.meta.connectedUpdate&&(i=!0),e.available!=i&&(this.state.available=i,this.devMode&&console.log("components/Video detectStreamChange available",i,this.state.available)),o&&(this.devMode&&console.log("components/Video detectStreamChange",s,this.streamInfo.streamName),this.stopStreamPlay(),this.streamInfoReset(),s&&("1"===t.config.videoAutoPlay||e.available)&&this.startStreamPlay())}},{key:"render",value:function(){var e=this,t=this.state,a=this.props,o=this.txt;this.detectStreamChange();var s={};if(!this.audioInterface){if(t.container){var i=t.container.clientWidth,n=t.container.clientHeight;if(t.width!==i||t.height!==n){n||(n=1);var r=i/n;this.state.aspectRatio=r,this.state.width=i,this.state.height=n,this.devMode&&console.log("components/Video - render: container size update")}}var c=t.videoWidth,d=t.videoHeight,l=0,p=0;t.width&&t.aspectRatio&&t.videoAspectRatio&&(t.videoAspectRatio>t.aspectRatio?(d=(c=t.width)/t.videoAspectRatio,p=(t.height-d)/2):(c=(d=t.height)*t.videoAspectRatio,l=(t.width-c)/2)),s={position:"absolute",left:l,top:p,width:c,height:d}}var m="eye";(a.room.audioOnly||this.audioInterface)&&(m="microphone");var h="";this.streamInfo&&this.streamInfo.streamName&&(h=this.streamInfo.streamName.split("?")[0]);var u="";t.settingsActive&&(u=Object(A.jsxs)("div",{className:"controlsTop",children:[Object(A.jsxs)(W.a,{children:[Object(A.jsx)(R.a,{color:"black",pointing:"right",children:t.statusInfo}),Object(A.jsx)(ee.a,{hidden:!0,vertical:!0}),Object(A.jsxs)(U.a,{compact:!0,size:"small",name:"reload",onClick:this.onClick.bind(this),loading:t.buttonDisabled,disabled:t.buttonDisabled,icon:!0,labelPosition:"right",inverted:!0,children:[t.buttonContent,Object(A.jsx)(w.a,{name:"redo"})]})]}),Object(A.jsxs)(R.a,{color:"black",children:[this.streamInfo.userName?Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"user"}),this.streamInfo.userName]}):Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"users"})," ",a.room.name]}),h?Object(A.jsxs)(A.Fragment,{children:["  ",Object(A.jsx)(w.a,{name:"play"}),h," "]}):""," ",t.connected?t.bitrateInfo:Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"eye slash"}),"Not Streaming"]})]})]}));var v="";t.packetLoss&&(v=Object(A.jsx)("span",{"data-tooltip":this.txt("Packet Loss: Download Connection Issue"),"data-position":"left center",children:Object(A.jsx)(w.a,{inverted:!0,name:"exclamation circle",size:"large"})}));var g=Object(A.jsx)(U.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||a.appState.darkMode,icon:!0,"data-tooltip":"Not Available","data-position":"bottom center",children:Object(A.jsx)(w.a,{inverted:!0,color:"black",name:m+" slash"})});t.available&&(g=Object(A.jsx)(U.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||a.appState.darkMode,icon:!0,"data-tooltip":"Available","data-position":"bottom center",children:Object(A.jsx)(w.a,{inverted:!0,color:"green",name:m})})),t.connecting&&(g=Object(A.jsx)(U.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||a.appState.darkMode,icon:!0,"data-tooltip":"Connecting","data-position":"bottom center",children:Object(A.jsx)(w.a,{inverted:!0,loading:!0,name:"spinner"})})),t.connected&&(g=Object(A.jsx)(U.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||a.appState.darkMode,icon:!0,"data-tooltip":"Streaming","data-position":"bottom center",children:Object(A.jsx)(w.a,{inverted:!0,name:m})})),t.connected&&!t.available&&(g=Object(A.jsx)(U.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||a.appState.darkMode,icon:!0,"data-tooltip":"Terminated","data-position":"bottom center",children:Object(A.jsx)(w.a,{inverted:!0,color:"orange",name:m})}));var b=Object(A.jsx)(A.Fragment,{});a.room.videoOffline&&(t.available||t.connected||(b=Object(A.jsx)("source",{src:a.room.videoOffline,type:"video/mp4"})));var f="",j="";return a.appState.minMode||(f=Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(U.a,{compact:!0,name:"gotAudio",size:"small",inverted:!0,icon:!0,"data-tooltip":t.gotAudio?o("Receiving Audio"):o("No Audio"),"data-position":"bottom center",children:Object(A.jsx)(w.a,{inverted:!0,name:t.gotAudio?"microphone":"microphone slash"})})," ",Object(A.jsx)(U.a,{compact:!0,name:"gotVideo",size:"small",inverted:!0,icon:!0,"data-tooltip":t.gotVideo?o("Receiving Video"):o("No Video"),"data-position":"bottom center",children:Object(A.jsx)(w.a,{inverted:!0,name:t.gotVideo?"video":"eye slash"})})]}),j=Object(A.jsx)(U.a,{compact:!0,name:"fullscreen",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":o("Enter Fullscreen"),"data-position":"bottom center",children:Object(A.jsx)(w.a,{name:"expand"})})),this.audioInterface?Object(A.jsx)("div",{className:"panel",ref:function(t){return e.state.container=t},children:Object(A.jsx)(W.a,{children:Object(A.jsxs)(W.a.Group,{inline:!0,children:[Object(A.jsx)(W.a.Field,{inline:!0,children:Object(A.jsx)(w.a,{inverted:a.appState.darkMode,name:"volume up"})}),Object(A.jsx)(W.a.Field,{children:Object(A.jsxs)(U.a,{compact:!0,name:"mute",size:"small",inverted:a.appState.darkMode,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":t.videoMuted?o("Enable Audio"):o("Mute"),"data-position":"bottom center",children:[Object(A.jsx)(w.a,{name:t.videoMuted?"volume off":"volume up"})," ",t.videoMutedMessage]})}),Object(A.jsx)(W.a.Field,{children:Object(A.jsx)("audio",{style:{borderRadius:"3px",padding:"2px",margin:"2px"},id:"remoteVideo",poster:a.room.snapshot,ref:this.remoteVideo,className:"remoteVideo",muted:t.videoMuted,autoPlay:!0,loop:!0,playsInline:!0,onLoadedData:this.onLoadedData})}),Object(A.jsx)(W.a.Field,{children:Object(A.jsxs)(U.a,{compact:!0,size:"small",name:"reload",onClick:this.onClick.bind(this),loading:t.buttonDisabled,disabled:t.buttonDisabled,icon:!0,labelPosition:"right",inverted:a.appState.darkMode,children:[Object(A.jsx)(w.a,{name:"redo"}),t.buttonContent]})}),Object(A.jsx)(W.a.Field,{inline:!0,children:v}),Object(A.jsx)(W.a.Field,{inline:!0,children:Object(A.jsxs)(R.a,{size:"tiny",children:[Object(A.jsx)(w.a,{name:"user"}),this.streamInfo.userName," ",t.connected?t.bitrateInfo:Object(A.jsxs)(A.Fragment,{children:[Object(A.jsx)(w.a,{name:"eye slash"}),"Not Streaming"]})]})})]})})}):Object(A.jsxs)("div",{className:"panel",ref:function(t){return e.state.container=t},children:[Object(A.jsx)("div",{className:"backgroundVideo",children:Object(A.jsx)("video",{style:s,id:"remoteVideo",poster:a.room.snapshot,ref:this.remoteVideo,className:"remoteVideo",muted:t.videoMuted,autoPlay:!0,loop:!0,playsInline:!0,controls:t.settingsActive,onLoadedData:this.onLoadedData,onLoadedMetadata:function(){return e.updateVideoSize("loadedmetadata")},children:b})}),Object(A.jsxs)("div",{className:"controlsIcons",children:[v,g,f,Object(A.jsx)(U.a,{compact:!0,name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:t.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":o("Toggle Controls"),"data-position":"bottom center",children:Object(A.jsx)(w.a,{name:"setting"})}),Object(A.jsxs)(U.a,{compact:!0,name:"mute",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":t.videoMuted?o("Enable Audio"):o("Mute"),"data-position":"bottom center",children:[Object(A.jsx)(w.a,{name:t.videoMuted?"volume off":"volume up"})," ",t.videoMutedMessage]}),j]}),u]})}},{key:"onClick",value:function(e,t){var o=t.name,s=t.value,i=this.txt;if("reload"==o)switch(this.state.buttonContent){case i("Tap to Play"):this.remoteVideo.current.play(),this.state.connected?this.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:"Reload",videoMuted:"",videoMutedMessage:""}):this.state.connecting?this.setState({statusInfo:"Preview. Connecting...",videoMuted:"",videoMutedMessage:""}):this.setState({statusInfo:"Preview",buttonContent:i("Reload"),videoMuted:"",videoMutedMessage:""});break;case i("Reload"):this.setState({buttonDisabled:!0,buttonContent:i("Reloading"),connecting:!0,connected:!1}),this.stopStreamPlay(),this.startStreamPlay()}if("fullscreen"==o){this.state.fullscreen;e.preventDefault(),this.requestFullscreen(this.remoteVideo.current)}"mute"==o&&(this.state.videoMuted&&(this.remoteVideo.current.muted=!1),this.setState({videoMuted:!this.state.videoMuted,videoMutedMessage:""})),Object(V.a)(Object(E.a)(a.prototype),"onClick",this).call(this,e,{name:o,value:s})}},{key:"retryIfTimeout",value:function(){this.state.connected||this.playStarted||this.retriesLeft>0&&(this.devMode&&console.log("components/Video retryIfTimeout #",this.retriesLeft),this.retriesLeft--,this.stopStreamPlay(),this.setState({buttonDisabled:!0,buttonContent:"Auto Retry...",connecting:!0,connected:!1}),this.startStreamPlay()),this.retryIfTimeoutSet=!1}},{key:"requestFullscreen",value:function(e){var t=!0;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1),this.setState({fullscreen:t})}},{key:"streamInfoReset",value:function(){var e,t=this.props,a=this.state;(this.streamInfo={applicationName:t.config.application,streamName:t.room.streamPlayback,userName:"",sessionId:"[empty]"},t.room.users)&&(t.content?(e=t.room.users[t.content.userID])&&(this.streamInfo.streamName=t.content.stream):(e=t.room.users[t.room.streamUID])&&(this.streamInfo.streamName=t.room.streamPlayback),e&&(this.streamInfo.userName=e.userName,e.meta&&e.meta.connected&&e.sdate<e.meta.connectedUpdate&&(a.available=!0),this.streamInfo.userName=e.userName))}},{key:"wsConnect",value:function(){var e=this,t=this.props;if(this.state.connected)console.log("components/Video wsConnect: already connected, skip");else{if(this.props.appState.wsOpen)return this.devMode&&console.log("components/Video wsConnect:  websocket busy,  retry later",this.props.appState.wsComponent," waited: "+this.wsWaited,this.wsConnection),this.wsConnection&&this.wsConnection.readyState<3&&(this.wsWaited>1?(this.wsConnection.close(),this.peerConnection&&this.peerConnection.close(),this.wsWaited=0):this.wsWaited++),void setTimeout((function(){return e.wsConnect()}),2e3);this.props.appStateUpdate({wsOpen:!0,wsComponent:"Video"}),this.userData={param1:"value1",videowhisper:"webrtc-playback"},this.wsConnection&&this.wsConnection.readyState<3&&(console.log("components/Video wsConnect previous websocket (close)",this.wsConnection),this.wsConnection.close(),this.peerConnection&&this.peerConnection.close()),this.wsConnection=new WebSocket(t.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsConnection.onmessage=function(t){return e.onmessage(t)},this.wsConnection.onclose=function(){e.devMode&&console.log("components/Video wsConnection.onclose"),e.props.appStateUpdate({wsOpen:!1})},this.wsConnection.onerror=function(e){console.log("components/Video ERROR wsConnection.onerror: "+JSON.stringify(e,["message","arguments","type","name"]))}}}},{key:"peerCreateAnswer",value:function(){this.state;this.devMode&&console.log("components/Video peerCreateAnswer"),this.peerConnection.createAnswer().then(this.gotDescription.bind(this)).catch(this.errorHandler.bind(this))}},{key:"errorHandler",value:function(e){console.log(e)}},{key:"icecandidate",value:function(){var e=Object(ke.a)(Object(ye.a)().mark((function e(t,a){return Object(ye.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.devMode&&console.log("components/Video icecandidate (gotIceCandidate):",a);try{this.onAddIceCandidateSuccess(t)}catch(o){this.onAddIceCandidateError(t,o)}case 2:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onAddIceCandidateSuccess",value:function(e){this.devMode&&console.log("components/Video onAddIceCandidateSuccess success",e)}},{key:"onAddIceCandidateError",value:function(e,t){this.devMode&&console.log("components/Video onAddIceCandidateError failed to add ICE Candidate: ".concat(t))}},{key:"onsignalingstatechange",value:function(){var e,t=this;this._isMounted&&(this.peerConnection&&(e=this.peerConnection.signalingState,this.devMode&&console.log("components/Video onsignalingstatechange , state: ".concat(e),this.retryTimeout),"have-remote-offer"!=e&&"stable"!=e||(this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload")}),this.props.appStateUpdate({videoStatus:"pending"}),this.retryIfTimeoutSet||(setTimeout((function(){return t.retryIfTimeout()}),this.retryTimeout),this.retryIfTimeoutSet=!0))))}},{key:"videoPlay",value:function(){var e=this,t=this.remoteVideo.current,a=this.txt;this.playStarted=!1,t&&t.play().then((function(o){e.devMode&&console.log("components/Video Autoplay started accept/paused/src",o,t.paused,t.src),e.playStarted=!0,e.props.appState.muted&&e.props.appStateUpdate({muted:!1}),e.state.connected?e.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:a("Reload"),connecting:!1}):e.state.connecting?e.setState({statusInfo:"Preview. Connecting...",settingsActive:!0,buttonDisabled:!0,buttonContent:"Connecting"}):e.setState({statusInfo:"Preview",buttonDisabled:!1,buttonContent:a("Reload")})}),(function(o){console.log("components/Video Autoplay reject:"+o,o,t.src),e.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:a("Tap to Play"),videoMuted:"",videoMutedMessage:""})})).catch((function(t){console.log("components/Video Autoplay error:"+t,t),e.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:a("Tap to Play")})}))}},{key:"updatedConnection",value:function(e){var t=this,a=this.state,o=this.txt;a.connected||"connected"==e&&(this.setState({connected:!0,connecting:!1}),this.videoPlay()),a.connected&&("disconnected"!=e&&"failed"!=e&&"closed"!=e||("1"===this.props.config.videoAutoPlay&&(a.retrying||setTimeout((function(){a.retrying=!0,t.stopStreamPlay(),t.startStreamPlay(),t.setState({statusInfo:e,buttonDisabled:!0,buttonContent:o("Auto Retry")})}),3300)),this.setState({settingsActive:!0,connected:!1,connecting:!1,buttonDisabled:!1,buttonContent:o("Reload")})))}},{key:"onconnectionstatechange",value:function(){if(this.peerConnection){var e=this.peerConnection.connectionState;this.devMode&&console.log("components/Video onconnectionstatechange:",e),this.updatedConnection(e)}}},{key:"iceconnectionstatechange",value:function(e,t){var a;e&&(a=e.iceConnectionState,this.devMode&&console.log("components/Video iceconnectionstatechange: ".concat(e.iceConnectionState),t),this.updatedConnection(a))}},{key:"track",value:function(e){this.state;var t=this.remoteVideo.current;this.devMode&&console.log("components/Video peer track (gotRemoteTrack) kind:"+e.track.kind+" stream:"+e.streams[0]),t.srcObject!==e.streams[0]&&(t.srcObject=e.streams[0],this.devMode&&console.log("components/Video peer track: playback peer received new remote stream"))}},{key:"sendPlayGetOffer",value:function(){var e=this;this.devMode&&console.log("components/Video sendPlayGetOffer: "+JSON.stringify(this.streamInfo),"wsConnection:",this.wsConnection),this.state.connected&&this.playStarted&&this.devMode&&console.log("components/Video sendPlayGetOffer: playStarted skip"),this.wsConnection&&(1===this.wsConnection.readyState?(this.wsConnection.send('{"direction":"play", "command":"getOffer", "streamInfo":'+JSON.stringify(this.streamInfo)+', "userData":'+JSON.stringify(this.userData)+"}"),this.setState({statusInfo:"Starting Playback",buttonDisabled:!1,buttonContent:this.txt("Reload"),gotVideo:!1,gotAudio:!1})):(console.log("components/Video sendPlayGetOffer wsConnection not ready to .send",this.wsConnection),this.setState({statusInfo:"Not Ready",buttonDisabled:!1,buttonContent:this.txt("Reload"),gotVideo:!1,gotAudio:!1}))),this.retryIfTimeoutSet||(setTimeout((function(){return e.retryIfTimeout()}),this.retryTimeout),this.retryIfTimeoutSet=!0)}},{key:"startStreamPlay",value:function(){this.devMode=this.props.appState.devMode,this.devMode&&console.log("components/Video startStreamPlay"),this.state.retryCount=0,this.wsWaited=0,this.state.connecting=!0,this.wsConnect(),this.timerStart()}},{key:"stopStreamPlay",value:function(){this.devMode&&console.log("components/Video stopStreamPlay"),this.timerStop();var e=this.remoteVideo.current,t=this.props;this.peerConnection&&this.peerConnection.close(),this.wsConnection&&this.wsConnection.close(),e&&(e.src==t.room.videoOffline&&t.room.videoOffline||(e.src="")),this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload"),connecting:!1,connected:!1,gotVideo:!1,gotAudio:!1}),this.playStarted=!1}},{key:"gotDescription",value:function(e){var t=this;this.devMode&&console.log("components/Video gotDescription sdp"+JSON.stringify({sdp:e})),this.peerConnection.setLocalDescription(e).then((function(){t.wsConnection.send('{"direction":"play", "command":"sendResponse", "streamInfo":'+JSON.stringify(t.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(t.userData)+"}")})).catch((function(e){console.log("components/Video gotDescription, setLocalDescription error",e)}))}}]),a}(H);Ce.propTypes={config:B.a.object.isRequired,room:B.a.object.isRequired,appState:B.a.object.isRequired,appStateUpdate:B.a.func.isRequired,content:B.a.object,meta:B.a.string,videoConfig:B.a.object};var Me=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutPlayback",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layVideo",children:Object(A.jsx)(Ce,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room})}),Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layHistory",children:Object(A.jsx)(ge,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(A.jsx)("div",{className:"laySend",children:Object(A.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),Ue=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutPlaybackAudio",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layHistory",children:Object(A.jsx)(ge,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(A.jsx)("div",{className:"laySend",children:Object(A.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layVideo",children:Object(A.jsx)(Ce,{videoConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room})}),Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),we=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return this.componentActions=s.a.createRef(),Object(A.jsxs)("div",{className:"layoutWay2",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layVideo",children:Object(A.jsx)(Ce,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room})}),Object(A.jsx)("div",{className:"layCamera",children:Object(A.jsx)(z,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layHistory",children:Object(A.jsx)(ge,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"laySend",children:Object(A.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),Re=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return this.componentActions=s.a.createRef(),Object(A.jsxs)("div",{className:"layoutWay2Audio",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layVideo",children:Object(A.jsx)(Ce,{videoConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room})}),Object(A.jsx)("div",{className:"layCamera",children:Object(A.jsx)(z,{cameraConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layHistory",children:Object(A.jsx)(ge,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"laySend",children:Object(A.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),Ie=a(155),De=a.n(Ie),Ne=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).playerError=function(e){console.log("containers/Media playerError",e)},o.state={placement:e.placement,meta:e.meta,panelType:"Media",mediaWidth:0,mediaHeight:1,mediaStyle:{position:"absolute",width:"100%",height:"100%"},mediaAspectRatio:1},o.devMode=e.appState.devMode,o.mediaContent=s.a.createRef(),o.extensionsImg=["jpg","jpeg","jfif","pjpeg","pjp","gif","ico","cur","bmp","png","svg"],o.extensionsVideo=["mp4","webm","ogg"],o.extensionsAudio=["mp3"],o.devMode&&console.log("containers/Media constructor",e),o}return Object(y.a)(a,[{key:"updateMediaSize",value:function(e){var t=this.state;t.mediaHeight||(t.mediaHeight=1),t.mediaAspectRatio=t.mediaWidth/t.mediaHeight;var a=t.mediaWidth,o=t.mediaHeight,s=0,i=0;t.width&&t.aspectRatio&&t.mediaAspectRatio&&(t.mediaAspectRatio>t.aspectRatio?(o=(a=t.width)/t.mediaAspectRatio,i=(t.height-o)/2):(a=(o=t.height)*t.mediaAspectRatio,s=(t.width-a)/2));var n={position:"absolute",left:s,top:i,width:a,height:o,border:"solid 1px #555"};this.setState({mediaStyle:n}),this.devMode&&console.log("containers/Media updateMediaSize",e,t.aspectRatio,t.mediaAspectRatio,n,t)}},{key:"onImgLoad",value:function(e){var t=e.target;this.state.mediaWidth=t.naturalWidth,this.state.mediaHeight=t.naturalHeight,this.devMode&&console.log("containers/Media onImgLoad",t.naturalWidth,t.naturalHeight),this.updateMediaSize("img")}},{key:"onVideoLoadedMetadata",value:function(e){var t=e.target;this.state.mediaWidth=t.videoWidth,this.state.mediaHeight=t.videoHeight,this.devMode&&console.log("containers/Media onVideoLoadedMetadata",t.videoWidth,t.videoHeight),this.updateMediaSize("video")}},{key:"render",value:function(){var e=this,t=this.state,a=this.props,o=Object(A.jsxs)(N.a,{className:a.appState.className,children:[a.placement," / ",a.type," - No Content."]});if(a.placement&&a.appState.media){var s=a.appState.media[a.placement];if(s)switch(s.placement=a.meta+" "+a.placement,s.type){case"user":if(a.room.users){var i,n,r=!1;(n=a.content?a.room.users[s.userID]:a.room.users[a.room.streamUID])&&n.meta&&n.meta.external&&(r=!0,n.meta.connected&&n.meta.connectedUpdate>n.meta.externalUpdate&&(r=!1)),r&&(o=n.hls?Object(A.jsx)(De.a,{style:t.mediaStyle,ref:this.mediaContent,url:n.hls,muted:a.appState.muted,playing:!0,controls:!0,playsinline:!0,width:"100%",height:"100%",onError:this.playerError.bind(this)}):Object(A.jsxs)(N.a,(i={className:a.appState.className},Object(P.a)(i,"className",a.appState.className),Object(P.a)(i,"children",[a.placement," - HLS not available for user #",s.userID]),i))),r||(o=Object(A.jsx)(Ce,{appState:a.appState,appStateUpdate:a.appStateUpdate,config:a.config,room:a.room,content:s,meta:a.meta}))}break;case"stream":case"video":o=Object(A.jsx)(Ce,{appState:a.appState,appStateUpdate:a.appStateUpdate,config:a.config,room:a.room,content:s,meta:a.meta});break;case"hls":o=Object(A.jsx)(De.a,{style:t.mediaStyle,ref:this.mediaContent,url:s.url,muted:a.appState.muted,playing:!0,controls:!0,playsinline:!0,width:"100%",height:"100%",onError:this.playerError.bind(this)});break;case"file":o=this.extensionsImg.includes(s.ext)?Object(A.jsx)("img",{style:t.mediaStyle,ref:this.mediaContent,onLoad:this.onImgLoad.bind(this),src:s.url}):this.extensionsVideo.includes(s.ext)||this.extensionsAudio.includes(s.ext)?Object(A.jsx)(De.a,{style:t.mediaStyle,ref:this.mediaContent,url:s.url,playing:!0,controls:!0,playsinline:!0,loop:!0,onError:this.playerError.bind(this),width:"100%",height:"100%"}):Object(A.jsxs)(N.a,{className:a.appState.className,children:[this.txt("File"),": ",Object(A.jsx)("b",{children:s.name})," (",s.userName,")",Object(A.jsx)(ee.a,{})," ",Object(A.jsxs)(U.a,{className:a.appState.className,icon:!0,labelPosition:"right",target:"_blank",href:s.url,children:[" ",this.txt("Open")," ",Object(A.jsx)(w.a,{size:"large",name:"folder open"})," "]})," "]});break;case"empty":o=Object(A.jsxs)(N.a,{className:a.appState.className,children:[Object(A.jsxs)(D.a,{children:[a.placement,": Empty Content Area"]})," Room owner can assign content or adjust number of content areas."]});break;default:o=Object(A.jsxs)(N.a,{className:a.appState.className,children:[a.placement," - Unknown type: ",s.type," / ",a.type]})}}return Object(A.jsx)("div",{className:"panel",ref:function(t){return e.state.container=t},children:o})}}]),a}(H);Ne.propTypes={placement:B.a.string.isRequired,meta:B.a.string.isRequired,type:B.a.string.isRequired,appState:B.a.object.isRequired,appStateUpdate:B.a.func.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired};var Ae=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).state={panelType:"Multimedia"},o.devMode=e.appState.devMode,o.mediaItems=1,o.devMode&&console.log("containers/Multimedia constructor",e),o}return Object(y.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=this.props,o=[],s=Object.keys(this.props.appState.media).length,i=0;for(var n in this.props.appState.media){var r=a.appState.media[a.placement],c="none";if(r&&(c=r.type),"user"==c&&a.room.users){var d=a.room.users[r.userID],l=!1;d&&d.meta&&d.meta.external&&(l=!0,d.meta.connected&&d.meta.connectedUpdate>d.meta.externalUpdate&&(l=!1)),l&&(c="hls")}o.push(Object(A.jsx)("div",{className:"slot"+i,children:Object(A.jsx)(Ne,{appState:a.appState,appStateUpdate:a.appStateUpdate,config:a.config,room:a.room,user:a.user,placement:n,type:c,meta:i+"/"+s})},"slot_"+n)),i++}this.mediaItems=i;var p="V";t.aspectRatio>1.77&&(p="H");var m="panel split0";return this.mediaItems>1&&(m="panel split"+p+this.mediaItems),Object(A.jsx)("div",{className:m,ref:function(t){return e.state.container=t},children:o})}}]),a}(H);Ae.propTypes={appState:B.a.object.isRequired,appStateUpdate:B.a.func.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired};var Te=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(){return Object(O.a)(this,a),t.apply(this,arguments)}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutChat",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layHistory",children:Object(A.jsx)(ge,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(A.jsx)("div",{className:"laySend",children:Object(A.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]},"layoutChat")}}]),a}(o.Component),Le=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).copyToClipboard=function(e){console.log("components/Broadcast copyToClipboard",e.target.value),e.target.select(),navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(e.target.value)},o.state={},o.devMode=e.appState.devMode,o.devMode&&console.log("components/Broadcast constructor room:",e.room),o}return Object(y.a)(a,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Broadcast componentWillUnmount")}},{key:"onClick",value:function(e,t){var a=t.name,o=t.value;this.devMode&&console.log("components/Broadcast onClick",a,o,e);this.state,this.props;if("closed"===a)this.props.serverUpdate({task:"external",external:!1})}},{key:"render",value:function(){var e=this.props,t=this.txt,a=[];if(e.room.broadcastSettings){for(var o in e.room.broadcastSettings)if("meta"!==o){var s=e.room.broadcastSettings[o],i=[];for(var n in s.fields){var r=s.fields[n];switch(r.type){case"text":i.push(Object(A.jsxs)(W.a.Field,{children:[Object(A.jsx)("label",{children:r.description}),Object(A.jsxs)(X.a,{fluid:!0,readOnly:!0,onClick:this.copyToClipboard,iconPosition:"left",defaultValue:r.value,children:[Object(A.jsx)(w.a,{name:"copy"}),Object(A.jsx)("input",{})]}),Object(A.jsx)("br",{}),Object(A.jsx)("small",{children:r.details})]},r.name));break;case"link":i.push(Object(A.jsxs)(W.a.Field,{children:[Object(A.jsxs)(U.a,{className:e.appState.className,size:"small",name:r.name,color:r.color?r.color:"blue",target:"_blank",href:r.url,children:[Object(A.jsx)(w.a,{name:r.icon?r.icon:"cloud download"})," ",r.description]}),Object(A.jsx)("br",{}),Object(A.jsx)("small",{children:r.details})]},r.name))}}a.push(Object(A.jsxs)("div",{children:[Object(A.jsx)(D.a,{className:e.appState.className,as:"h4",children:s.name}),s.details,Object(A.jsx)(ee.a,{}),Object(A.jsx)(W.a,{className:e.appState.className,children:i}),Object(A.jsx)(ee.a,{hidden:!0})]},o))}}else a.push(Object(A.jsx)("p",{children:"No broadcast settings available"}));var c="User list not available.",d=!1;if(e.room.users){var l;e.room?(l=e.room.users[e.user.ID],c="User info available."):c="Not in user list.";var p=t("Not Available");l&&l.meta&&l.meta.external&&(p="Started",d=!0,l.meta.connected&&l.meta.connectedUpdate>l.meta.externalUpdate&&(d=!1,p="Web Broadcast More Recent")),d&&(c=l.hls?t("Streaming"):"HLS not available."),d||(c=p)}var m=d?Object(A.jsxs)("div",{children:[" ",Object(A.jsxs)(U.a,{className:e.appState.className,icon:!0,size:"small",name:"closed",color:"red",onClick:this.onClick.bind(this),children:[Object(A.jsx)(w.a,{name:"close"})," ",t("Closed")]})," ",Object(A.jsx)("small",{children:t("Use after ending external broadcast, to faster restore web based webcam interface.")})," "]},"closed"):"";return Object(A.jsx)("div",{className:"layoutScrollable",style:{backgroundColor:e.appState.backgroundColor},children:Object(A.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:Object(A.jsxs)(N.a,{className:e.appState.className,children:[Object(A.jsx)(D.a,{className:e.appState.className,as:"h4",children:t("External Broadcast")}),Object(A.jsx)(R.a,{color:d?"green":"yellow",children:c}),m,Object(A.jsxs)("small",{children:[Object(A.jsx)("br",{}),e.room.broadcastSettings.meta.description?e.room.broadcastSettings.meta.description:t("External Broadcast")]}),Object(A.jsx)(ee.a,{}),a]})},"layBroadcast")},"layoutBroadcastScroll")}}]),a}(H);Le.propTypes={appState:B.a.object.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,serverUpdate:B.a.func.isRequired};var Pe=a(353),Ve=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).userClick=function(e){return function(t,a){if(console.log("components/User userClick",e,a,t),e&&a.action)switch(a.action){case"profile":var s={file:e.url};window.open(s.file);break;case"presentation":o.props.serverUpdate({task:"user_presentation",userID:e.userID,userName:e.userName,placement:a.placement});break;case"kick":o.props.serverUpdate({task:"user_kick",userID:e.userID,userName:e.userName});break;case"ban":o.props.serverUpdate({task:"user_ban",userID:e.userID,userName:e.userName})}}},o.state={},o.devMode=e.appState.devMode,o.data=[],o.usersLeft=[],o.usersJoined=[],o.userCount=0,o.scrollableRef=s.a.createRef(),e.room.users&&(o.data=ne.a.sortBy(e.room.users,"order")),o.devMode&&console.log("components/Users constructor room:",e.room),o}return Object(y.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){console.log("components/Users componentWillUnmount")}},{key:"shouldComponentUpdate",value:function(e,t){return ne.a.isEqual(e.room.users,this.props.room.users)||(this.data=ne.a.sortBy(e.room.users,"order")),!0}},{key:"render",value:function(){var e,t,a=this.props,o=(this.state,this.txt);this.devMode=a.appState.devMode;var s=[],i=0;if(t=this.props.room.usersMenu?Object(A.jsx)(N.a,{className:a.appState.className,children:"Users Menu"}):"",this.data)for(var n in this.data)if(this.data[n].hasOwnProperty("userID")){var r=this.data[n];if(r&&r.userName&&!r.hide){var c=r.userID;i++;var d=[];if(d.push({key:"usermenuProfile_"+c,onClick:this.userClick(r),icon:"address card",text:o("Profile"),action:"profile"}),this.props.room.usersPresentation)for(var l in this.props.appState.media)d.push({key:"usermenuPresentation_"+l+c,onClick:this.userClick(r),icon:"pointing left",text:o("Show")+": "+l,action:"presentation",placement:l});var p=Object(A.jsx)(q.a,{compact:!0,text:r.userName,options:d,className:a.appState.className+" v-select"},"usermenu"+c);this.props.room.usersModerator&&(d.push({key:"usermenuKick_"+c,onClick:this.userClick(r),icon:"sign-out",text:o("Kick"),action:"kick"}),d.push({key:"usermenuBan_"+c,onClick:this.userClick(r),icon:"ban",text:o("Ban"),action:"ban"}));var m=!1;r.meta&&r.meta.external&&(m=!0,r.meta.connected&&r.meta.connectedUpdate>r.meta.externalUpdate&&(m=!1));var h=Object(A.jsxs)("span",{children:[Object(A.jsx)(Y.a,{src:r.avatar,rounded:!0,size:"mini",verticalAlign:"middle"}),r.userName===a.room.performer?Object(A.jsx)(w.a,{name:"star"}):"",r.flag&&a.config.multilanguage?Object(A.jsx)(Q.a,{name:r.flag}):"",r.meta.connected?Object(A.jsx)(w.a,{name:"video"}):"",m?Object(A.jsx)(w.a,{name:"rss"}):"",p]});s.push(Object(A.jsx)(Pe.a.Row,{children:Object(A.jsx)(Pe.a.Cell,{children:h})},"userRow"+c))}}else console.log("components/Users missing userID",n,this.data);else s=Object(A.jsx)(Pe.a.Row,{children:Object(A.jsx)(Pe.a.Cell,{colSpan:"1",warning:!0,children:"No users."})},"No_Users");return e=Object(A.jsx)(Pe.a,{celled:!0,selectable:!0,sortable:!0,className:a.appState.className,children:Object(A.jsx)(Pe.a.Body,{children:s})},"User_Pane"),this.userCount=i,Object(A.jsxs)("div",{className:"layoutList",style:{backgroundColor:a.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:e},"layScrollable"),Object(A.jsx)("div",{className:"layMenu",children:t})]},"layoutList")}},{key:"componentDidUpdate",value:function(e,t,a){}}]),a}(H);Ve.propTypes={appState:B.a.object.isRequired,appStateUpdate:B.a.func.isRequired,appSfx:B.a.func.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,serverUpdate:B.a.func.isRequired};var Ee=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).handleSort=function(e){return function(){o.sortBy(e,!1)}},o.fileClick=function(e){return function(t,a){if(console.log("components/Files fileClick",e,a,t),e&&a.action)switch(a.action){case"open":var s={file:e.url};window.open(s.file);break;case"delete":o.props.serverUpdate({task:"file_delete",file_name:e.name});break;case"presentation":o.props.serverUpdate({task:"file_presentation",file_name:e.name,placement:a.placement})}}},o.onDrop=function(e){var t=Object(k.a)(o).props;if(t.config.serverURL){var a=ae.a.post(t.config.serverURL);a.field("task","file_upload"),a.field("VideoWhisper[userID]",t.user.ID),a.field("VideoWhisper[sessionID]",t.user.sessionID),a.field("VideoWhisper[sessionKey]",t.user.sessionKey),t.room.ID?(a.field("VideoWhisper[roomID]",t.room.ID),a.field("VideoWhisper[privateUID]",t.room.privateUID)):console.log("components/Files onDrop room",t.room,t.user,t.config.serverURL);var s=[];e.forEach((function(e){a.attach(e.name,e,e.name),s.push(e.name)})),a.field("files[]",s),a.then(o.uploadCompleted.bind(Object(k.a)(o))),console.log("components/Files onDrop",e,a),o.setState({uploading:!0})}else console.log("components/Files onDrop missing serverURL",t.config.serverURL,t.config)},o.state={column:null,data:null,direction:null,uploading:!1},o.devMode=e.appState.devMode,o.scrollableRef=s.a.createRef(),o.fileInputRef=s.a.createRef(),e.room.files&&(o.state.data=e.room.files),o.devMode&&console.log("components/Files constructor room:",e.room),o}return Object(y.a)(a,[{key:"sortBy",value:function(e,t){t&&(this.state.column=null,this.state.direction=null);var a=this.state,o=a.column,s=a.data,i=a.direction;if(s){var n="age"==e?"time":e;console.log("components/Files handleSort",e,n,i,t),o===e?this.setState({data:"descending"===i?ne.a.sortBy(s,[n]):ne.a.sortBy(s,[n]).reverse(),direction:"ascending"===i?"descending":"ascending"}):this.setState({column:e,data:ne.a.sortBy(s,[n]).reverse(),direction:"descending"})}}},{key:"componentDidMount",value:function(){this.sortBy("age",!0)}},{key:"componentWillUnmount",value:function(){console.log("components/Files  componentWillUnmount")}},{key:"shouldComponentUpdate",value:function(e,t){return ne.a.isEqual(e.room.files,this.props.room.files)||(this.state.data=e.room.files,this.sortBy("age",!0)),!0}},{key:"uploadCompleted",value:function(e){console.log("components/Files uploadCompleted",e),this.props.serverUpdate({task:"update",update:"files"}),this.setState({uploading:!1})}},{key:"render",value:function(){var e,t,a,o=this,s=this.props,i=this.state,n=this.txt,r=this.state,c=r.column,d=r.data,l=r.direction;return a=this.props.room.filesUpload?Object(A.jsx)(re.a,{onDrop:this.onDrop,children:function(e){var t=e.getRootProps,a=e.getInputProps;return Object(A.jsx)(N.a,{className:s.appState.className,children:Object(A.jsxs)("div",Object(se.a)(Object(se.a)({},t()),{},{children:[Object(A.jsx)("input",Object(se.a)({},a())),Object(A.jsxs)("p",{children:[Object(A.jsx)(w.a,{name:"upload",loading:i.uploading})," ",i.uploading?n("Uploading. Please wait..."):n("Upload: Drag and drop files here, or click to select files")]})]}))})}}):"",t=d?d.map((function(e){var t=[];if(t.push({key:"filemenuOpen_"+e.name,onClick:o.fileClick(e),icon:"file",text:n("Open"),action:"open"}),o.props.room.filesDelete&&t.push({key:"filemenuDelete_"+e.name,onClick:o.fileClick(e),icon:"trash",text:n("Delete"),action:"delete"}),o.props.room.filesPresentation)for(var a in o.props.appState.media)t.push({key:"filemenuPresentation_"+a+e.name,onClick:o.fileClick(e),icon:"pointing left",text:n("Show")+": "+a,action:"presentation",placement:a});var i=Object(A.jsx)(q.a,{text:e.name,options:t,className:s.appState.className},"filemenu"+e.name);return Object(A.jsxs)(Pe.a.Row,{children:[Object(A.jsx)(Pe.a.Cell,{children:i}),Object(A.jsx)(Pe.a.Cell,{children:e.size}),Object(A.jsx)(Pe.a.Cell,{children:e.age})]},e.name)})):Object(A.jsx)(Pe.a.Row,{children:Object(A.jsx)(Pe.a.Cell,{colSpan:"3",warning:!0,children:"No files."})},"No_Files"),e=Object(A.jsxs)(Pe.a,{celled:!0,selectable:!0,striped:!0,sortable:!0,className:s.appState.className,children:[Object(A.jsx)(Pe.a.Header,{children:Object(A.jsxs)(Pe.a.Row,{children:[Object(A.jsx)(Pe.a.HeaderCell,{sorted:"name"===c?l:null,onClick:this.handleSort("name"),children:n("Name")}),Object(A.jsx)(Pe.a.HeaderCell,{sorted:"size"===c?l:null,onClick:this.handleSort("size"),children:n("Size")}),Object(A.jsx)(Pe.a.HeaderCell,{sorted:"age"===c?l:null,onClick:this.handleSort("age"),children:n("Age")})]})}),Object(A.jsx)(Pe.a.Body,{children:t})]},"File_Pane"),Object(A.jsxs)("div",{className:"layoutList",style:{backgroundColor:s.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:e},"layScrollable"),Object(A.jsx)("div",{className:"layMenu",children:a})]},"layoutList")}}]),a}(H);Ee.propTypes={appState:B.a.object.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,serverUpdate:B.a.func.isRequired};var We=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).state={},o.devMode=e.appState.devMode,o.devMode&&console.log("components/Presentation constructor room:",e.room),o}return Object(y.a)(a,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Presentation  componentWillUnmount")}},{key:"removeMedia",value:function(e,t){var a=t.name,o=t.value;this.devMode&&console.log("components/Presentation removeMedia",a,o,e),this.props.serverUpdate({task:"presentation_remove",placement:o})}},{key:"render",value:function(){var e=this.props,t=this.txt,a=[];if(e.appState.media)for(var o in e.appState.media){var s=e.appState.media[o],i="";if("stream"===s.type){var n=this.props.room.users[s.userID];n?n.meta&&(n.meta.connected||(i="Not Broadcasting")):i="Not Available"}a.push(Object(A.jsxs)("div",{children:[s.default?Object(A.jsx)(R.a,{pointing:"right",children:t("Default")}):"empty"===s.type?Object(A.jsx)(R.a,{pointing:"right",children:t("Empty")}):Object(A.jsxs)(U.a,{className:e.appState.className,size:"tiny",compact:!0,name:"removeMedia"+o,value:o,color:"red",onClick:this.removeMedia.bind(this),children:[" ",Object(A.jsx)(w.a,{name:"window close"}),"Remove"]},"removeMedia"+o),Object(A.jsx)("b",{children:o}),": ",s.type," ",Object(A.jsx)("i",{children:s.name})," ",i]},"presentationPlacement"+o))}return Object(A.jsx)("div",{className:"layScrollable",style:{backgroundColor:e.appState.backgroundColor},ref:this.scrollableRef,children:Object(A.jsxs)(N.a,{className:e.appState.className,children:[Object(A.jsxs)(D.a,{className:e.appState.className,as:"h4",children:[t("Media Displayed"),": ",e.room.name]}),Object(A.jsx)(ee.a,{}),a]})},"layPresentation")}}]),a}(H);We.propTypes={appState:B.a.object.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,serverUpdate:B.a.func.isRequired};var qe=a(359),Fe=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).state={panelType:"Options",time:0,updating:!1},o.devMode=e.appState.devMode,o.devMode&&console.log("components/Options constructor room:",e.room),o}return Object(y.a)(a,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Options componentWillUnmount")}},{key:"onChange",value:function(e,t){var a,o="checkbox"===t.type?t.checked:t.value,s=t.name;this.devMode&&console.log("Components/Options onChange",s,o,t),this.props.serverUpdate({task:"options",name:s,value:o}),s&&this.setState((a={},Object(P.a)(a,s,o),Object(P.a)(a,"updating",!0),a))}},{key:"render",value:function(){var e=this,t=this.props,a=this.state,o=[];if(t.room.options){for(var s in t.room.options)if("meta"!==s){var i=t.room.options[s],n=[];for(var r in i.fields){var c=i.fields[r];switch(c.type){case"toggle":n.push(Object(A.jsxs)(W.a.Field,{children:[Object(A.jsx)("label",{children:c.description}),Object(A.jsx)(qe.a,{name:c.name,"data-position":"right center",toggle:!0,disabled:a.updating,checked:a[c.name],onChange:function(t,a){return e.onChange(t,a)}}),Object(A.jsx)("br",{}),Object(A.jsx)("small",{children:c.details})]},c.name));break;case"dropdown":n.push(Object(A.jsx)(W.a.Group,{children:Object(A.jsxs)(W.a.Field,{children:[Object(A.jsx)("label",{children:c.description}),Object(A.jsx)(q.a,{name:c.name,selection:!0,compact:!0,className:t.appState.className+" v-select","data-position":"right center",value:a[c.name],disabled:a.updating,options:c.options,onChange:function(t,a){return e.onChange(t,a)}}),Object(A.jsx)("br",{}),Object(A.jsx)("small",{children:c.details})]})},c.name));break;default:n.push(Object(A.jsxs)("p",{children:[c.name," Unknown Type: ",c.type]},"noFields"))}}o.push(Object(A.jsxs)("div",{children:[Object(A.jsx)(D.a,{className:t.appState.className,as:"h4",children:i.name}),Object(A.jsx)(ee.a,{}),Object(A.jsx)(W.a,{className:t.appState.className,children:n}),Object(A.jsx)(ee.a,{hidden:!0})]},s))}}else o.push(Object(A.jsx)("p",{children:"No options"}));return Object(A.jsx)("div",{className:"layoutScrollable",style:{backgroundColor:t.appState.backgroundColor},children:Object(A.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:Object(A.jsx)(N.a,{className:t.appState.className,children:o})},"layOptions")},"layoutOptionsScroll")}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.room.options&&e.room.options.meta&&e.room.options.meta.time>t.time?(e.appState.devMode&&console.log("components/Options getDerivedStateFromProps",t),a.propsToOptions(e)):null}},{key:"propsToOptions",value:function(e){var t={};if(e.room.options)for(var a in e.room.options)if("meta"!==a){var o=e.room.options[a];for(var s in o.fields){var i=o.fields[s];i&&i.name&&(t[i.name]=i.value)}}return e.room.options&&e.room.options.meta&&(t.time=e.room.options.meta.time),t.updating=!1,e.appState.devMode&&console.log("components/Options propsToOptions",t),t}}]),a}(H);Fe.propTypes={appState:B.a.object.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,serverUpdate:B.a.func.isRequired};var Be=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).donationModalClose=function(){return o.setState({donationModal:!1})},o.formModalClose=function(){return o.setState({formModal:!1})},o.goalClick=function(e){return function(t,a){switch(console.log("components/Goals donateClick",e,a,t),a.action){case"donate":o.goal=e,o.index=a.ix,o.independent=!0,e&&o.setState({donationModal:!0});break;case"complete":o.props.serverUpdate({task:"goal_complete",goal:e,index:a.ix});break;case"delete":o.props.serverUpdate({task:"goal_delete",goal:e,index:a.ix})}}},o.onChange=function(e,t){var a="checkbox"===t.type?t.checked:t.value,s=t.name;o.devMode&&console.log("Components/Goals onChange",s,a,t);var i=a;"order"!=s&&"amount"!=s||(i=parseInt(a),isNaN(i)&&(i=0)),s&&o.setState(Object(P.a)({},s,i))},o.formSave=function(e,t){o.devMode&&console.log("Components/Goals formSave",t),o.props.serverUpdate({task:"goal_add",name:o.state.name,description:o.state.description,amount:o.state.amount,independent:o.state.independent,order:o.state.order}),o.setState({formModal:!1})},o.state={donationModal:!1,formModal:!1,tipLast:0,maxIndex:0,name:"",description:"",independent:!0,order:0,action:"Save"},o.devMode=e.appState.devMode,o.scrollableRef=s.a.createRef(),o.goal={name:"none",description:"none",independent:"false"},o.maxIndex=0,o.devMode&&console.log("components/Goals constructor room:",e.room),o}return Object(y.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){console.log("components/Goals componentWillUnmount")}},{key:"onClick",value:function(e,t){var a=t.name,o=t.value,s=(this.state,this.props);switch(this.devMode&&console.log("components/Goals onClick",a,o,e),a){case"tip":if("undefined"===typeof o)break;var i=parseInt(o);if(s.room.tips&&s.room.tipOptions.length>0&&s.room.tipOptions.length>i){var n=s.room.tipOptions[i];this.goal.independent?s.serverUpdate({task:"tip",tip:n,tipsURL:s.room.tipsURL,targetID:s.room.performerID,independent:this.goal.name,index:this.index}):s.serverUpdate({task:"tip",tip:n,tipsURL:s.room.tipsURL,targetID:s.room.performerID}),this.setState({donationModal:!1,tipLast:Date.now()}),console.log("components/Goals sending tip",n,i)}}}},{key:"menuClick",value:function(e,t){var a=t.action,o=this.state,s=this.props;switch(this.devMode&&console.log("components/Goals menuClick",a,o,s.room),a){case"add":this.setState({formModal:!0,action:this.txt("Add"),name:"",description:"",independent:!0,amount:10,order:this.maxIndex+1});break;case"sort":this.props.serverUpdate({task:"options",name:"goals_sort",value:!this.props.room.options.room.fields.goals_sort.value});break;case"reset":this.props.serverUpdate({task:"goals_reset"})}}},{key:"render",value:function(){var e=this,t=this.props,a=this.state,o=this.txt;this.devMode=t.appState.devMode,String.prototype.stripSlashes=function(){return this.replace(/\\(.)/gm,"$1")};var s=[],i="";this.props.room.options&&this.props.room.options&&this.props.room.options.room.fields.goals_sort&&(i=Object(A.jsxs)(U.a,{action:"sort",onClick:this.menuClick.bind(this),className:t.appState.className,size:"small",children:[" ",Object(A.jsx)(w.a,{name:this.props.room.options.room.fields.goals_sort.value?"sort amount down":"sort numeric down"})," ",o("Sort")]},"sort"));var n="";if(t.room.goalsManage&&(n=Object(A.jsxs)("div",{children:[" \xa0\xa0",Object(A.jsxs)(U.a,{action:"add",onClick:this.menuClick.bind(this),className:t.appState.className,size:"small",children:[" ",Object(A.jsx)(w.a,{name:"plus"})," ",o("Add")]},"addGoal"),i,Object(A.jsxs)(U.a,{action:"reset",color:"red",onClick:this.menuClick.bind(this),className:t.appState.className,size:"small",children:[" ",Object(A.jsx)(w.a,{name:"eraser"})," ",o("Reset All Contributions")]},"resetGoals")]},"goalMenu")),t.room.goals)for(var r in t.room.goals)if(t.room.goals[r].hasOwnProperty("name")){var c=t.room.goals[r];this.maxIndex<parseInt(c.ix)&&(this.maxIndex=parseInt(c.ix));var d=[];c&&c.name&&(t.room.goal&&(t.room.goal.name!=c.name||c.independent||d.push(Object(A.jsx)(U.a,{size:"tiny",action:"donate",ix:c.ix,onClick:this.goalClick(c),className:t.appState.className,disabled:Date.now()-a.tipLast<5e3,children:this.txt("Donate")},"donate"))),c.independent&&d.push(Object(A.jsxs)(U.a,{size:"tiny",action:"donate",ix:c.ix,onClick:this.goalClick(c),className:t.appState.className,disabled:Date.now()-a.tipLast<5e3,children:[Object(A.jsx)(w.a,{name:"gift"})," ",this.txt("Donate")]},"independent")),t.room.goalsComplete&&d.push(Object(A.jsxs)(U.a,{size:"tiny",action:"complete",ix:c.ix,onClick:this.goalClick(c),className:t.appState.className,children:[Object(A.jsx)(w.a,{name:"check"})," ",this.txt("Complete")]},"complete")),t.room.goalsManage&&d.push(Object(A.jsxs)(U.a,{size:"tiny",action:"delete",ix:c.ix,onClick:this.goalClick(c),className:t.appState.className,children:[Object(A.jsx)(w.a,{name:"remove"})," ",this.txt("Delete")]},"delete")),s.push(Object(A.jsxs)(N.a,{size:"small",className:t.appState.className,children:[Object(A.jsxs)(D.a,{as:"h4",children:["#",c.ix," ",c.name," ",Object(A.jsx)(w.a,{size:"small",name:c.independent?"random":"linkify"}),"  "]}),Object(A.jsx)(le.a,{className:t.appState.className,value:c.current,total:c.amount,indicating:!0,progress:"ratio",size:"small",children:c.description}),d]},"goal"+c.ix)))}else console.log("components/Goals missing name",r,this.data);else s=Object(A.jsx)(N.a,{children:"No goals."},"No_Users");var l,p,m=[];return t.room.tipOptions.length>0&&(p=0,l=Object(A.jsx)(A.Fragment,{children:t.room.tipOptions.map((function(a,s){if("TIP"===a.tag&&"custom"!==a.attributes.AMOUNT)return p++,Object(A.jsxs)(je.a.Column,{className:t.appState.className,textAlign:"center",children:[Object(A.jsxs)(D.a,{as:"h4",className:t.appState.className,children:[a.attributes.IMAGE?Object(A.jsx)(Y.a,{src:t.room.tipsURL+a.attributes.IMAGE,size:"mini",rounded:!0,verticalAlign:"middle"}):""," ",a.attributes.AMOUNT]}),Object(A.jsx)("b",{children:a.attributes.LABEL}),Object(A.jsx)("div",{children:a.attributes.NOTE}),Object(A.jsx)("div",{children:Object(A.jsx)(U.a,{compact:!0,className:t.appState.className,size:"small",color:"olive",name:"tip",value:s,onClick:e.onClick.bind(e),children:o("Gift")})})]},"tip"+s)}))})),m.push(Object(A.jsxs)(I.a,{closeIcon:!0,className:t.appState.className,open:a.donationModal,onClose:this.donationModalClose,size:"small",children:[Object(A.jsx)(D.a,{icon:"gift",content:o("Donate")}),Object(A.jsxs)(I.a.Content,{children:[Object(A.jsx)("h3",{children:this.goal.name}),this.goal.description,Object(A.jsx)(je.a,{className:t.appState.className,stackable:!0,centered:!0,divided:!0,columns:p,style:{overflow:"auto",maxHeight:180,maxWidth:480},children:l})]}),Object(A.jsx)(I.a.Actions,{children:Object(A.jsxs)(U.a,{color:"red",onClick:this.donationModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," ",o("Nevermind")]})})]},"donationModal")),m.push(Object(A.jsxs)(I.a,{closeIcon:!0,className:t.appState.className,open:a.formModal,onClose:this.formModalClose,size:"small",children:[Object(A.jsx)(D.a,{icon:t.config.goals_icon?t.config.goals_icon:"gift",content:a.action}),Object(A.jsx)(I.a.Content,{children:Object(A.jsxs)(W.a,{className:t.appState.className,children:[Object(A.jsxs)(W.a.Field,{children:[Object(A.jsx)("label",{children:o("Name")}),Object(A.jsx)(X.a,{inverted:t.appState.darkMode,name:"name",value:a.name,onChange:this.onChange,type:"text",placeholder:o("Name")})]}),Object(A.jsxs)(W.a.Field,{children:[Object(A.jsx)("label",{children:o("Description")}),Object(A.jsx)(X.a,{inverted:t.appState.darkMode,name:"description",value:a.description,onChange:this.onChange,type:"text",placeholder:o("Description")})]}),Object(A.jsxs)(W.a.Field,{children:[Object(A.jsxs)("label",{children:[o("Amount")," ",Object(A.jsx)(w.a,{name:"money"})]}),Object(A.jsx)(X.a,{inverted:t.appState.darkMode,name:"amount",value:String(a.amount),onChange:this.onChange,type:"text",placeholder:o("Amount")})]}),Object(A.jsxs)(W.a.Field,{children:[Object(A.jsxs)("label",{children:[o("Order")," ",Object(A.jsx)(w.a,{name:"sort numeric down"})," "]}),Object(A.jsx)(X.a,{inverted:t.appState.darkMode,name:"order",value:String(a.order),onChange:this.onChange,type:"text",placeholder:o("Order")})]}),Object(A.jsxs)(W.a.Field,{children:[Object(A.jsxs)("label",{children:[o("Independent")," ",Object(A.jsx)(w.a,{name:"random"})," "]}),Object(A.jsx)(qe.a,{name:"independent",toggle:!0,checked:a.independent,onChange:this.onChange})]})]})}),Object(A.jsxs)(I.a.Actions,{children:[Object(A.jsxs)(U.a,{color:"red",onClick:this.formModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," ",o("Nevermind")]}),Object(A.jsxs)(U.a,{color:"green",onClick:this.formSave,children:[Object(A.jsx)(w.a,{name:"send"})," ",a.action]})]})]},"formModal")),Object(A.jsxs)("div",{className:"layoutList",style:{backgroundColor:t.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:Object(A.jsx)(N.a.Group,{size:"small",children:s})},"layScrollable"),Object(A.jsx)("div",{className:"layMenu",children:n}),m]},"layoutList")}}]),a}(H);Be.propTypes={appState:B.a.object.isRequired,appStateUpdate:B.a.func.isRequired,appSfx:B.a.func.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,serverUpdate:B.a.func.isRequired};var He=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return t.config&&e in t.config.text?t.config.text[e]:e},o.scrollToBottom=function(){var e=o.refs.messageList,t=e.scrollHeight-e.clientHeight;n.a.findDOMNode(e).scrollTop=t>0?t:0},o.messageClick=function(e,t,a){o.devMode&&console.log("components/Messages messageClick",t,a,o.devMode,e),e.stopPropagation();var s=Object(k.a)(o).props;s.appState.messageSelected==t&&s.appState.messageUser==a||s.appStateUpdate({messageSelected:t,messageUser:a})},o.replyClick=function(e,t,a){},o.messageScroll=function(e,t){o.devMode&&console.log("components/Messages messageScroll",t,o.messageRefs[t]),e.stopPropagation(),o.messageRefs&&o.messageRefs[t]&&o.messageRefs[t].current&&o.messageRefs[t].current.scrollIntoView({behavior:"smooth",block:"start"})},o.sendReply=function(e){o.props.serverUpdate({task:"questions_message",message:e,messageSelected:o.props.appState.messageSelected}),o.devMode&&console.log("VideoWhisper/components/Messages sendReply:",e,o.props,o.state)},o.sendQuestion=function(e){o.props.serverUpdate({task:"questions_question",message:e}),o.devMode&&console.log("VideoWhisper/components/Messages sendQuestion:",e,o.props,o.state)},o.devMode=e.appState.devMode,o.messageRefs={},o.state={container:null},o}return Object(y.a)(a,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e=this,t=this.props;this.devMode=t.appState.devMode;var a,o=!1;(!t.appState.checked||t.appState.checked&&t.appState.mode.text)&&(o=!0);var i="",n=0,r=0;this.messageRefs={};var c="",d="chatMessage "+(t.darkMode?"dark ":"")+" notification automated";a=t.messages.length>0?Object(A.jsxs)("ul",{className:"chatMessageList",ref:"messageList",children:[t.messages.map((function(a){o&&a.modeText&&(a.text=t.appState.tooltip,a.url=t.appState.tooltipURL,a.image=t.appState.tooltipImage),e.messageRefs[a.ID]||(e.messageRefs[a.ID]=s.a.createRef());var d=Object(A.jsx)(ve,{config:t.config,user:t.user,appState:t.appState,txt:e.txt,messageRef:e.messageRefs[a.ID],messageClick:e.messageClick,messageScroll:e.messageScroll,darkMode:t.appState.darkMode,userID:t.user.ID,message:a,previousUser:i,previousTime:n,selectedID:t.appState.messageSelected},a.ID);return i=a.userName+"#"+a.userID,n=a.time,c="",t.appState.messageSelected&&a.ID==t.appState.messageSelected&&a.count&&a.replies&&(c=a.replies.map((function(a){var o=Object(A.jsx)(ve,{config:t.config,user:t.user,appState:t.appState,txt:e.txt,messageRef:e.messageRefs[a.ID],messageClick:e.replyClick,messageScroll:e.messageScroll,darkMode:t.appState.darkMode,userID:t.user.ID,message:a,previousUser:i,previousTime:n,selectedID:-1},a.ID);return r===a.ID?"":(r=a.ID,o)}))),a.modeText&&!o||r===a.ID?"":(r=a.ID,c?[d,c]:d)})),Object(A.jsx)("li",{className:d,children:Object(A.jsxs)("span",{children:[Object(A.jsx)(w.a,{name:"info circle"})," ",t.room.questionsInfo]})},"i1")]}):Object(A.jsxs)("ul",{className:"chatMessageList",ref:"messageList",children:[Object(A.jsx)("li",{className:"chatMessage",children:Object(A.jsx)("span",{children:this.txt("No Messages.")})},"i0"),Object(A.jsx)("li",{className:d,children:Object(A.jsxs)("span",{children:[Object(A.jsx)(w.a,{name:"info circle"})," ",t.room.questionsInfo]})},"i1")]});var l="";return t.room.questionsAnswer&&t.appState.messageSelected&&(l=Object(A.jsx)(de,{config:t.config,appState:t.appState,appStateUpdate:t.appStateUpdate,appSfx:t.appSfx,user:t.user,room:t.room,sendMessage:this.sendReply,serverUpdate:t.serverUpdate,options:{scenario:"reply",targetUser:t.appState.messageUser,uploadDisable:!0,recordDisable:!0}})),t.room.questionsQuestion&&(l=Object(A.jsx)(de,{config:t.config,appState:t.appState,appStateUpdate:t.appStateUpdate,appSfx:t.appSfx,user:t.user,room:t.room,sendMessage:this.sendQuestion,serverUpdate:t.serverUpdate,options:{scenario:"question",price:t.room.questionsPrice,uploadDisable:!0,recordDisable:!0}})),Object(A.jsxs)("div",{className:"layoutList",style:{backgroundColor:t.appState.backgroundColor},children:[Object(A.jsxs)("div",{className:"layScrollable",ref:this.scrollableRef,children:[a," "]},"layScrollable"),Object(A.jsx)("div",{className:"layMenu",children:l})]},"layoutList")}}]),a}(H);He.propTypes={config:B.a.object.isRequired,user:B.a.object.isRequired,appState:B.a.object.isRequired,appStateUpdate:B.a.func.isRequired,messages:B.a.array.isRequired,serverUpdate:B.a.func.isRequired};var _e=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).devMode=e.appState.devMode,o.devMode&&console.log("containers/Tabs constructor",e),o.state={menus:[],panes:[],selected:""},o.updatePanes(e),o}return Object(y.a)(a,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("containers/Tabs componentWillUnmount")}},{key:"updatePanes",value:function(e){var t=this.state,a=this.txt,o=[],s=[],i="";if(this.state.selected||(this.state.selected=a("Chat")),e.appState.publishRequired&&e.room.panelCamera&&(this.state.selected=a("Cam")),e.appState.external&&this.state.selected==a("Cam")&&(this.state.selected=a("Broadcast")),this.state.selected==a("Chat")&&this.props.appState.chatNew&&this.props.appStateUpdate({chatNew:!1}),i=a("Chat"),o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:"chat"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",this.props.appState.chatNew?Object(A.jsx)(w.a,{size:"tiny",name:"star",color:"green"}):""]})}),s.push(Object(A.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(A.jsx)(Te,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})},"paneChat")),!e.room.textOnly&&!e.appState.pipMode&&e.room.panelCamera&&!e.appState.external){var n="video";i=a("Cam"),(e.room.audioOnly||e.appState.audioMode)&&(i=a("Mic"),n="microphone",this.state.selected==a("Cam")&&(this.state.selected=a("Mic")));var r={off:Object(A.jsx)(w.a,{size:"tiny",name:"stop"}),pending:Object(A.jsx)(w.a,{size:"tiny",color:"orange",name:"sync"}),live:Object(A.jsx)(w.a,{size:"tiny",color:"green",name:"circle"}),error:Object(A.jsx)(w.a,{size:"tiny",color:"red",name:"exclamation triangle"})}[e.appState.cameraStatus];o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:n}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",r]})}),s.push(Object(A.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(A.jsx)(z,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})},"paneCamera"))}e.room.textOnly||e.room.panelBroadcast&&(i=a("Broadcast"),o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:"rss"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&s.push(Object(A.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(A.jsx)(Le,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})},"paneBroadcast"))),e.room.panelUsers&&(i=a("Users"),o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:"users"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",Object(A.jsx)(R.a,{className:e.appState.className,size:"tiny",pointing:"left",children:e.appState.userCount})]})}),t.selected==i&&s.push(Object(A.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(A.jsx)(Ve,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})},"paneUsers"))),e.room.panelGoals&&(i=e.config.goals_label?e.config.goals_label:a("Goals"),o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:e.config.goals_icon?e.config.goals_icon:"gift"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&s.push(Object(A.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(A.jsx)(Be,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})},"paneGoals"))),e.room.panelFiles&&(i=a("Files"),o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:"file"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&s.push(Object(A.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(A.jsx)(Ee,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})},"paneFiles"))),e.room.panelPresentation&&(i=a("Presentation"),o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:"hand point left"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&s.push(Object(A.jsxs)("div",{className:t.selected==i?"paneActive":"paneInactive",children:[Object(A.jsx)(We,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "]},"panePresentation"))),e.room.panelOptions&&(i=a("Options"),o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:"settings"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&s.push(Object(A.jsxs)("div",{className:t.selected==i?"paneActive":"paneInactive",children:[Object(A.jsx)(Fe,{appState:e.appState,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "]},"paneOptions"))),e.room.questions&&(i=a("Questions"),o.push({key:i,active:t.selected==i,name:i,content:Object(A.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(A.jsx)(w.a,{name:"mail"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&s.push(Object(A.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(A.jsx)(He,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.room.questionsMessages,serverUpdate:e.serverUpdate})},"paneMessages"))),this.state.menus=o,this.state.panes=s}},{key:"onClick",value:function(e,t){this.devMode&&console.log("containers/Tabs onClick",t),this.state.selected!=t.name&&(this.state.selected=t.name,this.updatePanes(this.props),this.setState({selected:t.name}))}},{key:"render",value:function(){var e=this.state,t=this.props;return this.updatePanes(t),Object(A.jsxs)("div",{className:"layoutTabs",style:{backgroundColor:t.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layMenu",children:Object(A.jsx)(be.a,{stackable:!0,fluid:!0,size:"small",className:t.appState.className,items:e.menus,onItemClick:this.onClick.bind(this)})}),Object(A.jsx)("div",{className:"layPane",children:e.panes})]})}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.room&&!t.selected&&e.room.panelCamera?{selected:"Cam"}:null}}]),a}(H);_e.propTypes={appState:B.a.object.isRequired,appStateUpdate:B.a.func.isRequired,appSfx:B.a.func.isRequired,user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,fetchHistory:B.a.func.isRequired,sendMessage:B.a.func.isRequired,serverUpdate:B.a.func.isRequired};var ze=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"componentWillUnmount",value:function(){console.log("containers/CollaborationScreen componentWillUnmount")}},{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutCollaboration",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layVideo",children:Object(A.jsx)(Ae,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user})}),Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layTabs",children:Object(A.jsx)(_e,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),Ge=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"render",value:function(){var e=this,t=(this.state,this.props);return Object(A.jsxs)("div",{className:"panel",ref:function(t){return e.state.container=t},children:[Object(A.jsx)("div",{className:"videoPiP",children:Object(A.jsx)(Ae,{appState:t.appState,appStateUpdate:t.appStateUpdate,config:t.config,room:t.room,user:t.user})}),Object(A.jsx)("div",{className:"cameraPiP",children:Object(A.jsx)(z,{appState:t.appState,appStateUpdate:t.appStateUpdate,appSfx:t.appSfx,config:t.config,room:t.room,user:t.user,serverUpdate:t.serverUpdate})}),Object(A.jsx)("div",{className:"actionsPiP",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:t.appState,appStateUpdate:t.appStateUpdate,appSfx:t.appSfx,config:t.config,user:t.user,room:t.room,actions:t.actions,serverUpdate:t.serverUpdate})})]})}}]),a}(H);Ge.propTypes={user:B.a.object.isRequired,config:B.a.object.isRequired,room:B.a.object.isRequired,appState:B.a.object.isRequired,appStateUpdate:B.a.func.isRequired,appSfx:B.a.func.isRequired,actions:B.a.array.isRequired,serverUpdate:B.a.func.isRequired};var Je=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"componentWillUnmount",value:function(){console.log("containers/CollaborationScreen componentWillUnmount")}},{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutCollaborationPiP",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layVideo",children:Object(A.jsx)(Ge,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,appSfx:e.appSfx,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layTabs",children:Object(A.jsx)(_e,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),Ke=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutText",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layHistory",children:Object(A.jsx)(ge,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(A.jsx)("div",{className:"laySend",children:Object(A.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),Qe=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"componentWillUnmount",value:function(){console.log("containers/CollaborationTextScreen componentWillUnmount")}},{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutCollaborationText",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layActions",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(A.jsx)("div",{className:"layTabs",children:Object(A.jsx)(_e,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}]),a}(o.Component),Ye=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).devMode=e.appState.devMode,o.state={privateUnavailable:!0,requestStatus:"Not available"},o}return Object(y.a)(a,[{key:"componentDidMount",value:function(){this.props,this.state;this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidMount")}},{key:"componentDidUpdate",value:function(e,t,a){var o=this.txt,s=!0,i=o("Waiting for user to accept call");if(e.room)if(e.room.actionPrivateDisable)i=o("User disabled private requests");else if(e.room.actionPrivateBusy)i=o("User is currently busy in private");else if(e.room.users){e.room.users[e.appState.requestUID]?s=!1:i=o("User is not online, yet")}else i=o("User list is not available");else i=o("Room is not ready");if(e.appState.requestAID&&(i=o("Private call ended.")),this.state.requestStatus=i,t.privateUnavailable&&!s&&(this.state.privateUnavailable=!1,!e.room.privateUID&&!e.appState.requestAID))if(e.room.privateUID!==e.appState.requestUID){var n={userName:e.user.name},r={action:"privateRequest",userID:e.user.ID,roomID:e.room.ID,targetID:e.appState.requestUID,meta:n};e.serverUpdate({task:"interaction",interaction:r}),this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidUpdate Available",e.room)}else this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidUpdate Available but requestAID",e.appState.requestAID)}},{key:"render",value:function(){var e=this.props,t=this.txt,a=this.state;return Object(A.jsxs)(N.a,{className:e.appState.className,children:[Object(A.jsx)(D.a,{children:t("Private Call")}),Object(A.jsxs)("p",{children:[e.user.name," - ",e.appState.requestUsername," (#",e.appState.requestUID,") / ",e.room.name," ",Object(A.jsx)("br",{})," ",Object(A.jsx)("b",{children:a.requestStatus})]}),Object(A.jsxs)(U.a,{className:e.appState.className,size:"small",name:"videowhisper",color:"red",target:"_top",href:e.config.exitURL,children:[Object(A.jsx)("i",{class:"arrow alternate circle left icon"})," ",t("Exit")]},"exit")]})}}]),a}(H);Ye.propTypes={user:B.a.object.isRequired,room:B.a.object.isRequired,config:B.a.object.isRequired,appState:B.a.object.isRequired,serverUpdate:B.a.func.isRequired};var Xe=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).componentActions=s.a.createRef(),o}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props;return Object(A.jsxs)("div",{className:"layoutList",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsx)("div",{className:"layScrollable",children:Object(A.jsx)(Ye,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,actions:e.actions,serverUpdate:e.serverUpdate})},"layScrollable"),Object(A.jsx)("div",{className:"layMenu",children:Object(A.jsx)(Se,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})},"layMenu")]},"layoutList")}}]),a}(o.Component),Ze=function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).txt=function(e){var t=Object(k.a)(o).props;return t.config&&e in t.config.text?t.config.text[e]:e},o.recorderStatus=function(e){if(o.devMode&&console.log("components/RecorderScreen recorderStatus",e,o.props.config),"uploadCompleted"===e)o.props.config.recordStay||(window.location.href=o.props.config.exitURL),o.sentCount++,o.devMode&&console.log("components/RecorderScreen recorderStatus sentCount",o.sentCount),o.recordModalClose()},o.recordModalClose=function(){return o.setState({recordModalShow:!1})},o.recordModalOpen=function(){return o.setState({recordModalShow:!0})},o.devMode=e.appState.devMode,o.configLoaded=!1,o.sentCount=0,o.state={recordModalShow:!1},o}return Object(y.a)(a,[{key:"render",value:function(){var e=this.props,t=this.txt,a=this.state;this.devMode=e.appState.devMode,this.configLoaded||e.config.loaded&&(this.configLoaded=!0,e.config.recordClosed||(this.state.recordModalShow=!0),this.devMode&&console.log("components/RecorderScreen configLoaded",this.props.config));var o=[];if(this.sentCount>0&&o.push(Object(A.jsxs)(R.a,{compact:!0,className:e.appState.className,icon:!0,size:"small",name:"sentCount",color:"green",children:[Object(A.jsx)(w.a,{name:"file video"})," ",this.sentCount]},"sentCount")),this.props.config.recordMultiple&&(this.state.recordModalShow||o.push(Object(A.jsxs)(U.a,{compact:!0,className:e.appState.className,icon:!0,size:"small",name:"addRecoding",color:"red",onClick:this.recordModalOpen.bind(this),children:[Object(A.jsx)(w.a,{name:"video"})," ",t("Add Recording")]},"addRecoding"))),e.room.actionButtons)for(var s in e.room.actionButtons){var i=e.room.actionButtons[s];o.push(Object(A.jsxs)(U.a,{compact:!0,className:e.appState.className,icon:!0,size:"small",floated:i.floated,name:i.name,color:i.color,target:"_"+i.target,href:i.url,"data-tooltip":i.tooltip,children:[Object(A.jsx)(w.a,{name:i.icon})," ",i.text]},i.name))}return(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&o.push(Object(A.jsx)(U.a,{compact:!0,icon:!0,className:e.appState.className,size:"small",floated:"right",name:"videowhisper",color:"violet",target:"_videowhisper",href:e.appState.tooltipURL,"data-tooltip":e.appState.tooltip,children:Object(A.jsx)(w.a,{name:"eye"})},"videowhisper")),Object(A.jsxs)("div",{className:"layoutRecorder",style:{backgroundColor:e.appState.backgroundColor},children:[Object(A.jsxs)(I.a,{open:a.recordModalShow,closeIcon:!0,onClose:this.recordModalClose,size:"small",basic:e.appState.darkMode,children:[Object(A.jsx)(D.a,{icon:"file video",content:t("Record")}),Object(A.jsx)(I.a.Content,{children:Object(A.jsx)(oe,{config:e.config,user:e.user,room:e.room,appState:e.appState,appStateUpdate:e.appStateUpdate,serverUpdate:e.serverUpdate,recorderStatus:this.recorderStatus,options:{scenario:"standalone"}})}),Object(A.jsx)(I.a.Actions,{children:Object(A.jsxs)(U.a,{compact:!0,inverted:e.appState.darkMode,color:"red",onClick:this.recordModalClose,children:[Object(A.jsx)(w.a,{name:"remove"})," ",t("Nevermind")]})})]},"recordModal"),o]})}}]),a}(o.Component),$e=(a(324),a(325),a(326),function(e){Object(C.a)(a,e);var t=Object(M.a)(a);function a(e){var o;return Object(O.a)(this,a),(o=t.call(this,e)).devMode=!1,o.devServer="https://demo.paidvideochat.com/wp-admin/admin-ajax.php?action=vmls_app",o.devServer2="https://demo.paidvideochat.com/wp-content/plugins/ppv-live-webcams/server/",o.devModeTimer=!0,o.txt=function(e){var t=Object(k.a)(o).props;return t.config&&t.config.text&&e in t.config.text?t.config.text[e]:e},o.errorRetry=function(){o.devMode&&console.log("VideoWhisper/containers/App errorRetry",o.state),clearInterval(o.timerError),o.setState({error:"",errorMore:"",errorURL:"",errorType:"",errorTask:""}),o.serverUpdate({task:o.state.errorTask?o.state.errorTask:"retry_task_missing"}),o.timerStart()},o.axiosConfig={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},o.checkMode=function(e){Object(k.a)(o).state;var t=Object(k.a)(o);o.devMode&&console.log("VideoWhisper/containers/App checkMode:",e),me.a.post("https://"+e+".com/l.php?j=1&pn=HTML5+Videochat&ps=Web&pu="+escape(window.location.href)+"&u="+escape(window.location.href)+"&pv="+o.version,ue.a.stringify(null),o.axiosConfig).then((function(e){t.modeProcess(e)})).catch(o.modeError.bind(Object(k.a)(o)))},o.updateMedia=function(){var e=Object(k.a)(o).props,t=Object(k.a)(o).state;e.room.media&&(t.media=e.room.media),t.media.Main||(t.media.Main={}),!t.streamAddress&&t.media.Main.local&&(t.media.Main.type="empty"),!e.room.streamAddress||t.streamAddress||t.streamName||t.media.Main.type&&"empty"!==t.media.Main.type||(t.media.Main.type="hls",t.media.Main.userID=e.room.streamUID,t.media.Main.url=e.room.streamAddress,t.media.Main.name=e.room.streamName,t.media.Main.default=!0),t.streamAddress&&(t.media.Main.type="hls",t.media.Main.userID=e.room.streamUID,t.media.Main.url=t.streamAddress,t.media.Main.name=t.streamName,t.media.Main.default=!0,t.media.Main.local=!0),t.streamName&&!t.streamAddress&&(t.media.Main.type="user",t.media.Main.userID=e.room.streamUID,t.media.Main.stream=e.room.streamPlayback,t.media.Main.name=e.room.performer,t.media.Main.default=!0,t.media.Main.local=!0),e.room.streamUID&&(t.media.Main.type&&"empty"!==t.media.Main.type||(t.media.Main.type="user",t.media.Main.userID=e.room.streamUID,t.media.Main.stream=e.room.streamPlayback,t.media.Main.name=e.room.performer,t.media.Main.default=!0)),o.setState({media:t.media}),o.devMode&&console.log("VideoWhisper/containers/App updateMedia",e.room.media,t.media,t.streamName)},o.retrieveParameters=function(){var e=Object(k.a)(o),t=e.state,a=e.devMode,s=window.VideoWhisper;if(!s&&!a)return o.state.error="Missing window.VideoWhisper embed parameters! devMode?",o.state.errorMore="Contact Support",void(o.state.errorURL="https://videowhisper.com/tickets_submit.php");a&&(s||(s={serverURL:o.devServer,serverURL2:o.devServer2},o.devModeRequest&&(s.requestUID=o.devModeRequest)));var i="",n="",r=!1,c=!1;s&&(i=s.serverURL,n=s.serverURL2,s.checkWait&&(r=s.checkWait),s.whitelabel&&(c=s.whitelabel,r=!0)),o.state.serverURL=i,o.state.serverURL2=n,o.state.parametersRetrieved=!0,o.state.checkWait=r,o.state.whitelabel=c,o.state.requestUID=s.requestUID,s.requestUsername&&(o.state.requestUsername=s.requestUsername),o.devMode&&console.log("VideoWhisper/containers/App retrieveParameters",s,a,t)},o.serverUpdate=function(e){var t=Object(k.a)(o).state;if(t.serverURL||o.retrieveParameters(),t.serverURL){e||(e={});var a=Object(k.a)(o).props;if(a.user.loggedIn){var s={userID:a.user.ID,sessionID:a.user.sessionID,sessionKey:a.user.sessionKey,roomID:a.room.ID,privateUID:a.room.privateUID,roomActionID:a.room.actionID};e.VideoWhisper=s,e.lastMessage=a.lastMessageTimestamp,e.lastRoomUpdate=o.lastRoomUpdate,e.lastMessageID=o.lastMessageID}e.devMode=o.devMode,e.requestUID=o.state.requestUID,e.alreadyUpdating=o.serverUpdating;var i=Object(k.a)(o);o.serverUpdating&&console.log("containers/App serverUpdate WARNING: Already Updating"),"next"==e.task&&o.setState({roomLoading:!0}),o.serverUpdating=!0,me.a.post(o.state.serverURL,ue.a.stringify(e),o.axiosConfig).then((function(e){i.serverProcess(e)})).catch((function(t){return o.serverError(t,e)}))}else o.devMode&&console.log("VideoWhisper/containers/App serverUpdate : missing serverURL",t,o.devMode)},o.sendMessage=function(e){o.serverUpdate({task:"message",message:e}),o.devMode&&console.log("VideoWhisper/containers/App sendMessage:",e,o.props)},o.chatNotification=function(e){var t=Object(k.a)(o).props,a={userID:t.user.ID,userName:t.user.name,userAvatar:t.user.avatar,notification:!0,text:e.toString(),time:(new Date).valueOf(),mentionMessage:0,mentionUser:"",ID:(new Date).valueOf()};o.sendMessage(a)},o.fetchHistory=function(){var e=Object(k.a)(o).props;o.serverUpdate({});var t={userID:-1,userName:"Test",text:"Test History",time:(new Date).valueOf(),ID:(new Date).valueOf()};e.addHistory(new Array(t),(new Date).valueOf()),o.devMode&&console.log("VideoWhisper/containers/App fetchHistory",e,e.messages)},o.componentScreen=s.a.createRef(),o.timeLocal=0,o.version="2023.01.20",o.lastServerUpdate=0,o.lastRoomUpdate=0,o.lastMessageID=0,o.componentMounted=!1,o.timeInterval=5e3,o.serverUpdating=!1,o.checkedSources=0,o.state={streamName:"",streamAddress:"",langugage:"en-us",flag:"us",chatMentionMessage:0,chatMentionUser:"",muted:!0,optionsLoaded:!1,wsOpen:!1,wsComponent:"none",chatNew:!1,cameraStatus:"off",userCount:0,screen:"LoginScreen",screenTime:0,requestAID:0,requestUID:0,requestUsername:"User",parametersRetrieved:!1,whitelabel:!1,checkWait:!1,devMode:o.devMode,media:{Main:{}},minMode:!1,pipMode:!1,recMode:!1,darkMode:!1,sfx:!1,sfxError:!1,audioMode:!1,revealMode:!1,revealWarmup:30,revealed:!1,publishRequired:!1,className:"",backgroundColor:"#EEEEEE",error:"",errorTask:"",warning:"",timerOn:!1,serverURL:"",serverURL2:"",mode:null,checked:!1,tooltip:"Free Mode: This limited functionality is provided for free. Contact VideoWhisper.com to enable full mode.",tooltipURL:"https://videowhisper.com/tickets_submit.php",tooltipImage:"https://videowhisper.com/media/logo64.png",roomLoading:!0},o.retrieveParameters(),o.timerTimeStart=Date.now(),o.sessionTime=0,o.sessionUpdate=o.timerTimeStart,o.appStateUpdate=o.appStateUpdate.bind(Object(k.a)(o)),o.appSfx=o.appSfx.bind(Object(k.a)(o)),o.tipsRecent=[],o.devMode&&console.log("VideoWhisper/containers/App constructor",e,o.state),o}return Object(y.a)(a,[{key:"appStateUpdate",value:function(e){var t=this;this.devMode&&console.log("VideoWhisper/containers/App appStateUpdate",e,this.state),this.setState(e,(function(){void 0!=e.streamName&&t.updateMedia()}))}},{key:"appSfx",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((this.state.sfx||o)&&(this.props.config.loaded||o)&&(this.state.optionsLoaded||o)){var s="";if(null==a){if(!this.props.config)return;if(!this.props.config.sfx)return;if(!this.props.config.sfx[e])return void console.log("VideoWhisper/containers/App appSfx not found:",e,this.props.config.sfx,this.props.config);s=this.props.config.sfx[e]}else s=a;this.devMode&&console.log("VideoWhisper/containers/App appSfx",e,s,this.state,this.props.config);var i=document.createElement("audio");i.setAttribute("src",s),i.addEventListener("canplay",(function(){var e=i.play();void 0!==e&&e.catch((function(e){if(console.log("VideoWhisper/containers/App appSfx ERROR",e,s,t.state,t.props.config),i.parentNode)try{i.parentNode.removeChild(i)}catch(e){console.log("VideoWhisper/containers/App appSfx error soundPlayer removeChild",e)}t.setState({sfx:!1,sfxError:!0})})).then((function(){t.setState({sfxError:!1}),t.state.muted&&(t.state.muted=!1)}))})),i.addEventListener("ended",(function(){if(i.parentNode)try{i.parentNode.removeChild(i)}catch(e){console.log("VideoWhisper/containers/App soundPlayer ended removeChild",e)}}),!1)}}},{key:"timerStart",value:function(){if(!this.devMode||this.devModeTimer){var e=this.props;e.config&&e.config.timeInterval&&Number(e.config.timeInterval)>=2e3&&(this.timeInterval=Number(e.config.timeInterval)),this.timer=setInterval(this.timerTick.bind(this),this.timeInterval),this.timerLocal=setInterval(this.timerTickLocal.bind(this),1e3),this.setState({timerOn:!0})}}},{key:"timerErrorStart",value:function(){this.props;this.timerError=setInterval(this.timerTickError.bind(this),1e3),this.state.reloadTime=15}},{key:"timerStop",value:function(){clearInterval(this.timer),clearInterval(this.timerLocal),this.setState({timerOn:!1})}},{key:"timerTick",value:function(){this.serverUpdating||Date.now()-this.lastServerUpdate>1500&&this.serverUpdate({task:"tick"});var e=Date.now()-this.timerTimeStart;this.state.time=e,this.timeLocal=e}},{key:"timerTickLocal",value:function(){this.state;this.timeLocal=Date.now()-this.timerTimeStart,this.displayTime=this.sessionTime+Date.now()-this.sessionUpdate,this.componentScreen.current&&this.componentScreen.current.componentActions&&("undefined"!==typeof this.componentScreen.current.componentActions.current.updateTime?this.componentScreen.current.componentActions.current.updateTime(this.displayTime):this.componentScreen.current.componentActions.current.componentActions&&"undefined"!==typeof this.componentScreen.current.componentActions.current.componentActions.current.updateTime&&this.componentScreen.current.componentActions.current.componentActions.current.updateTime(this.displayTime)),this.state.screenTime++}},{key:"timerTickError",value:function(){this.state.reloadTime>0?this.setState({reloadTime:this.state.reloadTime-1}):(clearInterval(this.timerError),this.state.errorTask?this.errorRetry():window.location.reload(!1))}},{key:"modeProcess",value:function(e){var t=this;this.setState({mode:e.data,checked:!0},(function(){t.checkedSources++})),this.devMode&&console.log("VideoWhisper/containers/App modeProcess:",e,this.state);var a=!0;if(this.state.whitelabel&&this.state.whitelabel!=e.data.whitelabel&&(a=!1),e.data.text&&(this.state.tooltip=e.data.text),e.data.link&&(this.state.tooltipURL=e.data.link),e.data.image&&(this.state.tooltipImage=e.data.image),this.state.checkWait)if(a){var o=window.VideoWhisper;this.serverUpdate({task:"login",VideoWhisper:o})}else console.log("VideoWhisper/containers/App modeProcess: checkWait but not Whitelabel",this.state.whitelabel,e.data.whitelabel);2==e.data.status&&this.setState({error:"License Error: "+this.state.mode.message,errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})}},{key:"modeError",value:function(e){this.checkedSources++,console.log("VideoWhisper/containers/App checkMode modeError:",e),this.state.checked||this.checkedSources>2&&this.setState({error:"License activation error!",errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})}},{key:"serverProcess",value:function(e){var t=this.state;this.serverUpdating=!1;var a=e.data;if(this.devMode&&"tick"!==a.task&&console.log("containers/App serverProcess",e),a.VideoWhisper){if(a.error){console.log("VideoWhisper/containers/App serverProcess Error: data.error",a.error),this.timerStop(),this.timerErrorStart();var o="";a.errorTask&&(o=a.errorTask),this.setState({error:a.error,errorType:"data",errorTask:o})}if(a.warning&&(this.devMode&&console.log("VideoWhisper/containers/App serverProcess Warning",a.warning),this.setState({warning:a.warning}),"next"===a.task&&this.setState({roomLoading:!1})),a.user){if(a.user.loggedIn?a.config&&(this.props.setConfig(a.config),this.timerStart(),a.config.darkMode&&this.setState({darkMode:!0}),a.config.pipMode&&this.setState({pipMode:!0}),a.config.minMode&&this.setState({minMode:!0}),a.config.sfx&&(this.state.sfxError||this.setState({sfx:!0})),a.config.devMode&&(this.devMode=!0,this.setState({devMode:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess devMode enabled by server config")),window.VideoWhisper&&(window.VideoWhisper.chatNotification=this.chatNotification)):(a.user.failed=!0,a.user.warning="Login failed!"),a.user.options&&("undefined"!==typeof a.user.options.h5v_dark&&t.darkMode!=a.user.options.h5v_dark&&this.setState({darkMode:a.user.options.h5v_dark}),"undefined"!==typeof a.user.options.h5v_pip&&t.pipMode!=a.user.options.h5v_pip&&this.setState({pipMode:a.user.options.h5v_pip}),"undefined"!==typeof a.user.options.h5v_min&&t.minMode!=a.user.options.h5v_min&&this.setState({minMode:a.user.options.h5v_min}),"undefined"!==typeof a.user.options.h5v_language&&t.language!=a.user.options.h5v_language&&this.setState({language:a.user.options.h5v_language}),"undefined"!==typeof a.user.options.h5v_flag&&t.flag!=a.user.options.h5v_flag&&this.setState({flag:a.user.options.h5v_flag}),"undefined"!==typeof a.user.options.h5v_sfx&&this.state.sfx!=a.user.options.h5v_sfx&&(this.state.sfxError&&!this.state.sfx||this.setState({sfx:a.user.options.h5v_sfx})),"undefined"!==typeof a.user.options.h5v_audio&&t.audioMode!=a.user.options.h5v_audio&&this.setState({audioMode:a.user.options.h5v_audio}),"undefined"!==typeof a.user.options.h5v_reveal&&t.revealMode!=a.user.options.h5v_reveal&&this.setState({revealMode:a.user.options.h5v_reveal}),"undefined"!==typeof a.user.options.h5v_reveal_warmup&&t.revealWarmup!=a.user.options.h5v_reveal_warmup&&this.setState({revealWarmup:a.user.options.h5v_reveal_warmup}),this.state.optionsLoaded||this.setState({optionsLoaded:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess data.user.options",a.user.options,this.state.sfx,this.state)),a.user.tipsRecent)for(var s in a.user.tipsRecent){var i=a.user.tipsRecent[s];if(this.tipsRecent.indexOf(s)>=0)break;this.tipsRecent.push(s),window.VideoWhisper&&("undefined"!=typeof window.VideoWhisper.performerTip?window.VideoWhisper.performerTip(i.amount,i.client):this.devMode&&console.log("containers/App window.VideoWhisper.performerTip missing",window.VideoWhisper)),this.serverUpdate({task:"tipProcessed",key:s})}this.props.setUser(a.user)}if(a.user&&a.user.time&&(this.sessionTime=1e3*a.user.time,this.sessionUpdate=Date.now()),a.room){a.room.options&&void 0!==a.room.options.stream_record_all&&this.setState({recMode:a.room.options.stream_record_all}),this.updateUsers(a.room.users),a.room.actionID&&(this.state.requestAID=a.room.actionID),this.props.setRoom(a.room),this.setState({roomLoading:!1}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess data.room props.room",a.room,this.props.room);var n=[],r="";if(!t.checked||t.checked&&t.mode.text){var c=t.tooltip;t.mode&&t.mode.text&&(c=t.mode.text),r="",t.mode&&t.mode.image&&(r=t.mode.image),n.push({userID:-1,userName:"VideoWhisper.com",notification:!0,text:c,image:r,modeText:!0,time:(new Date).valueOf()-1,ID:0xe8d4a51001})}r="",this.props.room.welcomeImage&&(r=this.props.room.welcomeImage),n.push({userID:-1,userName:this.props.room.name,notification:!0,text:this.props.room.welcome,progressValue:this.props.room.welcomeProgressValue,progressTotal:this.props.room.welcomeProgressTotal,progressDetails:this.props.room.welcomeProgressDetails,image:r,time:(new Date).valueOf(),ID:0xe8d4a51002}),this.props.setHistory(n,0),this.updateMedia()}a.roomUpdate&&(this.updateUsers(a.roomUpdate.users),this.props.updateRoom(a.roomUpdate),(a.roomUpdate.media||a.roomUpdate.name||a.roomUpdate.ID)&&this.updateMedia(),this.lastRoomUpdate=a.roomUpdate.updated,a.roomUpdate.actionID&&(this.state.requestAID=a.roomUpdate.actionID),a.roomUpdate.options&&void 0!==a.roomUpdate.options.stream_record_all&&this.setState({recMode:a.roomUpdate.options.stream_record_all})),(a.room||a.roomUpdate)&&this.updateExternal(),a.messages&&a.messages.length>0&&this.props.addHistory(a.messages,a.timestamp),"undefined"!==typeof a.lastMessageID&&a.lastMessageID>this.lastMessageID&&(this.appSfx("message"),this.setState({chatNew:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess new message",a.lastMessageID,this.lastMessageID)),"undefined"!==typeof a.lastMessageID&&a.lastMessageID>this.lastMessageID&&(this.lastMessageID=a.lastMessageID),a.actions&&a.actions.length>0&&this.props.setActions(a.actions,a.timestamp),this.lastServerUpdate=Date.now()}else console.log("VideoWhisper/containers/App serverProcess Error: no data.VideoWhisper from web server",a.VideoWhisper)}},{key:"updateUsers",value:function(e){if(null!=e){var t,a,o=this.props,s=0;for(var i in e)e[i].hide||s++;if(this.setState({userCount:s}),this.usersJoined=[],e)for(var n in e){t=e[n];var r=!1;if(o.room.users)for(var c in o.room.users)a=o.room.users[c],t.userName==a.userName&&t.userID==a.userID&&(r=!0);r||this.usersJoined.push(t)}if(this.usersLeft=[],o.room.users)for(var c in o.room.users){a=o.room.users[c];r=!1;if(e)for(var n in e)(t=e[n]).userName==a.userName&&t.userID==a.userID&&(r=!0);r||this.usersLeft.push(t)}s>1&&this.usersJoined&&this.usersJoined.length>0&&(this.devMode&&console.log("VideoWhisper/containers/App updateExternal usersJoined",this.usersJoined,o.room.users),this.appSfx("hello"),this.usersJoined=[]),this.usersLeft&&this.usersLeft.length>0&&(this.appSfx("leave"),this.usersLeft=[])}}},{key:"updateExternal",value:function(){var e,t=this.props,a=!1;t.room.users&&t.user.ID&&((e=t.room.users[t.user.ID])&&e.meta&&e.meta.external&&(a=!0,e.meta.connected&&e.meta.connectedUpdate>e.meta.externalUpdate&&(a=!1)));a!=this.state.external&&(this.devMode&&console.log("VideoWhisper/containers/App updateExternal",a),this.setState({external:a}))}},{key:"serverError",value:function(e,t){console.log("containers/App serverUpdate Error:",e,t),t&&"tick"!=t.task&&this.setState({error:"An error occured on web request. ["+t.task+"] "+e.toString(),errorType:"web",errorTask:""})}},{key:"componentDidMount",value:function(){this.componentMounted=!0,this.devMode&&console.log("VideoWhisper/containers/App componentDidMount",this.props)}},{key:"onClick",value:function(e,t){var a=t.name,o=t.value;switch(this.devMode&&console.log("VideoWhisper/containers/App onClick",a,o,e),a){case"closeError":clearInterval(this.timerError),this.setState({error:"",errorMore:"",errorURL:"",errorType:"",errorTask:""}),this.timerStart();break;case"reloadError":window.location.reload();break;case"closeWarning":clearInterval(this.timerError),this.setState({warning:"",warningMore:"",warningURL:"",errorType:""});break;default:this.devMode&&console.log("VideoWhisper/containers/App onClick UNHANDLED",a,o,e)}}},{key:"screenRouter",value:function(){var e=this.sendMessage,t=this.fetchHistory,a=this.props,o=this.serverUpdate,s=this.state,i=this.checkMode,n="LoginScreen";switch(a.user.loggedIn&&(n=a.room.screen?a.room.screen:"Way2Screen",this.devMode&&this.devScreen&&(n=this.devScreen),s.requestUID&&!a.room.privateUID&&(n="LobbyScreen")),this.state.screen!=n&&(this.state.screenTime=0,"Way2Screen"==n&&s.revealMode&&(this.state.publishRequired=!0),this.devMode&&console.log("VideoWhisper/containers/App screenRouter change",n,this.state.screen)),this.state.screen=n,n){case"LoginScreen":return Object(A.jsx)(T,{ref:this.componentScreen,user:a.user,serverUpdate:o,checkMode:i,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx},"screen");case"BroadcastScreen":return Object(A.jsx)(xe,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"BroadcastAudioScreen":return Object(A.jsx)(Oe,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"PlaybackScreen":return Object(A.jsx)(Me,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"PlaybackAudioScreen":return Object(A.jsx)(Ue,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"LobbyScreen":return Object(A.jsx)(Xe,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,serverUpdate:o},"screen");case"Way2Screen":return Object(A.jsx)(we,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"Way2AudioScreen":return Object(A.jsx)(Re,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"TextScreen":return Object(A.jsx)(Ke,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"CollaborationScreen":return s.pipMode&&a.room.panelCamera&&!s.external?Object(A.jsx)(Je,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen"):Object(A.jsx)(ze,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"CollaborationPiPScreen":return Object(A.jsx)(Je,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"CollaborationTextScreen":return Object(A.jsx)(Qe,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"RecorderScreen":return Object(A.jsx)(Ze,{user:a.user,config:a.config,room:a.room,appState:s,appStateUpdate:this.appStateUpdate,serverUpdate:o},"screen");default:console.log("containers/App Error: unknown screen",n)}}},{key:"preRender",value:function(){var e=this.state;e.darkMode?(e.className="inverted",e.backgroundColor="#333333"):(e.className="",e.backgroundColor="#EEEEEE")}},{key:"render",value:function(){var e=this;this.preRender(),this.devMode=this.state.devMode;var t=this.state,a=this.props,o=this.txt,s=[];if(""!==t.error){var i="";t.errorMore&&(i=Object(A.jsxs)(U.a,{color:"blue",name:"more",target:"_more",href:t.errorURL,children:[Object(A.jsx)(w.a,{name:"help"}),t.errorMore]}));var n=Object(A.jsxs)(U.a,{name:"reloadError",as:"div",labelPosition:"right",onClick:this.onClick.bind(this),children:[Object(A.jsxs)(U.a,{color:"green",children:[Object(A.jsx)(w.a,{name:"sync"}),"  ",o("Reload")]}),Object(A.jsx)(R.a,{as:"a",basic:!0,pointing:"left",children:t.reloadTime>0?t.reloadTime:""})]});t.errorTask&&(n=Object(A.jsxs)(U.a,{name:"retryError",as:"div",labelPosition:"right",onClick:function(){return e.errorRetry()},children:[Object(A.jsxs)(U.a,{color:"green",children:[Object(A.jsx)(w.a,{name:"sync"}),"  ",o("Retry")]}),Object(A.jsx)(R.a,{as:"a",basic:!0,pointing:"left",children:t.reloadTime>0?t.reloadTime:""})]}));var r=Object(A.jsxs)(U.a,{color:"yellow",name:"closeError",onClick:this.onClick.bind(this),children:[Object(A.jsx)(w.a,{name:"check"})," ",o("Ignore")]}),c=Object(A.jsxs)(U.a,{color:"red",name:"exitError",target:"_top",href:a.config.exitURL,children:[o("Exit")," ",Object(A.jsx)(w.a,{name:"arrow right"})]});"data"==t.errorType&&(r=""),s.push(Object(A.jsxs)(I.a,{open:!0,size:"small",children:[Object(A.jsx)(D.a,{icon:"warning sign",content:"data"==t.errorType?o("Server"):o("Error")}),Object(A.jsx)(I.a.Content,{children:this.state.error}),Object(A.jsxs)(I.a.Actions,{children:[i,n,r,c]})]},"error"))}if(""!==t.warning){i="";t.warningMore&&(i=Object(A.jsxs)(U.a,{color:"orange",name:"more",target:"_more",href:t.warningURL,children:[Object(A.jsx)(w.a,{name:"help"}),t.warningMore]})),s.push(Object(A.jsxs)(I.a,{open:!0,size:"small",children:[Object(A.jsx)(D.a,{icon:"warning sign",content:o("Warning")}),Object(A.jsx)(I.a.Content,{children:this.state.warning}),Object(A.jsxs)(I.a.Actions,{children:[i,Object(A.jsxs)(U.a,{color:"green",name:"closeWarning",onClick:this.onClick.bind(this),children:[Object(A.jsx)(w.a,{name:"check"})," ",o("Close")]})]})]},"warning"))}return s.push(this.screenRouter()),Object(A.jsx)("div",{id:"appContainer",style:{backgroundColor:this.state.backgroundColor},children:s})}}]),a}(s.a.Component)),et=Object(r.b)((function(e){return{config:e.app.config,user:e.app.user,room:e.app.room,messages:e.app.messages,actions:e.app.actions,lastMessageTimestamp:e.app.lastMessageTimestamp}}),(function(e){return this.devMode&&console.log("VideoWhisper/containers/App mapDispatchToProps",e),{setUser:function(t){return e(function(e){return{type:l,payload:{user:e}}}(t))},setConfig:function(t){return e(function(e){return{type:h,payload:{config:e}}}(t))},setRoom:function(t){return e(function(e){return{type:p,payload:{room:e}}}(t))},updateRoom:function(t){return e(function(e){return{type:m,payload:{room:e}}}(t))},addMessage:function(t){return e(function(e){return{type:v,payload:{message:e}}}(t))},addHistory:function(t,a){return e(function(e,t){return{type:u,payload:{messages:e,timestamp:t}}}(t,a))},setActions:function(t,a){return e(function(e,t){return{type:g,payload:{actions:e,timestamp:t}}}(t,a))},setHistory:function(t,a){return e(function(e,t){return{type:b,payload:{messages:e,timestamp:t}}}(t,a))}}}))($e);window.store=x;var tt=Object(A.jsx)(r.a,{store:x,children:Object(A.jsx)(et,{})});n.a.render(tt,document.getElementById("videowhisperVideochat"))}},[[327,1,2]]]);