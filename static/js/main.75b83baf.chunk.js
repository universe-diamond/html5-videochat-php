(this.webpackJsonpvideowhisper=this.webpackJsonpvideowhisper||[]).push([[0],{243:function(e,t,s){},247:function(e,t,s){},332:function(e,t){},339:function(e,t,s){},340:function(e,t,s){},341:function(e,t,s){},342:function(e,t,s){"use strict";s.r(t);var o=s(1),a=s.n(o),i=s(33),n=s.n(i),r=(s(243),s(143)),c=s(87);const d="App/UPDATE_USER",l="App/SET_ROOM",p="App/UPDATE_ROOM",h="App/SET_CONFIG",m="App/ADD_HISTORY",u="App/ADD_MESSAGE",g="App/SET_ACTIONS",v="App/SET_HISTORY",b={user:{ID:0,sessionID:0,sessionKey:"",name:"User.0",loggedIn:!1,warning:"Please wait for login..",balance:0},room:{ID:0,name:"Room.0",screen:"LoginScreen",streamBroadcast:"Room",streamPlayback:"Room",privateUID:0,actionPrivate:!1,actionPrivateClose:!1,actionID:0,performer:"",performerID:0,welcome:"Welcome to default room!"},config:{wss:"",application:"",videoCodec:"h264",videoBitrate:"400",videoFramerae:"29.97",audioCodec:"opus",audioBitrate:"64",autoBroadcast:!1,exitURL:"https://videowhisper.com",errorURL:"https://videowhisper.com/tickets_submit.php",actionFullpage:!1,actionFullscreen:!0,loaded:!1},messages:[],actions:[],lastMessageTimestamp:0};var f=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};var s;switch(t.type){case d:s=Object.assign({},e,{user:Object.assign({},e.user,t.payload.user)});break;case l:s=Object.assign({},e,{room:Object.assign({},t.payload.room)});break;case p:s=Object.assign({},e,{room:Object.assign({},e.room,t.payload.room)});break;case h:s=Object.assign({},e,{config:Object.assign({},t.payload.config)});break;case u:s=Object.assign({},e,{messages:[...e.messages,t.payload.message]});break;case m:s=Object.assign({},e,{lastMessageTimestamp:t.payload.timestamp,messages:e.messages.concat(t.payload.messages)});break;case g:s=Object.assign({},e,{lastMessageTimestamp:t.payload.timestamp,actions:[...t.payload.actions]});break;case v:s=Object.assign({},e,{lastMessageTimestamp:t.payload.timestamp,messages:[...t.payload.messages]});break;default:s=Object.assign({},e)}return s};var j=Object(c.b)({app:f});var S=Object(c.c)(j);var x=s(343),O=s(72),C=s(111),M=s(365),y=s(369),k=(s(247),s(368)),w=s(0);class R extends o.Component{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return e in t.config.text?t.config.text[e]:e},this.devMode=e.appState.devMode,this.state={loggedin:!1,modeServers:["videowhisper","videowhispers","ateom"]}}componentDidMount(){const{props:e,state:t}=this;if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen componentDidMount",e.appState.parametersRetrieved,e.appState.checkWait,e,t,window,window.VideoWhisper),!t.loggedin&&e.appState.parametersRetrieved&&!e.user.loggedIn&&!e.user.failed&&!e.appState.checkWait){const t=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:t}),this.state.loggedin=!0}this.devMode?setTimeout((()=>t.modeServers.forEach(e.checkMode)),3e3):t.modeServers.forEach(e.checkMode)}componentDidUpdate(e,t,s){if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen componentDidUpdate parametersRetrieved checkWait loggedin",e.appState.parametersRetrieved,e.appState.checkWait,t.loggedin),!t.loggedin&&e.appState.parametersRetrieved&&!e.user.loggedIn&&!e.user.failed&&!e.appState.checkWait){const t=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:t}),this.state.loggedin=!0}}render(){const{props:e,state:t}=this;let s;s=e.user.loggedIn?"Logged in as "+e.user.name:"Not logged in, yet. ",e.user.warning&&(s+=e.user.warning);var o=Object(w.jsxs)("p",{children:["Entering the ",Object(w.jsx)("a",{href:"https://consult.videowhisper.com",children:"HTML5 Videochat"})]});return(e.appState.whitelabel||!e.appState.parametersRetrieved&&!e.appState.error)&&(o=Object(w.jsx)("p",{children:"Entering Videochat"})),e.appState.checked&&(e.appState.mode.status||(o=e.appState.mode.text?e.appState.mode.text:"This is server connection screen."),e.appState.whitelabel&&e.appState.whitelabel!=e.appState.mode.whitelabel&&e.appState.modeVersion!=e.appState.version&&(o=Object(w.jsxs)("p",{children:[Object(w.jsx)("a",{href:"https://consult.videowhisper.com",children:"Contact"})," for attribution removal assistance!"]}))),Object(w.jsxs)(k.a,{className:e.appState.className,children:[Object(w.jsxs)("p",{children:[" Logged in: ",s," "]}),Object(w.jsxs)("p",{children:[" ",e.user.error," "]}),o]})}}var U=s(364),I=s(362),D=s(2),N=s.n(D);class A extends o.Component{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return e in t.config.text?t.config.text[e]:e},this.updateSize=()=>{var{state:e}=this;if(e.container){let t=e.container.clientWidth,s=e.container.clientHeight;s||(s=1);const o=t/s;this.setState({aspectRatio:o,width:t,height:s})}},this.state={container:null,width:0,height:0,aspectRatio:0,settingsActive:!0},this.devMode=e.appState.devMode}componentDidMount(){this.updateSize(),window.addEventListener("resize",this.updateSize,!1),document.addEventListener("onfullscreenchange",this.updateSize,!1),document.addEventListener("webkitfullscreenchange",this.updateSize,!1),document.addEventListener("mozfullscreenchange",this.updateSize,!1),document.addEventListener("msfullscreenchange",this.updateSize,!1),document.addEventListener("MSFullscreenChange",this.updateSize,!1),document.addEventListener("fullscreenchange",this.updateSize,!1)}componentWillUnmount(){window.removeEventListener("resize",this.updateSize),document.removeEventListener("onfullscreenchange",this.updateSize),document.removeEventListener("webkitfullscreenchange",this.updateSize),document.removeEventListener("mozfullscreenchange",this.updateSize),document.removeEventListener("msfullscreenchange",this.updateSize),document.removeEventListener("MSFullscreenChange",this.updateSize),document.removeEventListener("fullscreenchange",this.updateSize)}static getDerivedStateFromProps(e,t){if(t.container){let s=t.container.clientWidth,o=t.container.clientHeight;if(o||(o=1),t.width!==s||t.height!==o){const a={aspectRatio:s/o,width:s,height:o};return e.appState.devMode&&console.log("components/Panel getDerivedStateFromProps size update",a,t),a}}return null}onClick(e,t){let{name:s,value:o}=t;const{state:a}=this;"settings"===s&&this.setState((e=>({settingsActive:!a.settingsActive}))),this.devMode&&console.log("components/Panel onClick ",s,o,e,a)}}var T=s(226),P=s(142),L=s(153),V=s.n(L);class E extends A{constructor(e){super(e),this._isMounted=!1,this.bitrateOptions=e=>{var t=[];t.push({key:"bitrate-title",text:Object(w.jsxs)("span",{children:[Object(w.jsx)("strong",{children:"Video Bitrate"})," ",this.state.maxBitrate?" <"+this.state.maxBitrate+"kbps":""]}),disabled:!0});var s=this.state.maxBitrate;let o=!1;return[{value:.35,label:"Very Low"},{value:.5,label:"Low"},{value:.75,label:"Medium"},{value:1,label:"Good"},{value:1.25,label:"High"},{value:1.5,label:"Very High"}].forEach((a=>{var i=Math.round(a.value*e);i===s&&(o=!0),i<=s&&t.push({key:i,value:i,text:i+" kbps "+a.label})})),(0===t.length||!o&&1.5*e>s)&&t.push({key:s,value:s,text:s+" kbps Limit"}),t},this.onopen=function(e){if(this.devMode&&console.log("components/Camera wsConnection.onopen ",this.wsConnection.readyState,e,this.state),this.wsMessaged=!1,this.props.appStateUpdate({wsOpen:!0,wsComponent:"Camera onopen"}),1!=this.wsConnection.readyState)return;this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.onicecandidate=this.onicecandidate.bind(this),this.peerConnection.onsignalingstatechange=this.onsignalingstatechange.bind(this),this.peerConnection.oniceconnectionstatechange=this.oniceconnectionstatechange.bind(this),this.peerConnection.onnegotiationneeded=this.onnegotiationneeded.bind(this),this.peerConnection.onconnectionstatechange=this.onconnectionstatechange.bind(this);if(this.localStream.getAudioTracks().forEach((e=>this.peerConnection.addTrack(e,this.localStream))),!this.audioInterface){this.localStream.getVideoTracks().forEach((e=>this.peerConnection.addTrack(e,this.localStream)))}this.devMode&&console.log("components/Camera wsConnection.onopen setting wsMessagedCheck"),setTimeout((()=>this.wsMessagedCheck()),6e3);try{this.setPeerBitrate(this.peerConnection,Number(this.state.audioBitrate),Number(this.state.bitrate),Number(this.state.frameRate))}catch(t){console.error("Failed to set bitrate limits:",t,Number(this.state.audioBitrate),Number(this.state.bitrate))}},this.wsMessagedCheck=()=>{this.devMode&&console.log("components/Camera wsConnection wsMessagedCheck",this.wsMessaged),this.wsMessaged||(this.setState({buttonDisabled:!1,buttonContent:this.txt("Broadcast"),statusInfo:"Websocked did not reply"}),console.log("components/Camera wsMessagedCheck","Websocked did not reply with ice candidates",this.wsConnection),this.retryIfTimeoutSet||this.retryIfTimeout())},this.onWsMessage=e=>{this.wsMessaged=!0,this.devMode&&console.log("components/Camera wsConnection.onWsMessage",e);var t=JSON.parse(e.data),s=Number(t.status);t.command;if(504===s)console.log("components/Camera wsConnection.onWsMessage status=504 New stream connecting to WSE");else if(503===s)this.retryIfBusy&&setTimeout((()=>this.buildStream()),2500),this.retryIfBusy=!1,console.log("components/Camera wsConnection.onWsMessage 503 error busy, retry:",s,t.statusDescription,this.retryIfBusy),this.setState({buttonDisabled:!0,buttonContent:this.txt("Auto Retry"),statusInfo:t.statusDescription,connecting:!0,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"});else if(200!=s)console.log("components/Camera wsConnection.onWsMessage error sdp:",s,t.statusDescription,this.streamInfo),this.stopPublisher(),this.setState({buttonDisabled:!1,buttonContent:this.txt("Broadcast"),statusInfo:t.statusDescription,connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"}),this.retriesLeft=0,this.retryIfBusy=!0;else{var o=t.sdp;void 0!==o&&(this.devMode&&console.log("components/Camera wsConnection.onWsMessage 200 sdp:",t.sdp),this.peerConnection.setRemoteDescription(o).then((()=>{this.devMode&&console.log("components/Camera peerConnection.setRemoteDescription: ",this.peerConnection,o)})).catch((e=>{var t=o.sdp,s=t.substring(t.length-2);console.log("components/Camera peerConnection.setRemoteDescriptionError",e,t,s,"\r\n"==s)})));var a=t.iceCandidates;if(this.devMode&&console.log("components/Camera wsConnection msgJSON iceCandidates: ",a),void 0!==a){for(var i in a)this.devMode&&console.log("components/Camera wsConnection iceCandidate: ",i,a[i]),this.peerConnection.addIceCandidate(new RTCIceCandidate(a[i])).then((()=>this.onAddIceCandidateSuccess(this.peerConnection)),(e=>this.onAddIceCandidateError(this.peerConnection,e)));this.wsConnection&&this.wsConnection.readyState<2&&this.wsConnection.close()}this.retryIfBusy=!0}},this.errorHandler=e=>{this.devMode&&console.log("components/Camera",e)},this.devMode=e.appState.devMode,this.devMode&&console.log("components/Camera constructor",e),this.serverVideowhisper=!1,this.serverWowza=!1,this.audioInterface=!1,e.cameraConfig&&(this.audioInterface=e.cameraConfig.audioInterface),this.tChecked=!1,this.retriesLeft=5,this.retryTimeout=5500,this.retryIfTimeoutSet=!1,this.retryIfBusy=!0,this.wsConnection=null,this.peerConnection=null,this.peerConnectionConfig={iceServers:[],optional:[{googSuspendBelowMinBitrate:!1,googImprovedWifiBwe:!0}]},this.vwsPeerConfig=this.peerConnectionConfig,this.localStream=null,this.streamInfo=null,this.userData=null,this.SDPOutput={},this.offerOptions={offerToReceiveAudio:1,offerToReceiveVideo:1},this.localVideo=a.a.createRef(),this.stats={video:{timestamp:0,bandwidth:0,bitrate:0,packetsLost:0,qualityLimitationReason:"none"},audio:{timestamp:0,bandwidth:0,bitrate:0,packetsLost:0}},this.videoIndex=-1,this.audioIndex=-1,this.changedBy="",this.enhanceData={},this.tWarn="",this.resolutions={"4K":{label:"4K",width:3840,height:2160,ratio:"16:9",bitrate:16e3},"1440p":{label:"1440p",width:2560,height:1440,ratio:"16:9",bitrate:6e3},"1080p":{label:"1080p",width:1920,height:1080,ratio:"16:9",bitrate:4e3},"720p":{label:"720p",width:1280,height:720,ratio:"16:9",bitrate:1600},SVGA:{label:"SVGA",width:800,height:600,ratio:"4:3",bitrate:800},"480p":{label:"480p",width:854,height:480,ratio:"16:9",bitrate:800},VGA:{label:"VGA",width:640,height:480,ratio:"4:3",bitrate:600},"360p":{label:"360p",width:640,height:360,ratio:"16:9",bitrate:500},"240p":{label:"240p",width:426,height:240,ratio:"16:9",bitrate:300},CIF:{label:"CIF",width:352,height:288,ratio:"4:3",bitrate:200},QVGA:{label:"QVGA",width:320,height:240,ratio:"4:3",bitrate:180},"180p":{label:"180p",width:320,height:180,ratio:"16:9",bitrate:160},"90p":{label:"90p",width:160,height:90,ratio:"16:9",bitrate:100}},this.state={screenShare:!1,audioOn:!0,videoOn:!0,hasError:!1,errorMessage:"Check JS console.",packetLoss:!1,revealed:!0,tapRequired:!1,connected:!1,connecting:!1,settingsActive:!1,statusInfo:"Connecting...",buttonContent:"Connecting",buttonDisabled:!0,bitrateInfo:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"eye slash"}),"Detecting"]}),videoWidth:640,videoHeight:360,videoAspectRatio:1.73,camera:null,cameraOptions:[],videoSource:null,microphone:null,microphoneOptions:[],audioSource:null,maxBitrate:750,maxResolutionHeight:360,maxFrameRate:15,bitrate:500,audioBitrate:48,bitrateOptions:[{key:500,value:500,text:"500 kbps"}],frameRateOptions:[{key:10,value:10,text:"10 fps"}],frameRate:15,resolution:"360p",resolutionOptions:[]},this.onChange=this.onChange.bind(this)}static getDerivedStateFromError(e){return console.log("components/Camera getDerivedStateFromError",e),{hasError:!0,errorMessage:e.toString()}}componentDidCatch(e,t){console.log("components/Camera componentDidCatch",e,t)}componentDidMount(){this.devMode&&console.log("components/Camera componentDidMount"),this._isMounted=!0,super.componentDidMount(),this.interfaceReady()}componentWillUnmount(){this.devMode&&console.log("components/Camera componentWillUnmount"),this.stopSnapshots(),this.props.serverUpdate({task:"media",connected:!1}),this._isMounted=!1,this.stopPublisher(),this.vwsSocket&&this.vwsSocket.disconnect();var{state:e}=this;this.localStream&&this.localStream.getTracks().forEach((e=>e.stop())),super.componentWillUnmount()}timerStart(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.packetsLost=0,this.stats.audio.packetsLost=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),2500),this.setState({packetLoss:!1})}timerStop(){clearInterval(this.timer),this.setState({packetLoss:!1})}timerTick(){var e=0;if(this.state.connected&&this.streamInfo&&this.streamInfo.streamName!=this.props.room.streamBroadcast&&(e=1),(this.props.appState.publishRequired||e)&&(this.state.connected||"1"==this.props.config.cameraAutoBroadcast)&&(this.devMode&&console.log("components/Camera timerTick publishRequired",this.props.appState.publishRequired,e,this.streamInfo),this.props.appStateUpdate({publishRequired:!1}),this.setState({buttonDisabled:!0,buttonContent:this.txt("Closing")}),this.stopPublisher(),this.serverVideowhisper&&this.vwsSocket&&this.vwsSocket.connected&&this.vwsSocket.disconnect(),this.setState({buttonDisabled:!0,buttonContent:this.txt("Restarting Broadcast"),statusInfo:this.txt("Restarting Broadcast"),connecting:!0,connected:!1}),this.buildStream()),this.serverVideowhisper&&(this.state.settingsActive||this.audioInterface)&&(this.connectionInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"broken chain"}),"Socket Not Connected"]}),this.wsConnection&&(this.connectionInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"chain"}),this.wsConnection.readyState]})),this.vwsSocket&&(this.connectionInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:this.vwsSocket.connected?"chain":"unlink"})," "]})),this.peerInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"play circle"}),this.vwsChannel,": ",Object.keys(this.vwsPeers).length," Peers"]}),this.bitrateInfo=Object(w.jsxs)(w.Fragment,{children:[this.connectionInfo," ",this.peerInfo]}),this.setState({bitrateInfo:this.bitrateInfo})),this.state.connected&&this.peerConnection){this.peerConnection.getSenders().forEach((e=>{e.getStats().then((e=>{e.forEach((e=>{var t=e.kind;if(void 0===t&&(t=e.mediaType),t&&(this.devMode&&e.packetsLost>0&&console.log("components/Camera packetsLost ",e.packetsLost,t,e),"remote-inbound-rtp"==e.type&&(this.stats[t]||(this.stats[t]={}),this.stats[t].packetsLost=e.packetsLost,this.stats[t].roundTripTime=e.roundTripTime,this.stats[t].jitter=e.jitter,this.stats[t].timestampRemote=e.timestamp),"outbound-rtp"===e.type&&!e.isRemote&&("video"===t||"audio"===t))){var s=e.timestamp-this.stats[t].timestamp;s>0&&s<6e3&&e.bytesSent>=this.stats[t].bytesSent&&(this.stats[t].bitrate=8*(e.bytesSent-this.stats[t].bytesSent)/s),this.stats[t].timestamp=e.timestamp,this.stats[t].bytesSent=e.bytesSent,this.stats[t].qualityLimitationReason=e.qualityLimitationReason}}))}))}));var t="";this.audioInterface||this.props.room.audioOnly||this.props.appState.audioMode||"Way2Screen"==this.props.appState.screen&&this.props.appState.revealMode&&!this.props.appState.revealed||(t=Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"video camera"}),Math.round(this.stats.video.bitrate)," kbps","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":"",this.stats.video.roundTripTime>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"clock"}),this.stats.video.roundTripTime," "]}):"",this.stats.video.jitter>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"circle notch"}),Math.round(1e3*(this.stats.video.jitter+Number.EPSILON))/1e3," jitter "]}):"",this.stats.video.packetsLost>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"exclamation circle"}),this.stats.video.packetsLost," packets lost "]}):"",Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"expand"}),this.state.videoWidth,"x",this.state.videoHeight," "]}),Object(w.jsx)("br",{})]})),this.connectionInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"broken chain"}),"Socket Not Connected"]}),this.wsConnection&&(this.connectionInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"chain"}),this.wsConnection.readyState]})),this.vwsSocket&&(this.connectionInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:this.vwsSocket.connected?"chain":"unlink"})," "]})),this.peerInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"stop circle"}),"Peer Not Connected"]}),this.peerConnection&&(this.peerInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"play circle"}),this.peerConnection.connectionState,"/",this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState]}));var s=Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"wait"}),"Measuring..."]}),o="";this.streamInfo&&this.streamInfo.streamName&&(o=this.streamInfo.streamName.split("?")[0]),(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(s=Object(w.jsxs)("div",{children:[Object(w.jsx)(O.a,{name:"user"})," ",o," ",Object(w.jsx)("br",{}),t,Object(w.jsx)(O.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps","none"!==this.stats.audio.qualityLimitationReason&&void 0!==this.stats.audio.qualityLimitationReason?"(limited: "+this.stats.audio.qualityLimitationReason+")":"",this.stats.audio.roundTripTime>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"clock"}),this.stats.audio.roundTripTime," "]}):"",this.stats.audio.jitter>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"circle notch"}),Math.round(1e3*(this.stats.audio.jitter+Number.EPSILON))/1e3," jitter "]}):"",this.stats.audio.packetsLost>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"exclamation circle"}),this.stats.audio.packetsLost," packets lost "]}):"",Object(w.jsx)("br",{}),this.connectionInfo," ",this.peerInfo]})),(this.state.settingsActive||this.audioInterface)&&this.setState({bitrateInfo:s}),(this.stats.audio.packetsLost||this.stats.video.packetsLost)&&(this.state.packetLoss||this.setState({packetLoss:!0}))}}render(){if(this.state.hasError)return Object(w.jsxs)("h1",{children:["Something went wrong: ",this.state.errorMessage," "]});const{state:e,props:t,onChange:s}=this;this.devMode=t.appState.devMode;var o={};if(!this.audioInterface){let t=e.videoWidth,s=e.videoHeight,a=0,i=0;e.width&&e.aspectRatio&&e.videoAspectRatio&&(e.videoAspectRatio>e.aspectRatio?(t=e.width,s=t/e.videoAspectRatio,i=(e.height-s)/2):(s=e.height,t=s*e.videoAspectRatio,a=(e.width-t)/2)),o={position:"absolute",left:a,top:i,width:t,height:s}}var a="";e.tapRequired&&(a=Object(w.jsxs)(U.a.Field,{children:[Object(w.jsx)(x.a,{inverted:!0,name:"tap",content:"Tap to Show",onClick:this.onClick.bind(this)}),Object(w.jsx)(C.a,{pointing:"left",color:"black",children:"Gesture is required to show preview"})]}));var i="",n="",r="",c="microphone";this.audioInterface||t.room.audioOnly||t.appState.audioMode||"Way2Screen"==t.appState.screen&&t.appState.revealMode&&!t.appState.revealed||(c="video","function"===typeof navigator.mediaDevices.getDisplayMedia&&(i=Object(w.jsxs)(U.a.Field,{inline:!0,children:[Object(w.jsx)(x.a,{compact:!0,inverted:t.appState.darkMode,size:"small",name:"screenShare",content:this.txt("Screen Share"),onClick:this.onClick.bind(this)})," ","_screen"==e.videoSource?Object(w.jsx)(O.a,{color:"green",name:"eye"}):""]})),e.screenShare||(n=Object(w.jsxs)(U.a.Field,{children:[Object(w.jsx)(I.a,{upward:!0,compact:!0,className:"inverted tiny v-select",name:"camera",value:e.camera,placeholder:"Camera",selection:!0,onChange:this.onChange,options:e.cameraOptions})," ",e.videoSource==e.camera&&"_disabled"!=e.videoSource?Object(w.jsx)(O.a,{color:"green",name:"eye"}):""," "]})),r=Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(U.a.Field,{children:Object(w.jsx)(I.a,{upward:!0,compact:!0,className:"inverted tiny v-select",name:"resolution",value:e.resolution,onChange:s,placeholder:"Video Resolution",selection:!0,options:e.resolutionOptions})}),Object(w.jsx)(U.a.Field,{children:Object(w.jsx)(I.a,{upward:!0,compact:!0,className:"inverted tiny v-select",name:"bitrate",value:e.bitrate,onChange:s,placeholder:"Video Bitrate",selection:!0,options:e.bitrateOptions})}),Object(w.jsx)(U.a.Field,{children:Object(w.jsx)(I.a,{upward:!0,compact:!0,className:"inverted tiny v-select",name:"frameRate",value:e.frameRate,onChange:s,placeholder:"Video Frame Rate",selection:!0,options:e.frameRateOptions})})]})),this.tChecked||this.updateBitrates();var d="";e.settingsActive?(this.connectionInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"broken chain"}),"Socket Not Connected"]}),this.wsConnection&&(this.connectionInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"chain"}),this.wsConnection.readyState]})),this.peerInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"stop circle"}),"Peer Not Connected"]}),this.peerConnection&&(this.peerInfo=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"play circle"}),this.peerConnection.connectionState,"/",this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState]})),d=Object(w.jsxs)("div",{className:"controlsBottom vwsCameraControls",children:[Object(w.jsx)(C.a,{size:"tiny",color:"black",children:this.tWarn}),i,n,Object(w.jsx)(U.a.Field,{children:Object(w.jsx)(I.a,{upward:!0,compact:!0,className:"inverted tiny v-select",name:"microphone",value:e.microphone,onChange:s,placeholder:"Microphone",selection:!0,onChange:this.onChange,options:e.microphoneOptions},"microphone")}),r,Object(w.jsxs)(U.a.Field,{children:[Object(w.jsx)(x.a,{compact:!0,inverted:!0,name:"broadcast",content:e.buttonContent,onClick:this.onClick.bind(this),disabled:e.buttonDisabled}),Object(w.jsx)(C.a,{pointing:"left",color:"black",children:e.statusInfo})]}),a,Object(w.jsx)(C.a,{color:"black",children:e.connected?e.bitrateInfo:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:("microphone"==c?"microphone":"eye")+" slash"}),"Not Broadcasting ",this.connectionInfo," ",this.peerInfo," "]})})]})):this.tWarn.length>0&&(d=Object(w.jsx)("div",{className:"controlsBottom",children:Object(w.jsx)(C.a,{size:"tiny",pointing:"left",color:"black",children:this.tWarn})}));var l="";e.packetLoss&&(l=Object(w.jsx)("span",{"data-tooltip":this.txt("Packet Loss: Upload Connection Issue"),"data-position":"left center",children:Object(w.jsx)(O.a,{inverted:!0,name:"exclamation circle",size:"large"})}));var p=Object(w.jsx)(O.a,{inverted:!0,color:"black",name:("microphone"==c?"microphone":"eye")+" slash",size:"large"});e.connecting&&(p=Object(w.jsx)(O.a,{inverted:!0,loading:!0,name:"spinner",size:"large"})),e.connected&&(p=Object(w.jsx)(O.a,{inverted:!0,name:c,size:"large"}));var h=Object(w.jsxs)(x.a,{compact:!0,name:"audioToggle",size:"small",inverted:!0,icon:!0,toggle:!0,active:e.audioOn,onClick:this.onClick.bind(this),"data-tooltip":e.audioOn?this.txt("Mute Microphone"):this.txt("Enable Microphone"),"data-position":"left center",children:[" ",Object(w.jsx)(O.a,{name:"microphone"})]}),m=Object(w.jsx)(x.a,{compact:!0,name:"videoToggle",size:"small",inverted:!0,icon:!0,toggle:!0,active:e.videoOn,onClick:this.onClick.bind(this),"data-tooltip":e.videoOn?this.txt("Hide Camera"):this.txt("Enable Camera"),"data-position":"left center",children:Object(w.jsx)(O.a,{name:"video"})});return"microphone"==c&&(m=""),this.audioInterface?Object(w.jsx)("div",{className:"panel vwsMicrophone",style:{backgroundColor:t.appState.backgroundColor},ref:e=>this.state.container=e,children:Object(w.jsx)(U.a,{children:Object(w.jsxs)(U.a.Group,{inline:!0,children:[Object(w.jsx)(U.a.Field,{inline:!0,children:Object(w.jsx)(O.a,{inverted:t.appState.darkMode,name:"microphone"})}),Object(w.jsx)(U.a.Field,{inline:!0,children:Object(w.jsx)(x.a,{compact:!0,inverted:t.appState.darkMode,size:"small",name:"broadcast",content:e.buttonContent,onClick:this.onClick.bind(this),disabled:e.buttonDisabled})}),Object(w.jsx)(U.a.Field,{inline:!0,children:Object(w.jsx)(I.a,{compact:!0,className:"v-select",size:"small",className:t.appState.className,name:"microphone",value:e.microphone,onChange:s,placeholder:"Microphone",selection:!0,onChange:this.onChange,options:e.microphoneOptions},"microphone")}),Object(w.jsx)(U.a.Field,{inline:!0,children:Object(w.jsx)(C.a,{pointing:"left",color:t.appState.darkMode?"black":"grey",children:e.statusInfo})}),Object(w.jsx)(U.a.Field,{inline:!0,children:l}),Object(w.jsx)(U.a.Field,{inline:!0,children:Object(w.jsx)(C.a,{size:"tiny",children:e.connected?e.bitrateInfo:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:("microphone"==c?"microphone":"eye")+" slash"}),"Not Broadcasting ",this.connectionInfo," ",this.peerInfo," "]})})})]})})}):Object(w.jsxs)("div",{className:"panel vwsCamera",ref:e=>this.state.container=e,children:[Object(w.jsx)("div",{className:"backgroundVideo",children:Object(w.jsx)("video",{poster:t.config.cameraSnapshot?t.config.cameraSnapshot:t.room.snapshot,style:o,id:"localVideo",ref:this.localVideo,className:"localVideo",autoPlay:!0,playsInline:!0,muted:!0,onLoadedMetadata:()=>{this.updateVideoSize("loadedmetadata"),this.videoPlay()}})}),Object(w.jsxs)("div",{className:"controlsIcons",children:[l,p,h,m,Object(w.jsx)(x.a,{compact:!0,name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:e.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":"Toggle Controls","data-position":"left center",children:Object(w.jsx)(O.a,{name:"settings"})})]}),d]})}onChange(e,t){let{name:s,value:o}=t;this.setState({[s]:o}),this.changedBy=s,this.devMode&&console.log("components/Camera onChange",s,o,e),navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this))}onClick(e,t){let{name:s,value:o}=t;const{txt:a,props:i,state:n}=this;if(this.devMode&&console.log("components/Camera onClick",s,o,e),"screenShare"===s&&(n.screenShare?this.setState({videoSource:n.camera,screenShare:!1},(()=>this.buildStream())):this.setState({videoSource:"_screen",screenShare:!0},(()=>this.buildStream()))),"tap"===s&&this.videoPlay(),"audioToggle"===s&&this.setState({audioOn:!n.audioOn},(()=>this.buildStream())),"videoToggle"===s&&this.setState({videoOn:!n.videoOn},(()=>this.buildStream())),"broadcast"===s)switch(this.state.buttonContent){case a("Broadcast"):this.retriesLeft=5,this.setState({buttonDisabled:!0,buttonContent:a("Starting Broadcast"),statusInfo:a("Starting Broadcast"),connecting:!0,connected:!1}),this.buildStream();break;case a("Stop Broadcast"):this.retriesLeft=0,this.setState({buttonDisabled:!0,buttonContent:a("Ending"),statusInfo:a("Ending")}),this.stopPublisher(),this.setState({buttonDisabled:!1,buttonContent:a("Broadcast"),statusInfo:a("Stopped Broadcast"),connecting:!1,connected:!1}),i.serverUpdate({task:"media",connected:!1}),i.appStateUpdate({cameraStatus:"off"}),this.stopSnapshots()}super.onClick(e,{name:s,value:o})}retryIfTimeout(){if(this.devMode)return console.log("components/Camera retryIfTimeout skipped on devMode"),void(this.retryIfTimeoutSet=!1);this.state.connected||this.retriesLeft>0&&(this.retriesLeft--,this.stopPublisher(),this.setState({buttonDisabled:!0,buttonContent:this.txt("Auto Retry"),statusInfo:this.txt("Auto Retry"),connecting:!0,connected:!1}),this.buildStream()),this.retryIfTimeoutSet=!1}updateBitrates(){const{props:e}=this;if(this.bitrate=Number(e.config.bitrate),this.bitrate||(this.bitrate=500),this.audioBitrate=Number(this.props.config.audioBitrate),this.audioBitrate||(this.audioBitrate=32),this.resolutionHeight=Number(e.config.resolutionHeight),this.resolutionHeight||(this.resolutionHeight=360),this.videoBitrate=Number(e.config.videoBitrate),this.maxBitrate=Number(e.config.maxBitrate),this.videoBitrate<this.maxBitrate&&(this.maxBitrate=this.videoBitrate),this.maxBitrate||(this.maxBitrate=0),this.maxResolutionHeight=Number(e.config.maxResolutionHeight),this.maxResolutionHeight||(this.maxResolutionHeight=0),this.frameRate=Number(e.config.frameRate),this.frameRate||(this.frameRate=15),this.maxFrameRate<this.frameRate&&(this.frameRate=this.maxFrameRate),this.tWarn="",(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&(this.resolutionHeight>360&&(this.resolutionHeight=360),this.bitrate>750&&(this.bitrate=750),this.maxResolutionHeight>360&&(this.maxResolutionHeight=360),this.maxResolutionHeight||(this.maxResolutionHeight=360),this.maxBitrate>750&&(this.maxBitrate=750),this.maxBitrate||(this.maxBitrate=750),this.maxFrameRate>15&&(this.maxFrameRate=15),this.maxFrameRate||(this.maxFrameRate=15),this.frameRate||(this.frameRate=15),this.frameRate>this.maxFrameRate&&(this.frameRate=this.maxFrameRate),this.bitrate>this.maxBitrate&&(this.bitrate=this.maxBitrate),this.resolutionHeight>this.maxResolutionHeight&&(this.resolutionHeight=this.maxResolutionHeight),this.audioBitrate>32&&(this.audioBitrate=32),this.tWarn="Demo Mode Configured: Broadcasting Resolution, Bitrate, FPS is Limited"),this.state.maxBitrate=this.maxBitrate,this.state.maxResolutionHeight=this.maxResolutionHeight,this.state.maxFrameRate=this.maxFrameRate,this.resolutionOptions=[{key:"res-title",text:Object(w.jsxs)("span",{children:[Object(w.jsx)("strong",{children:this.txt("Video Resolution")}),this.state.maxResolutionHeight?" <"+this.state.maxResolutionHeight+"p":""]}),disabled:!0}],this.frameRateOptions=[{key:"fps-title",text:Object(w.jsxs)("span",{children:[Object(w.jsx)("strong",{children:this.txt("Video Frame Rate")}),this.state.maxFrameRate?" <"+this.state.maxFrameRate+this.txt("fps"):""]}),disabled:!0}],this.resolutions)for(var t in this.resolutions)(0===this.maxBitrate||.35*this.resolutions[t].bitrate<=this.maxBitrate)&&(0===this.maxResolutionHeight||this.resolutions[t].height<=this.maxResolutionHeight)&&this.resolutionOptions.push({key:t,value:t,text:this.resolutions[t].label+" "+this.resolutions[t].width+"x"+this.resolutions[t].height+" "+this.resolutions[t].ratio});for(var s of[5,10,15,24,30,48,60,120])(0===this.maxFrameRate||s<=this.maxFrameRate)&&this.frameRateOptions.push({key:s,value:s,text:s+" "+this.txt("fps")});this.state.resolutionOptions=this.resolutionOptions,this.state.bitrateOptions=this.bitrateOptions(this.bitrate),this.state.frameRateOptions=this.frameRateOptions,this.state.resolution=this.resolutionHeight.toString()+"p",this.state.maxBitrate=this.maxBitrate,this.state.bitrate=this.bitrate,this.state.audioBitrate=this.audioBitrate,this.state.frameRate=this.frameRate,e.appState.checked&&(this.tChecked=!0)}interfaceReady(){var{state:e}=this;const{props:t}=this;setTimeout((()=>this.props.serverUpdate({task:"media",connected:!1})),500),this.updateBitrates(),this.setState({resolutionOptions:this.resolutionOptions,resolution:this.resolutionHeight.toString()+"p",bitrateOptions:this.bitrateOptions(this.bitrate),maxBitrate:this.maxBitrate,bitrate:this.bitrate,settingsActive:"1"==this.props.config.cameraControls});const{cameraAutoBroadcast:s}=this.props.config,{txt:o}=this;if(!navigator.mediaDevices)return this.devMode&&console.log("components/Camera interfaceReady navigator.mediaDevices",navigator.mediaDevices),void this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:o("Broadcast"),statusInfo:"Navigator media devices not available!",connecting:!1,connected:!1});if("1"!=s||this.props.appState.external){var a=o("Make a selection to start!");this.props.appState.external&&(a=o("External broadcast detected.")),navigator.mediaDevices.enumerateDevices().then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)),this.setState({buttonDisabled:!1,buttonContent:o("Broadcast"),statusInfo:a,connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"off"})}else navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this)),this.setState({statusInfo:"Connecting...",connecting:!0,connected:!1}),this.props.appStateUpdate({cameraStatus:"pending"});this.devMode&&console.log("components/Camera interfaceReady ",s,this.maxBitrate,this.maxResolutionHeight,this.maxFrameRate)}videoPlay(){const e=this.localVideo.current;var{state:t}=this,s=!1,o=e.play();void 0!==o&&o.catch((e=>{s=!0,console.log("components/Camera Auto play error:"+e,e),this.setState({tapRequired:!0,settingsActive:!0})})).then((()=>{s||(this.setState({tapRequired:!1}),t.connected&&this.setState({settingsActive:!1}))}))}composedStream(e){let[t,s]=e;var o=new MediaStream;if(this.devMode&&console.log("components/Camera/composedStream : ",t,s,o),s.getVideoTracks().forEach((function(e){o.addTrack(e)})),s.getAudioTracks().length>0){var a=new AudioContext,i=a.createMediaStreamDestination();const e=a.createMediaStreamSource(s),n=a.createGain();if(n.gain.value=1,e.connect(n).connect(i),this.devMode&&console.log("composedStream added system audio"),t&&t.getAudioTracks().length>0){const e=a.createMediaStreamSource(t),s=a.createGain();s.gain.value=1,e.connect(s).connect(i),this.devMode&&console.log("composedStream added mic audio")}i.stream.getAudioTracks().forEach((function(e){o.addTrack(e)}))}else t.getAudioTracks().forEach((function(e){o.addTrack(e)}));return this.devMode&&console.log("components/Camera/composedStream : ",t,s,o),o}takeSnapshot(){var{props:e}=this;const t=this.localVideo.current,s=document.createElement("canvas");s.width=t.videoWidth,s.height=t.videoHeight,s.getContext("2d").drawImage(t,0,0);const o=s.toDataURL("image/png");e.serverUpdate({task:"snapshot",data:o}),s.remove()}startSnapshots(){var{props:e}=this;if(this.timerSnap&&clearInterval(this.timerSnap),!e.config.snapshotDisable&&!e.room.snapshotDisable){var t=Number(e.config.snapshotInterval);t<10&&(t=300),this.takeSnapshot(),this.timerSnap=setInterval(this.takeSnapshot.bind(this),1e3*t)}}stopSnapshots(){this.timerSnap&&clearInterval(this.timerSnap)}buildStream(){if(this._isMounted){var{state:e,props:t}=this;for(var s in window.stream&&window.stream.getTracks().forEach((e=>{e.stop()})),this.audioInterface||(this.localVideo.current.srcObject=null),this.resolutions)s==e.resolution&&(e.videoWidth=this.resolutions[s].width,e.videoHeight=this.resolutions[s].height,"bitrate"!==this.changedBy&&(0===e.maxBitrate||this.resolutions[s].bitrate<=e.maxBitrate?e.bitrate=this.resolutions[s].bitrate:e.bitrate=e.maxBitrate),e.bitrateOptions=this.bitrateOptions(this.resolutions[s].bitrate));if(this.constraints={},e.audioOn&&"_disabled"!=e.audioSource?this.constraints.audio={deviceId:e.audioSource?{ideal:e.audioSource}:void 0}:this.constraints.audio=!1,this.audioInterface||t.room.audioOnly||t.appState.audioMode||"Way2Screen"==t.appState.screen&&t.appState.revealMode&&!t.appState.revealed?this.constraints.video=!1:e.videoOn&&"_disabled"!=e.videoSource&&!e.screenShare?this.constraints.video={deviceId:e.videoSource?{ideal:e.videoSource}:void 0,width:{ideal:e.videoWidth,max:e.videoWidth},height:{ideal:e.videoHeight,max:e.videoHeight},frameRate:{ideal:e.frameRate,max:e.frameRate}}:this.constraints.video=!1,navigator.userAgent.indexOf("Firefox")>0&&this.constraints.video&&(delete this.constraints.video.width.max,delete this.constraints.video.height.max,delete this.constraints.video.frameRate.max),"_screen"!==e.videoSource)e.audioOn&&"_disabled"!=e.audioSource&&"_screen"!=e.videoSource||e.videoOn&&"_disabled"!=e.videoSource&&!e.screenShare?navigator.mediaDevices.getUserMedia(this.constraints).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)):console.log("Camera/buildStream NO SOURCE enabled",e.videoSource,e.audioSource,e.videoOn,e.audioOn),this.devMode&&console.log("components/Camera/buildStream videoSource: ",e.videoSource,"  constraints=",this.constraints);else{var o={video:!0,audio:!0,systemAudio:"include"};if(navigator.mediaDevices.getDisplayMedia)if(this.constraints.audio){const e=navigator.mediaDevices.getDisplayMedia(o).catch(this.handleError.bind(this)),t=navigator.mediaDevices.getUserMedia(this.constraints).catch(this.handleError.bind(this));console.log("components/Camera/buildStrea Promise.all fc",e,t),Promise.all([t,e]).then((e=>this.composedStream(e))).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this))}else navigator.mediaDevices.getDisplayMedia(o).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this));else console.log("components/Camera/buildStream getDisplayMedia not supported");this.devMode&&console.log("components/Camera/buildStream screen videoSource: ",e.videoSource,"  constraintsScreen=",o,"  constraints=",this.constraints)}}else console.log("components/Camera buildStream not mounted")}handleError(e){if(console.log("components/Camera navigator.mediaDevices handleError: ",e," this._isMounted="+this._isMounted),this._isMounted){var t="";if("OverconstrainedError"===e.name)t=" ("+e.constraint+")";this.setState({settingsActive:!0,statusInfo:"Media Error: "+e.name+t,buttonDisabled:!1,buttonContent:this.txt("Broadcast"),connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"}),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices||console.log("components/Camera navigator.mediaDevices handleError - enumerateDevices() - not supported"),navigator.mediaDevices.enumerateDevices().then((function(e){e.forEach((function(e){console.log("components/Camera navigator.mediaDevices handleError enumerateDevices "+e.kind+": "+e.label+" id = "+e.deviceId)}))})).catch((function(e){console.log("components/Camera navigator.mediaDevices handleError enumerateDevices error: "+e.name+": "+e.message)}))}}gotStream(e){const t=this.state;this.audioInterface||(this.localVideo.current.srcObject=e);const s=e.getVideoTracks()[0];let o="no video track";return s&&(o=-1===navigator.userAgent.toLowerCase().indexOf("firefox")?s.getCapabilities():"capabilities not supported in Firefox"),this.devMode&&console.log("components/Camera/gotStream after getUserMedia",o,e),s&&s.applyConstraints({width:{min:Math.floor(.8*t.videoWidth),ideal:t.videoWidth,max:Math.floor(1.1*t.videoWidth)},height:{min:Math.floor(.8*t.videoHeight),ideal:t.videoHeight,max:Math.floor(1.1*t.videoHeight)},frameRate:{ideal:t.frameRate,max:t.frameRate}}),this.localStream=e,null!=this.localStream&&this.stopPublisher(),this.startPublisher(),navigator.mediaDevices.enumerateDevices()}startPublisher(){this.devMode&&console.log("components/Camera startPublisher",this.props);const{props:e,state:t}=this;let s=e.config.serverType;e.room.serverType&&(s=e.room.serverType),"videowhisper"==s?(this.serverVideowhisper=!0,this.vwsPublish=!0,this.streamParams={width:t.videoWidth,height:t.videoHeight,bitrate:t.bitrate,frameRate:t.frameRate,audioBitrate:t.audioBitrate},this.streamInfo={applicationName:e.config.application,streamName:e.room.streamBroadcast,sessionId:"[empty]"},this.vwsChannel=e.room.streamBroadcastName?e.room.streamBroadcastName:e.room.streamBroadcast.substring(0,e.room.streamBroadcast.indexOf("?")),this.vwsSocket&&this.vwsSocket.connected?this.vwsSocket.emit("publish",this.vwsPeerId,this.vwsChannel,this.streamParams):this.vwsConnect()):(this.serverWowza=!0,this.wsConnect()),this.timerStart()}stopPublisher(){if(this.timerStop(),this.stopSnapshots(),this.serverWowza&&(this.peerConnection&&this.peerConnection.close(),this.wsConnection&&this.wsConnection.readyState<2&&this.wsConnection.close(),this.devMode&&console.log("components/Camera stopPublisher",this.wsConnection,this.peerConnection)),this.serverVideowhisper){this.vwsPublish=!1;for(const e in this.vwsPeers)this.vwsPeers[e].close();this.devMode&&console.log("components/Camera stopPublisher closing vwsPeers")}}gotDevices(e){var{state:t}=this,s=[{key:"cam-title",text:Object(w.jsxs)("span",{children:["Select ",Object(w.jsx)("strong",{children:"Camera"}),":"]}),disabled:!0},{text:"No Camera",value:"_disabled"}],o=[{key:"mic-title",text:Object(w.jsxs)("span",{children:["Select ",Object(w.jsx)("strong",{children:"Microphone"}),":"]}),disabled:!0}];"function"===typeof navigator.mediaDevices.getDisplayMedia&&t.screenShare&&s.push({key:"screen",text:this.txt("Screen Share"),value:"_screen"});let a=!1,i=!1;for(let r=0;r!==e.length;++r){const c=e[r];var n={value:c.deviceId};"audioinput"===c.kind?(n.text=c.label||`Microphone ${o.length+1}`,o.push(n),t.microphone||(t.microphone=c.deviceId),c.deviceId===t.microphone&&(i=!0)):"videoinput"===c.kind&&(n.text=c.label||`Camera ${s.length+1}`,s.push(n),t.camera||(t.camera=c.deviceId),c.deviceId===t.camera&&(a=!0))}t.screenShare||(a||"_disabled"===t.camera)&&(t.videoSource=t.camera),(i||"_disabled"===t.microphone)&&(t.audioSource=t.microphone),t.camera===t.videoSource&&t.microphone===t.audioSource||a&&i||(this.devMode&&console.log("components/Camera gotDevices: deviceID changed videoValid:"+t.camera+" videoSelected: "+t.microphone+" audioValid:"+i),this.setState({settingsActive:!0,statusInfo:"Media DeviceID changed: Please select again!",buttonDisabled:!1,buttonContent:this.txt("Broadcast")})),this.devMode&&console.log("gotDevices: verified videoSource: "+t.videoSource+" changed videoValid: "+a),this._isMounted&&this.setState({cameraOptions:s,microphoneOptions:o})}gotDevicesPublish(e){this.gotDevices(e),this.buildStream()}updateVideoSize(e){const t=this.localVideo.current;var{state:s}=this;let o;t.videoHeight&&(s.videoWidth===t.videoWidth&&s.videoHeight===t.videoHeight||(s.videoWidth=t.videoWidth,s.videoHeight=t.videoHeight,s.videoHeight||(s.videoHeight=1)),o=t.videoWidth/t.videoHeight,s.videoAspectRatio!==o&&this.setState({videoAspectRatio:o}))}vwsConnect(){const{props:e,txt:t}=this;var{state:s}=this;this.devMode&&console.log("components/Camera vwsConnect (VideoWhisper socket server)",e.config.vwsSocket,e.config.vwsToken);var o=null;this.audioInterface||(o=this.localStream.getVideoTracks());const a=this.localStream.getAudioTracks();this.audioInterface||o.length>0&&this.devMode&&console.log(`components/Camera vwsConnect Using Video device: ${o[0].label}`),a.length>0&&this.devMode&&console.log(`components/Camera vwsConnect Using Audio device: ${a[0].label}`),this.vwsSocket||(this.vwsPeerId=e.user.name,this.vwsChannel=e.room.streamBroadcastName?e.room.streamBroadcastName:e.room.streamBroadcast.substring(0,e.room.streamBroadcast.indexOf("?")),this.vwsPeers=[],this.vwsSocket=new P.a(e.config.vwsSocket,{auth:{token:e.config.vwsToken},transports:["websocket"],secure:!0,autoConnect:!1,reconnection:!1}),this.vwsSocket.on("connect",(()=>{const{state:e}=this;this.streamParams={width:e.videoWidth,height:e.videoHeight,bitrate:e.bitrate,frameRate:e.frameRate,audioBitrate:e.audioBitrate},this.devMode&&console.log("components/Camera vwsSocket Connected with id",this.vwsSocket.id,this.streamParams),this.vwsSocket.emit("publish",this.vwsPeerId,this.vwsChannel,this.streamParams)})),this.vwsSocket.on("disconnect",(()=>{this.devMode&&console.log("components/Camera vwsSocket Disconnected"),this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:t("Broadcast"),statusInfo:"Disconnected",connecting:!1,connected:!1,bitrateInfo:Object(w.jsx)(O.a,{name:"eye slash"})}),e.serverUpdate({task:"media",connected:!1}),e.appStateUpdate({cameraStatus:"off"}),this.stopSnapshots()})),this.vwsSocket.on("connect_error",(e=>{console.log("components/Camera vwsSocket Connection error",e),this.setState({statusInfo:"Connection error: "+e.message,settingsActive:!0,buttonDisabled:!1,buttonContent:t("Broadcast"),connecting:!1,connected:!1})})),this.vwsSocket.on("connect_failed",(e=>{console.log("components/Camera vwsSocket Connection failed",e),this.setState({statusInfo:"Connection failed: "+e.message,settingsActive:!0,buttonDisabled:!1,buttonContent:t("Broadcast"),connecting:!1,connected:!1})})),this.vwsSocket.on("message",(o=>{if(this.devMode&&console.log("components/Camera vwsSocket.on(message",o),o.from!=this.vwsPeerId&&("answer"==o.type&&(this.vwsPeers[o.from]?this.vwsPeers[o.from].setRemoteDescription(o.content).then((()=>{this.devMode&&console.log("components/Camera peerConnection.setRemoteDescription Success",o.target,o)})).catch((e=>{console.log("components/Camera peerConnection.setRemoteDescription Error",e,o)})):console.log("components/Camera peerConnection.setRemoteDescription Error: peer not found",o.from,this.vwsPeers)),"peer"==o.type&&this.vwsPublish&&o.peerID&&this.vwsAddPeer(o.peerID),"peers"==o.type&&(o.peerConfig&&(this.vwsPeerConfig=o.peerConfig),o.peers&&o.peers.forEach((e=>{this.vwsAddPeer(e.peerID)}))),"peer"!=o.type&&"peers"!=o.type||(this.devMode&&console.log("components/Camera peer(s) received",s.connecting,s.connected),s.connected||(this.setState({settingsActive:!1,buttonDisabled:!1,buttonContent:t("Stop Broadcast"),statusInfo:t("Broadcasting"),connecting:!1,connected:!0,bitrateInfo:Object(w.jsx)(O.a,{name:"clock"})}),e.serverUpdate({task:"media",connected:!0}),e.appStateUpdate({publishRequired:!1,cameraStatus:"live"}),this.startSnapshots())),"candidate"===o.type))if(this.vwsPeers[o.from]&&o.candidate){const e=new RTCIceCandidate(o.candidate);this.vwsPeers[o.from].addIceCandidate(e).then((()=>{this.devMode&&console.log("components/Camera peerConnection.addIceCandidate Success",o.target,o)})).catch((t=>{console.error("components/Camera peerConnection.addIceCandidate Error:",t),console.log("RTCIceCandidate(",o.candidate,e),console.log("peer",o.from,this.vwsPeers[o.from])}))}else console.log("components/Camera peerConnection.addIceCandidate Error: peer or message.candidate not found",o.from,o)})),this.vwsSocket.on("uniquenessError",(e=>{console.error(`components/Camera vwsSocket uniquenessError: ${e.message}`),this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:t("Broadcast"),statusInfo:e.message,connecting:!1,connected:!1,bitrateInfo:Object(w.jsx)(O.a,{name:"clock"})})})),this.vwsSocket.on("publishError",(e=>{console.error(`components/Camera vwsSocket publishError: ${e.message}`),this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:t("Broadcast"),statusInfo:e.message,connecting:!1,connected:!1,bitrateInfo:Object(w.jsx)(O.a,{name:"clock"})})}))),this.vwsSocket.connected||this.vwsSocket.connect(),this.devMode&&console.log("components/Camera vwsConnect connecting",this.vwsSocket)}transformSdp(e,t){const s=t.resolutionHeight,o=t.frameRate,a=t.videoBitrate;this.devMode&&console.log("components/Camera transformSdp",t);const i=V.a.parse(e),n=i.media.find((e=>"video"===e.type));return n&&n.fmtp.forEach(((e,t)=>{n.rtp[t].codec;const i=V.a.parseParams(e.config);i["max-fs"]=s,i["max-fr"]=o,i["max-mbps"]=s*o,e.config=Object.entries(i).map((e=>{let[t,s]=e;return`${t}=${s}`})).join(";"),n.bandwidth=[{type:"AS",limit:a}]})),V.a.write(i)}mungeDescription(e){const{state:t,props:s}=this;return this.enhanceData={},void 0!==s.config.audioBitrate&&(this.enhanceData.audioBitrate=Number(t.audioBitrate)),void 0!==t.bitrate&&(this.enhanceData.videoBitrate=Number(t.bitrate)),void 0!==t.frameRate&&(this.enhanceData.frameRate=Number(t.frameRate)),this.enhanceData.resolutionHeight=this.resolutionHeight?this.resolutionHeight:360,this.serverVideowhisper||"_screen"==t.videoSource?e.sdp=this.transformSdp(e.sdp,this.enhanceData):e.sdp=this.mungeSDPPublish(e.sdp,this.enhanceData),this.devMode&&console.log("components/Camera mungeDescription",this.enhanceData,e),e}vwsAddPeer(e){if(e==this.vwsPeerId)return;if(this.devMode&&console.log("components/Camera vwsAddPeer new",e,this.vwsPeerConfig),!e)return;var t=new RTCPeerConnection(this.vwsPeerConfig);t.onicecandidate=t=>{if(t.candidate){if(this.devMode&&"relay"!==t.candidate.type)return void console.log("components/Camera vwsAddPeer peerConnection.onicecandidate: Ignoring non-relay candidate in devMode",e,t.candidate);this.vwsSocket.emit("messagePeer",{from:this.vwsPeerId,target:e,type:"candidate",candidate:t.candidate}),this.devMode&&console.log("components/Camera vwsAddPeer peerConnection.onicecandidate",e,t.candidate)}else this.devMode&&console.log("components/Camera vwsAddPeer peerConnection.onicecandidate: End of candidates.",e)},t.onsignalingstatechange=s=>{this.devMode&&console.log("components/Camera vwsAddPeer peerConnection.onsignalingstatechange",e,s,t.signalingState)},t.oniceconnectionstatechange=s=>{this.devMode&&console.log("components/Camera vwsAddPeer peerConnection.oniceconnectionstatechange",e,s,t.iceConnectionState)},t.onnegotiationneeded=s=>{this.devMode&&console.log("components/Camera vwsAddPeer peerConnection.onnegotiationneeded",e,s),t.createOffer(this.offerOptions).then((s=>{s=this.mungeDescription(s),t.setLocalDescription(s).then((()=>{const t={target:e,type:"offer",content:s,from:this.vwsPeerId,target:e,peerConfig:this.vwsPeerConfig};this.devMode&&console.log("components/Camera vwsAddPeer/createOffer/setLocalDescription",t),this.vwsSocket.emit("messagePeer",t)})).catch((e=>{console.log("components/Camera peerConnection.setLocalDescription Error",e,s)}))})).catch((e=>{console.log("components/Camera peerConnection.createOffer Error",e,this.offerOptions)}))},t.onconnectionstatechange=s=>{if(this.devMode&&console.log("components/Camera vwsAddPeer peerConnection.onconnectionstatechange",e,s,t.connectionState),"connected"==t.connectionState)try{this.setPeerBitrate(this.vwsPeers[e],Number(this.state.audioBitrate),Number(this.state.bitrate),Number(this.state.frameRate)),this.devMode&&console.log("components/Camera vwsAddPeer bitrate",Number(this.state.audioBitrate),Number(this.state.bitrate))}catch(o){console.error("Failed to set bitrate limits:",o,Number(this.state.audioBitrate),Number(this.state.bitrate))}};if(this.localStream.getAudioTracks().forEach((e=>t.addTrack(e,this.localStream))),!this.audioInterface){this.localStream.getVideoTracks().forEach((e=>t.addTrack(e,this.localStream)))}this.vwsPeers[e]=t,this.devMode&&console.log("components/Camera vwsAddPeer count",Object.keys(this.vwsPeers).length,this.vwsPeers)}setPeerBitrate(e,t,s,o){return this.devMode&&console.log("components/Camera setPeerBitrate",t,s,o,e),new Promise((async(a,i)=>{try{const i=e.getSenders(),n=i.find((e=>e.track&&"audio"===e.track.kind));if(n){const e=n.getParameters();this.devMode&&console.log("components/Camera setPeerBitrate audioParameters",e),e.encodings&&e.encodings.length>0&&(e.encodings[0].maxBitrate=1e3*t,await n.setParameters(e))}const r=i.find((e=>e.track&&"video"===e.track.kind));if(r){const e=r.getParameters();this.devMode&&console.log("components/Camera setPeerBitrate videoParameters",e),e.encodings&&e.encodings.length>0&&(e.encodings[0].maxBitrate=1e3*s,e.encodings[0].maxFramerate=o,await r.setParameters(e))}a()}catch(n){console.log("components/Camera setPeerBitrate error",n),i(n)}}))}wsConnect(){const{props:e}=this;var{state:t}=this;if(this.devMode=e.appState.devMode,this.devMode&&console.log("components/Camera wsConnect",this.props.appState.wsOpen,e.appState.wsComponent),this.props.appState.wsOpen)return this.devMode&&console.log("components/Camera wsConnection websocket busy, retrying later",this.props.appState.wsComponent),this.wsConnection&&this.wsConnection.readyState<2&&this.wsConnection.close(),void setTimeout((()=>this.wsConnect()),1e3);this.props.appStateUpdate({wsOpen:!0,wsComponent:"Camera"}),this.SDPOutput={};var s=null;this.audioInterface||(s=this.localStream.getVideoTracks());const o=this.localStream.getAudioTracks();this.audioInterface||s.length>0&&this.devMode&&console.log(`components/Camera wsConnect Using Video device: ${s[0].label}`),o.length>0&&this.devMode&&console.log(`components/Camera wsConnect Using Audio device: ${o[0].label}`),this.streamInfo={applicationName:e.config.application,streamName:e.room.streamBroadcast,sessionId:"[empty]"},this.userData={param1:"value1",videowhisper:"webrtc-broadcast"},this.devMode&&console.log("components/Camera wsConnect","_isMounted="+this._isMounted,this.streamInfo,this.userData,this.props,this.state),this.wsConnection&&(console.log("components/Camera wsConnect previous websocket (to close)",this.wsConnection),this.wsConnection.readyState<2&&this.wsConnection.close()),this.wsConnection=new WebSocket(e.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsMessaged=!1,this.wsConnection.onmessage=e=>this.onWsMessage(e),this.wsConnection.onclose=()=>{this.devMode&&console.log("components/Camera wsConnection.onclose"),this.props.appStateUpdate({wsOpen:!1})},this.wsConnection.onerror=e=>{console.log("components/Camera wsConnection.onerror: ",e),this.setState({buttonDisabled:!1})}}onnegotiationneeded(){this.devMode&&console.log("components/Camera peerConnection onnegotiationneeded"),this.peerConnection.createOffer(this.offerOptions).then(this.gotDescription.bind(this),this.errorHandler)}onicecandidate(e){e.candidate&&this.devMode&&console.log("components/Camera gotIceCandidate: "+JSON.stringify({ice:e.candidate}))}onsignalingstatechange(){const{txt:e}=this;let t;this.peerConnection&&(t=this.peerConnection.signalingState,this.devMode&&console.log(`components/Camera onsignalingstatechange state, peerConnection, wsConnection  ${t}`,this.peerConnection.signalingState,this.peerConnection.readyState,this.peerConnection,this.wsConnection),"have-local-offer"==t&&"new"==this.peerConnection.iceConnectionState&&(this.setState({buttonDisabled:!1,buttonContent:e("Stop Broadcast"),statusInfo:e("Broadcasting")}),this.props.appStateUpdate({cameraStatus:"pending"}),this.retryIfTimeoutSet||(setTimeout((()=>this.retryIfTimeout()),this.retryTimeout),this.retryIfTimeoutSet=!0)))}connectionUpdated(e){const{props:t,txt:s,state:o}=this;this.devMode&&console.log("components/Camera connectionUpdated ",e,o.connected),o.connected||"connected"===e&&(this.setState({settingsActive:!1,buttonDisabled:!1,buttonContent:s("Stop Broadcast"),statusInfo:s("Broadcasting"),connecting:!1,connected:!0,bitrateInfo:Object(w.jsx)(O.a,{name:"clock"})}),t.serverUpdate({task:"media",connected:!0}),t.appStateUpdate({publishRequired:!1,cameraStatus:"live"}),this.startSnapshots(),this.peerConnection&&this.peerConnection.getSenders().forEach((e=>{if(e.track){var t=e.getParameters();t.encodings||(t.encodings=[{}]),"audio"==e.track.kind&&this.enhanceData.audioBitrate&&(t.encodings[0].maxBitrate=1e3*this.enhanceData.audioBitrate),"video"==e.track.kind&&this.enhanceData.videoBitrate&&(t.encodings[0].maxBitrate=1e3*this.enhanceData.videoBitrate),e.setParameters(t),this.devMode&&console.log("components/Camera connectionUpdated ",e.track.kind,t)}}))),o.connected&&("failed"!==e&&"disconnected"!==e&&"closed"!==e||(this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:s("Broadcast"),statusInfo:e,connecting:!1,connected:!1,bitrateInfo:Object(w.jsx)(O.a,{name:"eye slash"})}),t.serverUpdate({task:"media",connected:!1}),t.appStateUpdate({cameraStatus:"off"}),this.stopSnapshots()))}onconnectionstatechange(){const{props:e,txt:t,state:s}=this;let o;this.peerConnection&&(o=this.peerConnection.connectionState,this.devMode&&console.log(`components/Camera onconnectionstatechange peerConnection.onconnectionstatechange ${o}`,this.peerConnection.iceConnectionState,this.peerConnection.iceGatheringState,this.peerConnection.readyState),this.connectionUpdated(o))}oniceconnectionstatechange(){const{props:e,txt:t}=this;let s;this.peerConnection&&(s=this.peerConnection.iceConnectionState,this.devMode&&console.log(`components/Camera oniceconnectionstatechange peerConnection.iceConnectionState ${s}`,this.peerConnection.iceConnectionState,this.peerConnection.iceGatheringState,this.peerConnection.readyState),this.connectionUpdated(s))}onAddIceCandidateSuccess(e){this.devMode&&console.log("components/Camera onAddIceCandidateSuccess success.",e)}onAddIceCandidateError(e,t){console.log("components/Camera onAddIceCandidateError",t,e)}gotDescription(e){const{props:t,state:s,txt:o}=this;this.devMode&&console.log("components/Camera gotDescription: original",e,this.serverWowza,this.serverVideowhisper),e=this.mungeDescription(e),this.peerConnection||console.log("components/Camera gotDescription: Error no this.peerConnection",s),this.peerConnection.setLocalDescription(e).then((()=>{if(this.serverWowza){const t='{"direction":"publish", "command":"sendOffer", "streamInfo":'+JSON.stringify(this.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(this.userData)+"}";this.devMode&&console.log("components/Camera gotDescription > wsConnection.send after setLocalDescription ",this.wsConnection,t),this.wsConnection&&(1==this.wsConnection.readyState?this.wsConnection.send(t):console.log("components/Camera gotDescription > wsConnection.send / wsConnection not ready - readyState:",this.wsConnection.readyState))}this.serverVideowhisper})).catch((t=>{console.log("components/Camera gotDescription, setLocalDescription error, description.sdp",t,e.sdp),this.setState({statusInfo:"Stream setup error: Retry!",settingsActive:!0,buttonDisabled:!1,buttonContent:o("Broadcast"),connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"})}))}addAudio(e,t){let s=e.split(/\r\n/),o="",a="",i=!1;for(let n in s){let e=s[n];e.length<=0||(0===e.indexOf("m=audio")?o="audio":0===e.indexOf("m=video")&&(o="video"),a+=e,a+="\r\n","audio"===o&&0==="a=rtcp-mux".localeCompare(e)&&!1===i&&(a+=t,i=!0))}return a}addVideo(e,t){let s=e.split(/\r\n/),o="",a=!1,i=!1;for(let n in s){let e=s[n];e.length<=0||e.includes("a=rtcp-rsize")&&(i=!0)}for(let n in s){let e=s[n];o+=e,o+="\r\n",0==="a=rtcp-rsize".localeCompare(e)&&!1===a&&!0===i&&(o+=t,a=!0),0==="a=rtcp-mux".localeCompare(e)&&!0===a&&!1===i&&(o+=t,a=!0),0==="a=rtcp-mux".localeCompare(e)&&!1===a&&!1===i&&(a=!0)}return o}mungeSDPPublish(e,t){const{config:s}=this.props,o=T.a.browserDetails;this.SDPOutput={};var a="42e01f",i="opus";this.videoIndex=-1,this.audioIndex=-1;let n=e.split(/\r\n/),r="header",c=!1,d="";null!=t.videoCodec&&""!==t.videoCodec&&(a=t.videoCodec),null!=t.audioCodec&&""!==t.audioCodec&&(i=t.audioCodec);for(let l in n){let e=n[l];e.length<=0||(e.includes("urn:3gpp:video-orientation")||this.checkLine(e)&&(d+=e,d+="\r\n"))}d=this.addAudio(d,this.deliverCheckLine(i,"audio")),d=this.addVideo(d,this.deliverCheckLine(a,"video")),n=(e=d).split(/\r\n/),d="";for(let l in n){let e=n[l];if(!(e.length<=0)){if("chrome"===o.browser){let t;if(0===e.indexOf("m=audio")&&-1!==this.audioIndex){t=e.split(" "),d+=t[0]+" "+t[1]+" "+t[2]+" "+this.audioIndex+"\r\n";continue}if(0===e.indexOf("m=video")&&-1!==this.videoIndex){t=e.split(" "),d+=t[0]+" "+t[1]+" "+t[2]+" "+this.videoIndex+"\r\n";continue}}if(d+=e,0===e.indexOf("m=audio")?(r="audio",c=!1):0===e.indexOf("m=video")?(r="video",c=!1):0===e.indexOf("a=rtpmap")&&(r="bandwidth",c=!1),"chrome"===o.browser&&(0===e.indexOf("a=mid:")||0===e.indexOf("a=rtpmap"))&&!c)if(0==="audio".localeCompare(r))void 0!==t.audioBitrate&&(d+="\r\nb=CT:"+t.audioBitrate,d+="\r\nb=AS:"+t.audioBitrate),c=!0;else if(0==="video".localeCompare(r))void 0!==t.videoBitrate&&(d+="\r\nb=CT:"+t.videoBitrate,d+="\r\nb=AS:"+t.videoBitrate,void 0!==t.frameRate&&(d+="\r\na=framerate:"+t.frameRate)),c=!0;else if(0==="bandwidth".localeCompare(r)){let s;if(s=this.getrtpMapID(e),null!==s){let e=s[2].toLowerCase();0!=="vp9".localeCompare(e)&&0!=="vp8".localeCompare(e)&&0!=="h264".localeCompare(e)&&0!=="red".localeCompare(e)&&0!=="ulpfec".localeCompare(e)&&0!=="rtx".localeCompare(e)||void 0!==t.videoBitrate&&(d+="\r\na=fmtp:"+s[1]+" x-google-min-bitrate="+t.videoBitrate+";x-google-max-bitrate="+t.videoBitrate),0!=="opus".localeCompare(e)&&0!=="isac".localeCompare(e)&&0!=="g722".localeCompare(e)&&0!=="pcmu".localeCompare(e)&&0!=="pcma".localeCompare(e)&&0!=="cn".localeCompare(e)||void 0!==t.audioBitrate&&(d+="\r\na=fmtp:"+s[1]+" x-google-min-bitrate="+t.audioBitrate+";x-google-max-bitrate="+t.audioBitrate)}}if(("firefox"===o.browser||"safari"===o.browser)&&0===e.indexOf("c=IN")){if(0==="audio".localeCompare(r)){if(""!==t.audioBitrate){let e=1e3*parseInt(t.audioBitrate);d+="\r\nb=TIAS:"+(1e3*parseInt(t.audioBitrate)*.95-16e3)+"\r\n",d+="b=AS:"+e+"\r\n",d+="b=CT:"+e+"\r\n"}continue}if(0==="video".localeCompare(r)){if(""!==t.videoBitrate){let e=1e3*parseInt(t.videoBitrate);d+="\r\nb=TIAS:"+(1e3*parseInt(t.videoBitrate)*.95-16e3)+"\r\n",d+="b=AS:"+e+"\r\n",d+="b=CT:"+e+"\r\n"}continue}}d+="\r\n"}}return navigator.userAgent.toLowerCase().indexOf("safari/")>-1&&(d=d.replace(/UDP\/TLS\/RTP\/SAVPF/gi,"RTP/SAVPF")),d}deliverCheckLine(e,t){for(let s in this.SDPOutput){let o=this.SDPOutput[s];if(o.includes(e)){if(e.includes("VP9")||e.includes("VP8")){let e="",a=o.split(/\r\n/);for(let t in a){e+=a[t],e+="\r\n"}return t.includes("audio")&&(this.audioIndex=s),t.includes("video")&&(this.videoIndex=s),e}return t.includes("audio")&&(this.audioIndex=s),t.includes("video")&&(this.videoIndex=s),o}}return""}checkLine(e){if(e.startsWith("a=rtpmap")||e.startsWith("a=rtcp-fb")||e.startsWith("a=fmtp")){let t=e.split(":");if(t.length>1){let s=t[1].split(" ");if(!isNaN(s[0])&&!s[1].startsWith("http")&&!s[1].startsWith("ur")){let t=this.SDPOutput[s[0]];return t||(t=""),t+=e+"\r\n",this.SDPOutput[s[0]]=t,!1}}}return!0}getrtpMapID(e){var t=new RegExp("a=rtpmap:(\\d+) (\\w+)/(\\d+)"),s=e.match(t);return s&&s.length>=3?s:null}}E.propTypes={appState:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,user:N.a.object.isRequired,serverUpdate:N.a.func.isRequired,appStateUpdate:N.a.func.isRequired,cameraConfig:N.a.object};s(257);var W=s(225),B=s(222),F=s(359),q=s(357),H=s(227),z=s(358),_=s(361),G=s(113),J=s.n(G),$=s(360),K=s(84),Q=s.n(K);class Y extends o.Component{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return t.config&&e in t.config.text?t.config.text[e]:e},this.toMMSS=function(e){var t=Math.floor(e/60),s=e-60*t;return s<10&&(s="0"+s),t+":"+s},this.onChange=(e,t)=>{let{name:s,value:o}=t;this.state[s]!=o&&(this.setState({[s]:o},(()=>{this.changedBy=s,this.recordingDiscard(),navigator.mediaDevices.enumerateDevices().then(this.gotDevices.bind(this)).catch(this.handleError.bind(this))})),this.devMode&&console.log("components/Recorder onChange",s,o,e))},this.devMode=e.appState.devMode,this._isMounted=!1,this.videoWidth=480,this.videoHeight=320,this.state={camera:null,cameraOptions:[],videoSource:null,microphone:null,microphoneOptions:[],audioSource:null,mode:"video",mediaRecorder:!1,buttonStart:!1,buttonStop:!1,buttonDiscard:!1,buttonSend:!1,statusInfo:"",uploading:!1,displayTime:"0:00"},this.info="",this.maxTime=0,this.audioPlayback=a.a.createRef(),this.videoPlayback=a.a.createRef(),this.videoPreview=a.a.createRef(),this.recorderData=null,this.mimeType="video/mp4",this.fileExtension="mp4",this.resolutions={"4K":{label:"4K",width:3840,height:2160,ratio:"16:9",bitrate:12e3},"1440p":{label:"1440p",width:2560,height:1440,ratio:"16:9",bitrate:6e3},"1080p":{label:"1080p",width:1920,height:1080,ratio:"16:9",bitrate:3e3},"720p":{label:"720p",width:1280,height:720,ratio:"16:9",bitrate:1800},SVGA:{label:"SVGA",width:800,height:600,ratio:"4:3",bitrate:800},"480p":{label:"480p",width:858,height:480,ratio:"16:9",bitrate:750},VGA:{label:"VGA",width:640,height:480,ratio:"4:3",bitrate:600},"360p":{label:"360p",width:640,height:360,ratio:"16:9",bitrate:400},"240p":{label:"240p",width:426,height:240,ratio:"16:9",bitrate:220},CIF:{label:"CIF",width:352,height:288,ratio:"4:3",bitrate:200},QVGA:{label:"QVGA",width:320,height:240,ratio:"4:3",bitrate:180},"180p":{label:"180p",width:320,height:180,ratio:"16:9",bitrate:160},"90p":{label:"90p",width:160,height:90,ratio:"16:9",bitrate:100}}}timerStart(){const{props:e}=this;this.timerTimeStart=Date.now(),this.timerLocal=setInterval(this.timerTick.bind(this),1e3)}timerStop(){clearInterval(this.timerLocal),this.timeLocal=Date.now()-this.timerTimeStart,this.setState({displayTime:this.toMMSS(Math.floor(this.timeLocal/1e3))})}timerTick(){this.timeLocal=Date.now()-this.timerTimeStart,this.props.appState.checked&&this.props.appState.mode.time&&(0==this.maxTime||this.maxTime>this.props.appState.mode.time)&&(this.maxTime=this.props.appState.mode.time),this.setState({displayTime:this.toMMSS(Math.floor(this.timeLocal/1e3))}),this.maxTime>0&&this.timeLocal>=1e3*this.maxTime&&this.recordingStop()}componentDidMount(){this._isMounted=!0,this.devMode&&console.log("components/Recorder componentDidMount",this.props),this.setupInterface()}componentWillUnmount(){this.devMode&&console.log("components/Recorder componentWillUnmount"),this._isMounted=!1,this.recordingDiscard(),this.timerStop()}setupInterface(){this.isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveOrOpenBlob||!!navigator.msSaveBlob),this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.recorderRTC=null,this.stream=null,this.setState({statusInfo:this.txt("Ready to Start")}),this.props.config.recorderMaxTime&&(this.maxTime=this.props.config.recorderMaxTime),this.props.config.recorderMode&&this.setState({mode:this.props.config.recorderMode}),this.getMedia(),this.devMode&&console.log("components/Recorder/setupInterface")}componentDidUpdate(){}composedStream(e){let[t,s]=e;var o=new MediaStream;if(this.devMode&&console.log("components/Recorder/composedStream : ",t,s,o),s.getVideoTracks().forEach((function(e){o.addTrack(e)})),s.getAudioTracks().length>0){var a=new AudioContext,i=a.createMediaStreamDestination();const e=a.createMediaStreamSource(s),n=a.createGain();if(n.gain.value=1,e.connect(n).connect(i),this.devMode&&console.log("composedStream added system audio"),t&&t.getAudioTracks().length>0){const e=a.createMediaStreamSource(t),s=a.createGain();s.gain.value=1,e.connect(s).connect(i),this.devMode&&console.log("composedStream added mic audio")}i.stream.getAudioTracks().forEach((function(e){o.addTrack(e)}))}else t.getAudioTracks().forEach((function(e){o.addTrack(e)}));return this.devMode&&console.log("components/Recorder/composedStream : ",t,s,o),o}getMedia(){const{state:e,props:t}=this;if(this._isMounted){var s;if(this.state.mediaRecorder&&"undefined"==typeof MediaRecorder&&this.setState({mediaRecorder:!1,mode:"audio"}),this.state.mediaRecorder||"undefined"==typeof MediaRecorder||this.setState({mediaRecorder:!0}),"undefined"!==typeof MediaRecorder&&"function"===typeof MediaRecorder.isTypeSupported)s="audio"===this.state.mode?{mp3:"audio/mp4",mp3:"audio/mpeg",wav:"audio/wav",webm:"audio/webm",ogg:"audio/ogg"}:{mp4:"video/mp4",webm:"video/webm",mkv:"video/x-matroska"},this.mimeType=Object.values(s).filter(MediaRecorder.isTypeSupported)[0],this.fileExtension=Object.keys(s).find((e=>s[e]===this.mimeType)),this.devMode&&console.log("components/Recorder/getMedia MediaRecorder",this.mimeType,this.fileExtension,this.state.mode);for(var o in"audio"===this.state.mode?(this.mimeType||(this.mimeType="audio/mp4"),this.fileExtension||(this.fileExtension="mp3")):(this.mimeType||(this.mimeType="video/mp4"),this.fileExtension||(this.fileExtension="mp4")),this.resolutions)o==e.resolution&&(this.videoWidth=this.resolutions[o].width,this.videoHeight=this.resolutions[o].height);var a={};if("_disabled"!=e.audioSource?a.audio={deviceId:e.microphone?{ideal:e.microphone}:void 0}:a.audio=!1,!this.isEdge&&a.audio&&(a.audio.echoCancellation=!1),"_disabled"!=e.videoSource&&"audio"!=e.mode?a.video={deviceId:e.camera?{ideal:e.camera}:void 0,width:{ideal:this.videoWidth},height:{ideal:this.videoHeight}}:a.video=!1,"screen"!==e.mode)this.devMode&&console.log("components/Recorder getUserMedia:",a,this.state),navigator.mediaDevices.getUserMedia(a).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this));else{var i={video:!0,audio:!0};if(navigator.mediaDevices.getDisplayMedia)if(a.audio){const e=navigator.mediaDevices.getDisplayMedia(i).catch(this.handleError.bind(this)),t=navigator.mediaDevices.getUserMedia(a).catch(this.handleError.bind(this));console.log("components/Recorder/getMedia screen Promise.all fc",e,t),Promise.all([t,e]).then((e=>this.composedStream(e))).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this))}else navigator.mediaDevices.getDisplayMedia(i).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this));else console.log("No navigator.mediaDevices.getDisplayMedia!");this.devMode&&console.log("components/Recorder/getMedia screen videoSource: ",e.videoSource,"  constraintsScreen=",i,"  constraints=",a)}}else this.devMode&&console.log("components/Recorder/getMedia not _isMounted",this._isMounted)}gotStream(e){if(this._isMounted)return this.stream=e,"audio"!=this.state.mode&&(this.videoPreview.current.srcObject=e),this.devMode&&console.log("components/Recorder gotStream",e,this.videoPreview.current),this.setState({buttonStart:!0}),navigator.mediaDevices.enumerateDevices()}gotDevices(e){if(!this._isMounted)return;this.devMode&&console.log("components/Recorder gotDevices after getUserMedia",e);var{state:t,props:s}=this,o=[{key:"cam-title",text:Object(w.jsxs)("span",{children:["Select ",Object(w.jsx)("strong",{children:"Camera"}),":"]}),disabled:!0}],a=[{key:"mic-title",text:Object(w.jsxs)("span",{children:["Select ",Object(w.jsx)("strong",{children:"Microphone"}),":"]}),disabled:!0}];let i=!1,n=!1;for(let l=0;l!==e.length;++l){const s=e[l];var r={value:s.deviceId};"audioinput"===s.kind?(r.text=s.label||`microphone ${a.length+1}`,a.push(r),t.microphone||(t.microphone=s.deviceId),s.deviceId===t.microphone&&(n=!0)):"videoinput"===s.kind&&(r.text=s.label||`camera ${o.length+1}`,o.push(r),t.camera||(t.camera=s.deviceId),s.deviceId===t.camera&&(i=!0))}(i||"_disabled"===t.camera)&&(t.videoSource=t.camera),(n||"_disabled"===t.microphone)&&(t.audioSource=t.microphone),t.camera===t.videoSource&&t.microphone===t.audioSource||i&&n||(console.log("components/Camera gotDevices: deviceID changed videoValid:"+t.camera+" videoSelected: "+t.microphone+" audioValid:"+n),this.setState({statusInfo:"Media DeviceID changed: Please select again!"})),this.devMode&&console.log("gotDevices: verified videoSource: "+t.videoSource+" changed videoValid: "+i);var c=!1;if((!s.appState.checked||s.appState.checked&&s.appState.mode.text)&&(c=!0,s.appState.checked&&s.appState.mode.time&&(0==this.maxTime||this.maxTime>s.appState.mode.time)&&(this.maxTime=s.appState.mode.time)),this.modeText=c,this.resolutionHeight=Number(s.config.resolutionHeight),this.resolutionHeight||(this.resolutionHeight=480),this.maxResolutionHeight=Number(s.config.maxResolutionHeight),this.maxResolutionHeight||(this.maxResolutionHeight=0),this.tWarn="",(!s.appState.checked||s.appState.checked&&s.appState.mode.text)&&(this.resolutionHeight>480&&(this.resolutionHeight=480),this.maxResolutionHeight>480&&(this.maxResolutionHeight=480),this.maxResolutionHeight||(this.maxResolutionHeight=480),this.resolutionHeight>this.maxResolutionHeight&&(this.resolutionHeight=this.maxResolutionHeight),this.tWarn="Demo Mode Configured: Limited resolution and recording time."),this.state.maxResolutionHeight=this.maxResolutionHeight,this.resolutionOptions=[{key:"res-title",text:Object(w.jsxs)("span",{children:[Object(w.jsx)("strong",{children:this.txt("Video Resolution")}),this.state.maxResolutionHeight?" <"+this.state.maxResolutionHeight+"p":""]}),disabled:!0}],this.resolutions)for(var d in this.resolutions)(0===this.maxResolutionHeight||this.resolutions[d].height<=this.maxResolutionHeight)&&this.resolutionOptions.push({key:d,value:d,text:this.resolutions[d].label+" "+this.resolutions[d].width+"x"+this.resolutions[d].height+" "+this.resolutions[d].ratio});this.state.resolutionOptions=this.resolutionOptions,t.resolution||(this.state.resolution=this.resolutionHeight.toString()+"p"),s.appState.checked&&(this.tChecked=!0),this._isMounted&&this.setState({cameraOptions:o,microphoneOptions:a})}handleError(e){console.log("components/Recorder getMedia handleError: ",e),this.setState({statusInfo:"Error: "+e})}SaveToDisk(e,t){if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var s=window.open(e,"_blank");s.document.close(),s.document.execCommand("SaveAs",!0,t||e),s.close()}}else{var o=document.createElement("a");if(o.href=e,o.download=t||"unknown",o.style="display:none;opacity:0;color:transparent;",(document.body||document.documentElement).appendChild(o),"function"===typeof o.click)o.click();else{o.target="_blank";var a=document.createEvent("Event");a.initEvent("click",!0,!0),o.dispatchEvent(a)}(window.URL||window.webkitURL).revokeObjectURL(o.href)}this.props.recorderStatus("fileSaved")}getRandomString(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),t="",s=0,o=e.length;s<o;s++)t+=e[s].toString(36);return t}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}getFileName(e){var t=new Date;return"VideoWhisper-"+t.getFullYear()+t.getMonth()+t.getDate()+"-"+this.getRandomString()+"."+e}uploadCompleted(e){this.devMode&&console.log("components/Recorder uploadCompleted",e),this.setState({uploading:!1,statusInfo:this.txt("Upload completed.")}),this.props.options&&"chat"==this.props.options.scenario&&this.props.serverUpdate({task:"update",update:"chat"}),this.props.recorderStatus("uploadCompleted"),"undefined"!=typeof window.VideoWhisper.recoderUploadCompleted?window.VideoWhisper.recoderUploadCompleted(this.filename):this.devMode&&console.log("components/Recorder uploadCompleted window.VideoWhisper.recoderUploadCompleted missing",typeof window.VideoWhisper.recoderUploadCompleted,window.recorderUploadCompleted,window.VideoWhisper)}recordingStop(){this.devMode&&console.log("components/Recorder recordingStop",this.recorderRTC),this.mediaRecorder&&this.mediaRecorder.stop(),this.recorderRTC&&this.recorderRTC.stopRecording((()=>{this.recorderData=URL.createObjectURL(this.recorderRTC.getBlob()),this.devMode&&console.log("components/Recorder this.recorderData",this.recorderData),"audio"===this.state.mode?(this.audioPlayback.current.src=this.recorderData,this.audioPlayback.current.play().then((e=>{this.devMode&&console.log("components/Recorder Audio Autoplay started",e)}),(e=>{console.log("components/Recorder Audio Autoplay reject:",e)})).catch((e=>{console.log("components/Recorder Audio Autoplay error:",e)}))):(this.videoPlayback.current.src=this.recorderData,this.videoPlayback.current.play().then((e=>{this.devMode&&console.log("components/Recorder Video Autoplay started",e)}),(e=>{console.log("components/Recorder Video Autoplay reject:",e)})).catch((e=>{console.log("components/Recorder Video Autoplay error:",e)})))})),"audio"!=this.state.mode&&(this.videoPreview.current.srcObject=null),this.stream.stop(),this.timerStop(),this.setState({buttonStart:!1,buttonStop:!1,buttonDiscard:!0,buttonSend:!0,statusInfo:this.txt("Recorded: Send, Download or Discard")})}recordingDiscard(){this.recorderData=null,this.stream&&this.stream.getTracks().forEach((e=>{e.stop(),this.devMode&&console.log("components/Recorder buttonDiscard closed track",e)})),this.setState({buttonStart:!0,buttonStop:!1,buttonDiscard:!1,buttonSend:!1,statusInfo:this.txt("Ready to Start"),displayTime:"0:00"}),this.getMedia()}onClick(e,t){let{name:s,value:o}=t;const{state:a,props:i}=this;switch(this.devMode&&console.log("components/Recorder onClick",s,o,e,a),s){case"buttonDetect":this.getMedia();break;case"buttonAudio":if("audio"==a.mode)break;this.setState({mode:"audio"},(()=>this.recordingDiscard()));break;case"buttonVideo":if(!a.mediaRecorder)break;if("video"===a.mode)break;this.setState({mode:"video"},(()=>this.recordingDiscard()));break;case"buttonScreen":if(!a.mediaRecorder)break;if("screen"===a.mode)break;this.setState({mode:"screen"},(()=>this.recordingDiscard()));break;case"buttonStart":if(this.mediaRecorder&&(this.mediaRecorder.stop(),this.mediaRecorder=null),this.recorderRTC&&(this.recorderRTC.destroy(),this.recorderRTC=null),this.filename="",this.directMediaRecorder=!1,this.directMediaRecorder)this.fileExtension="mp4",this.mimeType="video/mp4",this.mediaRecorder=new MediaRecorder(this.stream,{mimeType:this.mimeType}),this.chunks=[],this.mediaRecorder.ondataavailable=e=>{this.chunks.push(e.data)},this.mediaRecorder.onerror=e=>{console.log("components/Recorder MediaRecorder.onerror: "+e)},this.mediaRecorder.onwarning=e=>{console.log("components/Recorder mediaRecorder.onwarning: "+e)},this.mediaRecorder.onstop=()=>{this.devMode&&console.log("components/Recorder mediaRecorder.onstop");var e=new Blob(this.chunks,{type:"video/mp4"});this.chunks=[],this.recorderData=URL.createObjectURL(e),this.videoPlayback.current.src=this.recorderData,this.videoPlayback.current.play().then((e=>{this.devMode&&console.log("components/Recorder mediaRecorder Video Autoplay started",e)}),(e=>{console.log("components/Recorder mediaRecorder Video Autoplay reject:",e)})).catch((e=>{console.log("components/Recorder mediaRecorder Video Autoplay error:",e)}))},this.mediaRecorder.onstart=()=>{this.devMode&&console.log("components/Recorder mediaRecorder.onstart",this.mimeType)},this.mediaRecorder.start();else{var n={type:"audio"==this.state.mode?"audio":"video",mimeType:this.mimeType,numberOfAudioChannels:this.isEdge?1:2,checkForInactiveTracks:!0,bufferSize:16384,disableLogs:!this.devMode,recorderType:J.a.MediaStreamRecorder};(this.isSafari||this.isEdge)&&"audio"===a.mode&&(n.recorderType=J.a.StereoAudioRecorder),navigator.platform&&-1===navigator.platform.toString().toLowerCase().indexOf("win")&&(n.sampleRate=48e3),this.isSafari&&(n.sampleRate=44100,n.bufferSize=4096,n.numberOfAudioChannels=2),this.recorderRTC=J()(this.stream,n),this.devMode&&console.log("components/Recorder buttonStart",n,this.recorderRTC),this.recorderRTC.startRecording()}this.timerStart(),this.setState({buttonStart:!1,buttonStop:!0,buttonDiscard:!1,buttonSend:!1,statusInfo:this.txt("Recording")+" "+this.mimeType+" ."+this.fileExtension});break;case"buttonStop":this.recordingStop();break;case"buttonDiscard":this.recordingDiscard();break;case"buttonDownload":if(this.devMode&&console.log("components/Recorder buttonDownload",this.recorderRTC),this.mediaRecorder){this.SaveToDisk(this.recorderData,this.getFileName(this.fileExtension));break}if(!this.recorderRTC||!this.recorderRTC.getBlob())break;if(this.isSafari){this.recorderRTC.getDataURL((e=>{this.SaveToDisk(e,this.getFileName(this.fileExtension))}));break}var r=this.recorderRTC.getBlob(),c=new File([r],this.getFileName(this.fileExtension),{type:this.mimeType});J.a.invokeSaveAsDialog(c);break;case"buttonSend":if(!i.config.serverURL)return void console.log("components/Recorder  missing serverURL",i.config.serverURL,i.config);const e=Q.a.post(i.config.serverURL);e.field("task","recorder_upload"),e.field("mode","audio"==this.state.mode?"audio":"video"),e.field("scenario",i.options.scenario),e.field("duration",a.displayTime),e.field("VideoWhisper[userID]",i.user.ID),e.field("VideoWhisper[sessionID]",i.user.sessionID),e.field("VideoWhisper[sessionKey]",i.user.sessionKey),i.room.ID?(e.field("VideoWhisper[roomID]",i.room.ID),e.field("VideoWhisper[privateUID]",i.room.privateUID)):console.log("components/Recorder missing room ID",i.room,i.user,i.config.serverURL);var d=[];const t=this.getFileName(this.fileExtension);this.filename=t;r=this.recorderRTC.getBlob(),c=new File([r],t,{type:this.mimeType});e.attach(t,c,t),d.push(t),e.field("files[]",d),e.then((e=>this.uploadCompleted(e))).catch((e=>{console.log("components/Recorder request error",e)})),this.devMode&&console.log("components/Recorder uploading ...",d,e),this.setState({uploading:!0,statusInfo:this.txt("Uploading. Please wait...")})}this.props.recorderStatus(s)}render(){const{props:e,state:t,txt:s}=this;this.devMode=e.appState.devMode;var o=Object(w.jsxs)(x.a.Group,{children:[Object(w.jsxs)(x.a,{icon:!0,name:"buttonAudio",onClick:this.onClick.bind(this),color:"audio"==t.mode?"black":"grey","data-tooltip":s("Audio"),children:[" ",Object(w.jsx)(O.a,{name:"microphone"})," "]}),Object(w.jsxs)(x.a,{icon:!0,name:"buttonVideo",onClick:this.onClick.bind(this),color:"video"==t.mode?"black":"grey","data-tooltip":s("Video"),children:[" ",Object(w.jsx)(O.a,{name:"video",disabled:!t.mediaRecorder})," "]}),Object(w.jsxs)(x.a,{icon:!0,name:"buttonScreen",onClick:this.onClick.bind(this),color:"screen"==t.mode?"black":"grey","data-tooltip":s("Screen"),children:[" ",Object(w.jsx)(O.a,{name:"desktop",disabled:!t.mediaRecorder})," "]})]},"modeSelect");return this.props.config.recorderModeDisable&&(o=""),Object(w.jsxs)("div",{children:[o,t.mediaRecorder?"":Object(w.jsx)(C.a,{pointing:"left",color:"black",children:"Video recording is not available in this browser."}),Object(w.jsx)($.a,{hidden:!0}),this.isSafari&&!t.mediaRecorder?Object(w.jsxs)(k.a,{size:"small",compact:!0,className:e.appState.className,children:["How To Enable Webcam Recording in Latest Safari:",Object(w.jsx)("br",{}),"1. Show Develop menu from Safari > Preferences > Advanced menu.",Object(w.jsx)("br",{}),"2. Toggle Develop > Experimental Features > MediaRecorder menu to enable video recording.",Object(w.jsx)("br",{}),"3. Reload page to activate feature."]}):"",Object(w.jsxs)(k.a,{compact:!0,className:e.appState.className,children:[Object(w.jsxs)(x.a,{icon:!0,name:"buttonStart",onClick:this.onClick.bind(this),disabled:!t.buttonStart,color:"red","data-tooltip":s("Start"),children:[" ",Object(w.jsx)(O.a,{name:"circle"})," "]}),Object(w.jsxs)(x.a,{icon:!0,name:"buttonStop",onClick:this.onClick.bind(this),disabled:!t.buttonStop,color:"blue","data-tooltip":s("Stop"),children:[" ",Object(w.jsx)(O.a,{name:"square"})," "]}),Object(w.jsxs)(x.a,{icon:!0,name:"buttonDiscard",onClick:this.onClick.bind(this),disabled:!t.buttonDiscard,color:"orange","data-tooltip":s("Discard"),children:[" ",Object(w.jsx)(O.a,{name:"trash"})," "]}),Object(w.jsxs)(x.a,{icon:!0,name:"buttonDownload",onClick:this.onClick.bind(this),disabled:!t.buttonSend,color:"olive","data-tooltip":s("Download"),children:[" ",Object(w.jsx)(O.a,{name:"download"})," "]}),Object(w.jsxs)(x.a,{icon:!0,name:"buttonSend",onClick:this.onClick.bind(this),disabled:!t.buttonSend,color:"green",loading:t.uploading,"data-tooltip":s("Send"),children:[" ",Object(w.jsx)(O.a,{name:"send"})," "]}),this.modeText?Object(w.jsxs)(x.a,{icon:!0,href:e.appState.tooltipURL,"data-tooltip":e.appState.tooltip,color:["red","blue","orange","olive","green","grey","black"][Math.floor(7*Math.random())],children:[" ",Object(w.jsx)(O.a,{name:["eye","audio description","bullhorn","tag","question circle","at"][Math.floor(6*Math.random())]})," "]}):"",Object(w.jsx)($.a,{hidden:!0}),Object(w.jsx)(I.a,{compact:!0,className:e.appState.className+" tiny",name:"microphone",value:t.microphone,onChange:this.onChange,placeholder:"Microphone",selection:!0,options:t.microphoneOptions},"microphone"),"video"==t.mode?Object(w.jsxs)("span",{children:[Object(w.jsx)(I.a,{compact:!0,className:e.appState.className+" tiny",name:"camera",value:t.camera,onChange:this.onChange,placeholder:"Camera",selection:!0,options:t.cameraOptions},"camera"),Object(w.jsx)(I.a,{compact:!0,className:e.appState.className+" tiny",name:"resolution",value:t.resolution,onChange:this.onChange,placeholder:"Video Resolution",selection:!0,options:t.resolutionOptions}),this.tWarn?Object(w.jsx)("div",{children:Object(w.jsx)(C.a,{size:"small",color:e.appState.darkMode?"black":"grey",children:this.tWarn})}):""]}):"","audio"==t.mode||t.buttonSend?"":Object(w.jsxs)("div",{children:[Object(w.jsx)("br",{})," ",Object(w.jsx)("video",{style:{maxWidth:"100%"},id:"videoPreview",ref:this.videoPreview,autoPlay:!0,muted:!0,playsInline:!0})]})]}),Object(w.jsxs)(C.a,{color:"black",children:[t.displayTime,this.maxTime?" / "+this.toMMSS(this.maxTime):""]}),Object(w.jsx)(C.a,{color:"black",children:t.statusInfo}),Object(w.jsx)("br",{}),Object(w.jsxs)(k.a,{compact:!0,className:e.appState.className,style:{visibility:t.buttonSend?"visible":"hidden"},children:[this.txt("Recorded: Playback")," ",Object(w.jsx)("br",{}),"audio"!=t.mode?Object(w.jsx)("video",{style:{maxWidth:"100%",visibility:t.buttonSend?"visible":"hidden"},id:"videoPlayback",ref:this.videoPlayback,controls:!0,autoPlay:!0,playsInline:!0}):Object(w.jsx)("audio",{style:{maxWidth:"100%",visibility:t.buttonSend?"visible":"hidden"},id:"audioPlayback",ref:this.audioPlayback,controls:!0,autoPlay:!0,playsInline:!0}),this.isSafari?"":Object(w.jsx)("div",{children:Object(w.jsx)(C.a,{size:"small",color:e.appState.darkMode?"black":"grey",children:"Safari may not play recordings from other browsers. Record using Safari if available."})})]})]},"recorderControls")}}var X=s(25),Z=s.n(X),ee=s(144);class te extends o.Component{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return e in t.config.text?t.config.text[e]:e},this.onDrop=e=>{const{props:t}=this;if(!t.config.serverURL)return void console.log("components/Files onDrop missing serverURL",t.config.serverURL,t.config);const s=Q.a.post(t.config.serverURL);s.field("task","file_upload"),s.field("VideoWhisper[userID]",t.user.ID),s.field("VideoWhisper[sessionID]",t.user.sessionID),s.field("VideoWhisper[sessionKey]",t.user.sessionKey),t.room.ID?(s.field("VideoWhisper[roomID]",t.room.ID),s.field("VideoWhisper[privateUID]",t.room.privateUID)):console.log("components/Files onDrop room",t.room,t.user,t.config.serverURL);var o=[];e.forEach((e=>{s.attach(e.name,e,e.name),o.push(e.name)})),s.field("files[]",o),s.then(this.uploadCompleted.bind(this)),console.log("components/Files onDrop",e,s),this.setState({uploading:!0})},this.state={uploading:!1},this.devMode=e.appState.devMode,this.fileInputRef=a.a.createRef(),this.devMode&&console.log("components/Files constructor room:",e.room)}componentWillUnmount(){console.log("components/Files  componentWillUnmount")}uploadCompleted(e){console.log("components/Files uploadCompleted",e),this.props.serverUpdate({task:"update",update:"files"}),this.setState({uploading:!1}),this.props.uploadsStatus("uploadCompleted")}render(){const{props:e,state:t,txt:s}=this;return this.props.room.filesUpload?Object(w.jsx)(ee.a,{onDrop:this.onDrop,children:o=>{let{getRootProps:a,getInputProps:i}=o;return Object(w.jsx)(k.a,{className:e.appState.className,children:Object(w.jsxs)("div",{...a(),children:[Object(w.jsx)("input",{...i()}),Object(w.jsxs)("p",{children:[Object(w.jsx)(O.a,{name:"upload",loading:t.uploading})," ",t.uploading?s("Uploading. Please wait..."):s("Upload: Drag and drop files here, or click to select files")]})]})})}}):s("File upload disabled.")}}class se extends o.Component{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return t.config&&e in t.config.text?t.config.text[e]:e},this.onSubmit=e=>{e&&e.preventDefault();const{props:t,state:s}=this;if(this.devMode&&console.log("ChatInput onSubmit",this.state),!this.state)return;const o=this.state.message;if(0!==o.length){if("/vws dev"===o)t.appStateUpdate({devMode:!0}),console.log("components/ChatInput devMode Enabled",this.state);var a={userID:t.user.ID,userName:t.user.name,userAvatar:t.user.avatar,notification:!1,text:o,language:t.appState.language,flag:t.appState.flag,time:(new Date).valueOf(),mentionMessage:0,mentionUser:"",ID:(new Date).valueOf()};0!=t.appState.chatMentionMessage&&("message"!=s.mention&&"replyat"!=s.mention||(a.mentionMessage=t.appState.chatMentionMessage)),""!=t.appState.chatMentionUser&&("user"!=s.mention&&"replyat"!=s.mention||(a.mentionUser=t.appState.chatMentionUser)),t.sendMessage(a),this.setState({message:""}),t.appStateUpdate({chatMentionMessage:0,chatMentionUser:""})}},this.emojiModalClose=()=>this.setState({emojiModalShow:!1}),this.recordModalClose=()=>this.setState({recordModalShow:!1}),this.uploadModalClose=()=>this.setState({uploadModalShow:!1}),this.languageModalClose=()=>this.setState({languageModalShow:!1}),this.textModalClose=()=>this.setState({textModalShow:!1,message:"",messageLong:""}),this.textModalSend=e=>{this.setState({textModalShow:!1,message:this.state.messageLong,messageLong:""},(e=>this.onSubmit(e)))},this.textModalKeep=()=>{this.setState({textModalShow:!1,message:this.state.messageLong,messageLong:""})},this.onEmojiButton=()=>this.setState({emojiModalShow:!0}),this.onRecordButton=()=>this.setState({recordModalShow:!0}),this.onUploadButton=()=>this.setState({uploadModalShow:!0}),this.onLanguageButton=()=>this.setState({languageModalShow:!0}),this.addEmoji=e=>{var t;this.devMode&&console.log("components/ChatInput addEmoji",e),this.state.textModalShow?(t=this.state.messageLong,e&&e.native&&(t+=e.native),this.setState({emojiModalShow:!1,messageLong:t})):(t=this.state.message,e&&e.native&&(t+=e.native),this.setState({emojiModalShow:!1,message:t}))},this.onMentionChange=(e,t)=>{this.devMode&&console.log("components/ChatInput onMentionChange",t),"cancel"==t.value?this.props.appStateUpdate({chatMentionMessage:0,chatMentionUser:""}):this.setState({mention:t.value})},this.recorderStatus=e=>{if(this.devMode&&console.log("components/ChatInput recorderStatus",e),"uploadCompleted"===e)this.recordModalClose()},this.uploadsStatus=e=>{if(this.devMode&&console.log("components/ChatInput uploadsStatus",e),"uploadCompleted"===e)this.uploadModalClose()},this.devMode=e.appState.devMode,this.state={message:"",messageLong:"",mention:"replyat",container:null,emojiModalShow:!1,recordModalShow:!1,textModalShow:!1,uploadModalShow:!1,languageModalShow:!1},this.inputRef=a.a.createRef(),this.onChange=this.onChange.bind(this)}componentDidMount(){}onChange(e){const t=e.target;var s="checkbox"===t.type?t.checked:t.value;const o=t.name;"message"!=o&&"messageLong"!=o||(s=Object(B.checkText)(s));var a=20;this.props.config.longTextLength&&(a=this.props.config.longTextLength),"message"==o&&s.length>=a?this.setState({message:s,messageLong:s,textModalShow:!0}):this.setState({[o]:s})}language2flag(e){const t={"en-us":"us","en-gb":"gb","pt-br":"br","pt-pt":"pt",zh:"cn",ja:"jp",el:"gr",da:"dk"};return t[e]?t[e]:e}onLanguageChange(e,t){this.devMode&&console.log("Components/ChatInput onLanguageChange",t,e),this.props.serverUpdate({task:"options",name:t.name,value:t.value}),this.setState({language:t.value,flag:this.language2flag(t.value),languageModalShow:!1}),this.props.appStateUpdate({language:t.value,flag:this.language2flag(t.value)})}render(){const{props:e,onSubmit:t,state:s,onChange:o,txt:a}=this;var i=!0;s.message.length>4&&(i=!1);var n="",r="",c="";this.props.room.filesUpload&&i&&(r=Object(w.jsx)(x.a,{compact:!0,icon:!0,type:"button",color:"teal","data-tooltip":a("Upload"),onClick:this.onUploadButton,inverted:e.appState.darkMode,children:Object(w.jsx)(O.a,{name:"upload"})}),n=Object(w.jsxs)(M.a,{closeIcon:!0,open:s.uploadModalShow,onClose:this.uploadModalClose,size:"small",basic:e.appState.darkMode,children:[Object(w.jsx)(y.a,{icon:"upload",content:a("Upload")}),Object(w.jsx)(M.a.Content,{children:Object(w.jsx)(te,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate,uploadsStatus:this.uploadsStatus})}),Object(w.jsx)(M.a.Actions,{children:Object(w.jsxs)(x.a,{inverted:e.appState.darkMode,color:"red",onClick:this.uploadModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," ",a("Nevermind")]})})]},"uploadModal")),e.options&&e.options.uploadDisable&&(r="");const d=Object(w.jsxs)(M.a,{closeIcon:!0,open:s.textModalShow,onClose:this.textModalSend,size:"small",basic:e.appState.darkMode,children:[Object(w.jsx)(y.a,{icon:"text width",content:a("Long Text")}),Object(w.jsx)(M.a.Content,{children:Object(w.jsx)(U.a,{children:Object(w.jsx)(F.a,{fluid:!0,name:"messageLong",value:s.messageLong,onChange:o})})}),Object(w.jsxs)(M.a.Actions,{children:[Object(w.jsxs)(x.a,{inverted:e.appState.darkMode,type:"button",color:"yellow","data-tooltip":a("Emoticons"),onClick:this.onEmojiButton,children:[Object(w.jsx)(O.a,{name:"smile"})," ",a("Emoticons")]}),Object(w.jsxs)(x.a,{inverted:e.appState.darkMode,color:"blue",onClick:this.textModalSend,children:[Object(w.jsx)(O.a,{name:"send"})," ",a("Send")]}),Object(w.jsxs)(x.a,{inverted:e.appState.darkMode,color:"green",onClick:this.textModalKeep,children:[Object(w.jsx)(O.a,{name:"check"})," ",a("Keep")]}),Object(w.jsxs)(x.a,{inverted:e.appState.darkMode,color:"red",onClick:this.textModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," ",a("Erase")]})]})]},"textModal"),l=Object(w.jsxs)(M.a,{closeIcon:!0,open:s.emojiModalShow,onClose:this.emojiModalClose,size:"small",basic:e.appState.darkMode,children:[Object(w.jsx)(y.a,{icon:"smile",content:a("Emoji")}),Object(w.jsx)(M.a.Content,{children:Object(w.jsx)(W.a,{onSelect:this.addEmoji,darkMode:e.appState.darkMode,native:!0,perLine:16})}),Object(w.jsx)(M.a.Actions,{children:Object(w.jsxs)(x.a,{inverted:e.appState.darkMode,color:"red",onClick:this.emojiModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," ",a("Nevermind")]})})]},"emojiModal");var p="",h="",m="";if(!e.config.recorderDisable&&i&&(h=Object(w.jsx)(x.a,{compact:!0,icon:!0,type:"button",color:"orange","data-tooltip":a("Record"),onClick:this.onRecordButton,inverted:e.appState.darkMode,children:Object(w.jsx)(O.a,{name:"microphone"})}),p=Object(w.jsxs)(M.a,{closeIcon:!0,open:s.recordModalShow,onClose:this.recordModalClose,size:"small",basic:e.appState.darkMode,children:[Object(w.jsx)(y.a,{icon:"file video",content:a("Record")}),Object(w.jsx)(M.a.Content,{children:Object(w.jsx)(Y,{config:e.config,user:e.user,room:e.room,appState:e.appState,appStateUpdate:e.appStateUpdate,serverUpdate:e.serverUpdate,recorderStatus:this.recorderStatus,options:{scenario:e.options?e.options.scenario:"chat"}})}),Object(w.jsx)(M.a.Actions,{children:Object(w.jsxs)(x.a,{compact:!0,inverted:e.appState.darkMode,color:"red",onClick:this.recordModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," ",a("Nevermind")]})})]},"recordModal")),e.options&&e.options.recordDisable&&(h=""),e.config.multilanguage&&i&&e.config.languages){m=Object(w.jsx)(x.a,{compact:!0,icon:!0,type:"button",color:"grey","data-tooltip":a("Language"),onClick:this.onLanguageButton,inverted:e.appState.darkMode,children:Object(w.jsx)(q.a,{name:e.appState.flag})});const t=e.config.languages;c=Object(w.jsxs)(M.a,{closeIcon:!0,open:s.languageModalShow,onClose:this.languageModalClose,size:"small",basic:e.appState.darkMode,children:[Object(w.jsx)(y.a,{icon:"flag",content:a("Chat Language")}),Object(w.jsx)(M.a.Content,{children:Object(w.jsxs)(U.a,{children:[Object(w.jsx)(I.a,{name:t.name,selection:!0,compact:!0,fluid:!0,className:e.appState.className+" v-select","data-position":"right center",value:e.appState.language,options:t.options,flag:e.appState.flag,onChange:(e,t)=>this.onLanguageChange(e,t)}),Object(w.jsx)("div",{children:t.details})]})})]},"languageModal")}var u="";if(0!=e.appState.chatMentionMessage||""!=e.appState.chatMentionUser){const t=[{key:1,text:Object(w.jsx)(O.a,{name:"arrow up"}),value:"message"},{key:2,text:Object(w.jsx)(O.a,{name:"at"}),value:"user"},{key:3,text:Object(w.jsx)(O.a,{name:"reply"}),value:"replyat"},{key:4,text:Object(w.jsx)(O.a,{name:"close"}),value:"cancel"}];u=Object(w.jsx)(I.a,{className:e.appState.className,compact:!0,inline:!0,options:t,defaultValue:s.mention,selection:!0,onChange:this.onMentionChange})}var g="";return i&&!e.appState.minMode&&(g=Object(w.jsxs)("span",{children:[Object(w.jsx)(H.a,{src:e.user.avatar,verticalAlign:"middle",avatar:!0,"data-tooltip":e.user.name})," ",Object(w.jsxs)("label",{children:[Object(w.jsxs)("small",{children:[e.user.name," ",e.options&&e.options.targetUser?Object(w.jsxs)("div",{children:[Object(w.jsx)("span",{children:Object(w.jsx)(O.a,{name:"arrow right"})}),e.options.targetUser," "]}):""," ",e.options&&e.options.price?Object(w.jsxs)("div",{children:[Object(w.jsx)("span",{children:Object(w.jsx)(O.a,{name:"money"})}),e.options.price," "]}):""]})," "]})," \xa0 "]},"codeUser")),Object(w.jsxs)("div",{className:"panel",style:{backgroundColor:e.appState.backgroundColor},ref:e=>this.state.container=e,children:[Object(w.jsx)("div",{className:"controlsBottom",children:Object(w.jsx)(U.a,{id:"chatInputSubmitForm",onSubmit:t,className:e.appState.className,autoComplete:"off",children:Object(w.jsx)(U.a.Group,{inline:!0,unstackable:!0,children:Object(w.jsxs)(z.a,{inverted:e.appState.darkMode,attached:"left",fluid:!0,focus:!0,name:"message",value:s.message,onChange:o,type:"text",placeholder:a("Type your message"),children:[g,Object(w.jsx)("div",{style:{zIndex:4},children:u}),Object(w.jsx)(_.a,{inverted:e.appState.darkMode,trigger:Object(w.jsx)(x.a,{compact:!0,icon:!0,type:"button",color:"grey","data-tooltip":a("Insert"),inverted:e.appState.darkMode,children:Object(w.jsx)(O.a,{name:"plus"})}),content:Object(w.jsxs)(x.a.Group,{vertical:!0,children:[r,h,m,Object(w.jsx)(x.a,{compact:!0,icon:!0,type:"button",color:"yellow","data-tooltip":a("Emoticons"),onClick:this.onEmojiButton,inverted:e.appState.darkMode,children:Object(w.jsx)(O.a,{name:"smile"})})]}),on:"click",position:"top center"}),Object(w.jsx)("input",{ref:this.inputRef}),Object(w.jsx)(x.a,{compact:!0,primary:!0,icon:!0,type:"submit","data-tooltip":a("Send"),inverted:e.appState.darkMode,children:Object(w.jsx)(O.a,{name:"send"})})]})})})}),l,p,d,n,c]})}}var oe=s(367),ae=s(108),ie=s.n(ae),ne=s(109),re=s.n(ne);class ce extends o.Component{constructor(e){super(e),this.translationUpdate=e=>{e.stopPropagation();const{props:t,state:s}=this;if(t.appState.serverURL2){var o={};if(t.user.loggedIn){const e={userID:t.user.ID,sessionID:t.user.sessionID,sessionKey:t.user.sessionKey};o.VideoWhisper=e,o.message=t.message,o.language=t.appState.language,o.flag=t.appState.flag}o.devMode=this.devMode;var a=this;ie.a.post(t.appState.serverURL2+"translate.php",re.a.stringify(o),this.axiosConfig).then((function(e){a.translationReceived(e)})).catch((e=>this.translationError(e,o))),this.setState({updating:!0})}else console.log("VideoWhisper/components/ChatMessage translationUpdate: missing serverURL2")},this.devMode=e.appState.devMode,this.state={translation:"",language:"",flag:"",updating:!1},this.axiosConfig={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}}translationReceived(e){const{state:t}=this,s=e.data;s.translation?this.setState({translation:s.translation,language:s.language,flag:s.flag,updating:!1}):this.setState({updating:!1})}translationError(e,t){console.log("VideoWhisper/components/ChatMessage translationError:",e,t),this.setState({updating:!1})}render(){const{props:e,state:t}=this,s=e.message,o=s.notification,a=s.userID===e.userID&&!o,i=e.previousUser==s.userName+"#"+s.userID,n=s.time-e.previousTime<6e4;var r=s.userAvatar?Object(w.jsx)(H.a,{className:"avatar","data-tooltip":s.userName,avatar:!0,src:s.userAvatar,size:"mini",rounded:!0}):"";const c=new Date(s.time),d=c.toLocaleDateString()+" at "+c.toLocaleTimeString();var l="chatMessage "+(e.darkMode?"dark ":"")+" "+(o?"notification":"user")+" "+(a?"own ":"")+" "+(s.automated?"automated":""),p=i||o?"":Object(w.jsxs)("strong",{children:[" ",r," ",s.userName]}),h=i&&n?"":Object(w.jsx)("i",{children:d}),m=p||h?Object(w.jsxs)(w.Fragment,{children:[p," ",h,":",Object(w.jsx)("br",{})]}):"",u="";s.image&&(u=Object(w.jsx)(H.a,{src:s.image,size:"mini",rounded:!0,floated:"left",verticalAlign:"middle"})),s.picture&&(u=Object(w.jsx)(H.a,{src:s.picture,size:"small",rounded:!0,floated:"left",verticalAlign:"middle"}));var g="";return e.config.multilanguage&&(g=s.flag?s.flag!=e.appState.flag?t.flag==e.appState.flag?Object(w.jsxs)("div",{children:[" ",Object(w.jsx)(q.a,{name:s.flag})," ",Object(w.jsx)("br",{})," ",t.translation.split("\n").map(((e,t)=>Object(w.jsx)("div",{children:e},t)))," ",Object(w.jsx)(q.a,{name:t.flag})]}):e.config.translations?Object(w.jsxs)(x.a,{onClick:this.translationUpdate,compact:!0,basic:!0,size:"tiny",disabled:t.updating,loading:t.updating,className:e.darkMode?"inverted ":"",children:[Object(w.jsx)(q.a,{name:s.flag})," \u2192 ",Object(w.jsx)(q.a,{name:e.appState.flag})]}):Object(w.jsx)(q.a,{name:s.flag}):Object(w.jsx)(q.a,{name:s.flag}):""),Object(w.jsxs)("li",{className:l,ref:e.messageRef,children:[m,0!=s.mentionMessage&&void 0!=s.mentionMessage?Object(w.jsxs)(x.a,{"data-tooltip":e.txt("Scrool to Message"),onClick:t=>e.messageScroll(t,s.mentionMessage),size:"tiny",className:e.darkMode?"inverted ":"",target:"_blank",compact:!0,icon:!0,children:[" ",Object(w.jsx)(O.a,{name:"arrow up",size:"small"})," "]}):"",""!=s.mentionUser&&void 0!=s.mentionUser?Object(w.jsxs)("span",{children:[" @",s.mentionUser,Object(w.jsx)("br",{})]}):"",s.video?Object(w.jsx)("div",{children:Object(w.jsx)("video",{style:{maxWidth:"75%"},src:s.video,controls:!0})}):"",s.audio?Object(w.jsx)("div",{children:Object(w.jsx)("audio",{src:s.audio,controls:!0})}):"",e.selectedID==s.ID?Object(w.jsx)("span",{children:Object(w.jsx)(O.a,{name:"arrow right"})}):"",-1==e.selectedID?Object(w.jsx)("span",{children:Object(w.jsx)(O.a,{name:"caret right"})}):"",Object(w.jsxs)("label",{className:"messageText",style:s.progressTotal?{minWidth:"45%"}:{},id:"m"+s.ID,onClick:t=>e.messageClick(t,s.ID,s.userName),children:[u,s.text.split("\n").map(((e,t)=>Object(w.jsx)("div",{children:e},t))),g,s.progressTotal?Object(w.jsx)("div",{children:Object(w.jsx)(oe.a,{style:{minWidth:"40%"},className:e.darkMode?"inverted ":"",value:s.progressValue,total:s.progressTotal,indicating:!0,progress:"ratio",size:"small",children:s.progressDetails})}):"",s.url?Object(w.jsx)(x.a,{className:e.darkMode?"inverted ":"",target:"_blank",href:s.url,compact:!0,icon:!0,children:Object(w.jsx)(O.a,{name:"linkify"})}):"",s.count?Object(w.jsxs)(C.a,{children:[Object(w.jsx)(O.a,{name:"mail"})," ",s.count]}):"",s.attachmentsCount?Object(w.jsxs)(C.a,{children:[Object(w.jsx)(O.a,{name:"file"})," ",s.attachmentsCount]}):"",s.recordingsCount?Object(w.jsxs)(C.a,{children:[Object(w.jsx)(O.a,{name:"file video"})," ",s.recordingsCount]}):"",s.file_name?Object(w.jsxs)("span",{children:[" ",s.file_name," ",s.file_size," ",Object(w.jsx)(x.a,{className:e.darkMode?"inverted ":"",target:"_blank",href:s.file_url,compact:!0,icon:!0,children:Object(w.jsx)(O.a,{name:"download"})})," "]}):""]})]},s.ID)}}class de extends o.Component{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return t.config&&e in t.config.text?t.config.text[e]:e},this.onScroll=()=>{const{refs:e}=this;e.messageList.scrollTop},this.scrollToBottom=()=>{const{messageList:e}=this.refs,t=e.scrollHeight-e.clientHeight;n.a.findDOMNode(e).scrollTop=t>0?t:0},this.messageClick=(e,t,s)=>{this.devMode&&console.log("components/ChatHistory messageClick",t,s,this.devMode,e),e.stopPropagation();const{props:o}=this;o.appState.chatMentionMessage==t&&o.appState.chatMentionUser==s||o.appStateUpdate({chatMentionMessage:t,chatMentionUser:s})},this.messageScroll=(e,t)=>{this.devMode&&console.log("components/ChatHistory messageScroll",t,this.messageRefs[t]),e.stopPropagation(),this.messageRefs&&this.messageRefs[t]&&this.messageRefs[t].current&&this.messageRefs[t].current.scrollIntoView({behavior:"smooth",block:"start"})},this.devMode=e.appState.devMode,this.messageRefs={},this.state={container:null}}componentDidMount(){}componentDidUpdate(){this.scrollToBottom()}render(){const{props:e,onScroll:t}=this;this.devMode=e.appState.devMode;var s=!1;let o;(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&(s=!0);var i="",n=0,r=0;return this.messageRefs={},this.mIDs=[],o=e.messages.length>0?Object(w.jsx)("ul",{className:"chatMessageList",ref:"messageList",onScroll:t,children:e.messages.map((t=>{s&&t.modeText&&(t.text=e.appState.tooltip,t.url=e.appState.tooltipURL,t.image=e.appState.tooltipImage),this.messageRefs[t.ID]||(this.messageRefs[t.ID]=a.a.createRef());const o=Object(w.jsx)(ce,{config:e.config,user:e.user,appState:e.appState,txt:this.txt,messageRef:this.messageRefs[t.ID],messageClick:this.messageClick,messageScroll:this.messageScroll,darkMode:e.appState.darkMode,userID:e.user.ID,message:t,previousUser:i,previousTime:n},t.ID);return i=t.userName+"#"+t.userID,n=t.time,t.modeText&&!s||r===t.ID||this.mIDs.indexOf(t.ID)>=0?"":(r=t.ID,this.mIDs.push(r),o)}))}):Object(w.jsx)("ul",{className:"chatMessageList",ref:"messageList",onScroll:t,children:Object(w.jsx)("li",{className:"chatMessage",children:Object(w.jsx)("span",{children:"No Messages."})},"0")}),Object(w.jsx)("div",{className:"panel",style:{backgroundColor:e.appState.backgroundColor},ref:e=>this.state.container=e,children:Object(w.jsx)("div",{className:"controls",children:o})})}}var le=s(363),pe=s(370);class he extends o.Component{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return e in t.config.text?t.config.text[e]:e},this.privateModalClose=()=>this.setState({privateModalShow:!1}),this.fullscreenModalClose=()=>this.setState({fullscreenRecommended:!0}),this.handleFullscreenChange=e=>{var t=!1;(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(t=!0),this.setState({fullscreen:t})},this.toHHMMSS=function(e){var t=Math.floor(e/3600),s=Math.floor((e-3600*t)/60),o=e-3600*t-60*s;return t>0&&t<10&&(t="0"+t),s<10&&(s="0"+s),o<10&&(o="0"+o),(t?t+":":"")+s+":"+o},this.modesClick=(e,t)=>{const{props:s}=this;this.devMode&&console.log("components/Actions modesClick",t,s.room),this.setState({modesOpen:!1}),s.serverUpdate({task:"modesSet",mode:t.name})},this.streamsClick=(e,t)=>{const{props:s}=this;this.devMode&&console.log("components/Actions streamsClick",t,s.room),this.setState({streamsOpen:!1}),s.room.streamsAdmin?t.placement?s.serverUpdate({task:"streamPresentation",streamName:t.stream,streamAddress:t.address,placement:t.placement}):s.serverUpdate({task:"streamsSet",streamName:t.stream,streamAddress:t.address}):s.appStateUpdate({streamName:t.stream,streamAddress:t.address})},this.state={tipLast:0,fullpage:!1,fullscreenRecommended:!1,fullscreen:!1,tipsOpen:!1,privateModalShow:!1,privateLoading:!1,requestModalShow:!1,requestDetails:"Details for request modal: No action meta info!",requestAction:{ID:0},displayTime:"00:00"},this.devMode=e.appState.devMode}updateTime(e){this.setState({displayTime:this.toHHMMSS(Math.floor(e/1e3))})}onClick(e,t){let{name:s,value:o}=t;const{state:a,props:i}=this;var n;switch(this.devMode&&console.log("components/Actions onClick",s,o,e,"props:",i),s){case"voteButton":this.devMode&&console.log("components/Actions voteButton",i.room.voteOptions),i.serverUpdate({task:"vote",category:0});break;case"tipsButton":case"menuButton":a.fullscreen&&this.exitFullscreen();break;case"fullpage":const t=!a.fullpage;this.setState({fullpage:t}),this.fullpage();break;case"sfx":var r=!i.appState.sfx;r&&i.appSfx("message",null,!0),i.appStateUpdate({sfx:r}),i.serverUpdate({task:"options",name:"h5v_sfx",value:r});break;case"darkMode":var c=!i.appState.darkMode;i.appStateUpdate({darkMode:c}),i.serverUpdate({task:"options",name:"h5v_dark",value:c});break;case"pipMode":var d=!i.appState.pipMode;i.appStateUpdate({pipMode:d}),i.serverUpdate({task:"options",name:"h5v_pip",value:d});break;case"recMode":var l=!i.appState.recMode;i.appStateUpdate({recMode:l}),i.serverUpdate({task:"options",name:"stream_record_all",value:l});break;case"fullscreenRecommended":i.config.actionFullpage&&(this.setState({fullpage:!0}),this.fullpage());case"fullscreen":if(this.state.fullscreenRecommended=!0,a.fullscreen)this.exitFullscreen();else{const e=document.getElementById("videowhisperVideochat");this.requestFullscreen(e)}break;case"tip":if("undefined"===typeof o)break;const h=parseInt(o);if(i.room.tips&&i.room.tipOptions.length>0&&i.room.tipOptions.length>h){const e=i.room.tipOptions[h];i.serverUpdate({task:"tip",tip:e,tipsURL:i.room.tipsURL,targetID:i.room.performerID}),this.setState({tipsOpen:!1,tipLast:Date.now()}),console.log("components/Actions sending tip",e,h)}break;case"next":i.serverUpdate({task:"next",targetID:i.room.performerID});break;case"party_return":i.serverUpdate({task:"party_return"});break;case"party_leave":i.serverUpdate({task:"party_leave"});break;case"reveal":i.appStateUpdate({revealed:!0,publishRequired:!0});break;case"private":this.setState({privateModalShow:!0});break;case"privateClose":n={action:"privateRequest",ID:i.room.actionID,privateUID:i.room.privateUID,status:7},i.serverUpdate({task:"interaction-close",interaction:n});break;case"privateRequest":this.setState({privateLoading:!0,privateModalShow:!1});var p={userName:i.user.name};n={action:"privateRequest",userID:i.user.ID,roomID:i.room.ID,targetID:i.room.performerID,meta:p},i.serverUpdate({task:"interaction",interaction:n});break;case"declineRequest":this.setState({requestModalShow:!1}),n={ID:a.requestAction.ID,answer:0,status:2},i.serverUpdate({task:"interaction-answer",interaction:n});break;case"acceptRequest":this.setState({requestModalShow:!1}),n={ID:a.requestAction.ID,answer:1,status:2},i.serverUpdate({task:"interaction-answer",interaction:n});break;default:console.log("components/Actions onClick UNHANDLED",s,o,e)}}fullpage(){const e=document.getElementById("videowhisperVideochat");this.state.fullpage?(e.style.position="fixed",e.style.top="0",e.style.left="0"):e.style.position="absolute",console.log("components/Actions fullpage",this.state.fullpage,e.style.position)}componentDidMount(){document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("msfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("MSFullscreenChange",this.handleFullscreenChange,!1),document.addEventListener("fullscreenchange",this.handleFullscreenChange,!1)}componentWillUnmount(){document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullscreenChange),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullscreenChange),document.removeEventListener("fullscreenchange",this.handleFullscreenChange)}requestFullscreen(e){var t=!0;this.state.fullscreen=t,e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1,this.state.fullscreen=!1),this.setState({fullscreen:t})}exitFullscreen(){this.setState({fullscreen:!1}),(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.log("components/Actions Fullscreen API is not supported."))}componentDidUpdate(e){e.actions!==this.props.actions&&this.processActions()}processActions(){const{props:e,state:t}=this;e.actions.length>0&&e.actions.forEach((s=>{if(s)if(s.userID===e.user.ID){if("privateRequest"===s.action){if(3===s.status&&1===s.answer){s={ID:t.requestAction.ID,status:5};e.serverUpdate({task:"interaction-confirm",interaction:s})}s.status>=3&&s.status<7&&s.answer}}else if("privateRequest"===s.action){if(s.status<2&&e.room.privateUID!==s.userID&&("function"===typeof e.appSfx&&e.appSfx("call"),t.requestModalShow=!0,s.meta&&this.setState({requestDetails:'User "'+s.meta.userName+'" requested starting a private call.'}),t.requestAction=s),2===s.status&&1===s.answer){s={ID:t.requestAction.ID,status:3};e.serverUpdate({task:"interaction-answer",interaction:s})}s.status>=3&&s.status<7&&s.answer}}))}componentWillReceiveProps(e){}render(){const{props:e,state:t,txt:s}=this,o=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;var a=navigator.userAgent.toLowerCase().indexOf("android")>-1,i=[];if(o||a||t.fullscreenRecommended||window.innerWidth<500&&i.push(Object(w.jsxs)(M.a,{closeIcon:!0,open:!0,onClose:this.fullscreenModalClose,size:"small",children:[Object(w.jsx)(y.a,{icon:"star",content:"FullScreen Recommended"}),Object(w.jsx)(M.a.Content,{children:Object(w.jsx)("h3",{children:"When available space is small, fullscreen is recommended to access interface more easily."})}),Object(w.jsxs)(M.a.Actions,{children:[Object(w.jsxs)(x.a,{color:"orange",onClick:this.fullscreenModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," Nevermind"]}),Object(w.jsxs)(x.a,{color:"green",name:"fullscreenRecommended",onClick:this.onClick.bind(this),children:[Object(w.jsx)(O.a,{name:"expand"})," Go Fullscreen"]})]})]},"recommendFullscreen")),e.config.siteMenu){var n=[],r=[],c=null;e.config.siteMenu.forEach((t=>{t.parentID?r.push(Object(w.jsxs)(I.a.Item,{href:t.url,target:"_blank",children:[" ",t.title," "]},t.ID)):(r.length?(n.push(Object(w.jsx)(I.a,{className:e.appState.className,item:!0,text:c.title,children:Object(w.jsx)(I.a.Menu,{children:r})},c.ID)),r=[]):c&&n.push(Object(w.jsxs)(le.a.Item,{href:c.url,target:"_blank",children:[" ",c.title," "]},c.ID)),c=t)})),i.push(Object(w.jsx)(_.a,{className:e.appState.className,on:["hover","click"],trigger:Object(w.jsx)(x.a,{name:"menuButton",onClick:this.onClick.bind(this),compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",children:Object(w.jsx)(O.a,{name:"align justify"})}),flowing:!0,hoverable:!0,children:Object(w.jsxs)(le.a,{vertical:!0,className:e.appState.className,children:[Object(w.jsx)(le.a.Item,{header:!0,children:s("Site Menu")}),n]})},"siteMenu"))}var d="";if(e.user.balance!=e.user.balancePending&&(d=Object(w.jsxs)(C.a,{"data-tooltip":s("Pending Balance"),className:e.appState.className,as:"a",color:e.appState.darkMode?"black":"grey",children:[" ",Object(w.jsx)(O.a,{name:"notched circle loading icon"})," ",e.user.balancePending]})),(e.config.balanceURL||e.user.balance)&&i.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",name:"balance",as:"div",labelPosition:"right",children:[Object(w.jsx)(x.a,{"data-tooltip":s("Wallet"),compact:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",color:"green",target:"_balance",href:e.config.balanceURL,children:Object(w.jsx)(O.a,{name:"money"})}),Object(w.jsx)(C.a,{"data-tooltip":s("Balance"),className:e.appState.className,as:"a",color:e.appState.darkMode?"black":"grey",target:"_balance",href:e.config.balanceURL,children:e.user.balance}),d]},"balance")),e.room.tips&&e.room.tipOptions.length>0){var l=0;const o=Object(w.jsx)(w.Fragment,{children:e.room.tipOptions.map(((t,o)=>{if("TIP"===t.tag&&"custom"!==t.attributes.AMOUNT)return l++,Object(w.jsxs)(pe.a.Column,{className:e.appState.className,textAlign:"center",children:[Object(w.jsxs)(y.a,{as:"h4",className:e.appState.className,children:[t.attributes.IMAGE?Object(w.jsx)(H.a,{src:e.room.tipsURL+t.attributes.IMAGE,size:"mini",rounded:!0,verticalAlign:"middle"}):""," ",t.attributes.AMOUNT]}),Object(w.jsx)("b",{children:t.attributes.LABEL}),Object(w.jsx)("div",{children:t.attributes.NOTE}),Object(w.jsx)("div",{children:Object(w.jsx)(x.a,{compact:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",color:"olive",name:"tip",value:o,onClick:this.onClick.bind(this),children:s("Gift")})})]},"tip"+o)}))});i.push(Object(w.jsx)(_.a,{className:e.appState.className,on:["hover","click"],trigger:Object(w.jsxs)(x.a,{icon:!0,compact:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",name:"tipsButton",onClick:this.onClick.bind(this),color:"olive",disabled:Date.now()-t.tipLast<5e3,children:[" ",Object(w.jsx)(O.a,{name:"gift"})," ",e.appState.minMode?"":s("Gifts")]},"tipsButton"),flowing:!0,hoverable:!0,open:this.state.tipsOpen,onOpen:()=>this.setState({tipsOpen:!0}),onClose:()=>this.setState({tipsOpen:!1}),children:Object(w.jsx)(pe.a,{className:e.appState.className,stackable:!0,centered:!0,divided:!0,columns:l,style:{overflow:"auto",maxHeight:180,maxWidth:480},children:o})},"tipsPopup"))}var p=!0,h=s("Request Private Session");if(e.room.actionPrivateDisable)h=s("Performer Disabled Private Requests");else if(e.room.actionPrivateBusy)h=s("Performer is Busy in Private");else if(e.room.users){(b=e.room.users[e.room.performerID])?p=!1:h=s("Performer is Not Online")}if(e.room.actionPrivate&&i.push(Object(w.jsx)("span",{"data-tooltip":h,children:Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",name:"private",color:"orange",loading:t.privateLoading,disabled:t.privateLoading||p,onClick:this.onClick.bind(this),children:[" ",Object(w.jsx)(O.a,{name:"star"})," ",s("Private")]})},"private")),e.room.actionPrivateClose&&i.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",name:"privateClose",color:"red",onClick:this.onClick.bind(this),children:[Object(w.jsx)(O.a,{name:"window close"})," ",s("Close Private")]},"privateClose")),i.push(Object(w.jsxs)(M.a,{closeIcon:!0,open:t.privateModalShow,onClose:this.privateModalClose,size:"small",children:[Object(w.jsx)(y.a,{icon:"star",content:s("Request Private 2 Way Videochat Show")}),Object(w.jsx)(M.a.Content,{children:Object(w.jsx)("h3",{children:e.room.performer})}),Object(w.jsxs)(M.a.Actions,{children:[Object(w.jsxs)(x.a,{color:"red",onClick:this.privateModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," ",s("Nevermind")]}),Object(w.jsxs)(x.a,{color:"green",name:"privateRequest",onClick:this.onClick.bind(this),loading:t.privateLoading,disabled:t.privateLoading,children:[Object(w.jsx)(O.a,{name:"star"})," ",s("Request Private")]})]})]},"privateModal")),i.push(Object(w.jsxs)(M.a,{open:t.requestModalShow,closeOnEscape:!1,closeOnDimmerClick:!1,size:"small",children:[Object(w.jsx)(y.a,{icon:"star",content:"Answer Private Show Request"}),Object(w.jsx)(M.a.Content,{children:Object(w.jsx)("h3",{children:t.requestDetails})}),Object(w.jsxs)(M.a.Actions,{children:[Object(w.jsxs)(x.a,{color:"red",name:"declineRequest",onClick:this.onClick.bind(this),children:[Object(w.jsx)(O.a,{name:"remove"})," ",s("Decline")]}),Object(w.jsxs)(x.a,{color:"green",name:"acceptRequest",onClick:this.onClick.bind(this),children:[Object(w.jsx)(O.a,{name:"star"})," ",s("Accept")]})]})]},"requestModal")),e.room.next&&i.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",name:"next",color:"teal","data-tooltip":e.room.nextTooltip?e.room.nextTooltip:s("Next: Random Videochat Room"),onClick:this.onClick.bind(this),disabled:e.appState.roomLoading,children:[s("Next")," ",Object(w.jsx)(O.a,{name:"arrow right"})]},"next")),e.room.partyHost?i.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",name:"party_return",color:"teal","data-tooltip":s("Return Party to Start Room"),onClick:this.onClick.bind(this),disabled:e.appState.roomLoading,children:[s("Return")," ",Object(w.jsx)(O.a,{name:"arrow circle left"})]},"party_return")):e.room.party&&i.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",name:"party_leave",color:"teal","data-tooltip":s("Leave Party"),onClick:this.onClick.bind(this),disabled:e.appState.roomLoading,children:[s("Leave")," ",Object(w.jsx)(O.a,{name:"close"})]},"party_leave")),e.appState.revealMode&&!e.appState.audioMode&&!e.room.audioOnly&&!e.appState.revealed&&"Way2Screen"==e.appState.screen){var m=e.appState.revealWarmup-e.appState.screenTime,u=!0;m<=0?(m="",u=!1):m=Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"clock"})," ",m," "]}),i.push(Object(w.jsx)("span",{"data-tooltip":s("Reveal Webcam"),children:Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",name:"reveal",color:"olive",onClick:this.onClick.bind(this),disabled:u,children:[Object(w.jsx)(O.a,{name:"video"})," ",s("Reveal")," ",m]},"reveal")}))}if(e.room.voteOptions){const t=e.room.voteOptions[0];i.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",name:"voteButton",color:"teal","data-tooltip":s("Vote")+" ("+t.cost+")",onClick:this.onClick.bind(this),disabled:t.voted,children:[Object(w.jsx)(O.a,{name:"thumbs up"})," ",t.votes]},"voteButton"))}if(e.room.modes){var g=[];for(var v in e.room.modes){const t=e.room.modes[v];g.push(Object(w.jsxs)(le.a.Item,{name:t.name,active:e.room.mode==t.name,onClick:this.modesClick,children:[Object(w.jsx)(O.a,{name:t.icon}),t.name]},t.key))}i.push(Object(w.jsx)(_.a,{className:e.appState.className,on:["hover","click"],trigger:Object(w.jsxs)(x.a,{icon:!0,compact:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",name:"modesButton",onClick:this.onClick.bind(this),color:"blue","data-tooltip":e.room.mode,"data-position":"right center",children:[" ",Object(w.jsx)(O.a,{name:"users"})," ",e.appState.minMode?"":s("Mode")]},"modesButton"),flowing:!0,hoverable:!0,open:this.state.modesOpen,onOpen:()=>this.setState({modesOpen:!0}),onClose:()=>this.setState({modesOpen:!1}),children:Object(w.jsx)(le.a,{className:e.appState.className,vertical:!0,children:g})},"modesPopup"))}if(e.room.streams&&(!e.appState.minMode||e.room.streamsAdmin)){var b,f=[],j=!1,S=this.txt("Webcam");if(e.room.users)(b=e.content?e.room.users[e.content.userID]:e.room.users[e.room.streamUID])&&(b.meta&&b.meta.connected&&b.sdate<b.meta.connectedUpdate&&(j=!0),S=b.userName);for(var k in f.push(Object(w.jsxs)(le.a.Item,{name:"",address:"",stream:S,active:e.room.streamsAdmin&&!e.room.streamAddress||!e.room.streamsAdmin&&e.appState.streamName&&!e.appState.streamAddress,onClick:this.streamsClick,children:[Object(w.jsx)(O.a,{name:"user"}),j?Object(w.jsx)(O.a,{size:"tiny",color:"green",name:"circle"}):Object(w.jsx)(O.a,{size:"tiny",name:"stop"}),S]},"streamsCamera")),e.room.streamsAdmin||f.push(Object(w.jsxs)(le.a.Item,{name:"",address:"",stream:"",active:!e.appState.streamName&&!e.room.streamAddress,onClick:this.streamsClick,children:[Object(w.jsx)(O.a,{name:"users"}),this.txt("Room Default")]},"streamsDefault")),e.room.streams){const t=e.room.streams[k];if(f.push(Object(w.jsxs)(le.a.Item,{name:t.name,address:t.address,stream:t.stream,active:e.room.streamsAdmin&&e.room.streamName==t.stream||!e.room.streamsAdmin&&e.appState.streamAddress==t.address||!e.room.streamsAdmin&&!e.appState.streamName&&e.room.streamAddress==t.address,onClick:this.streamsClick,children:[Object(w.jsx)(O.a,{name:"camera video"}),t.name]},t.key)),e.room.streamsAdmin&&e.room.usersPresentation)for(var R in e.appState.media)f.push(Object(w.jsxs)(le.a.Item,{name:R+t.name,address:t.address,stream:t.stream,placement:R,onClick:this.streamsClick,children:[Object(w.jsx)(O.a,{name:"pointing up"}),R,": ",t.name]},R+t.key))}i.push(Object(w.jsx)(_.a,{className:e.appState.className,on:["hover","click"],trigger:Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",name:"streamsButton",onClick:this.onClick.bind(this),color:"pink",children:[" ",Object(w.jsx)(O.a,{name:"video camera"})," ",s("Views")]},"streamsButton"),flowing:!0,hoverable:!0,open:this.state.streamsOpen,onOpen:()=>this.setState({streamsOpen:!0}),onClose:()=>this.setState({streamsOpen:!1}),children:Object(w.jsx)(le.a,{className:e.appState.className,vertical:!0,children:f})},"streamsPopup"))}if(e.appState.minMode||o||e.config.actionFullscreen&&i.push(Object(w.jsx)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",floated:"right",name:"fullscreen",color:"grey","data-tooltip":t.fullscreen?s("Exit Fullscreen"):s("Enter Fullscreen"),onClick:this.onClick.bind(this),children:Object(w.jsx)(O.a,{name:t.fullscreen?"compress":"expand"})},"fullscreen")),e.appState.minMode||e.config.actionFullpage&&i.push(Object(w.jsx)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",floated:"right",name:"fullpage",color:"grey","data-tooltip":t.fullpage?"Zoom Out of Full Page":"Zoom Into Full Page",onClick:this.onClick.bind(this),children:Object(w.jsx)(O.a,{name:t.fullpage?"zoom-out":"zoom-in"})},"fullpage")),e.appState.minMode||e.config.recordAction&&i.push(Object(w.jsx)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",floated:"right",name:"recMode",color:e.appState.recMode?"red":"black","data-tooltip":e.appState.recMode?s("Stop Recording"):s("Enable Recording"),onClick:this.onClick.bind(this),children:Object(w.jsx)(O.a,{name:e.appState.recMode?"stop":"record"})},"recMode")),e.appState.minMode||i.push(Object(w.jsx)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",floated:"right",name:"sfx",color:e.appState.sfxError?"red":e.appState.sfx?"green":"yellow","data-tooltip":e.appState.sfxError?s("Tap to Play"):e.appState.sfx?s("Sfx On"):s("Sfx Off"),onClick:this.onClick.bind(this),children:Object(w.jsx)(O.a,{name:e.appState.sfxError?"deaf":e.appState.sfx?"bell":"bell slash"})},"sfx")),e.appState.minMode||e.room.panelCamera&&i.push(Object(w.jsx)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",floated:"right",name:"pipMode",color:e.appState.pipMode?"grey":"black","data-tooltip":e.appState.pipMode?s("Disable Picture in Picture"):s("Enable Picture in Picture"),onClick:this.onClick.bind(this),children:Object(w.jsx)(O.a,{name:e.appState.pipMode?"window restore":"window maximize"})},"pipMode")),e.appState.minMode||i.push(Object(w.jsx)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",floated:"right",name:"darkMode",color:e.appState.darkMode?"yellow":"black","data-tooltip":e.appState.darkMode?s("Lights On"):s("Dark Mode"),onClick:this.onClick.bind(this),children:Object(w.jsx)(O.a,{name:e.appState.darkMode?"sun":"moon"})},"darkMode")),(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&i.push(Object(w.jsx)(x.a,{compact:!0,icon:!0,className:e.appState.className,size:e.appState.minMode?"tiny":"small",floated:"right",name:"videowhisper",color:["red","blue","orange","olive","green","pink","violet"][Math.floor(7*Math.random())],target:"_videowhisper",href:e.appState.tooltipURL,"data-tooltip":e.appState.tooltip,children:Object(w.jsx)(O.a,{name:["eye","audio description","bullhorn","tag","question circle","at"][Math.floor(6*Math.random())]})},"videowhisper")),i.push(Object(w.jsxs)(C.a,{size:e.appState.minMode?"tiny":"small","data-tooltip":s("Session Duration")+(e.room.mode?": "+e.room.mode:""),className:e.appState.className,color:e.appState.darkMode?"black":"grey",children:[Object(w.jsx)(O.a,{name:"time"}),t.displayTime]},"labelDuration")),e.user.cost>0&&i.push(Object(w.jsxs)(C.a,{size:e.appState.minMode?"tiny":"small","data-tooltip":(e.user.other?e.user.other+": ":"")+s("Session Cost"),className:e.appState.className,color:e.appState.darkMode?"black":"grey",children:[" ",Object(w.jsx)(O.a,{name:"money"})," ",e.user.cost]},"labelCost")),e.user.earn>0&&i.push(Object(w.jsxs)(C.a,{size:e.appState.minMode?"tiny":"small","data-tooltip":(e.user.other?e.user.other+": ":"")+s("Session Earning"),className:e.appState.className,color:e.appState.darkMode?"black":"grey",children:[" ",Object(w.jsx)(O.a,{name:"money"})," ",e.user.earn]},"labelEarn")),e.room.actionButtons)for(var U in e.room.actionButtons){var D=e.room.actionButtons[U];i.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:e.appState.minMode?"tiny":"small",floated:D.floated,name:D.name,color:D.color,target:"_"+D.target,href:D.url,"data-tooltip":D.tooltip,children:[Object(w.jsx)(O.a,{name:D.icon})," ",D.text]},D.name))}return Object(w.jsx)("div",{className:"panel",ref:e=>this.state.container=e,children:Object(w.jsx)("div",{className:"controlsBottom vwsActions",children:i})})}}class me extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutBroadcast",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layCamera",children:Object(w.jsx)(E,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layHistory",children:Object(w.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(w.jsx)("div",{className:"laySend",children:Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}class ue extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutBroadcastAudio",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layHistory",children:Object(w.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(w.jsx)("div",{className:"laySend",children:Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layCamera",children:Object(w.jsx)(E,{cameraConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})})]})}}class ge extends A{constructor(e){super(e),this.onLoadedData=e=>{const t=this.remoteVideo.current;this.devMode&&console.log("components/Video - loadeddata"),this.updateVideoSize("onLoadedData"),t&&t.paused&&0==t.currentTime&&(console.log("components/Video loadeddata : video paused on load - try to play",t.src,e),this.videoPlay())},this.onopen=function(e){var{state:t}=this;this.devMode&&console.log("components/Video wsConnection.onopen wsConnection.readyState:",this.wsConnection.readyState,e,this.state),this.props.appStateUpdate({wsOpen:!0,wsComponent:"Video onopen"}),1==this.wsConnection.readyState&&(t.retrying=!1,this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.addEventListener("icecandidate",(e=>this.icecandidate(this.peerConnection,e))),this.peerConnection.onconnectionstatechange=e=>this.onconnectionstatechange(e),this.peerConnection.onsignalingstatechange=e=>this.onsignalingstatechange(e),this.peerConnection.oniceconnectionstatechange=e=>this.iceconnectionstatechange(this.peerConnection,e),this.peerConnection.onnegotiationneeded=this.onnegotiationneeded.bind(this),this.peerConnection.addEventListener("track",this.track.bind(this)),this.wsConnection?1==this.wsConnection.readyState?this.sendPlayOffer():console.log("components/Video wsConnection not open for sendPlayOffer wsConnection.readyState:",this.wsConnection.readyState):console.log("components/Video wsConnection not available"))},this.mungeSDPPlay=function(e){let t=e.split(/\r\n/),s="";for(var o in t){var a=t[o];if(0!==a.length){if(a.includes("profile-level-id")){let e=a.substr(a.indexOf("profile-level-id")+17,6),t=Number("0x"+e.substr(0,2)),s=Number("0x"+e.substr(2,2)),o=Number("0x"+e.substr(4,2));t>66&&(t=66,s=224,o=31),0===s&&(s=224);let i=("00"+t.toString(16)).slice(-2).toLowerCase()+("00"+s.toString(16)).slice(-2).toLowerCase()+("00"+o.toString(16)).slice(-2).toLowerCase();a=a.replace(e,i)}s+=a,s+="\r\n"}}return this.devMode&&console.log("components/Video mungeSDPPlay",s),s},this.onmessage=function(e){var{state:t}=this;this.devMode&&console.log("components/Video onmessage",e);var s=JSON.parse(e.data),o=Number(s.status),a=s.command;let i="";if(t.retryCount++,200!=o)i=s.statusDescription,t.available&&(504===o||514===o||t.retryCount<t.autoRetries&&"1"===this.props.config.videoAutoPlay)?1==this.wsConnection.readyState?(this.devMode&&console.log("components/Video onmessage - Not ready: scheduling sendPlayOffer",o,i),setTimeout(this.sendPlayOffer.bind(this),1500),i=i+" (retry #"+t.retryCount+")",this.setState({buttonDisabled:!0,buttonContent:"Auto Retry",statusInfo:i,connecting:!0,connected:!1})):(console.log("components/Video onmessage - wsConnection Not open for sendPlayOffer wsConnection.readyState:",this.wsConnection.readyState),this.setState({buttonDisabled:!1,buttonContent:"Retry",statusInfo:i,connecting:!1,connected:!1})):this.stopStreamPlay(),this.setState({statusInfo:i});else{this.devMode&&console.log("components/Video onmessage 200 msgJSON",s);var n=s.streamInfo;void 0!==n&&(this.streamInfo.sessionId=n.sessionId),void 0!==s.sdp&&(this.devMode&&console.log("components/Video onmessage: setRemoteDescription sdp: "+JSON.stringify(s.sdp)),s.sdp.sdp=this.mungeSDPPlay(s.sdp.sdp),this.peerConnection.setRemoteDescription(s.sdp).then(this.peerCreateAnswer.bind(this)).catch(this.errorHandler.bind(this)));var r=s.iceCandidates;if(void 0!==r)for(var c in r)this.devMode&&console.log("addIceCandidate: "+JSON.stringify(r[c])),this.peerConnection.addIceCandidate(new RTCIceCandidate(r[c])).then((()=>this.onAddIceCandidateSuccess(this.peerConnection)),(e=>this.onAddIceCandidateError(this.peerConnection,e)));0=="sendResponse".localeCompare(a)&&this.wsConnection&&this.wsConnection.readyState<2&&this.wsConnection.close()}},this.devMode=e.appState.devMode,this._isMounted=!1,this.devMode&&console.log("components/Video constructor",e),this.audioInterface=!1,e.videoConfig&&(this.audioInterface=e.videoConfig.audioInterface),this.playStarted=!1,this.retriesLeft=5,this.retryTimeout=5e3,this.retryIfTimeoutSet=!1,this.wsWaited=0,this.remoteVideo=a.a.createRef(),this.wsConnection=null,this.peerConnection=null,this.peerConnectionConfig={iceServers:[]},this.vwsPeerConfig=this.peerConnectionConfig,this.userData={},this.startTime=null,this.stats={video:{timestamp:0,bandwidth:0,bitrate:0,packetsLost:0,qualityLimitationReason:"none",framesReceived:0,fps:0,frameWidth:0,frameHeight:0},audio:{timestamp:0,bandwidth:0,bitrate:0,packetsLost:0}},this.streamInfo={applicationName:e.config.application,streamName:e.room.streamPlayback,userName:e.room.performer,sessionId:"[empty]"},this.state={gotVideo:!1,gotAudio:!1,packetLoss:!1,panelType:"Video",meta:e.meta,bitrateInfo:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"eye slash"}),"Detecting"]}),videoMuted:"muted",videoMutedMessage:"Tap for Sound",fullscreen:!1,available:!1,connected:!1,connecting:!1,autoRetries:3,statusInfo:"Waiting...",buttonContent:"Connecting",buttonDisabled:!0,videoWidth:640,videoHeight:360,videoAspectRatio:1.77,retryCount:0,retrying:!1}}interfaceReady(){var{props:e,state:t}=this;this.streamInfoReset(),this.devMode&&console.log("components/Video - interfaceReady",this.streamInfo),("1"===e.config.videoAutoPlay||t.available)&&this.startStreamPlay()}updateVideoSize(e){var t=this.remoteVideo.current;this.devMode&&console.log("components/Video updateVideoSize",e,t);var{state:s}=this;let o;if(t&&t.videoHeight&&(s.videoWidth===t.videoWidth&&s.videoHeight===t.videoHeight||(s.videoWidth=t.videoWidth,s.videoHeight=t.videoHeight,s.videoHeight||(s.videoHeight=1),this.setState({videoWidth:t.videoWidth,videoHeight:t.videoHeight})),o=t.videoWidth/t.videoHeight,s.videoAspectRatio!==o&&this.setState({videoAspectRatio:o}),this.startTime)){const e=window.performance.now()-this.startTime;this.devMode&&console.log("components/Video updateVideoSize Remote Video playback setup time: "+e.toFixed(3)+"ms"),this.startTime=null}this.devMode&&console.log("components/Video updateVideoSize "+e,s.videoWidth,s.videoHeight,o)}componentDidMount(){this.devMode&&console.log("components/Video componentDidMount"),this._isMounted=!0,super.componentDidMount(),this.interfaceReady()}componentWillUnmount(){this.devMode&&console.log("components/Video stopStreamPlay"),this._isMounted=!1,this.stopStreamPlay(),super.componentWillUnmount()}componentDidUpdate(e,t,s){const{state:o,props:a}=this;if(this.devMode=a.appState.devMode,o.available&&(o.connected||o.connecting||o.retrying||(this.devMode&&console.log("components/Video - componentDidUpdate: startStreamPlay"),this.startStreamPlay())),e.room.videoOffline!=a.room.videoOffline){this.devMode&&console.log("components/Video - componentDidUpdate: props.room.videoOffline");var i=this.remoteVideo.current;i.paused||(i.pause(),i.removeAttribute("src"),i.load())}}timerStart(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.packetsLost=0,this.stats.audio.packetsLost=0,this.stats.video.fps=0,this.stats.video.frameWidth=0,this.stats.video.frameHeight=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),1e3),this.devMode&&console.log("components/Video timerStart"),this.setState({packetLoss:!1})}timerStop(){clearInterval(this.timer),this.devMode&&console.log("components/Video timerStop"),this.setState({packetLoss:!1})}timerTick(){if(!this._isMounted)return;const{state:e,props:t}=this;if(this.devMode=t.appState.devMode,!this.state.connected)return;if(!this.peerConnection)return;this.peerConnection.getReceivers().forEach((e=>{e.getStats().then((e=>{e.forEach((e=>{this.devMode&&e.packetsLost&&e.packetsLost>0&&console.log("components/Video packetsLost ",e.packetsLost,e);var t=e.kind;if(void 0===t&&(t=e.mediaType),t&&("inbound-rtp"==e.type&&(this.stats[t]||(this.stats[t]={}),this.stats[t].packetsLost=e.packetsLost,this.stats[t].roundTripTime=e.roundTripTime,this.stats[t].jitter=e.jitter,this.stats[t].timestampRemote=e.timestamp),"inbound-rtp"===e.type&&!e.isRemote&&("video"===t||"audio"===t))){var s=e.timestamp-this.stats[t].timestamp;s>0&&s<6e3&&e.bytesReceived>=this.stats[t].bytesReceived&&("video"==t&&(this.stats[t].fps=Math.round(1e3*(e.framesReceived-this.stats[t].framesReceived)/s)),this.stats[t].bitrate=8*(e.bytesReceived-this.stats[t].bytesReceived)/s),this.stats[t].timestamp=e.timestamp,this.stats[t].bytesReceived=e.bytesReceived,"video"==t&&(this.stats[t].framesReceived=e.framesReceived,this.stats[t].frameWidth=e.frameWidth,this.stats[t].frameHeight=e.frameHeight),this.stats[t].qualityLimitationReason=e.qualityLimitationReason}}))}))}));var s=Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"video"}),Math.round(this.stats.video.bitrate)," kbps","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":"",this.stats.video.roundTripTime>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"clock"}),this.stats.video.roundTripTime," "]}):"",this.stats.video.jitter>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"circle notch"}),Math.round(1e3*(this.stats.video.jitter+Number.EPSILON))/1e3," jitter "]}):"",this.stats.video.packetsLost>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"exclamation circle"}),this.stats.video.packetsLost," packets lost "]}):"",Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"expand"}),this.stats.video.frameWidth?this.stats.video.frameWidth:this.remoteVideo.current.videoWidth,"x",this.stats.video.frameHeight?this.stats.video.frameHeight:this.remoteVideo.current.videoHeight,"@",this.stats.video.fps," "]}),Object(w.jsx)("br",{})]});(this.props.room.audioOnly||this.audioInterface)&&(s="");var o=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"broken chain"}),"Socket Not Connected"]});this.wsConnection&&(o=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"chain"}),this.wsConnection.readyState]})),this.vwsSocket&&(o=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:this.vwsSocket.connected?"chain":"unlink"})," "]}));var a=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"stop circle"}),"Peer Not Connected"]});this.peerConnection&&(a=Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"play circle"}),this.peerConnection.connectionState,"/",this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState]}));let i=Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"wait"}),"Measuring..."]});(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(i=Object(w.jsxs)("div",{children:[s,Object(w.jsx)(O.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps","none"!==this.stats.audio.qualityLimitationReason&&void 0!==this.stats.audio.qualityLimitationReason?"(limited: "+this.stats.audio.qualityLimitationReason+")":"",this.stats.audio.roundTripTime>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"clock"}),this.stats.audio.roundTripTime," "]}):"",this.stats.audio.jitter>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"circle notch"}),Math.round(1e3*(this.stats.audio.jitter+Number.EPSILON))/1e3," jitter "]}):"",this.stats.audio.packetsLost>0?Object(w.jsxs)(w.Fragment,{children:[" ",Object(w.jsx)(O.a,{name:"exclamation circle"}),this.stats.audio.packetsLost," packets lost "]}):"",Object(w.jsx)("br",{}),o," ",a]})),(this.state.settingsActive||this.audioInterface)&&this.setState({bitrateInfo:i}),this.state.gotAudio&&0==this.stats.audio.bitrate&&this.setState({gotAudio:!1}),!this.state.gotAudio&&this.stats.audio.bitrate>0&&this.setState({gotAudio:!0}),this.state.gotVideo&&0==this.stats.video.bitrate&&this.setState({gotVideo:!1}),!this.state.gotVideo&&this.stats.video.bitrate>0&&this.setState({gotVideo:!0}),(this.stats.audio.packetsLost||this.stats.video.packetsLost)&&(this.state.packetLoss||this.setState({packetLoss:!0}))}detectStreamChange(){const{state:e,props:t}=this;this.devMode=t.appState.devMode;var s,o=0,a=t.room.streamPlayback,i=!1;t.room.users&&(t.content?(s=t.room.users[t.content.userID])&&(a=t.content.stream):(s=t.room.users[t.room.streamUID])&&(a=t.room.streamPlayback));this.streamInfo&&this.streamInfo.streamName!=a&&(o=1),s&&s.meta&&s.meta.connected&&s.sdate<s.meta.connectedUpdate&&(i=!0),e.available!=i&&(this.state.available=i,this.devMode&&console.log("components/Video detectStreamChange available",i,this.state.available)),o&&(this.devMode&&console.log("components/Video detectStreamChange",a,this.streamInfo.streamName),this.stopStreamPlay(),this.serverVideowhisper&&this.vwsSocket&&this.vwsSocket.connected&&this.vwsSocket.disconnect(),this.streamInfoReset(),a&&("1"===t.config.videoAutoPlay||e.available)&&this.startStreamPlay())}render(){const{state:e,props:t,txt:s}=this;this.devMode=t.appState.devMode,this.detectStreamChange();var o={};if(!this.audioInterface){if(e.container){let t=e.container.clientWidth,s=e.container.clientHeight;if(e.width!==t||e.height!==s){s||(s=1);const e=t/s;this.state.aspectRatio=e,this.state.width=t,this.state.height=s,this.devMode&&console.log("components/Video - render: container size update")}}let t=e.videoWidth,s=e.videoHeight,a=0,i=0;e.width&&e.aspectRatio&&e.videoAspectRatio&&(e.videoAspectRatio>e.aspectRatio?(t=e.width,s=t/e.videoAspectRatio,i=(e.height-s)/2):(s=e.height,t=s*e.videoAspectRatio,a=(e.width-t)/2)),o={position:"absolute",left:a,top:i,width:t,height:s}}var a="eye";(t.room.audioOnly||this.audioInterface)&&(a="microphone");var i="";this.streamInfo&&this.streamInfo.streamName&&(i=this.streamInfo.streamName.split("?")[0]);var n="";e.settingsActive&&(n=Object(w.jsxs)("div",{className:"controlsTop vwsVideoControls",children:[Object(w.jsxs)(U.a,{children:[Object(w.jsx)(C.a,{color:"black",pointing:"right",children:e.statusInfo}),Object(w.jsx)($.a,{hidden:!0,vertical:!0}),Object(w.jsxs)(x.a,{compact:!0,size:"small",name:"reload",onClick:this.onClick.bind(this),loading:e.buttonDisabled,disabled:e.buttonDisabled,icon:!0,labelPosition:"right",inverted:!0,children:[e.buttonContent,Object(w.jsx)(O.a,{name:"redo"})]})]}),Object(w.jsxs)(C.a,{color:"black",children:[this.streamInfo.userName?Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"user"}),this.streamInfo.userName]}):Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"users"})," ",t.room.name]}),i?Object(w.jsxs)(w.Fragment,{children:["  ",Object(w.jsx)(O.a,{name:"play"}),i," "]}):""," ",e.connected?e.bitrateInfo:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"eye slash"}),"Not Streaming"]})]})]}));var r="";e.packetLoss&&(r=Object(w.jsx)("span",{"data-tooltip":this.txt("Packet Loss: Download Connection Issue"),"data-position":"left center",children:Object(w.jsx)(O.a,{inverted:!0,name:"exclamation circle",size:"large"})}));var c=Object(w.jsx)(x.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Not Available","data-position":"bottom center",children:Object(w.jsx)(O.a,{inverted:!0,color:"black",name:a+" slash"})});e.available&&(c=Object(w.jsx)(x.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Available","data-position":"bottom center",children:Object(w.jsx)(O.a,{inverted:!0,color:"green",name:a})})),e.connecting&&(c=Object(w.jsx)(x.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Connecting","data-position":"bottom center",children:Object(w.jsx)(O.a,{inverted:!0,loading:!0,name:"spinner"})})),e.connected&&(c=Object(w.jsx)(x.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Streaming","data-position":"bottom center",children:Object(w.jsx)(O.a,{inverted:!0,name:a})})),e.connected&&!e.available&&(c=Object(w.jsx)(x.a,{compact:!0,name:"status",size:"small",inverted:!this.audioInterface||t.appState.darkMode,icon:!0,"data-tooltip":"Terminated","data-position":"bottom center",children:Object(w.jsx)(O.a,{inverted:!0,color:"orange",name:a})}));var d=Object(w.jsx)(w.Fragment,{});t.room.videoOffline&&(e.available||e.connected||(d=Object(w.jsx)("source",{src:t.room.videoOffline,type:"video/mp4"})));var l="",p="";return t.appState.minMode||(l=Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(x.a,{compact:!0,name:"gotAudio",size:"small",inverted:!0,icon:!0,"data-tooltip":e.gotAudio?s("Receiving Audio"):s("No Audio"),"data-position":"bottom center",children:Object(w.jsx)(O.a,{inverted:!0,name:e.gotAudio?"microphone":"microphone slash"})})," ",Object(w.jsx)(x.a,{compact:!0,name:"gotVideo",size:"small",inverted:!0,icon:!0,"data-tooltip":e.gotVideo?s("Receiving Video"):s("No Video"),"data-position":"bottom center",children:Object(w.jsx)(O.a,{inverted:!0,name:e.gotVideo?"video":"eye slash"})})]}),p=Object(w.jsx)(x.a,{compact:!0,name:"fullscreen",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":s("Enter Fullscreen"),"data-position":"bottom center",children:Object(w.jsx)(O.a,{name:"expand"})})),this.audioInterface?Object(w.jsx)("div",{className:"panel",ref:e=>this.state.container=e,children:Object(w.jsx)(U.a,{children:Object(w.jsxs)(U.a.Group,{inline:!0,children:[Object(w.jsx)(U.a.Field,{inline:!0,children:Object(w.jsx)(O.a,{inverted:t.appState.darkMode,name:"volume up"})}),Object(w.jsx)(U.a.Field,{children:Object(w.jsxs)(x.a,{compact:!0,name:"mute",size:"small",inverted:t.appState.darkMode,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":e.videoMuted?s("Enable Audio"):s("Mute"),"data-position":"bottom center",children:[Object(w.jsx)(O.a,{name:e.videoMuted?"volume off":"volume up"})," ",e.videoMutedMessage]})}),Object(w.jsx)(U.a.Field,{children:Object(w.jsx)("audio",{style:{borderRadius:"3px",padding:"2px",margin:"2px"},id:"remoteVideo",poster:t.room.snapshot,ref:this.remoteVideo,className:"remoteVideo",muted:e.videoMuted,autoPlay:!0,loop:!0,playsInline:!0,onLoadedData:this.onLoadedData})}),Object(w.jsx)(U.a.Field,{children:Object(w.jsxs)(x.a,{compact:!0,size:"small",name:"reload",onClick:this.onClick.bind(this),loading:e.buttonDisabled,disabled:e.buttonDisabled,icon:!0,labelPosition:"right",inverted:t.appState.darkMode,children:[Object(w.jsx)(O.a,{name:"redo"}),e.buttonContent]})}),Object(w.jsx)(U.a.Field,{inline:!0,children:r}),Object(w.jsx)(U.a.Field,{inline:!0,children:Object(w.jsxs)(C.a,{size:"tiny",children:[Object(w.jsx)(O.a,{name:"user"}),this.streamInfo.userName," ",e.connected?e.bitrateInfo:Object(w.jsxs)(w.Fragment,{children:[Object(w.jsx)(O.a,{name:"eye slash"}),"Not Streaming"]})]})})]})})}):Object(w.jsxs)("div",{className:"panel vwsVideo",ref:e=>this.state.container=e,children:[Object(w.jsx)("div",{className:"backgroundVideo",children:Object(w.jsx)("video",{style:o,id:"remoteVideo",poster:t.room.snapshot,ref:this.remoteVideo,className:"remoteVideo",muted:e.videoMuted,autoPlay:!0,loop:!0,playsInline:!0,controls:e.settingsActive,onLoadedData:this.onLoadedData,onLoadedMetadata:()=>this.updateVideoSize("loadedmetadata"),children:d})}),Object(w.jsxs)("div",{className:"controlsIcons",children:[r,c,l,Object(w.jsx)(x.a,{compact:!0,name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:e.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":s("Toggle Controls"),"data-position":"bottom center",children:Object(w.jsx)(O.a,{name:"setting"})}),Object(w.jsxs)(x.a,{compact:!0,name:"mute",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":e.videoMuted?s("Enable Audio"):s("Mute"),"data-position":"bottom center",children:[Object(w.jsx)(O.a,{name:e.videoMuted?"volume off":"volume up"})," ",e.videoMutedMessage]}),p]}),n]})}onClick(e,t){let{name:s,value:o}=t;const{txt:a}=this;if("reload"==s)switch(this.state.buttonContent){case a("Tap to Play"):this.remoteVideo.current.play(),this.state.connected?this.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:"Reload",videoMuted:"",videoMutedMessage:""}):this.state.connecting?this.setState({statusInfo:"Preview. Connecting...",videoMuted:"",videoMutedMessage:""}):this.setState({statusInfo:"Preview",buttonContent:a("Reload"),videoMuted:"",videoMutedMessage:""});break;case a("Reload"):this.setState({buttonDisabled:!0,buttonContent:a("Reloading"),connecting:!0,connected:!1}),this.stopStreamPlay(),this.startStreamPlay()}if("fullscreen"==s){this.state.fullscreen;e.preventDefault(),this.requestFullscreen(this.remoteVideo.current)}"mute"==s&&(this.state.videoMuted&&(this.remoteVideo.current.muted=!1),this.setState({videoMuted:!this.state.videoMuted,videoMutedMessage:""})),super.onClick(e,{name:s,value:o})}retryIfTimeout(){this.state.connected||this.playStarted||this.retriesLeft>0&&(this.devMode&&console.log("components/Video retryIfTimeout #",this.retriesLeft),this.retriesLeft--,this.stopStreamPlay(),this.setState({buttonDisabled:!0,buttonContent:"Auto Retry...",connecting:!0,connected:!1}),this.startStreamPlay()),this.retryIfTimeoutSet=!1}requestFullscreen(e){var t=!0;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1),this.setState({fullscreen:t})}streamInfoReset(){const{props:e,state:t}=this;var s;(this.streamInfo={applicationName:e.config.application,streamName:e.room.streamPlayback,userName:"",sessionId:"[empty]"},e.room.users)&&(e.content?(s=e.room.users[e.content.userID])&&(this.streamInfo.streamName=e.content.stream):(s=e.room.users[e.room.streamUID])&&(this.streamInfo.streamName=e.room.streamPlayback),s&&(this.streamInfo.userName=s.userName,s.meta&&s.meta.connected&&s.sdate<s.meta.connectedUpdate&&(t.available=!0),this.streamInfo.userName=s.userName))}vwsConnect(){const{props:e,state:t}=this;this.vwsPeerId=e.appState.username+"_play",this.streamInfo.streamName?this.vwsChannel=this.streamInfo.streamName.substring(0,e.room.streamPlayback.indexOf("?")):this.vwsChannel=e.room.streamPlaybackName?e.room.streamPlaybackName:e.room.streamPlayback.substring(0,e.room.streamPlayback.indexOf("?")),this.vwsSocket||(this.vwsSocket=new P.a(e.config.vwsSocket,{auth:{token:e.config.vwsToken},transports:["websocket"],secure:!0,autoConnect:!1,reconnection:!1}),this.devMode&&console.log("components/Video vwsSocket ",this.vwsPeerId,this.vwsChannel,e.config.vwsSocket),this.vwsSocket.on("connect",(()=>{this.devMode&&console.log("components/Video vwsSocket Connected #",this.vwsSocket.id),this.vwsSocket.emit("subscribe",this.vwsPeerId,this.vwsChannel)})),this.vwsSocket.on("disconnect",(()=>{console.log("components/Video vwsSocket Disconnected"),this.setState({statusInfo:this.txt("Disconnected"),buttonDisabled:!1,settingsActive:!0,buttonContent:this.txt("Reload"),connecting:!1,connected:!1})})),this.vwsSocket.on("connect_failed",(e=>{console.log("components/Video vwsSocket Connection failed",e.message),this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload"),settingsActive:!0,statusInfo:e.message,connecting:!1,connected:!1})})),this.vwsSocket.on("connect_error",(e=>{console.log("components/Video vwsSocket Connection error",e.message),this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload"),settingsActive:!0,statusInfo:e.message,connecting:!1,connected:!1})})),this.vwsSocket.on("message",(e=>{this.devMode&&console.log("components/Video vwsSocket.on(message",e.type?e.type:e),e.from!==this.vwsPeerId?("offer"===e.type&&(this.vwsPeerIdTarget=e.from,e.peerConfig&&(this.vwsPeerConfig=e.peerConfig),this.devMode&&console.log("components/Video offer creating peerConnection",this.vwsPeerConfig,e),this.peerConnection=new RTCPeerConnection(this.vwsPeerConfig),this.peerConnection.addEventListener("icecandidate",(e=>this.icecandidate(this.peerConnection,e))),this.peerConnection.addEventListener("track",this.track.bind(this)),this.peerConnection.onconnectionstatechange=e=>this.onconnectionstatechange(e),this.peerConnection.onsignalingstatechange=e=>this.onsignalingstatechange(e),this.peerConnection.oniceconnectionstatechange=e=>this.iceconnectionstatechange(this.peerConnection,e),this.peerConnection.onnegotiationneeded=this.onnegotiationneeded.bind(this),this.peerConnection.setRemoteDescription(e.content).then(this.peerCreateAnswer.bind(this)).catch(this.errorHandler.bind(this))),"candidate"===e.type&&e.candidate&&this.peerConnection.addIceCandidate(new RTCIceCandidate(e.candidate)).then((()=>{this.devMode&&console.log("components/Video peerConnection.addIceCandidate Success",e.target,e)})).catch((t=>{console.log("components/Video peerConnection.addIceCandidate Error",t,e)}))):this.devMode&&console.log("components/Video vwsSocket.on(message) ignore own message",e)})),this.vwsSocket.on("uniquenessError",(e=>{console.error(`components/Video vwsSocket Error: ${e.message}`),this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload"),settingsActive:!0,statusInfo:e.message,connecting:!1,connected:!1})})),this.vwsSocket.on("subscribeError",(e=>{console.error(`components/Video vwsSocket subscribeError: ${e.message}`),this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload"),settingsActive:!0,statusInfo:e.message,connecting:!1,connected:!1})}))),this.vwsSocket.connected||this.vwsSocket.connect()}wsConnect(){const{props:e,state:t}=this;if(this.devMode=e.appState.devMode,this.devMode&&console.log("components/Video wsConnect: ",t.connected,e.appState.wsOpen,this.wsConnection,this.wsWaited),t.connected)console.log("components/Video wsConnect: already connected, skip");else{if(this.props.appState.wsOpen)return this.devMode&&console.log("components/Video wsConnect:  websocket busy,  retry later",this.props.appState.wsComponent," waited: "+this.wsWaited,this.wsConnection),this.wsConnection&&this.wsConnection.readyState<2&&(this.wsWaited>1?(this.wsConnection.close(),this.peerConnection&&this.peerConnection.close(),this.wsWaited=0):this.wsWaited++),void setTimeout((()=>this.wsConnect()),2e3);this.props.appStateUpdate({wsOpen:!0,wsComponent:"Video"}),this.userData={param1:"value1",videowhisper:"webrtc-playback"},this.wsConnection&&this.wsConnection.readyState<2&&(console.log("components/Video wsConnect previous websocket (close)",this.wsConnection),this.wsConnection.close(),this.peerConnection&&this.peerConnection.close()),this.wsConnection=new WebSocket(e.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsConnection.onmessage=e=>this.onmessage(e),this.wsConnection.onclose=()=>{this.devMode&&console.log("components/Video wsConnection.onclose"),this.props.appStateUpdate({wsOpen:!1})},this.wsConnection.onerror=e=>{console.log("components/Video ERROR wsConnection.onerror: ",e),this.props.appStateUpdate({wsOpen:!1}),this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:"Retry",statusInfo:e.message})}}}peerCreateAnswer(){const{state:e}=this;this.devMode&&console.log("components/Video peerCreateAnswer"),this.peerConnection.createAnswer().then(this.gotDescription.bind(this)).catch(this.errorHandler.bind(this))}errorHandler(e){console.log(e)}async icecandidate(e,t){if(t.candidate){this.devMode&&console.log("components/Video icecandidate (onicecandidate):",t);try{if(this.serverVideowhisper){const e={type:"candidate",candidate:t.candidate,from:this.vwsPeerId,target:this.vwsPeerIdTarget};if(this.devMode){if("relay"!==t.candidate.type)return void console.log("components/Video icecandidate: Ignoring non-relay candidate in devMode",t.candidate);console.log('components/Video icecandidate vwsSocket.emit("messagePeer"',e)}this.vwsSocket.emit("messagePeer",e)}}catch(s){this.onAddIceCandidateError(e,s)}}else this.devMode&&console.log("components/Video icecandidate end (null event.candidate):",e)}onAddIceCandidateSuccess(e){this.devMode&&console.log("components/Video onAddIceCandidateSuccess success",e)}onAddIceCandidateError(e,t){this.devMode&&console.log(`components/Video onAddIceCandidateError failed to add ICE Candidate: ${t}`)}onnegotiationneeded(){this.devMode&&console.log("components/Video peerConnection onnegotiationneeded")}onsignalingstatechange(){if(!this._isMounted)return;let e;this.peerConnection&&(e=this.peerConnection.signalingState,this.devMode&&console.log(`components/Video onsignalingstatechange , state: ${e}`,this.retryTimeout),this.serverWowza&&("have-remote-offer"!=e&&"stable"!=e||(this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload")}),this.props.appStateUpdate({videoStatus:"pending"}),this.retryIfTimeoutSet||(setTimeout((()=>this.retryIfTimeout()),this.retryTimeout),this.retryIfTimeoutSet=!0))))}videoPlay(){const e=this.remoteVideo.current,{txt:t}=this;this.playStarted=!1,e&&e.play().then((s=>{this.devMode&&console.log("components/Video Autoplay started accept/paused/src",s,e.paused,e.src),this.playStarted=!0,this.props.appState.muted&&this.props.appStateUpdate({muted:!1}),this.state.connected?this.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:t("Reload"),connecting:!1}):this.state.connecting?this.setState({statusInfo:"Preview. Connecting...",settingsActive:!0,buttonDisabled:!0,buttonContent:"Connecting"}):this.setState({statusInfo:"Preview",buttonDisabled:!1,buttonContent:t("Reload"),settingsActive:!1})}),(s=>{console.log("components/Video Autoplay reject:"+s,s,e.src),this.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:t("Tap to Play"),videoMuted:"",videoMutedMessage:""})})).catch((e=>{console.log("components/Video Autoplay error:"+e,e),this.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:t("Tap to Play")})}))}updatedConnection(e){var{state:t,txt:s}=this;t.connected||"connected"==e&&(this.setState({connected:!0,connecting:!1}),this.videoPlay()),t.connected&&("disconnected"!=e&&"failed"!=e&&"closed"!=e||("1"===this.props.config.videoAutoPlay&&(t.retrying||setTimeout((()=>{t.retrying=!0,this.stopStreamPlay(),this.startStreamPlay(),this.setState({statusInfo:e,buttonDisabled:!0,buttonContent:s("Auto Retry")})}),3300)),this.setState({settingsActive:!0,connected:!1,connecting:!1,buttonDisabled:!1,buttonContent:s("Reload")})))}onconnectionstatechange(e){if(this.devMode&&console.log("components/Video onconnectionstatechange",e),this.peerConnection){let e=this.peerConnection.connectionState;this.devMode&&console.log("components/Video onconnectionstatechange:",e),this.updatedConnection(e)}}iceconnectionstatechange(e,t){let s;e&&(s=e.iceConnectionState,this.devMode&&console.log(`components/Video iceconnectionstatechange: ${e.iceConnectionState}`,t),this.updatedConnection(s))}track(e){const{state:t}=this;var s=this.remoteVideo.current;this.devMode&&console.log("components/Video peer track (gotRemoteTrack) kind:"+e.track.kind+" stream:"+e.streams[0]),s.srcObject!==e.streams[0]&&(s.srcObject=e.streams[0],this.devMode&&console.log("components/Video peer track: playback peer received new remote stream",e))}sendPlayOffer(){this.devMode&&console.log("components/Video sendPlayOffer"),this.state.connected&&this.playStarted&&this.devMode&&console.log("components/Video sendPlayOffer: playStarted skip"),this.serverVideowhisper&&(this.peerConnection?this.peerConnection.createAnswer().then(this.gotDescription.bind(this)).catch(this.errorHandler.bind(this)):console.log("components/Video sendPlayOffer: peerConnection not available")),this.serverWowza&&(this.wsConnection&&(1==this.wsConnection.readyState?(this.wsConnection.send('{"direction":"play", "command":"getOffer", "streamInfo":'+JSON.stringify(this.streamInfo)+', "userData":'+JSON.stringify(this.userData)+"}"),this.setState({statusInfo:"Starting Playback",settingsActive:!1,buttonDisabled:!1,buttonContent:this.txt("Reload"),gotVideo:!1,gotAudio:!1})):(console.log("components/Video sendPlayOffer wsConnection not ready to .send",this.wsConnection),this.setState({statusInfo:"Not Ready",settingsActive:!0,buttonDisabled:!1,buttonContent:this.txt("Reload"),gotVideo:!1,gotAudio:!1}))),this.retryIfTimeoutSet||(setTimeout((()=>this.retryIfTimeout()),this.retryTimeout),this.retryIfTimeoutSet=!0))}startStreamPlay(){const{props:e}=this;this.devMode=this.props.appState.devMode,this.devMode&&console.log("components/Video startStreamPlay"),this.state.retryCount=0,this.wsWaited=0,this.state.connecting=!0;let t=e.config.serverType;e.room.serverType&&(t=e.room.serverType),"videowhisper"==t?(this.serverVideowhisper=!0,this.vwsConnect()):(this.serverWowza=!0,this.wsConnect()),this.timerStart()}stopStreamPlay(){this.devMode&&console.log("components/Video stopStreamPlay"),this.timerStop();var e=this.remoteVideo.current,{props:t}=this;this.peerConnection&&this.peerConnection.close(),this.wsConnection&&this.wsConnection.readyState<2&&this.wsConnection.close(),this.vwsSocket&&this.vwsSocket.disconnect(),e&&(e.src==t.room.videoOffline&&t.room.videoOffline||(e.src="")),this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload"),connecting:!1,connected:!1,gotVideo:!1,gotAudio:!1}),this.playStarted=!1}gotDescription(e){this.devMode&&console.log("components/Video gotDescription",e),this.peerConnection.setLocalDescription(e).then((()=>{if(this.serverWowza&&(1==this.wsConnection.readyState?this.wsConnection.send('{"direction":"play", "command":"sendResponse", "streamInfo":'+JSON.stringify(this.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(this.userData)+"}"):console.log("components/Video gotDescription: wsConnection not ready to .send",this.wsConnection)),this.serverVideowhisper){const t={from:this.vwsPeerId,target:this.vwsPeerIdTarget,type:"answer",content:e};this.devMode&&console.log("components/Video gotDescription > vwsSocket.emit answer after setLocalDescription ",t,this.vwsSocket),this.vwsSocket.emit("messagePeer",t)}})).catch((e=>{console.log("components/Video gotDescription, setLocalDescription error",e)}))}}ge.propTypes={config:N.a.object.isRequired,room:N.a.object.isRequired,appState:N.a.object.isRequired,appStateUpdate:N.a.func.isRequired,content:N.a.object,meta:N.a.string,videoConfig:N.a.object};class ve extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutPlayback",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layVideo",children:Object(w.jsx)(ge,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room})}),Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layHistory",children:Object(w.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(w.jsx)("div",{className:"laySend",children:Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}class be extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutPlaybackAudio",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layHistory",children:Object(w.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(w.jsx)("div",{className:"laySend",children:Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layVideo",children:Object(w.jsx)(ge,{videoConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room})}),Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})})]})}}class fe extends o.Component{render(){const{props:e}=this;return this.componentActions=a.a.createRef(),Object(w.jsxs)("div",{className:"layoutWay2",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layVideo",children:Object(w.jsx)(ge,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room})}),Object(w.jsx)("div",{className:"layCamera",children:Object(w.jsx)(E,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layHistory",children:Object(w.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"laySend",children:Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}class je extends o.Component{render(){const{props:e}=this;return this.componentActions=a.a.createRef(),Object(w.jsxs)("div",{className:"layoutWay2Audio",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layVideo",children:Object(w.jsx)(ge,{videoConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room})}),Object(w.jsx)("div",{className:"layCamera",children:Object(w.jsx)(E,{cameraConfig:{audioInterface:!0},appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layHistory",children:Object(w.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"laySend",children:Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}var Se=s(154),xe=s.n(Se);class Oe extends A{constructor(e){super(e),this.playerError=e=>{console.log("containers/Media playerError",e)},this.state={placement:e.placement,meta:e.meta,panelType:"Media",mediaWidth:0,mediaHeight:1,mediaStyle:{position:"absolute",width:"100%",height:"100%"},mediaAspectRatio:1},this.devMode=e.appState.devMode,this.mediaContent=a.a.createRef(),this.extensionsImg=["jpg","jpeg","jfif","pjpeg","pjp","gif","ico","cur","bmp","png","svg"],this.extensionsVideo=["mp4","webm","ogg"],this.extensionsAudio=["mp3"],this.devMode&&console.log("containers/Media constructor",e)}updateMediaSize(e){var{state:t}=this;t.mediaHeight||(t.mediaHeight=1),t.mediaAspectRatio=t.mediaWidth/t.mediaHeight;let s=t.mediaWidth,o=t.mediaHeight,a=0,i=0;t.width&&t.aspectRatio&&t.mediaAspectRatio&&(t.mediaAspectRatio>t.aspectRatio?(s=t.width,o=s/t.mediaAspectRatio,i=(t.height-o)/2):(o=t.height,s=o*t.mediaAspectRatio,a=(t.width-s)/2));let n={position:"absolute",left:a,top:i,width:s,height:o,border:"solid 1px #555"};this.setState({mediaStyle:n}),this.devMode&&console.log("containers/Media updateMediaSize",e,t.aspectRatio,t.mediaAspectRatio,n,t)}onImgLoad(e){let{target:t}=e;this.state.mediaWidth=t.naturalWidth,this.state.mediaHeight=t.naturalHeight,this.devMode&&console.log("containers/Media onImgLoad",t.naturalWidth,t.naturalHeight),this.updateMediaSize("img")}onVideoLoadedMetadata(e){let{target:t}=e;this.state.mediaWidth=t.videoWidth,this.state.mediaHeight=t.videoHeight,this.devMode&&console.log("containers/Media onVideoLoadedMetadata",t.videoWidth,t.videoHeight),this.updateMediaSize("video")}render(){const{state:e,props:t}=this;var s=Object(w.jsxs)(k.a,{className:t.appState.className,children:[t.placement," / ",t.type," - No Content."]}),o=!1;if(t.placement&&t.appState.media){var a=t.appState.media[t.placement];if(a)switch(a.placement=t.meta+" "+t.placement,a.type){case"user":if(t.room.users){var i,n=!1;(i=t.content?t.room.users[a.userID]:t.room.users[t.room.streamUID])&&i.meta&&i.meta.external&&(n=!0,i.meta.connected&&i.meta.connectedUpdate>i.meta.externalUpdate&&(n=!1)),n&&(s=i.hls?Object(w.jsx)(xe.a,{style:e.mediaStyle,ref:this.mediaContent,url:i.hls,muted:t.appState.muted,playing:!0,controls:!0,playsinline:!0,width:"100%",height:"100%",onError:this.playerError.bind(this)}):Object(w.jsxs)(k.a,{className:t.appState.className,className:t.appState.className,children:[t.placement," - HLS not available for user #",a.userID]})),n||(s=Object(w.jsx)(ge,{appState:t.appState,appStateUpdate:t.appStateUpdate,config:t.config,room:t.room,content:a,meta:t.meta}))}break;case"stream":case"video":s=Object(w.jsx)(ge,{appState:t.appState,appStateUpdate:t.appStateUpdate,config:t.config,room:t.room,content:a,meta:t.meta});break;case"hls":s=Object(w.jsx)(xe.a,{style:e.mediaStyle,ref:this.mediaContent,url:a.url,muted:t.appState.muted,playing:!0,controls:!0,playsinline:!0,width:"100%",height:"100%",onError:this.playerError.bind(this)});break;case"file":o=!0,s=this.extensionsImg.includes(a.ext)?Object(w.jsx)("img",{style:e.mediaStyle,ref:this.mediaContent,onLoad:this.onImgLoad.bind(this),src:a.url}):this.extensionsVideo.includes(a.ext)||this.extensionsAudio.includes(a.ext)?Object(w.jsx)(xe.a,{style:e.mediaStyle,ref:this.mediaContent,url:a.url,playing:!0,controls:!0,playsinline:!0,loop:!0,onError:this.playerError.bind(this),width:"100%",height:"100%"}):Object(w.jsxs)(k.a,{className:t.appState.className,children:[this.txt("File"),": ",Object(w.jsx)("b",{children:a.name})," (",a.userName,")",Object(w.jsx)($.a,{})," ",Object(w.jsxs)(x.a,{className:t.appState.className,icon:!0,labelPosition:"right",target:"_blank",href:a.url,children:[" ",this.txt("Open")," ",Object(w.jsx)(O.a,{size:"large",name:"folder open"})," "]})," "]});break;case"empty":s=Object(w.jsxs)(k.a,{className:t.appState.className,children:[Object(w.jsxs)(y.a,{children:[t.placement,": Empty Content Area"]})," Room owner can assign content or adjust number of content areas."]});break;default:s=Object(w.jsxs)(k.a,{className:t.appState.className,children:[t.placement," - Unknown type: ",a.type," / ",t.type]})}}var r="";return!o&&t.config.logo&&(r=Object(w.jsx)("img",{className:"videowhisperAppLogo",src:t.config.logo})),Object(w.jsxs)("div",{className:"panel",ref:e=>this.state.container=e,children:[s,r]})}}Oe.propTypes={placement:N.a.string.isRequired,meta:N.a.string.isRequired,type:N.a.string.isRequired,appState:N.a.object.isRequired,appStateUpdate:N.a.func.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired};class Ce extends A{constructor(e){super(e),this.state={panelType:"Multimedia"},this.devMode=e.appState.devMode,this.mediaItems=1,this.devMode&&console.log("containers/Multimedia constructor",e)}render(){const{state:e,props:t}=this;var s=[],o=Object.keys(this.props.appState.media).length,a=0;for(var i in this.props.appState.media){var n=t.appState.media[t.placement],r="none";if(n&&(r=n.type),"user"==r&&t.room.users){var c=t.room.users[n.userID],d=!1;c&&c.meta&&c.meta.external&&(d=!0,c.meta.connected&&c.meta.connectedUpdate>c.meta.externalUpdate&&(d=!1)),d&&(r="hls")}s.push(Object(w.jsx)("div",{className:"slot"+a,children:Object(w.jsx)(Oe,{appState:t.appState,appStateUpdate:t.appStateUpdate,config:t.config,room:t.room,user:t.user,placement:i,type:r,meta:a+"/"+o})},"slot_"+i)),a++}this.mediaItems=a;var l="V";e.aspectRatio>1.77&&(l="H");var p="panel split0";return this.mediaItems>1&&(p="panel split"+l+this.mediaItems),Object(w.jsx)("div",{className:p,ref:e=>this.state.container=e,children:s})}}Ce.propTypes={appState:N.a.object.isRequired,appStateUpdate:N.a.func.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired};class Me extends o.Component{render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutChat",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layHistory",children:Object(w.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(w.jsx)("div",{className:"laySend",children:Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]},"layoutChat")}}class ye extends A{constructor(e){super(e),this.copyToClipboard=e=>{console.log("components/Broadcast copyToClipboard",e.target.value),e.target.select(),navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(e.target.value)},this.state={},this.devMode=e.appState.devMode,this.devMode&&console.log("components/Broadcast constructor room:",e.room)}componentWillUnmount(){this.devMode&&console.log("components/Broadcast componentWillUnmount")}onClick(e,t){let{name:s,value:o}=t;this.devMode&&console.log("components/Broadcast onClick",s,o,e);const{state:a,props:i}=this;if("closed"===s)this.props.serverUpdate({task:"external",external:!1})}render(){const{props:e,txt:t}=this;var s=[];if(e.room.broadcastSettings){for(var o in e.room.broadcastSettings)if("meta"!==o){var a=e.room.broadcastSettings[o],i=[];for(var n in a.fields){var r=a.fields[n];switch(r.type){case"text":i.push(Object(w.jsxs)(U.a.Field,{children:[Object(w.jsx)("label",{children:r.description}),Object(w.jsxs)(z.a,{fluid:!0,readOnly:!0,onClick:this.copyToClipboard,iconPosition:"left",defaultValue:r.value,children:[Object(w.jsx)(O.a,{name:"copy"}),Object(w.jsx)("input",{})]}),Object(w.jsx)("br",{}),Object(w.jsx)("small",{children:r.details})]},r.name));break;case"link":i.push(Object(w.jsxs)(U.a.Field,{children:[Object(w.jsxs)(x.a,{className:e.appState.className,size:"small",name:r.name,color:r.color?r.color:"blue",target:"_blank",href:r.url,children:[Object(w.jsx)(O.a,{name:r.icon?r.icon:"cloud download"})," ",r.description]}),Object(w.jsx)("br",{}),Object(w.jsx)("small",{children:r.details})]},r.name))}}s.push(Object(w.jsxs)("div",{children:[Object(w.jsx)(y.a,{className:e.appState.className,as:"h4",children:a.name}),a.details,Object(w.jsx)($.a,{}),Object(w.jsx)(U.a,{className:e.appState.className,children:i}),Object(w.jsx)($.a,{hidden:!0})]},o))}}else s.push(Object(w.jsx)("p",{children:"No broadcast settings available"}));var c="User list not available.",d=!1;if(e.room.users){var l;e.room?(l=e.room.users[e.user.ID],c="User info available."):c="Not in user list.";var p=t("Not Available");l&&l.meta&&l.meta.external&&(p="Started",d=!0,l.meta.connected&&l.meta.connectedUpdate>l.meta.externalUpdate&&(d=!1,p="Web Broadcast More Recent")),d&&(c=l.hls?t("Streaming"):"HLS not available."),d||(c=p)}const h=d?Object(w.jsxs)("div",{children:[" ",Object(w.jsxs)(x.a,{className:e.appState.className,icon:!0,size:"small",name:"closed",color:"red",onClick:this.onClick.bind(this),children:[Object(w.jsx)(O.a,{name:"close"})," ",t("Closed")]})," ",Object(w.jsx)("small",{children:t("Use after ending external broadcast, to faster restore web based webcam interface.")})," "]},"closed"):"";return Object(w.jsx)("div",{className:"layoutScrollable",style:{backgroundColor:e.appState.backgroundColor},children:Object(w.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:Object(w.jsxs)(k.a,{className:e.appState.className,children:[Object(w.jsx)(y.a,{className:e.appState.className,as:"h4",children:t("External Broadcast")}),Object(w.jsx)(C.a,{color:d?"green":"yellow",children:c}),h,Object(w.jsxs)("small",{children:[Object(w.jsx)("br",{}),e.room.broadcastSettings.meta.description?e.room.broadcastSettings.meta.description:t("External Broadcast")]}),Object(w.jsx)($.a,{}),s]})},"layBroadcast")},"layoutBroadcastScroll")}}ye.propTypes={appState:N.a.object.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,serverUpdate:N.a.func.isRequired};var ke=s(366);class we extends A{constructor(e){super(e),this.userClick=e=>(t,s)=>{if(console.log("components/User userClick",e,s,t),e&&s.action)switch(s.action){case"profile":const t={file:e.url};window.open(t.file);break;case"presentation":this.props.serverUpdate({task:"user_presentation",userID:e.userID,userName:e.userName,placement:s.placement});break;case"kick":this.props.serverUpdate({task:"user_kick",userID:e.userID,userName:e.userName});break;case"ban":this.props.serverUpdate({task:"user_ban",userID:e.userID,userName:e.userName})}},this.state={},this.devMode=e.appState.devMode,this.data=[],this.usersLeft=[],this.usersJoined=[],this.userCount=0,this.scrollableRef=a.a.createRef(),e.room.users&&(this.data=Z.a.sortBy(e.room.users,"order")),this.devMode&&console.log("components/Users constructor room:",e.room)}componentDidMount(){}componentWillUnmount(){console.log("components/Users componentWillUnmount")}shouldComponentUpdate(e,t){return Z.a.isEqual(e.room.users,this.props.room.users)||(this.data=Z.a.sortBy(e.room.users,"order")),!0}render(){const{props:e,state:t,txt:s}=this;var o,a;this.devMode=e.appState.devMode;var i=[],n=0;if(a=this.props.room.usersMenu?Object(w.jsx)(k.a,{className:e.appState.className,children:"Users Menu"}):"",this.data)for(var r in this.data)if(this.data[r].hasOwnProperty("userID")){var c=this.data[r];if(c&&c.userName&&!c.hide){var d=c.userID;n++;var l=[];if(l.push({key:"usermenuProfile_"+d,onClick:this.userClick(c),icon:"address card",text:s("Profile"),action:"profile"}),this.props.room.usersPresentation)for(var p in this.props.appState.media)l.push({key:"usermenuPresentation_"+p+d,onClick:this.userClick(c),icon:"pointing left",text:s("Show")+": "+p,action:"presentation",placement:p});let t=Object(w.jsx)(I.a,{compact:!0,text:c.userName,options:l,className:e.appState.className+" v-select"},"usermenu"+d);this.props.room.usersModerator&&(l.push({key:"usermenuKick_"+d,onClick:this.userClick(c),icon:"sign-out",text:s("Kick"),action:"kick"}),l.push({key:"usermenuBan_"+d,onClick:this.userClick(c),icon:"ban",text:s("Ban"),action:"ban"}));let o=!1;c.meta&&c.meta.external&&(o=!0,c.meta.connected&&c.meta.connectedUpdate>c.meta.externalUpdate&&(o=!1));var h=Object(w.jsxs)("span",{children:[Object(w.jsx)(H.a,{src:c.avatar,rounded:!0,size:"mini",verticalAlign:"middle"}),c.userName===e.room.performer?Object(w.jsx)(O.a,{name:"star"}):"",c.flag&&e.config.multilanguage?Object(w.jsx)(q.a,{name:c.flag}):"",c.meta.connected?Object(w.jsx)(O.a,{name:"video"}):"",o?Object(w.jsx)(O.a,{name:"rss"}):"",t]});i.push(Object(w.jsx)(ke.a.Row,{children:Object(w.jsx)(ke.a.Cell,{children:h})},"userRow"+d))}}else console.log("components/Users missing userID",r,this.data);else i=Object(w.jsx)(ke.a.Row,{children:Object(w.jsx)(ke.a.Cell,{colSpan:"1",warning:!0,children:"No users."})},"No_Users");return o=Object(w.jsx)(ke.a,{celled:!0,selectable:!0,sortable:!0,className:e.appState.className,children:Object(w.jsx)(ke.a.Body,{children:i})},"User_Pane"),this.userCount=n,Object(w.jsxs)("div",{className:"layoutList",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:o},"layScrollable"),Object(w.jsx)("div",{className:"layMenu",children:a})]},"layoutList")}componentDidUpdate(e,t,s){}}we.propTypes={appState:N.a.object.isRequired,appStateUpdate:N.a.func.isRequired,appSfx:N.a.func.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,serverUpdate:N.a.func.isRequired};class Re extends A{constructor(e){super(e),this.handleSort=e=>()=>{this.sortBy(e,!1)},this.fileClick=e=>(t,s)=>{if(console.log("components/Files fileClick",e,s,t),e&&s.action)switch(s.action){case"open":const t={file:e.url};window.open(t.file);break;case"delete":this.props.serverUpdate({task:"file_delete",file_name:e.name});break;case"presentation":this.props.serverUpdate({task:"file_presentation",file_name:e.name,placement:s.placement})}},this.onDrop=e=>{const{props:t}=this;if(!t.config.serverURL)return void console.log("components/Files onDrop missing serverURL",t.config.serverURL,t.config);const s=Q.a.post(t.config.serverURL);s.field("task","file_upload"),s.field("VideoWhisper[userID]",t.user.ID),s.field("VideoWhisper[sessionID]",t.user.sessionID),s.field("VideoWhisper[sessionKey]",t.user.sessionKey),t.room.ID?(s.field("VideoWhisper[roomID]",t.room.ID),s.field("VideoWhisper[privateUID]",t.room.privateUID)):console.log("components/Files onDrop room",t.room,t.user,t.config.serverURL);var o=[];e.forEach((e=>{s.attach(e.name,e,e.name),o.push(e.name)})),s.field("files[]",o),s.then(this.uploadCompleted.bind(this)),console.log("components/Files onDrop",e,s),this.setState({uploading:!0})},this.state={column:null,data:null,direction:null,uploading:!1},this.devMode=e.appState.devMode,this.scrollableRef=a.a.createRef(),this.fileInputRef=a.a.createRef(),e.room.files&&(this.state.data=e.room.files),this.devMode&&console.log("components/Files constructor room:",e.room)}sortBy(e,t){t&&(this.state.column=null,this.state.direction=null);const{column:s,data:o,direction:a}=this.state;if(!o)return;const i="age"==e?"time":e;console.log("components/Files handleSort",e,i,a,t),s===e?this.setState({data:"descending"===a?Z.a.sortBy(o,[i]):Z.a.sortBy(o,[i]).reverse(),direction:"ascending"===a?"descending":"ascending"}):this.setState({column:e,data:Z.a.sortBy(o,[i]).reverse(),direction:"descending"})}componentDidMount(){this.sortBy("age",!0)}componentWillUnmount(){console.log("components/Files  componentWillUnmount")}shouldComponentUpdate(e,t){return Z.a.isEqual(e.room.files,this.props.room.files)||(this.state.data=e.room.files,this.sortBy("age",!0)),!0}uploadCompleted(e){console.log("components/Files uploadCompleted",e),this.props.serverUpdate({task:"update",update:"files"}),this.setState({uploading:!1})}render(){const{props:e,state:t,txt:s}=this;var o,a,i,{column:n,data:r,direction:c}=this.state;return i=this.props.room.filesUpload?Object(w.jsx)(ee.a,{onDrop:this.onDrop,children:o=>{let{getRootProps:a,getInputProps:i}=o;return Object(w.jsx)(k.a,{className:e.appState.className,children:Object(w.jsxs)("div",{...a(),children:[Object(w.jsx)("input",{...i()}),Object(w.jsxs)("p",{children:[Object(w.jsx)(O.a,{name:"upload",loading:t.uploading})," ",t.uploading?s("Uploading. Please wait..."):s("Upload: Drag and drop files here, or click to select files")]})]})})}}):"",a=r?r.map((t=>{let o=[];if(o.push({key:"filemenuOpen_"+t.name,onClick:this.fileClick(t),icon:"file",text:s("Open"),action:"open"}),this.props.room.filesDelete&&o.push({key:"filemenuDelete_"+t.name,onClick:this.fileClick(t),icon:"trash",text:s("Delete"),action:"delete"}),this.props.room.filesPresentation)for(var a in this.props.appState.media)o.push({key:"filemenuPresentation_"+a+t.name,onClick:this.fileClick(t),icon:"pointing left",text:s("Show")+": "+a,action:"presentation",placement:a});var i=Object(w.jsx)(I.a,{text:t.name,options:o,className:e.appState.className},"filemenu"+t.name);return Object(w.jsxs)(ke.a.Row,{children:[Object(w.jsx)(ke.a.Cell,{children:i}),Object(w.jsx)(ke.a.Cell,{children:t.size}),Object(w.jsx)(ke.a.Cell,{children:t.age})]},t.name)})):Object(w.jsx)(ke.a.Row,{children:Object(w.jsx)(ke.a.Cell,{colSpan:"3",warning:!0,children:"No files."})},"No_Files"),o=Object(w.jsxs)(ke.a,{celled:!0,selectable:!0,striped:!0,sortable:!0,className:e.appState.className,children:[Object(w.jsx)(ke.a.Header,{children:Object(w.jsxs)(ke.a.Row,{children:[Object(w.jsx)(ke.a.HeaderCell,{sorted:"name"===n?c:null,onClick:this.handleSort("name"),children:s("Name")}),Object(w.jsx)(ke.a.HeaderCell,{sorted:"size"===n?c:null,onClick:this.handleSort("size"),children:s("Size")}),Object(w.jsx)(ke.a.HeaderCell,{sorted:"age"===n?c:null,onClick:this.handleSort("age"),children:s("Age")})]})}),Object(w.jsx)(ke.a.Body,{children:a})]},"File_Pane"),Object(w.jsxs)("div",{className:"layoutList",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:o},"layScrollable"),Object(w.jsx)("div",{className:"layMenu",children:i})]},"layoutList")}}Re.propTypes={appState:N.a.object.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,serverUpdate:N.a.func.isRequired};class Ue extends A{constructor(e){super(e),this.state={},this.devMode=e.appState.devMode,this.devMode&&console.log("components/Presentation constructor room:",e.room)}componentWillUnmount(){this.devMode&&console.log("components/Presentation  componentWillUnmount")}removeMedia(e,t){let{name:s,value:o}=t;this.devMode&&console.log("components/Presentation removeMedia",s,o,e),this.props.serverUpdate({task:"presentation_remove",placement:o})}render(){const{props:e,txt:t}=this;var s=[];if(e.appState.media)for(var o in e.appState.media){var a=e.appState.media[o];let i="";if("stream"===a.type){let e=this.props.room.users[a.userID];e?e.meta&&(e.meta.connected||(i="Not Broadcasting")):i="Not Available"}s.push(Object(w.jsxs)("div",{children:[a.default?Object(w.jsx)(C.a,{pointing:"right",children:t("Default")}):"empty"===a.type?Object(w.jsx)(C.a,{pointing:"right",children:t("Empty")}):Object(w.jsxs)(x.a,{className:e.appState.className,size:"tiny",compact:!0,name:"removeMedia"+o,value:o,color:"red",onClick:this.removeMedia.bind(this),children:[" ",Object(w.jsx)(O.a,{name:"window close"}),"Remove"]},"removeMedia"+o),Object(w.jsx)("b",{children:o}),": ",a.type," ",Object(w.jsx)("i",{children:a.name})," ",i]},"presentationPlacement"+o))}return Object(w.jsx)("div",{className:"layScrollable",style:{backgroundColor:e.appState.backgroundColor},ref:this.scrollableRef,children:Object(w.jsxs)(k.a,{className:e.appState.className,children:[Object(w.jsxs)(y.a,{className:e.appState.className,as:"h4",children:[t("Media Displayed"),": ",e.room.name]}),Object(w.jsx)($.a,{}),s]})},"layPresentation")}}Ue.propTypes={appState:N.a.object.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,serverUpdate:N.a.func.isRequired};var Ie=s(372);class De extends A{constructor(e){super(e),this.state={panelType:"Options",time:0,updating:!1},this.devMode=e.appState.devMode,this.devMode&&console.log("components/Options constructor room:",e.room)}componentWillUnmount(){this.devMode&&console.log("components/Options componentWillUnmount")}static getDerivedStateFromProps(e,t){return e.room.options&&e.room.options.meta&&e.room.options.meta.time>t.time?(e.appState.devMode&&console.log("components/Options getDerivedStateFromProps",t),De.propsToOptions(e)):null}static propsToOptions(e){var t={};if(e.room.options)for(var s in e.room.options)if("meta"!==s){var o=e.room.options[s];for(var a in o.fields){var i=o.fields[a];i&&i.name&&(t[i.name]=i.value)}}return e.room.options&&e.room.options.meta&&(t.time=e.room.options.meta.time),t.updating=!1,e.appState.devMode&&console.log("components/Options propsToOptions",t),t}onChange(e,t){const s="checkbox"===t.type?t.checked:t.value,o=t.name;this.devMode&&console.log("Components/Options onChange",o,s,t),this.props.serverUpdate({task:"options",name:o,value:s}),o&&this.setState({[o]:s,updating:!0})}render(){const{props:e,state:t}=this;var s=[];if(e.room.options){for(var o in e.room.options)if("meta"!==o){var a=e.room.options[o],i=[];for(var n in a.fields){var r=a.fields[n];switch(r.type){case"toggle":i.push(Object(w.jsxs)(U.a.Field,{children:[Object(w.jsx)("label",{children:r.description}),Object(w.jsx)(Ie.a,{name:r.name,"data-position":"right center",toggle:!0,disabled:t.updating,checked:t[r.name],onChange:(e,t)=>this.onChange(e,t)}),Object(w.jsx)("br",{}),Object(w.jsx)("small",{children:r.details})]},r.name));break;case"dropdown":i.push(Object(w.jsx)(U.a.Group,{children:Object(w.jsxs)(U.a.Field,{children:[Object(w.jsx)("label",{children:r.description}),Object(w.jsx)(I.a,{name:r.name,selection:!0,compact:!0,className:e.appState.className+" v-select","data-position":"right center",value:t[r.name],disabled:t.updating,options:r.options,onChange:(e,t)=>this.onChange(e,t)}),Object(w.jsx)("br",{}),Object(w.jsx)("small",{children:r.details})]})},r.name));break;default:i.push(Object(w.jsxs)("p",{children:[r.name," Unknown Type: ",r.type]},"noFields"))}}s.push(Object(w.jsxs)("div",{children:[Object(w.jsx)(y.a,{className:e.appState.className,as:"h4",children:a.name}),Object(w.jsx)($.a,{}),Object(w.jsx)(U.a,{className:e.appState.className,children:i}),Object(w.jsx)($.a,{hidden:!0})]},o))}}else s.push(Object(w.jsx)("p",{children:"No options"}));return Object(w.jsx)("div",{className:"layoutScrollable",style:{backgroundColor:e.appState.backgroundColor},children:Object(w.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:Object(w.jsx)(k.a,{className:e.appState.className,children:s})},"layOptions")},"layoutOptionsScroll")}}De.propTypes={appState:N.a.object.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,serverUpdate:N.a.func.isRequired};class Ne extends A{constructor(e){super(e),this.donationModalClose=()=>this.setState({donationModal:!1}),this.formModalClose=()=>this.setState({formModal:!1}),this.goalClick=e=>(t,s)=>{switch(console.log("components/Goals donateClick",e,s,t),s.action){case"donate":this.goal=e,this.index=s.ix,this.independent=!0,e&&this.setState({donationModal:!0});break;case"complete":this.props.serverUpdate({task:"goal_complete",goal:e,index:s.ix});break;case"delete":this.props.serverUpdate({task:"goal_delete",goal:e,index:s.ix})}},this.onChange=(e,t)=>{const s="checkbox"===t.type?t.checked:t.value,o=t.name;this.devMode&&console.log("Components/Goals onChange",o,s,t);var a=s;"order"!=o&&"amount"!=o||(a=parseInt(s),isNaN(a)&&(a=0)),o&&this.setState({[o]:a})},this.formSave=(e,t)=>{this.devMode&&console.log("Components/Goals formSave",t),this.props.serverUpdate({task:"goal_add",name:this.state.name,description:this.state.description,amount:this.state.amount,independent:this.state.independent,order:this.state.order}),this.setState({formModal:!1})},this.state={donationModal:!1,formModal:!1,tipLast:0,maxIndex:0,name:"",description:"",independent:!0,order:0,action:"Save"},this.devMode=e.appState.devMode,this.scrollableRef=a.a.createRef(),this.goal={name:"none",description:"none",independent:"false"},this.maxIndex=0,this.devMode&&console.log("components/Goals constructor room:",e.room)}componentDidMount(){}componentWillUnmount(){console.log("components/Goals componentWillUnmount")}onClick(e,t){let{name:s,value:o}=t;const{state:a,props:i}=this;switch(this.devMode&&console.log("components/Goals onClick",s,o,e),s){case"tip":if("undefined"===typeof o)break;const e=parseInt(o);if(i.room.tips&&i.room.tipOptions.length>0&&i.room.tipOptions.length>e){const t=i.room.tipOptions[e];this.goal.independent?i.serverUpdate({task:"tip",tip:t,tipsURL:i.room.tipsURL,targetID:i.room.performerID,independent:this.goal.name,index:this.index}):i.serverUpdate({task:"tip",tip:t,tipsURL:i.room.tipsURL,targetID:i.room.performerID}),this.setState({donationModal:!1,tipLast:Date.now()}),console.log("components/Goals sending tip",t,e)}}}menuClick(e,t){let{action:s}=t;const{state:o,props:a}=this;switch(this.devMode&&console.log("components/Goals menuClick",s,o,a.room),s){case"add":this.setState({formModal:!0,action:this.txt("Add"),name:"",description:"",independent:!0,amount:10,order:this.maxIndex+1});break;case"sort":this.props.serverUpdate({task:"options",name:"goals_sort",value:!this.props.room.options.room.fields.goals_sort.value});break;case"reset":this.props.serverUpdate({task:"goals_reset"})}}render(){const{props:e,state:t,txt:s}=this;this.devMode=e.appState.devMode,String.prototype.stripSlashes=function(){return this.replace(/\\(.)/gm,"$1")};var o=[],a="";this.props.room.options&&this.props.room.options&&this.props.room.options.room.fields.goals_sort&&(a=Object(w.jsxs)(x.a,{action:"sort",onClick:this.menuClick.bind(this),className:e.appState.className,size:"small",children:[" ",Object(w.jsx)(O.a,{name:this.props.room.options.room.fields.goals_sort.value?"sort amount down":"sort numeric down"})," ",s("Sort")]},"sort"));var i="";if(e.room.goalsManage&&(i=Object(w.jsxs)("div",{children:[" \xa0\xa0",Object(w.jsxs)(x.a,{action:"add",onClick:this.menuClick.bind(this),className:e.appState.className,size:"small",children:[" ",Object(w.jsx)(O.a,{name:"plus"})," ",s("Add")]},"addGoal"),a,Object(w.jsxs)(x.a,{action:"reset",color:"red",onClick:this.menuClick.bind(this),className:e.appState.className,size:"small",children:[" ",Object(w.jsx)(O.a,{name:"eraser"})," ",s("Reset All Contributions")]},"resetGoals")]},"goalMenu")),e.room.goals)for(var n in e.room.goals)if(e.room.goals[n].hasOwnProperty("name")){var r=e.room.goals[n];this.maxIndex<parseInt(r.ix)&&(this.maxIndex=parseInt(r.ix));var c=[];r&&r.name&&(e.room.goal&&(e.room.goal.name!=r.name||r.independent||c.push(Object(w.jsx)(x.a,{size:"tiny",action:"donate",ix:r.ix,onClick:this.goalClick(r),className:e.appState.className,disabled:Date.now()-t.tipLast<5e3,children:this.txt("Donate")},"donate"))),r.independent&&c.push(Object(w.jsxs)(x.a,{size:"tiny",action:"donate",ix:r.ix,onClick:this.goalClick(r),className:e.appState.className,disabled:Date.now()-t.tipLast<5e3,children:[Object(w.jsx)(O.a,{name:"gift"})," ",this.txt("Donate")]},"independent")),e.room.goalsComplete&&c.push(Object(w.jsxs)(x.a,{size:"tiny",action:"complete",ix:r.ix,onClick:this.goalClick(r),className:e.appState.className,children:[Object(w.jsx)(O.a,{name:"check"})," ",this.txt("Complete")]},"complete")),e.room.goalsManage&&c.push(Object(w.jsxs)(x.a,{size:"tiny",action:"delete",ix:r.ix,onClick:this.goalClick(r),className:e.appState.className,children:[Object(w.jsx)(O.a,{name:"remove"})," ",this.txt("Delete")]},"delete")),o.push(Object(w.jsxs)(k.a,{size:"small",className:e.appState.className,children:[Object(w.jsxs)(y.a,{as:"h4",children:["#",r.ix," ",r.name," ",Object(w.jsx)(O.a,{size:"small",name:r.independent?"random":"linkify"}),"  "]}),Object(w.jsx)(oe.a,{className:e.appState.className,value:r.current,total:r.amount,indicating:!0,progress:"ratio",size:"small",children:r.description}),c]},"goal"+r.ix)))}else console.log("components/Goals missing name",n,this.data);else o=Object(w.jsx)(k.a,{children:"No goals."},"No_Users");var d,l,p=[];return e.room.tipOptions.length>0&&(l=0,d=Object(w.jsx)(w.Fragment,{children:e.room.tipOptions.map(((t,o)=>{if("TIP"===t.tag&&"custom"!==t.attributes.AMOUNT)return l++,Object(w.jsxs)(pe.a.Column,{className:e.appState.className,textAlign:"center",children:[Object(w.jsxs)(y.a,{as:"h4",className:e.appState.className,children:[t.attributes.IMAGE?Object(w.jsx)(H.a,{src:e.room.tipsURL+t.attributes.IMAGE,size:"mini",rounded:!0,verticalAlign:"middle"}):""," ",t.attributes.AMOUNT]}),Object(w.jsx)("b",{children:t.attributes.LABEL}),Object(w.jsx)("div",{children:t.attributes.NOTE}),Object(w.jsx)("div",{children:Object(w.jsx)(x.a,{compact:!0,className:e.appState.className,size:"small",color:"olive",name:"tip",value:o,onClick:this.onClick.bind(this),children:s("Gift")})})]},"tip"+o)}))})),p.push(Object(w.jsxs)(M.a,{closeIcon:!0,className:e.appState.className,open:t.donationModal,onClose:this.donationModalClose,size:"small",children:[Object(w.jsx)(y.a,{icon:"gift",content:s("Donate")}),Object(w.jsxs)(M.a.Content,{children:[Object(w.jsx)("h3",{children:this.goal.name}),this.goal.description,Object(w.jsx)(pe.a,{className:e.appState.className,stackable:!0,centered:!0,divided:!0,columns:l,style:{overflow:"auto",maxHeight:180,maxWidth:480},children:d})]}),Object(w.jsx)(M.a.Actions,{children:Object(w.jsxs)(x.a,{color:"red",onClick:this.donationModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," ",s("Nevermind")]})})]},"donationModal")),p.push(Object(w.jsxs)(M.a,{closeIcon:!0,className:e.appState.className,open:t.formModal,onClose:this.formModalClose,size:"small",children:[Object(w.jsx)(y.a,{icon:e.config.goals_icon?e.config.goals_icon:"gift",content:t.action}),Object(w.jsx)(M.a.Content,{children:Object(w.jsxs)(U.a,{className:e.appState.className,children:[Object(w.jsxs)(U.a.Field,{children:[Object(w.jsx)("label",{children:s("Name")}),Object(w.jsx)(z.a,{inverted:e.appState.darkMode,name:"name",value:t.name,onChange:this.onChange,type:"text",placeholder:s("Name")})]}),Object(w.jsxs)(U.a.Field,{children:[Object(w.jsx)("label",{children:s("Description")}),Object(w.jsx)(z.a,{inverted:e.appState.darkMode,name:"description",value:t.description,onChange:this.onChange,type:"text",placeholder:s("Description")})]}),Object(w.jsxs)(U.a.Field,{children:[Object(w.jsxs)("label",{children:[s("Amount")," ",Object(w.jsx)(O.a,{name:"money"})]}),Object(w.jsx)(z.a,{inverted:e.appState.darkMode,name:"amount",value:String(t.amount),onChange:this.onChange,type:"text",placeholder:s("Amount")})]}),Object(w.jsxs)(U.a.Field,{children:[Object(w.jsxs)("label",{children:[s("Order")," ",Object(w.jsx)(O.a,{name:"sort numeric down"})," "]}),Object(w.jsx)(z.a,{inverted:e.appState.darkMode,name:"order",value:String(t.order),onChange:this.onChange,type:"text",placeholder:s("Order")})]}),Object(w.jsxs)(U.a.Field,{children:[Object(w.jsxs)("label",{children:[s("Independent")," ",Object(w.jsx)(O.a,{name:"random"})," "]}),Object(w.jsx)(Ie.a,{name:"independent",toggle:!0,checked:t.independent,onChange:this.onChange})]})]})}),Object(w.jsxs)(M.a.Actions,{children:[Object(w.jsxs)(x.a,{color:"red",onClick:this.formModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," ",s("Nevermind")]}),Object(w.jsxs)(x.a,{color:"green",onClick:this.formSave,children:[Object(w.jsx)(O.a,{name:"send"})," ",t.action]})]})]},"formModal")),Object(w.jsxs)("div",{className:"layoutList",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layScrollable",ref:this.scrollableRef,children:Object(w.jsx)(k.a.Group,{size:"small",children:o})},"layScrollable"),Object(w.jsx)("div",{className:"layMenu",children:i}),p]},"layoutList")}}Ne.propTypes={appState:N.a.object.isRequired,appStateUpdate:N.a.func.isRequired,appSfx:N.a.func.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,serverUpdate:N.a.func.isRequired};class Ae extends A{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return t.config&&e in t.config.text?t.config.text[e]:e},this.scrollToBottom=()=>{const{messageList:e}=this.refs,t=e.scrollHeight-e.clientHeight;n.a.findDOMNode(e).scrollTop=t>0?t:0},this.messageClick=(e,t,s)=>{this.devMode&&console.log("components/Messages messageClick",t,s,this.devMode,e),e.stopPropagation();const{props:o}=this;o.appState.messageSelected==t&&o.appState.messageUser==s||o.appStateUpdate({messageSelected:t,messageUser:s})},this.replyClick=(e,t,s)=>{},this.messageScroll=(e,t)=>{this.devMode&&console.log("components/Messages messageScroll",t,this.messageRefs[t]),e.stopPropagation(),this.messageRefs&&this.messageRefs[t]&&this.messageRefs[t].current&&this.messageRefs[t].current.scrollIntoView({behavior:"smooth",block:"start"})},this.sendReply=e=>{this.props.serverUpdate({task:"questions_message",message:e,messageSelected:this.props.appState.messageSelected}),this.devMode&&console.log("VideoWhisper/components/Messages sendReply:",e,this.props,this.state)},this.sendQuestion=e=>{this.props.serverUpdate({task:"questions_question",message:e}),this.devMode&&console.log("VideoWhisper/components/Messages sendQuestion:",e,this.props,this.state)},this.devMode=e.appState.devMode,this.messageRefs={},this.state={container:null}}componentDidMount(){}componentDidUpdate(){this.scrollToBottom()}render(){const{props:e}=this;this.devMode=e.appState.devMode;var t=!1;let s;e.appState.modeVersion!=e.appState.version&&(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&(t=!0);var o="",i=0,n=0;this.messageRefs={};var r="";const c="chatMessage "+(e.darkMode?"dark ":"")+" notification automated";s=e.messages.length>0?Object(w.jsxs)("ul",{className:"chatMessageList",ref:"messageList",children:[e.messages.map((s=>{t&&s.modeText&&(s.text=e.appState.tooltip,s.url=e.appState.tooltipURL,s.image=e.appState.tooltipImage),this.messageRefs[s.ID]||(this.messageRefs[s.ID]=a.a.createRef());const c=Object(w.jsx)(ce,{config:e.config,user:e.user,appState:e.appState,txt:this.txt,messageRef:this.messageRefs[s.ID],messageClick:this.messageClick,messageScroll:this.messageScroll,darkMode:e.appState.darkMode,userID:e.user.ID,message:s,previousUser:o,previousTime:i,selectedID:e.appState.messageSelected},s.ID);return o=s.userName+"#"+s.userID,i=s.time,r="",e.appState.messageSelected&&s.ID==e.appState.messageSelected&&s.count&&s.replies&&(r=s.replies.map((t=>{const s=Object(w.jsx)(ce,{config:e.config,user:e.user,appState:e.appState,txt:this.txt,messageRef:this.messageRefs[t.ID],messageClick:this.replyClick,messageScroll:this.messageScroll,darkMode:e.appState.darkMode,userID:e.user.ID,message:t,previousUser:o,previousTime:i,selectedID:-1},t.ID);return n===t.ID?"":(n=t.ID,s)}))),s.modeText&&!t||n===s.ID?"":(n=s.ID,r?[c,r]:c)})),Object(w.jsx)("li",{className:c,children:Object(w.jsxs)("span",{children:[Object(w.jsx)(O.a,{name:"info circle"})," ",e.room.questionsInfo]})},"i1")]}):Object(w.jsxs)("ul",{className:"chatMessageList",ref:"messageList",children:[Object(w.jsx)("li",{className:"chatMessage",children:Object(w.jsx)("span",{children:this.txt("No Messages.")})},"i0"),Object(w.jsx)("li",{className:c,children:Object(w.jsxs)("span",{children:[Object(w.jsx)(O.a,{name:"info circle"})," ",e.room.questionsInfo]})},"i1")]});var d="";return e.room.questionsAnswer&&e.appState.messageSelected&&(d=Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:this.sendReply,serverUpdate:e.serverUpdate,options:{scenario:"reply",targetUser:e.appState.messageUser,uploadDisable:!0,recordDisable:!0}})),e.room.questionsQuestion&&(d=Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:this.sendQuestion,serverUpdate:e.serverUpdate,options:{scenario:"question",price:e.room.questionsPrice,uploadDisable:!0,recordDisable:!0}})),Object(w.jsxs)("div",{className:"layoutList",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsxs)("div",{className:"layScrollable",ref:this.scrollableRef,children:[s," "]},"layScrollable"),Object(w.jsx)("div",{className:"layMenu",children:d})]},"layoutList")}}Ae.propTypes={config:N.a.object.isRequired,user:N.a.object.isRequired,appState:N.a.object.isRequired,appStateUpdate:N.a.func.isRequired,messages:N.a.array.isRequired,serverUpdate:N.a.func.isRequired};class Te extends A{constructor(e){super(e),this.devMode=e.appState.devMode,this.devMode&&console.log("containers/Tabs constructor",e),this.state={menus:[],panes:[],selected:""},this.updatePanes(e)}static getDerivedStateFromProps(e,t){return e.room&&!t.selected&&e.room.panelCamera?{selected:"Cam"}:null}componentWillUnmount(){this.devMode&&console.log("containers/Tabs componentWillUnmount")}updatePanes(e){const{state:t,txt:s}=this;var o=[],a=[],i="";if(this.state.selected||(this.state.selected=s("Chat")),e.appState.publishRequired&&e.room.panelCamera&&(this.state.selected=s("Cam")),e.appState.external&&this.state.selected==s("Cam")&&(this.state.selected=s("Broadcast")),this.state.selected==s("Chat")&&this.props.appState.chatNew&&this.props.appStateUpdate({chatNew:!1}),i=s("Chat"),o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:"chat"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",this.props.appState.chatNew?Object(w.jsx)(O.a,{size:"tiny",name:"star",color:"green"}):""]})}),a.push(Object(w.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(w.jsx)(Me,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})},"paneChat")),!e.room.textOnly&&!e.appState.pipMode&&e.room.panelCamera&&!e.appState.external){var n="video";i=s("Cam"),(e.room.audioOnly||e.appState.audioMode)&&(i=s("Mic"),n="microphone",this.state.selected==s("Cam")&&(this.state.selected=s("Mic")));const r={off:Object(w.jsx)(O.a,{size:"tiny",name:"stop"}),pending:Object(w.jsx)(O.a,{size:"tiny",color:"orange",name:"sync"}),live:Object(w.jsx)(O.a,{size:"tiny",color:"green",name:"circle"}),error:Object(w.jsx)(O.a,{size:"tiny",color:"red",name:"exclamation triangle"})}[e.appState.cameraStatus];o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:n}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",r]})}),a.push(Object(w.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(w.jsx)(E,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})},"paneCamera"))}e.room.textOnly||e.room.panelBroadcast&&(i=s("Broadcast"),o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:"rss"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&a.push(Object(w.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(w.jsx)(ye,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})},"paneBroadcast"))),e.room.panelUsers&&(i=s("Users"),o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:"users"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",Object(w.jsx)(C.a,{className:e.appState.className,size:"tiny",pointing:"left",children:e.appState.userCount})]})}),t.selected==i&&a.push(Object(w.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(w.jsx)(we,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})},"paneUsers"))),e.room.panelGoals&&(i=e.config.goals_label?e.config.goals_label:s("Goals"),o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:e.config.goals_icon?e.config.goals_icon:"gift"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&a.push(Object(w.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(w.jsx)(Ne,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})},"paneGoals"))),e.room.panelFiles&&(i=s("Files"),o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:"file"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&a.push(Object(w.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(w.jsx)(Re,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})},"paneFiles"))),e.room.panelPresentation&&(i=s("Presentation"),o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:"hand point left"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&a.push(Object(w.jsxs)("div",{className:t.selected==i?"paneActive":"paneInactive",children:[Object(w.jsx)(Ue,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "]},"panePresentation"))),e.room.panelOptions&&(i=s("Options"),o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:"settings"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&a.push(Object(w.jsxs)("div",{className:t.selected==i?"paneActive":"paneInactive",children:[Object(w.jsx)(De,{appState:e.appState,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "]},"paneOptions"))),e.room.questions&&(i=s("Questions"),o.push({key:i,active:t.selected==i,name:i,content:Object(w.jsxs)("div",{"data-tooltip":i,"data-position":"bottom center",children:[" ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":Object(w.jsx)(O.a,{name:"mail"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i]})}),t.selected==i&&a.push(Object(w.jsx)("div",{className:t.selected==i?"paneActive":"paneInactive",children:Object(w.jsx)(Ae,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.room.questionsMessages,serverUpdate:e.serverUpdate})},"paneMessages"))),this.state.menus=o,this.state.panes=a}onClick(e,t){this.devMode&&console.log("containers/Tabs onClick",t),this.state.selected!=t.name&&(this.state.selected=t.name,this.updatePanes(this.props),this.setState({selected:t.name}))}render(){const{state:e,props:t}=this;return this.updatePanes(t),Object(w.jsxs)("div",{className:"layoutTabs",style:{backgroundColor:t.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layMenu",children:Object(w.jsx)(le.a,{stackable:!0,fluid:!0,size:"small",className:t.appState.className,items:e.menus,onItemClick:this.onClick.bind(this)})}),Object(w.jsx)("div",{className:"layPane",children:e.panes})]})}}Te.propTypes={appState:N.a.object.isRequired,appStateUpdate:N.a.func.isRequired,appSfx:N.a.func.isRequired,user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,fetchHistory:N.a.func.isRequired,sendMessage:N.a.func.isRequired,serverUpdate:N.a.func.isRequired};class Pe extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}componentWillUnmount(){console.log("containers/CollaborationScreen componentWillUnmount")}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutCollaboration",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layVideo",children:Object(w.jsx)(Ce,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user})}),Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layTabs",children:Object(w.jsx)(Te,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}class Le extends A{constructor(e){super(e),this.componentActions=a.a.createRef()}render(){const{state:e,props:t}=this;return Object(w.jsxs)("div",{className:"panel",ref:e=>this.state.container=e,children:[Object(w.jsx)("div",{className:"videoPiP",children:Object(w.jsx)(Ce,{appState:t.appState,appStateUpdate:t.appStateUpdate,config:t.config,room:t.room,user:t.user})}),Object(w.jsx)("div",{className:"cameraPiP",children:Object(w.jsx)(E,{appState:t.appState,appStateUpdate:t.appStateUpdate,appSfx:t.appSfx,config:t.config,room:t.room,user:t.user,serverUpdate:t.serverUpdate})}),Object(w.jsx)("div",{className:"actionsPiP",children:Object(w.jsx)(he,{ref:this.componentActions,appState:t.appState,appStateUpdate:t.appStateUpdate,appSfx:t.appSfx,config:t.config,user:t.user,room:t.room,actions:t.actions,serverUpdate:t.serverUpdate})})]})}}Le.propTypes={user:N.a.object.isRequired,config:N.a.object.isRequired,room:N.a.object.isRequired,appState:N.a.object.isRequired,appStateUpdate:N.a.func.isRequired,appSfx:N.a.func.isRequired,actions:N.a.array.isRequired,serverUpdate:N.a.func.isRequired};class Ve extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}componentWillUnmount(){console.log("containers/CollaborationScreen componentWillUnmount")}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutCollaborationPiP",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layVideo",children:Object(w.jsx)(Le,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,appSfx:e.appSfx,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layTabs",children:Object(w.jsx)(Te,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}class Ee extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutText",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layHistory",children:Object(w.jsx)(de,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})}),Object(w.jsx)("div",{className:"laySend",children:Object(w.jsx)(se,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,room:e.room,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})})]})}}class We extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}componentWillUnmount(){console.log("containers/CollaborationTextScreen componentWillUnmount")}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutCollaborationText",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layActions",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})}),Object(w.jsx)("div",{className:"layTabs",children:Object(w.jsx)(Te,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})})]})}}class Be extends A{constructor(e){super(e),this.devMode=e.appState.devMode,this.state={privateUnavailable:!0,requestStatus:"Not available"}}componentDidMount(){const{props:e,state:t}=this;this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidMount")}componentDidUpdate(e,t,s){const{txt:o}=this;var a=!0,i=o("Waiting for user to accept call");if(e.room)if(e.room.actionPrivateDisable)i=o("User disabled private requests");else if(e.room.actionPrivateBusy)i=o("User is currently busy in private");else if(e.room.users){e.room.users[e.appState.requestUID]?a=!1:i=o("User is not online, yet")}else i=o("User list is not available");else i=o("Room is not ready");if(e.appState.requestAID&&(i=o("Private call ended.")),this.state.requestStatus=i,t.privateUnavailable&&!a&&(this.state.privateUnavailable=!1,!e.room.privateUID&&!e.appState.requestAID))if(e.room.privateUID!==e.appState.requestUID){var n={userName:e.user.name},r={action:"privateRequest",userID:e.user.ID,roomID:e.room.ID,targetID:e.appState.requestUID,meta:n};e.serverUpdate({task:"interaction",interaction:r}),this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidUpdate Available",e.room)}else this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidUpdate Available but requestAID",e.appState.requestAID)}render(){const{props:e,txt:t,state:s}=this;return Object(w.jsxs)(k.a,{className:e.appState.className,children:[Object(w.jsx)(y.a,{children:t("Private Call")}),Object(w.jsxs)("p",{children:[e.user.name," - ",e.appState.requestUsername," (#",e.appState.requestUID,") / ",e.room.name," ",Object(w.jsx)("br",{})," ",Object(w.jsx)("b",{children:s.requestStatus})]}),Object(w.jsxs)(x.a,{className:e.appState.className,size:"small",name:"videowhisper",color:"red",target:"_top",href:e.config.exitURL,children:[Object(w.jsx)("i",{class:"arrow alternate circle left icon"})," ",t("Exit")]},"exit")]})}}Be.propTypes={user:N.a.object.isRequired,room:N.a.object.isRequired,config:N.a.object.isRequired,appState:N.a.object.isRequired,serverUpdate:N.a.func.isRequired};class Fe extends o.Component{constructor(e){super(e),this.componentActions=a.a.createRef()}render(){const{props:e}=this;return Object(w.jsxs)("div",{className:"layoutList",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsx)("div",{className:"layScrollable",children:Object(w.jsx)(Be,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,actions:e.actions,serverUpdate:e.serverUpdate})},"layScrollable"),Object(w.jsx)("div",{className:"layMenu",children:Object(w.jsx)(he,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})},"layMenu")]},"layoutList")}}class qe extends o.Component{constructor(e){super(e),this.txt=e=>{const{props:t}=this;return t.config&&e in t.config.text?t.config.text[e]:e},this.recorderStatus=e=>{if(this.devMode&&console.log("components/RecorderScreen recorderStatus",e,this.props.config),"uploadCompleted"===e)this.props.config.recordStay||(window.location.href=this.props.config.exitURL),this.sentCount++,this.devMode&&console.log("components/RecorderScreen recorderStatus sentCount",this.sentCount),this.recordModalClose()},this.recordModalClose=()=>this.setState({recordModalShow:!1}),this.recordModalOpen=()=>this.setState({recordModalShow:!0}),this.devMode=e.appState.devMode,this.configLoaded=!1,this.sentCount=0,this.state={recordModalShow:!1}}render(){const{props:e,txt:t,state:s}=this;this.devMode=e.appState.devMode,this.configLoaded||e.config.loaded&&(this.configLoaded=!0,e.config.recordClosed||(this.state.recordModalShow=!0),this.devMode&&console.log("components/RecorderScreen configLoaded",this.props.config));var o=[];if(this.sentCount>0&&o.push(Object(w.jsxs)(C.a,{compact:!0,className:e.appState.className,icon:!0,size:"small",name:"sentCount",color:"green",children:[Object(w.jsx)(O.a,{name:"file video"})," ",this.sentCount]},"sentCount")),this.props.config.recordMultiple&&(this.state.recordModalShow||o.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:"small",name:"addRecoding",color:"red",onClick:this.recordModalOpen.bind(this),children:[Object(w.jsx)(O.a,{name:"video"})," ",t("Add Recording")]},"addRecoding"))),e.room.actionButtons)for(var a in e.room.actionButtons){var i=e.room.actionButtons[a];o.push(Object(w.jsxs)(x.a,{compact:!0,className:e.appState.className,icon:!0,size:"small",floated:i.floated,name:i.name,color:i.color,target:"_"+i.target,href:i.url,"data-tooltip":i.tooltip,children:[Object(w.jsx)(O.a,{name:i.icon})," ",i.text]},i.name))}return(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&o.push(Object(w.jsx)(x.a,{compact:!0,icon:!0,className:e.appState.className,size:"small",floated:"right",name:"videowhisper",color:"violet",target:"_videowhisper",href:e.appState.tooltipURL,"data-tooltip":e.appState.tooltip,children:Object(w.jsx)(O.a,{name:"eye"})},"videowhisper")),Object(w.jsxs)("div",{className:"layoutRecorder",style:{backgroundColor:e.appState.backgroundColor},children:[Object(w.jsxs)(M.a,{open:s.recordModalShow,closeIcon:!0,onClose:this.recordModalClose,size:"small",basic:e.appState.darkMode,children:[Object(w.jsx)(y.a,{icon:"file video",content:t("Record")}),Object(w.jsx)(M.a.Content,{children:Object(w.jsx)(Y,{config:e.config,user:e.user,room:e.room,appState:e.appState,appStateUpdate:e.appStateUpdate,serverUpdate:e.serverUpdate,recorderStatus:this.recorderStatus,options:{scenario:"standalone"}})}),Object(w.jsx)(M.a.Actions,{children:Object(w.jsxs)(x.a,{compact:!0,inverted:e.appState.darkMode,color:"red",onClick:this.recordModalClose,children:[Object(w.jsx)(O.a,{name:"remove"})," ",t("Nevermind")]})})]},"recordModal"),o]})}}s(339),s(340),s(341);class He extends a.a.Component{constructor(e){super(e),this.version="2024.12.09",this.devMode=!1,this.versionMode=!1,this.devServer="https://videolivesupport.com/wp-admin/admin-ajax.php?action=vmls_app",this.devServer2="https://videolivesupport.com/wp-content/plugins/ppv-live-webcams/server/",this.devModeTimer=!0,this.txt=e=>{const{props:t}=this;return t.config&&t.config.text&&e in t.config.text?t.config.text[e]:e},this.errorRetry=()=>{this.devMode&&console.log("VideoWhisper/containers/App errorRetry",this.state),clearInterval(this.timerError),this.setState({error:"",errorMore:"",errorURL:"",errorType:"",errorTask:""}),this.serverUpdate({task:this.state.errorTask?this.state.errorTask:"retry_task_missing"}),this.timerStart()},this.axiosConfig={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},this.checkMode=e=>{const{state:t}=this,s=this;this.devMode&&console.log("VideoWhisper/containers/App checkMode:",e),ie.a.post("https://"+e+".com/l.php?j=1&pn=HTML5+Videochat&ps=Web&pu="+escape(window.location.href)+"&u="+escape(window.location.href)+"&pv="+this.version,re.a.stringify(null),this.axiosConfig).then((function(e){s.modeProcess(e)})).catch(this.modeError.bind(this))},this.updateMedia=()=>{const{props:e}=this;var{state:t}=this;e.room.media&&(t.media=e.room.media),t.media.Main||(t.media.Main={}),!t.streamAddress&&t.media.Main.local&&(t.media.Main.type="empty"),!e.room.streamAddress||t.streamAddress||t.streamName||t.media.Main.type&&"empty"!==t.media.Main.type||(t.media.Main.type="hls",t.media.Main.userID=e.room.streamUID,t.media.Main.url=e.room.streamAddress,t.media.Main.name=e.room.streamName,t.media.Main.default=!0),t.streamAddress&&(t.media.Main.type="hls",t.media.Main.userID=e.room.streamUID,t.media.Main.url=t.streamAddress,t.media.Main.name=t.streamName,t.media.Main.default=!0,t.media.Main.local=!0),t.streamName&&!t.streamAddress&&(t.media.Main.type="user",t.media.Main.userID=e.room.streamUID,t.media.Main.stream=e.room.streamPlayback,t.media.Main.name=e.room.performer,t.media.Main.default=!0,t.media.Main.local=!0),e.room.streamUID&&(t.media.Main.type&&"empty"!==t.media.Main.type||(t.media.Main.type="user",t.media.Main.userID=e.room.streamUID,t.media.Main.stream=e.room.streamPlayback,t.media.Main.name=e.room.performer,t.media.Main.default=!0)),this.setState({media:t.media}),this.devMode&&console.log("VideoWhisper/containers/App updateMedia",e.room.media,t.media,t.streamName)},this.retrieveParameters=()=>{const{state:e,devMode:t}=this;var s=window.VideoWhisper;if(!s&&!t)return this.state.error="Missing window.VideoWhisper embed parameters! devMode?",this.state.errorMore="Contact Support",void(this.state.errorURL="https://consult.videowhisper.com");t&&(s||(s={serverURL:this.devServer,serverURL2:this.devServer2},this.devModeRequest&&(s.requestUID=this.devModeRequest)));var o="",a="",i=!1,n=!1,r="";s&&(o=s.serverURL,a=s.serverURL2,s.checkWait&&(i=s.checkWait),s.whitelabel&&(n=s.whitelabel,i=!0),s.modeVersion&&(r=s.modeVersion)),this.state.serverURL=o,this.state.serverURL2=a,this.state.parametersRetrieved=!0,this.state.checkWait=i,this.state.whitelabel=n,this.state.modeVersion=r,this.state.requestUID=s.requestUID,s.requestUsername&&(this.state.requestUsername=s.requestUsername),s.devMode&&(this.devMode=s.devMode,this.state.devMode=this.devMode),this.devMode&&console.log("VideoWhisper/containers/App retrieveParameters",s,t,e),n?console.log("HTML5 Videochat",this.version,this.versionMode,t):console.log("VideoWhisper.com / HTML5 Videochat",this.version,this.versionMode,t)},this.serverUpdate=e=>{const{state:t}=this;if(t.serverURL||this.retrieveParameters(),!t.serverURL)return void(this.devMode&&console.log("VideoWhisper/containers/App serverUpdate : missing serverURL",t,this.devMode));e||(e={});const{props:s}=this;if(s.user.loggedIn){const t={userID:s.user.ID,sessionID:s.user.sessionID,sessionKey:s.user.sessionKey,roomID:s.room.ID,privateUID:s.room.privateUID,roomActionID:s.room.actionID};e.VideoWhisper=t,e.lastMessage=s.lastMessageTimestamp,e.lastRoomUpdate=this.lastRoomUpdate,e.lastMessageID=this.lastMessageID}e.devMode=this.devMode,e.requestUID=this.state.requestUID,e.alreadyUpdating=this.serverUpdating,e.alreadyTask=this.serverTask;var o=this,a=100;this.serverUpdating&&(this.devMode&&console.log("containers/App serverUpdate WARNING: Already Updating now, prev",e.task,this.serverTask),a=1500),"next"==e.task&&this.setState({roomLoading:!0}),this.serverUpdating=!0,this.serverTask=e.task,setTimeout((()=>ie.a.post(this.state.serverURL,re.a.stringify(e),this.axiosConfig).then((function(e){o.serverProcess(e)})).catch((t=>this.serverError(t,e)))),a)},this.sendMessage=e=>{this.serverUpdate({task:"message",message:e}),this.devMode&&console.log("VideoWhisper/containers/App sendMessage:",e,this.props)},this.chatNotification=e=>{const{props:t}=this;var s={userID:t.user.ID,userName:t.user.name,userAvatar:t.user.avatar,notification:!0,text:e.toString(),time:(new Date).valueOf(),mentionMessage:0,mentionUser:"",ID:(new Date).valueOf()};this.sendMessage(s)},this.chatServer=(e,t)=>{this.serverUpdate({task:"externaljs",action:e,data:t})},this.fetchHistory=()=>{const{props:e}=this;this.serverUpdate({});const t={userID:-1,userName:"Test",text:"Test History",time:(new Date).valueOf(),ID:(new Date).valueOf()};e.addHistory(new Array(t),(new Date).valueOf()),this.devMode&&console.log("VideoWhisper/containers/App fetchHistory",e,e.messages)},this.componentScreen=a.a.createRef(),this.timeLocal=0,this.lastServerUpdate=0,this.lastRoomUpdate=0,this.lastMessageID=0,this.componentMounted=!1,this.timeInterval=5e3,this.serverUpdating=!1,this.serverTask="init",this.checkedSources=0,this.state={version:this.version,username:"unavailable",streamName:"",streamAddress:"",langugage:"en-us",flag:"us",chatMentionMessage:0,chatMentionUser:"",muted:!0,optionsLoaded:!1,wsOpen:!1,wsComponent:"none",chatNew:!1,cameraStatus:"off",userCount:0,screen:"LoginScreen",screenTime:0,requestAID:0,requestUID:0,requestUsername:"User",parametersRetrieved:!1,whitelabel:!1,checkWait:!1,devMode:this.devMode,media:{Main:{}},minMode:!1,pipMode:!1,recMode:!1,darkMode:!1,sfx:!1,sfxError:!1,audioMode:!1,revealMode:!1,revealWarmup:30,revealed:!1,publishRequired:!1,className:"",backgroundColor:"#EEEEEE",error:"",errorTask:"",warning:"",timerOn:!1,serverURL:"",serverURL2:"",mode:null,checked:!1,tooltip:"Demo Mode: This setup is in demo mode. Contact if you need assistance with configuration.",tooltipURL:"https://consult.videowhisper.com",tooltipImage:"https://videowhisper.com/media/logo64.png",roomLoading:!0},this.retrieveParameters(),this.timerTimeStart=Date.now(),this.sessionTime=0,this.sessionUpdate=this.timerTimeStart,this.appStateUpdate=this.appStateUpdate.bind(this),this.appSfx=this.appSfx.bind(this),this.tipsRecent=[],this.devMode&&console.log("VideoWhisper/containers/App constructor",e,this.state)}appStateUpdate(e){this.devMode&&console.log("VideoWhisper/containers/App appStateUpdate",e,this.state),this.setState(e,(()=>{void 0!=e.streamName&&this.updateMedia()}))}appSfx(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.state.sfx&&!s)return;if(!this.props.config.loaded&&!s)return;if(!this.state.optionsLoaded&&!s)return;var o="";if(null==t){if(!this.props.config)return;if(!this.props.config.sfx)return;if(!this.props.config.sfx[e])return void console.log("VideoWhisper/containers/App appSfx not found:",e,this.props.config.sfx,this.props.config);o=this.props.config.sfx[e]}else o=t;this.devMode&&console.log("VideoWhisper/containers/App appSfx",e,o,this.state,this.props.config);const a=document.createElement("audio");a.setAttribute("src",o),a.addEventListener("canplay",(()=>{var e=a.play();void 0!==e&&e.catch((e=>{if(console.log("VideoWhisper/containers/App appSfx ERROR",e,o,this.state,this.props.config),a.parentNode)try{a.parentNode.removeChild(a)}catch(e){console.log("VideoWhisper/containers/App appSfx error soundPlayer removeChild",e)}this.setState({sfx:!1,sfxError:!0})})).then((()=>{this.setState({sfxError:!1}),this.state.muted&&(this.state.muted=!1)}))})),a.addEventListener("ended",(function(){if(a.parentNode)try{a.parentNode.removeChild(a)}catch(e){console.log("VideoWhisper/containers/App soundPlayer ended removeChild",e)}}),!1)}timerStart(){if(this.devMode&&!this.devModeTimer)return;const{props:e}=this;e.config&&e.config.timeInterval&&Number(e.config.timeInterval)>=2e3&&(this.timeInterval=Number(e.config.timeInterval)),this.timer=setInterval(this.timerTick.bind(this),this.timeInterval),this.timerLocal=setInterval(this.timerTickLocal.bind(this),1e3),this.setState({timerOn:!0})}timerErrorStart(){const{props:e}=this;this.timerError=setInterval(this.timerTickError.bind(this),1e3),this.state.reloadTime=15}timerStop(){clearInterval(this.timer),clearInterval(this.timerLocal),this.setState({timerOn:!1})}timerTick(){this.serverUpdating||Date.now()-this.lastServerUpdate>1500&&this.serverUpdate({task:"tick"});let e=Date.now()-this.timerTimeStart;this.state.time=e,this.timeLocal=e}timerTickLocal(){const{state:e}=this;this.timeLocal=Date.now()-this.timerTimeStart,this.displayTime=this.sessionTime+Date.now()-this.sessionUpdate,this.componentScreen.current&&this.componentScreen.current.componentActions&&("undefined"!==typeof this.componentScreen.current.componentActions.current.updateTime?this.componentScreen.current.componentActions.current.updateTime(this.displayTime):this.componentScreen.current.componentActions.current.componentActions&&"undefined"!==typeof this.componentScreen.current.componentActions.current.componentActions.current.updateTime&&this.componentScreen.current.componentActions.current.componentActions.current.updateTime(this.displayTime)),this.state.screenTime++}timerTickError(){this.state.reloadTime>0?this.setState({reloadTime:this.state.reloadTime-1}):(clearInterval(this.timerError),this.state.errorTask?this.errorRetry():window.location.reload(!1))}modeProcess(e){const{state:t}=this;this.setState({mode:e.data,checked:!0},(()=>{this.checkedSources++})),this.devMode&&console.log("VideoWhisper/containers/App modeProcess:",e,this.state);var s=!0;if(this.state.whitelabel&&this.state.whitelabel!=e.data.whitelabel&&(s=!1),e.data.text&&(this.state.tooltip=e.data.text),e.data.link&&(this.state.tooltipURL=e.data.link),e.data.image&&(this.state.tooltipImage=e.data.image),this.state.checkWait)if(s){const e=window.VideoWhisper;this.serverUpdate({task:"login",VideoWhisper:e})}else console.log("VideoWhisper/containers/App modeProcess: checkWait but not Whitelabel",this.state.whitelabel,e.data.whitelabel);2==e.data.status&&this.setState({error:"Mode Error: "+this.state.mode.message,errorMore:"Contact Support",errorURL:"https://consult.videowhisper.com"})}modeError(e){this.checkedSources++,console.log("VideoWhisper/containers/App checkMode modeError:",e),this.state.checked||this.checkedSources>2&&this.setState({error:"Mode check error!",errorMore:"Contact Support",errorURL:"https://consult.videowhisper.com"})}serverProcess(e){const{state:t}=this;this.serverUpdating=!1,this.serverTask="serverProcess";const s=e.data;if(this.devMode&&"tick"!==s.task&&console.log("containers/App serverProcess",e),s.VideoWhisper){if(s.error){console.log("VideoWhisper/containers/App serverProcess Error: data.error",s.error),this.timerStop(),this.timerErrorStart();var o="";s.errorTask&&(o=s.errorTask),this.setState({error:s.error,errorType:"data",errorTask:o})}if(s.warning&&(this.devMode&&console.log("VideoWhisper/containers/App serverProcess Warning",s.warning),this.setState({warning:s.warning}),"next"===s.task&&this.setState({roomLoading:!1})),s.user&&s.user.name&&t.username!=s.user.name&&this.setState({username:s.user.name}),s.user){if(s.user.loggedIn?s.config&&(this.props.setConfig(s.config),this.timerStart(),s.config.darkMode&&this.setState({darkMode:!0}),s.config.pipMode&&this.setState({pipMode:!0}),s.config.minMode&&this.setState({minMode:!0}),s.config.sfx&&(this.state.sfxError||this.setState({sfx:!0})),s.config.devMode&&(this.devMode=!0,this.setState({devMode:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess devMode enabled by server config")),s.config.modeVersion&&(t.modeVersion||this.setState({modeVersion:s.config.modeVersion})),window.VideoWhisper&&(window.VideoWhisper.chatNotification=this.chatNotification,window.VideoWhisper.chatServer=this.chatServer)):(s.user.failed=!0,s.user.warning="Login failed!"),s.user.options&&("undefined"!==typeof s.user.options.h5v_dark&&t.darkMode!=s.user.options.h5v_dark&&this.setState({darkMode:s.user.options.h5v_dark}),"undefined"!==typeof s.user.options.h5v_pip&&t.pipMode!=s.user.options.h5v_pip&&this.setState({pipMode:s.user.options.h5v_pip}),"undefined"!==typeof s.user.options.h5v_min&&t.minMode!=s.user.options.h5v_min&&this.setState({minMode:s.user.options.h5v_min}),"undefined"!==typeof s.user.options.h5v_language&&t.language!=s.user.options.h5v_language&&this.setState({language:s.user.options.h5v_language}),"undefined"!==typeof s.user.options.h5v_flag&&t.flag!=s.user.options.h5v_flag&&this.setState({flag:s.user.options.h5v_flag}),"undefined"!==typeof s.user.options.h5v_sfx&&this.state.sfx!=s.user.options.h5v_sfx&&(this.state.sfxError&&!this.state.sfx||this.setState({sfx:s.user.options.h5v_sfx})),"undefined"!==typeof s.user.options.h5v_audio&&t.audioMode!=s.user.options.h5v_audio&&this.setState({audioMode:s.user.options.h5v_audio}),"undefined"!==typeof s.user.options.h5v_reveal&&t.revealMode!=s.user.options.h5v_reveal&&this.setState({revealMode:s.user.options.h5v_reveal}),"undefined"!==typeof s.user.options.h5v_reveal_warmup&&t.revealWarmup!=s.user.options.h5v_reveal_warmup&&this.setState({revealWarmup:s.user.options.h5v_reveal_warmup}),this.state.optionsLoaded||this.setState({optionsLoaded:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess data.user.options",s.user.options,this.state.sfx,this.state)),s.user.tipsRecent)for(var a in s.user.tipsRecent){const e=s.user.tipsRecent[a];if(this.tipsRecent.indexOf(a)>=0)break;this.tipsRecent.push(a),window.VideoWhisper&&("undefined"!=typeof window.VideoWhisper.performerTip?window.VideoWhisper.performerTip(e.amount,e.client):this.devMode&&console.log("containers/App window.VideoWhisper.performerTip missing",window.VideoWhisper)),this.serverUpdate({task:"tipProcessed",key:a})}this.props.setUser(s.user)}if(s.user&&s.user.time&&(this.sessionTime=1e3*s.user.time,this.sessionUpdate=Date.now()),s.room){s.room.options&&void 0!==s.room.options.stream_record_all&&this.setState({recMode:s.room.options.stream_record_all}),this.updateUsers(s.room.users),s.room.actionID&&(this.state.requestAID=s.room.actionID),this.props.setRoom(s.room),this.setState({roomLoading:!1}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess data.room props.room",s.room,this.props.room);var i=[],n="";if(!t.checked||t.checked&&t.mode.text){var r=t.tooltip;t.mode&&t.mode.text&&(r=t.mode.text),n="",t.mode&&t.mode.image&&(n=t.mode.image),i.push({userID:-1,userName:"VideoWhisper.com",notification:!0,text:r,image:n,modeText:!0,time:(new Date).valueOf()-1,ID:0xe8d4a51001})}n="",this.props.room.welcomeImage&&(n=this.props.room.welcomeImage),i.push({userID:-1,userName:this.props.room.name,notification:!0,text:this.props.room.welcome,progressValue:this.props.room.welcomeProgressValue,progressTotal:this.props.room.welcomeProgressTotal,progressDetails:this.props.room.welcomeProgressDetails,image:n,time:(new Date).valueOf(),ID:0xe8d4a51002}),this.props.setHistory(i,0),this.updateMedia()}s.roomUpdate&&(this.updateUsers(s.roomUpdate.users),this.props.updateRoom(s.roomUpdate),(s.roomUpdate.media||s.roomUpdate.name||s.roomUpdate.ID)&&this.updateMedia(),this.lastRoomUpdate=s.roomUpdate.updated,s.roomUpdate.actionID&&(this.state.requestAID=s.roomUpdate.actionID),s.roomUpdate.options&&void 0!==s.roomUpdate.options.stream_record_all&&this.setState({recMode:s.roomUpdate.options.stream_record_all})),(s.room||s.roomUpdate)&&this.updateExternal(),s.messages&&s.messages.length>0&&this.props.addHistory(s.messages,s.timestamp),"undefined"!==typeof s.lastMessageID&&s.lastMessageID>this.lastMessageID&&(this.appSfx("message"),this.setState({chatNew:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess new message",s.lastMessageID,this.lastMessageID)),"undefined"!==typeof s.lastMessageID&&s.lastMessageID>this.lastMessageID&&(this.lastMessageID=s.lastMessageID),s.actions&&s.actions.length>0&&this.props.setActions(s.actions,s.timestamp),this.lastServerUpdate=Date.now()}else console.log("VideoWhisper/containers/App serverProcess Error: no data.VideoWhisper from web server",e)}updateUsers(e){if(null==e)return;const{props:t}=this;var s,o,a=0;for(var i in e)e[i].hide||a++;if(this.setState({userCount:a}),this.usersJoined=[],e)for(var n in e){s=e[n];var r=!1;if(t.room.users)for(var c in t.room.users)o=t.room.users[c],s.userName==o.userName&&s.userID==o.userID&&(r=!0);r||this.usersJoined.push(s)}if(this.usersLeft=[],t.room.users)for(var c in t.room.users){o=t.room.users[c];r=!1;if(e)for(var n in e)(s=e[n]).userName==o.userName&&s.userID==o.userID&&(r=!0);r||this.usersLeft.push(s)}a>1&&this.usersJoined&&this.usersJoined.length>0&&(this.devMode&&console.log("VideoWhisper/containers/App updateExternal usersJoined",this.usersJoined,t.room.users),this.appSfx("hello"),this.usersJoined=[]),this.usersLeft&&this.usersLeft.length>0&&(this.appSfx("leave"),this.usersLeft=[])}updateExternal(){const{props:e}=this;var t,s=!1;e.room.users&&e.user.ID&&((t=e.room.users[e.user.ID])&&t.meta&&t.meta.external&&(s=!0,t.meta.connected&&t.meta.connectedUpdate>t.meta.externalUpdate&&(s=!1)));s!=this.state.external&&(this.devMode&&console.log("VideoWhisper/containers/App updateExternal",s),this.setState({external:s}))}serverError(e,t){console.log("containers/App serverUpdate Error:",e,t),t&&"tick"!=t.task&&this.setState({error:"An error occured on web request. ["+t.task+"] "+e.toString(),errorType:"web",errorTask:""}),this.serverUpdating=!1,this.serverTask="serverError"}componentDidMount(){this.componentMounted=!0,this.devMode&&console.log("VideoWhisper/containers/App componentDidMount",this.props)}onClick(e,t){let{name:s,value:o}=t;switch(this.devMode&&console.log("VideoWhisper/containers/App onClick",s,o,e),s){case"closeError":clearInterval(this.timerError),this.setState({error:"",errorMore:"",errorURL:"",errorType:"",errorTask:""}),this.timerStart();break;case"reloadError":window.location.reload();break;case"closeWarning":clearInterval(this.timerError),this.setState({warning:"",warningMore:"",warningURL:"",errorType:""});break;default:this.devMode&&console.log("VideoWhisper/containers/App onClick UNHANDLED",s,o,e)}}screenRouter(){const{sendMessage:e,fetchHistory:t,props:s,serverUpdate:o,state:a,checkMode:i}=this;let n="LoginScreen";switch(s.user.loggedIn&&(n=s.room.screen?s.room.screen:"Way2Screen",this.devMode&&this.devScreen&&(n=this.devScreen),a.requestUID&&!s.room.privateUID&&(n="LobbyScreen")),this.state.screen!=n&&(this.state.screenTime=0,"Way2Screen"==n&&a.revealMode&&(this.state.publishRequired=!0),this.devMode&&console.log("VideoWhisper/containers/App screenRouter change",n,this.state.screen)),this.state.screen=n,n){case"LoginScreen":return Object(w.jsx)(R,{ref:this.componentScreen,user:s.user,serverUpdate:o,checkMode:i,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx},"screen");case"BroadcastScreen":return Object(w.jsx)(me,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"BroadcastAudioScreen":return Object(w.jsx)(ue,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"PlaybackScreen":return Object(w.jsx)(ve,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"PlaybackAudioScreen":return Object(w.jsx)(be,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"LobbyScreen":return Object(w.jsx)(Fe,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,serverUpdate:o},"screen");case"Way2Screen":return Object(w.jsx)(fe,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"Way2AudioScreen":return Object(w.jsx)(je,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"TextScreen":return Object(w.jsx)(Ee,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"CollaborationScreen":return a.pipMode&&s.room.panelCamera&&!a.external?Object(w.jsx)(Ve,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen"):Object(w.jsx)(Pe,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"CollaborationPiPScreen":return Object(w.jsx)(Ve,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"CollaborationTextScreen":return Object(w.jsx)(We,{ref:this.componentScreen,user:s.user,config:s.config,room:s.room,messages:s.messages,actions:s.actions,appState:a,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o},"screen");case"RecorderScreen":return Object(w.jsx)(qe,{user:s.user,config:s.config,room:s.room,appState:a,appStateUpdate:this.appStateUpdate,serverUpdate:o},"screen");default:console.log("containers/App Error: unknown screen",n)}}preRender(){var{state:e}=this;e.darkMode?(e.className="inverted",e.backgroundColor="#333333"):(e.className="",e.backgroundColor="#EEEEEE")}render(){this.preRender();const{state:e,props:t,txt:s}=this;this.devMode=e.devMode;var o=[];if(""!==e.error){var a="";e.errorMore&&(a=Object(w.jsxs)(x.a,{color:"blue",name:"more",target:"_more",href:e.errorURL,children:[Object(w.jsx)(O.a,{name:"help"}),e.errorMore]}));var i=Object(w.jsxs)(x.a,{name:"reloadError",as:"div",labelPosition:"right",onClick:this.onClick.bind(this),children:[Object(w.jsxs)(x.a,{color:"green",children:[Object(w.jsx)(O.a,{name:"sync"}),"  ",s("Reload")]}),Object(w.jsx)(C.a,{as:"a",basic:!0,pointing:"left",children:e.reloadTime>0?e.reloadTime:""})]});e.errorTask&&(i=Object(w.jsxs)(x.a,{name:"retryError",as:"div",labelPosition:"right",onClick:()=>this.errorRetry(),children:[Object(w.jsxs)(x.a,{color:"green",children:[Object(w.jsx)(O.a,{name:"sync"}),"  ",s("Retry")]}),Object(w.jsx)(C.a,{as:"a",basic:!0,pointing:"left",children:e.reloadTime>0?e.reloadTime:""})]}));var n=Object(w.jsxs)(x.a,{color:"yellow",name:"closeError",onClick:this.onClick.bind(this),children:[Object(w.jsx)(O.a,{name:"check"})," ",s("Ignore")]}),r=Object(w.jsxs)(x.a,{color:"red",name:"exitError",target:"_top",href:t.config.exitURL,children:[s("Exit")," ",Object(w.jsx)(O.a,{name:"arrow right"})]});"data"==e.errorType&&(n=""),o.push(Object(w.jsxs)(M.a,{open:!0,size:"small",children:[Object(w.jsx)(y.a,{icon:"warning sign",content:"data"==e.errorType?s("Server"):s("Error")}),Object(w.jsx)(M.a.Content,{children:this.state.error}),Object(w.jsxs)(M.a.Actions,{children:[a,i,n,r]})]},"error"))}if(""!==e.warning){a="";e.warningMore&&(a=Object(w.jsxs)(x.a,{color:"orange",name:"more",target:"_more",href:e.warningURL,children:[Object(w.jsx)(O.a,{name:"help"}),e.warningMore]})),o.push(Object(w.jsxs)(M.a,{open:!0,size:"small",children:[Object(w.jsx)(y.a,{icon:"warning sign",content:s("Warning")}),Object(w.jsx)(M.a.Content,{children:this.state.warning}),Object(w.jsxs)(M.a.Actions,{children:[a,Object(w.jsxs)(x.a,{color:"green",name:"closeWarning",onClick:this.onClick.bind(this),children:[Object(w.jsx)(O.a,{name:"check"})," ",s("Close")]})]})]},"warning"))}return o.push(this.screenRouter()),Object(w.jsx)("div",{id:"appContainer",style:{backgroundColor:this.state.backgroundColor},children:o})}}var ze=Object(r.b)((function(e){return{config:e.app.config,user:e.app.user,room:e.app.room,messages:e.app.messages,actions:e.app.actions,lastMessageTimestamp:e.app.lastMessageTimestamp}}),(function(e){return this.devMode&&console.log("VideoWhisper/containers/App mapDispatchToProps",e),{setUser:t=>e(function(e){return{type:d,payload:{user:e}}}(t)),setConfig:t=>e(function(e){return{type:h,payload:{config:e}}}(t)),setRoom:t=>e(function(e){return{type:l,payload:{room:e}}}(t)),updateRoom:t=>e(function(e){return{type:p,payload:{room:e}}}(t)),addMessage:t=>e(function(e){return{type:u,payload:{message:e}}}(t)),addHistory:(t,s)=>e(function(e,t){return{type:m,payload:{messages:e,timestamp:t}}}(t,s)),setActions:(t,s)=>e(function(e,t){return{type:g,payload:{actions:e,timestamp:t}}}(t,s)),setHistory:(t,s)=>e(function(e,t){return{type:v,payload:{messages:e,timestamp:t}}}(t,s))}}))(He);window.store=S;const _e=Object(w.jsx)(r.a,{store:S,children:Object(w.jsx)(ze,{})});n.a.render(_e,document.getElementById("videowhisperVideochat"))}},[[342,1,2]]]);