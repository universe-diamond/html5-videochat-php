(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{310:function(e,t,a){e.exports=a(544)},315:function(e,t,a){},320:function(e,t,a){},541:function(e,t,a){},542:function(e,t,a){},543:function(e,t,a){},544:function(e,t,a){"use strict";a.r(t);var o=a(0),n=a.n(o),s=a(46),i=a.n(s),r=(a(315),a(127)),c=a(72),l=a(130),d="App/UPDATE_USER",p="App/SET_ROOM",m="App/UPDATE_ROOM",u="App/SET_CONFIG",h="App/ADD_HISTORY",v="App/ADD_MESSAGE",f="App/SET_ACTIONS",g="App/SET_HISTORY",b={user:{ID:0,sessionID:0,sessionKey:"",name:"User.0",loggedIn:!1,warning:"Please wait for login..",balance:0},room:{ID:0,name:"Room.0",screen:"LoginScreen",streamBroadcast:"Room",streamPlayback:"Room",privateUID:0,actionPrivate:!1,actionPrivateClose:!1,actionID:0,performer:"",performerID:0,welcome:"Welcome to default room!"},config:{wss:"",application:"",videoCodec:"h264",videoBitrate:"400",videoFramerae:"29.97",audioCodec:"opus",audioBitrate:"64",autoBroadcast:!1,exitURL:"https://videowhisper.com",errorURL:"https://videowhisper.com/tickets_submit.php",actionFullpage:!1,actionFullscreen:!0,loaded:!1},messages:[],actions:[],lastMessageTimestamp:0};var S=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(a.type){case d:e=Object.assign({},t,{user:Object.assign({},t.user,a.payload.user)});break;case p:e=Object.assign({},t,{room:Object.assign({},a.payload.room)});break;case m:e=Object.assign({},t,{room:Object.assign({},t.room,a.payload.room)});break;case u:e=Object.assign({},t,{config:Object.assign({},a.payload.config)});break;case v:e=Object.assign({},t,{messages:[].concat(Object(l.a)(t.messages),[a.payload.message])});break;case h:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,messages:t.messages.concat(a.payload.messages)});break;case f:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,actions:Object(l.a)(a.payload.actions)});break;case g:e=Object.assign({},t,{lastMessageTimestamp:a.payload.timestamp,messages:Object(l.a)(a.payload.messages)});break;default:e=Object.assign({},t)}return e},y=Object(c.b)({app:S}),k=Object(c.c)(y),C=a(12),E=a(13),M=a(17),w=a(9),O=a(18),x=a(8);var I=a(545),D=a(64),R=a(556),U=a(561),N=(a(320),a(560)),j=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).txt=function(e){var t=Object(x.a)(Object(x.a)(a)).props;return e in t.config.text?t.config.text[e]:e},a.devMode=e.appState.devMode,a.state={loggedin:!1,modeServers:["videowhisper","videowhispers","ateom"]},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){var e=this.props,t=this.state;if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen componentDidMount",e.appState.parametersRetrieved,e.appState.checkWait,e,t,window,window.VideoWhisper),!t.loggedin&&e.appState.parametersRetrieved&&!e.user.loggedIn&&!e.user.failed&&!e.appState.checkWait){var a=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:a}),this.state.loggedin=!0}this.devMode?setTimeout(function(){return t.modeServers.forEach(e.checkMode)},3e3):t.modeServers.forEach(e.checkMode)}},{key:"componentDidUpdate",value:function(e,t,a){if(this.devMode&&console.log("VideoWhisper/containers/LoginScreen componentDidUpdate parametersRetrieved checkWait loggedin",e.appState.parametersRetrieved,e.appState.checkWait,t.loggedin),!t.loggedin&&e.appState.parametersRetrieved&&!e.user.loggedIn&&!e.user.failed&&!e.appState.checkWait){var o=window.VideoWhisper;e.serverUpdate({task:"login",VideoWhisper:o}),this.state.loggedin=!0}}},{key:"render",value:function(){var e,t=this.props;this.state;e=t.user.loggedIn?"Logged in as "+t.user.name:"Not logged in, yet. ",t.user.warning&&(e+=t.user.warning);var a=n.a.createElement("p",null," Entering the ",n.a.createElement("a",{href:"https://videowhisper.com"},"VideoWhisper.com")," HTML5 Videochat App");return(t.appState.whitelabel||!t.appState.parametersRetrieved&&!t.appState.error)&&(a=n.a.createElement("p",null,"Entering Videochat")),t.appState.checked&&(t.appState.mode.status||(a=t.appState.mode.text?t.appState.mode.text:"This is server connection screen."),t.appState.whitelabel&&t.appState.whitelabel!=t.appState.mode.whitelabel&&(a=n.a.createElement("p",null,"Whitelabel license required to start ",n.a.createElement("a",{href:"https://videowhisper.com"},"VideoWhisper.com")," HTML5 Videochat application in whitelabel mode.",n.a.createElement("br",null),n.a.createElement("a",{href:"https://videowhisper.com/tickets_submit.php"},"Contact Support")," for details!"))),n.a.createElement(N.a,{className:t.appState.className},n.a.createElement("p",null," Logged in: ",e," "),n.a.createElement("p",null," ",t.user.error," "),a)}}]),t}(o.Component),A=a(178),L=a.n(A),P=a(271),V=a(56),q=a(555),T=a(93),W=a(554),B=a(2),F=a.n(B),H=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).txt=function(e){var t=Object(x.a)(Object(x.a)(a)).props;return e in t.config.text?t.config.text[e]:e},a.updateSize=function(){var e=Object(x.a)(Object(x.a)(a)).state;if(e.container){var t=e.container.clientWidth,o=e.container.clientHeight;o||(o=1);var n=t/o;a.setState({aspectRatio:n,width:t,height:o})}a.devMode&&console.log("components/Panel containerResized",e)},a.state={container:null,width:0,height:0,aspectRatio:0,settingsActive:!0},a.devMode=e.appState.devMode,a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.updateSize(),window.addEventListener("resize",this.updateSize,!1),document.addEventListener("onfullscreenchange",this.updateSize,!1),document.addEventListener("webkitfullscreenchange",this.updateSize,!1),document.addEventListener("mozfullscreenchange",this.updateSize,!1),document.addEventListener("msfullscreenchange",this.updateSize,!1),document.addEventListener("MSFullscreenChange",this.updateSize,!1),document.addEventListener("fullscreenchange",this.updateSize,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.updateSize),document.removeEventListener("onfullscreenchange",this.updateSize),document.removeEventListener("webkitfullscreenchange",this.updateSize),document.removeEventListener("mozfullscreenchange",this.updateSize),document.removeEventListener("msfullscreenchange",this.updateSize),document.removeEventListener("MSFullscreenChange",this.updateSize),document.removeEventListener("fullscreenchange",this.updateSize)}},{key:"onClick",value:function(e,t){var a=t.name,o=t.value,n=this.state;"settings"===a&&this.setState(function(e){return{settingsActive:!n.settingsActive}}),this.devMode&&console.log("components/Panel onClick ",a,o,e,n)}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(t.container){var a=t.container.clientWidth,o=t.container.clientHeight;if(o||(o=1),t.width!==a||t.height!==o){var n={aspectRatio:a/o,width:a,height:o};return e.appState.devMode&&console.log("components/Panel getDerivedStateFromProps size update",n,t),n}}return null}}]),t}(o.Component),z=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).onLoadedData=function(e){var t=a.remoteVideo.current;a.devMode&&console.log("components/Video - loadeddata"),a.updateVideoSize("onLoadedData"),t.paused&&0==t.currentTime&&(console.log("components/Video loadeddata : video paused on load - try to play",t.src,e),a.videoPlay())},a.onopen=function(e){var t=this,a=this.state;this.devMode&&console.log("components/Video wsConnection.onopen wsConnection.readyState:",this.wsConnection.readyState,e,this.state),this.props.appStateUpdate({wsOpen:!0,wsComponent:"Video onopen"}),1==this.wsConnection.readyState&&(a.retrying=!1,this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.addEventListener("icecandidate",function(e){return t.icecandidate(t.peerConnection,e)}),this.peerConnection.onsignalingstatechange=function(e){return t.onsignalingstatechange(e)},this.peerConnection.addEventListener("iceconnectionstatechange",function(e){return t.iceconnectionstatechange(t.peerConnection,e)}),this.peerConnection.addEventListener("track",this.track.bind(this)),this.wsConnection?1==this.wsConnection.readyState?this.sendPlayGetOffer():console.log("components/Video wsConnection not open for sendPlayGetOffer wsConnection.readyState:",this.wsConnection.readyState):console.log("components/Video wsConnection not available"))},a.onmessage=function(e){var t=this,a=this.state;this.devMode&&console.log("components/Video onmessage",e);var o=JSON.parse(e.data),n=Number(o.status),s=o.command,i="";if(a.retryCount++,200!=n)i=o.statusDescription,a.available&&(504===n||514===n||a.retryCount<a.autoRetries&&"1"===this.props.config.videoAutoPlay)?1===this.wsConnection.readyState?(this.devMode&&console.log("components/Video onmessage - Not ready: scheduling sendPlayGetOffer",n,i),setTimeout(this.sendPlayGetOffer.bind(this),2500),i=i+" (retry #"+a.retryCount+")",this.setState({buttonDisabled:!0,buttonContent:"Auto Retry",statusInfo:i,connecting:!0,connected:!1})):(console.log("components/Video onmessage - wsConnection Not open for sendPlayGetOffer wsConnection.readyState:",this.wsConnection.readyState),this.setState({buttonDisabled:!1,buttonContent:"Retry",statusInfo:i,connecting:!1,connected:!1})):this.stopStreamPlay(),this.setState({statusInfo:i});else{this.devMode&&console.log("components/Video onmessage 200 msgJSON",o);var r=o.streamInfo;void 0!==r&&(this.state.streamInfo.sessionId=r.sessionId),void 0!==o.sdp&&(this.devMode&&console.log("components/Video onmessage: setRemoteDescription sdp: "+JSON.stringify(o.sdp)),this.peerConnection.setRemoteDescription(o.sdp).then(this.peerCreateAnswer.bind(this)).catch(this.errorHandler.bind(this)));var c=o.iceCandidates;if(void 0!==c)for(var l in c)this.devMode&&console.log("addIceCandidate: "+JSON.stringify(c[l])),this.peerConnection.addIceCandidate(new RTCIceCandidate(c[l])).then(function(){return t.onAddIceCandidateSuccess(t.peerConnection)},function(e){return t.onAddIceCandidateError(t.peerConnection,e)});0=="sendResponse".localeCompare(s)&&null!=this.wsConnection&&this.wsConnection.close()}},a.devMode=e.appState.devMode,a._isMounted=!1,a.devMode&&console.log("components/Video constructor",e),a.playStarted=!1,a.retriesLeft=5,a.retryTimeout=5e3,a.retryIfTimeoutSet=!1,a.wsWaited=0,a.remoteVideo=n.a.createRef(),a.wsConnection=null,a.peerConnection=null,a.peerConnectionConfig={iceServers:[]},a.userData={},a.startTime=null,a.stats={video:{timestamp:0,bandwidth:0},audio:{timestamp:0,bandwidth:0}},a.state={streamInfo:{applicationName:e.config.application,streamName:e.room.streamPlayback,userName:e.room.performer,sessionId:"[empty]"},panelType:"Video",meta:e.meta,bitrateInfo:n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:"eye slash"}),"Detecting"),videoMuted:"muted",videoMutedMessage:"Tap for Sound",fullscreen:!1,available:!1,connected:!1,connecting:!1,autoRetries:3,statusInfo:"Connecting...",buttonContent:"Connecting",buttonDisabled:!0,videoWidth:640,videoHeight:360,videoAspectRatio:1.77,retryCount:0,retrying:!1},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"interfaceReady",value:function(){var e=this.props,t=this.state;this.streamInfoReset(),this.devMode&&console.log("components/Video - interfaceReady",t.streamInfo),("1"===e.config.videoAutoPlay||t.available)&&this.startStreamPlay()}},{key:"updateVideoSize",value:function(e){var t=this.remoteVideo.current;this.devMode&&console.log("components/Video updateVideoSize",e,t);var a,o=this.state;if(t.videoHeight&&(o.videoWidth===t.videoWidth&&o.videoHeight===t.videoHeight||(o.videoWidth=t.videoWidth,o.videoHeight=t.videoHeight,o.videoHeight||(o.videoHeight=1),this.setState({videoWidth:t.videoWidth,videoHeight:t.videoHeight})),a=t.videoWidth/t.videoHeight,o.videoAspectRatio!==a&&this.setState({videoAspectRatio:a}),this.startTime)){var n=window.performance.now()-this.startTime;this.devMode&&console.log("components/Video updateVideoSize Remote Video playback setup time: "+n.toFixed(3)+"ms"),this.startTime=null}this.devMode&&console.log("components/Video updateVideoSize "+e,o.videoWidth,o.videoHeight,a)}},{key:"componentDidMount",value:function(){this.devMode&&console.log("components/Video componentDidMount"),this._isMounted=!0,Object(V.a)(Object(w.a)(t.prototype),"componentDidMount",this).call(this),this.interfaceReady()}},{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Video stopStreamPlay"),this._isMounted=!1,this.stopStreamPlay(),Object(V.a)(Object(w.a)(t.prototype),"componentWillUnmount",this).call(this)}},{key:"componentDidUpdate",value:function(e,t,a){var o=this.state;o.available&&(o.connected||o.connecting||o.retrying||(this.devMode&&console.log("components/Video - componentDidUpdate: startStreamPlay"),this.startStreamPlay()))}},{key:"timerStart",value:function(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),2e3),this.devMode&&console.log("components/Video timerStart")}},{key:"timerStop",value:function(){clearInterval(this.timer),this.devMode&&console.log("components/Video timerStop")}},{key:"timerTick",value:function(){var e=this;if(this._isMounted&&this.state.connected&&this.peerConnection){this.peerConnection.getReceivers().forEach(function(t){t.getStats().then(function(t){t.forEach(function(t){if("inbound-rtp"===t.type&&!t.isRemote){var a=t.kind;if(void 0===a&&(a=t.mediaType),"video"===a||"audio"===a){var o=t.timestamp-e.stats[a].timestamp;o>0&&o<5e3&&t.bytesReceived>=e.stats[a].bytesReceived&&(e.stats[a].bitrate=8*(t.bytesReceived-e.stats[a].bytesReceived)/o),e.stats[a].timestamp=t.timestamp,e.stats[a].bytesReceived=t.bytesReceived,e.stats[a].qualityLimitationReason=t.qualityLimitationReason}}})})});var t=n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:"video"}),Math.round(this.stats.video.bitrate)," kbps ","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":""," ",this.remoteVideo.current.videoWidth,"x",this.remoteVideo.current.videoHeight);this.props.room.audioOnly&&(t="");var a=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"broken chain"}),"Socket Not Connected");this.wsConnection&&(a=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"chain"}),this.wsConnection.readyState));var o=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"stop circle"}),"Peer Not Connected");this.peerConnection&&(o=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"play circle"}),this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState));var s=n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:"wait"}),"Measuring...");(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(s=n.a.createElement("div",null,t,n.a.createElement(D.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps",a," ",o)),this.state.settingsActive&&this.setState({bitrateInfo:s})}}},{key:"render",value:function(){var e=this,t=this.state,a=this.props,o=this.txt;if(this.devMode=a.appState.devMode,t.container){var s=t.container.clientWidth,i=t.container.clientHeight;if(t.width!==s||t.height!==i){i||(i=1);var r=s/i;this.state.aspectRatio=r,this.state.width=s,this.state.height=i,this.devMode&&console.log("components/Video - render: container size update")}}var c=t.videoWidth,l=t.videoHeight,d=0,p=0;t.width&&t.aspectRatio&&t.videoAspectRatio&&(t.videoAspectRatio>t.aspectRatio?(l=(c=t.width)/t.videoAspectRatio,p=(t.height-l)/2):(c=(l=t.height)*t.videoAspectRatio,d=(t.width-c)/2));var m={position:"absolute",left:d,top:p,width:c,height:l},u="eye";a.room.audioOnly&&(u="microphone");var h="";t.settingsActive&&(h=n.a.createElement("div",{className:"controlsTop"},n.a.createElement(q.a,null,n.a.createElement(T.a,{color:"black",pointing:"right"},t.statusInfo),n.a.createElement(W.a,{hidden:!0,vertical:!0}),n.a.createElement(I.a,{name:"reload",onClick:this.onClick.bind(this),loading:t.buttonDisabled,disabled:t.buttonDisabled,icon:!0,labelPosition:"right",inverted:!0},n.a.createElement(D.a,{name:"redo"}),t.buttonContent)),n.a.createElement(T.a,{color:"black"},n.a.createElement(D.a,{name:"user"}),t.streamInfo.userName," ",t.connected?t.bitrateInfo:n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:"eye slash"}),"Not Streaming"))));var v=n.a.createElement(I.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Not Available","data-position":"bottom center"},n.a.createElement(D.a,{inverted:!0,color:"black",name:u+" slash"}));t.available&&(v=n.a.createElement(I.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Available","data-position":"bottom center"},n.a.createElement(D.a,{inverted:!0,color:"green",name:u}))),t.connecting&&(v=n.a.createElement(I.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Connecting","data-position":"bottom center"},n.a.createElement(D.a,{inverted:!0,loading:!0,name:"spinner"}))),t.connected&&(v=n.a.createElement(I.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Streaming","data-position":"bottom center"},n.a.createElement(D.a,{inverted:!0,name:u}))),t.connected&&!t.available&&(v=n.a.createElement(I.a,{name:"status",size:"small",inverted:!0,icon:!0,"data-tooltip":"Terminated","data-position":"bottom center"},n.a.createElement(D.a,{inverted:!0,color:"orange",name:u})));var f=n.a.createElement(n.a.Fragment,null);return a.room.videoOffline&&(t.available||t.connected||(f=n.a.createElement("source",{src:a.room.videoOffline,type:"video/mp4"}))),n.a.createElement("div",{className:"panel",ref:function(t){return e.state.container=t}},n.a.createElement("div",{className:"backgroundVideo"},n.a.createElement("video",{style:m,id:"remoteVideo",poster:a.room.snapshot,ref:this.remoteVideo,className:"remoteVideo",muted:t.videoMuted,autoPlay:!0,loop:!0,playsInline:!0,controls:t.settingsActive,onLoadedData:this.onLoadedData,onLoadedMetadata:function(){return e.updateVideoSize("loadedmetadata")}},f)),n.a.createElement("div",{className:"controlsIcons"},v,n.a.createElement(I.a,{name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:t.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":o("Toggle Controls"),"data-position":"bottom center"},n.a.createElement(D.a,{name:"setting"})),n.a.createElement(I.a,{name:"mute",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":t.videoMuted?o("Enable Audio"):o("Mute"),"data-position":"bottom center"},n.a.createElement(D.a,{name:t.videoMuted?"volume off":"volume up"})," ",t.videoMutedMessage),n.a.createElement(I.a,{name:"fullscreen",size:"small",inverted:!0,icon:!0,toggle:!0,onClick:this.onClick.bind(this),"data-tooltip":o("Enter Fullscreen"),"data-position":"bottom center"},n.a.createElement(D.a,{name:"expand"}))),h)}},{key:"onClick",value:function(e,a){var o=a.name,n=a.value,s=this.txt;if("reload"==o)switch(this.state.buttonContent){case s("Tap to Play"):this.remoteVideo.current.play(),this.state.connected?this.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:"Reload",videoMuted:"",videoMutedMessage:""}):this.state.connecting?this.setState({statusInfo:"Preview. Connecting...",videoMuted:"",videoMutedMessage:""}):this.setState({statusInfo:"Preview",buttonContent:s("Reload"),videoMuted:"",videoMutedMessage:""});break;case s("Reload"):this.setState({buttonDisabled:!0,buttonContent:s("Reloading"),connecting:!0,connected:!1}),this.stopStreamPlay(),this.startStreamPlay()}if("fullscreen"==o){this.state.fullscreen;e.preventDefault(),this.requestFullscreen(this.remoteVideo.current)}"mute"==o&&(this.state.videoMuted&&(this.remoteVideo.current.muted=!1),this.setState({videoMuted:!this.state.videoMuted,videoMutedMessage:""})),Object(V.a)(Object(w.a)(t.prototype),"onClick",this).call(this,e,{name:o,value:n})}},{key:"retryIfTimeout",value:function(){this.state.connected||this.playStarted||this.retriesLeft>0&&(this.devMode&&console.log("components/Video retryIfTimeout #",this.retriesLeft),this.retriesLeft--,this.stopStreamPlay(),this.setState({buttonDisabled:!0,buttonContent:"Auto Retry...",connecting:!0,connected:!1}),this.startStreamPlay()),this.retryIfTimeoutSet=!1}},{key:"requestFullscreen",value:function(e){var t=!0;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1),this.setState({fullscreen:t})}},{key:"streamInfoReset",value:function(){var e,t=this.props,a=this.state;(this.state.streamInfo={applicationName:t.config.application,streamName:t.room.streamPlayback,userName:"",sessionId:"[empty]"},t.room.users)&&(t.content?(e=t.room.users[t.content.userID])&&(a.streamInfo.streamName=t.content.stream):(e=t.room.users[t.room.streamUID])&&(a.streamInfo.streamName=t.room.streamPlayback),e&&(a.streamInfo.userName=e.userName,e.meta&&e.meta.connected&&e.sdate<e.meta.connectedUpdate&&(a.available=!0)))}},{key:"wsConnect",value:function(){var e=this,t=this.props;if(this.state.connected)console.log("components/Video wsConnect: already connected, skip");else{if(this.props.appState.wsOpen)return this.devMode&&console.log("components/Video wsConnect:  websocket busy, retrying later",this.props.appState.wsComponent," waited: "+this.wsWaited,this.wsConnection),this.wsConnection&&this.wsConnection.readyState<3&&(this.wsWaited>1?(this.wsConnection.close(),this.peerConnection&&this.peerConnection.close(),this.wsWaited=0):this.wsWaited++),void setTimeout(function(){return e.wsConnect()},2e3);this.props.appStateUpdate({wsOpen:!0,wsComponent:"Video"}),this.userData={param1:"value1",videowhisper:"webrtc-playback"},this.wsConnection&&this.wsConnection.readyState<3&&(console.log("components/Video wsConnect previous websocket (close)",this.wsConnection),this.wsConnection.close(),this.peerConnection&&this.peerConnection.close()),this.wsConnection=new WebSocket(t.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsConnection.onmessage=function(t){return e.onmessage(t)},this.wsConnection.onclose=function(){e.devMode&&console.log("components/Video wsConnection.onclose"),e.props.appStateUpdate({wsOpen:!1})},this.wsConnection.onerror=function(t){console.log("components/Video ERROR wsConnection.onerror: "+JSON.stringify(t,["message","arguments","type","name"])),e.wsConnection.close(),e.props.appStateUpdate({wsOpen:!1})}}}},{key:"peerCreateAnswer",value:function(){this.state;this.devMode&&console.log("components/Video peerCreateAnswer"),this.peerConnection.createAnswer().then(this.gotDescription.bind(this)).catch(this.errorHandler.bind(this))}},{key:"errorHandler",value:function(e){console.log(e)}},{key:"icecandidate",value:function(){var e=Object(P.a)(L.a.mark(function e(t,a){return L.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.devMode&&console.log("components/Video icecandidate (gotIceCandidate):",a);try{this.onAddIceCandidateSuccess(t)}catch(o){this.onAddIceCandidateError(t,o)}case 2:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}()},{key:"onAddIceCandidateSuccess",value:function(e){this.devMode&&console.log("components/Video onAddIceCandidateSuccess success",e)}},{key:"onAddIceCandidateError",value:function(e,t){this.devMode&&console.log("components/Video onAddIceCandidateError failed to add ICE Candidate: ".concat(t))}},{key:"onsignalingstatechange",value:function(){var e,t=this;this._isMounted&&(this.peerConnection&&(e=this.peerConnection.signalingState,this.devMode&&console.log("components/Video onsignalingstatechange , state: ".concat(e),this.retryTimeout),"have-remote-offer"!=e&&"stable"!=e||(this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload")}),this.props.appStateUpdate({videoStatus:"pending"}),this.retryIfTimeoutSet||(setTimeout(function(){return t.retryIfTimeout()},this.retryTimeout),this.retryIfTimeoutSet=!0))))}},{key:"videoPlay",value:function(){var e=this,t=this.remoteVideo.current,a=this.txt;this.playStarted=!1,t&&t.play().then(function(o){e.devMode&&console.log("components/Video Autoplay started accept/paused/src",o,t.paused,t.src),e.playStarted=!0,e.props.appState.muted&&e.props.appStateUpdate({muted:!1}),e.state.connected?e.setState({statusInfo:"Streaming",settingsActive:!1,buttonDisabled:!1,buttonContent:a("Reload"),connecting:!1}):e.state.connecting?e.setState({statusInfo:"Preview. Connecting...",settingsActive:!0,buttonDisabled:!0,buttonContent:"Connecting"}):e.setState({statusInfo:"Preview",buttonDisabled:!1,buttonContent:a("Reload")})},function(o){console.log("components/Video Autoplay reject:"+o,o,t.src),e.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:a("Tap to Play"),videoMuted:"",videoMutedMessage:""})}).catch(function(t){console.log("components/Video Autoplay error:"+t,t),e.setState({statusInfo:"Autoplay not available",settingsActive:!0,buttonDisabled:!1,buttonContent:a("Tap to Play")})})}},{key:"iceconnectionstatechange",value:function(e,t){var a,o=this,n=this.remoteVideo.current,s=this.state,i=this.txt;e&&(a=e.iceConnectionState,this.devMode&&console.log("components/Video iceconnectionstatechange: ".concat(e.iceConnectionState),t,n),"connected"==a&&(this.setState({connected:!0,connecting:!1}),this.videoPlay()),"disconnected"!=a&&"failed"!=a||("1"===this.props.config.videoAutoPlay&&(s.retrying||setTimeout(function(){s.retrying=!0,o.stopStreamPlay(),o.startStreamPlay(),o.setState({statusInfo:a,buttonDisabled:!0,buttonContent:i("Auto Retry")})},3300)),this.setState({settingsActive:!0,connected:!1,connecting:!1,buttonDisabled:!1,buttonContent:i("Reload")})))}},{key:"track",value:function(e){this.state;var t=this.remoteVideo.current;this.devMode&&console.log("components/Video peer track (gotRemoteTrack) kind:"+e.track.kind+" stream:"+e.streams[0]),t.srcObject!==e.streams[0]&&(t.srcObject=e.streams[0],this.devMode&&console.log("components/Video peer track: playback peer received new remote stream"))}},{key:"sendPlayGetOffer",value:function(){var e=this;this.devMode&&console.log("components/Video sendPlayGetOffer: "+JSON.stringify(this.state.streamInfo),"wsConnection:",this.wsConnection),this.state.connected&&this.playStarted&&this.devMode&&console.log("components/Video sendPlayGetOffer: playStarted skip"),this.wsConnection&&1===this.wsConnection.readyState&&this.wsConnection.send('{"direction":"play", "command":"getOffer", "streamInfo":'+JSON.stringify(this.state.streamInfo)+', "userData":'+JSON.stringify(this.userData)+"}"),this.setState({statusInfo:"Starting Playback",buttonDisabled:!1,buttonContent:this.txt("Reload")}),this.retryIfTimeoutSet||(setTimeout(function(){return e.retryIfTimeout()},this.retryTimeout),this.retryIfTimeoutSet=!0)}},{key:"startStreamPlay",value:function(){this.devMode&&console.log("components/Video startStreamPlay"),this.state.retryCount=0,this.wsWaited=0,this.state.connecting=!0,this.wsConnect(),this.timerStart()}},{key:"stopStreamPlay",value:function(){this.devMode&&console.log("components/Video stopStreamPlay"),this.timerStop();var e=this.remoteVideo.current,t=this.props;this.peerConnection&&this.peerConnection.close(),this.wsConnection&&this.wsConnection.close(),e&&(e.src==t.room.videoOffline&&t.room.videoOffline||(e.src="")),this.setState({buttonDisabled:!1,buttonContent:this.txt("Reload"),connecting:!1,connected:!1}),this.playStarted=!1}},{key:"gotDescription",value:function(e){var t=this;this.devMode&&console.log("components/Video gotDescription sdp"+JSON.stringify({sdp:e})),this.peerConnection.setLocalDescription(e).then(function(){t.wsConnection.send('{"direction":"play", "command":"sendResponse", "streamInfo":'+JSON.stringify(t.state.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(t.userData)+"}")}).catch(function(e){console.log("components/Video gotDescription, setLocalDescription error",e)})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var a,o={};o.streamInfo=t.streamInfo;var n=!1;return e.room.users&&(e.content?(a=e.room.users[e.content.userID])&&(o.streamInfo.streamName=e.content.stream):(a=e.room.users[e.room.streamUID])&&(o.streamInfo.streamName=e.room.streamPlayback),a&&a.meta&&a.meta.connected&&a.sdate<a.meta.connectedUpdate&&(n=!0),a&&(o.streamInfo.userName=a.userName)),n!==t.available?(o.available=n,e.appState.devMode&&console.log("components/Video - getDerivedStateFromProps nowAvailable",o,a),o):null}}]),t}(H);z.propTypes={config:F.a.object.isRequired,room:F.a.object.isRequired,appState:F.a.object.isRequired,appStateUpdate:F.a.func.isRequired,content:F.a.object,meta:F.a.string};var _=a(32),G=a(557),J=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e)))._isMounted=!1,a.bitrateOptions=function(e){var t=[];t.push({key:"bitrate-title",text:n.a.createElement("span",null,n.a.createElement("strong",null,"Video Bitrate")," ",a.state.maxBitrate?" <"+a.state.maxBitrate+"kbps":""),disabled:!0});var o=a.state.maxBitrate,s=!1;return[{value:.35,label:"Very Low"},{value:.5,label:"Low"},{value:.75,label:"Medium"},{value:1,label:"Good"},{value:1.25,label:"High"},{value:1.5,label:"Very High"}].forEach(function(a){var n=Math.round(a.value*e);n===o&&(s=!0),n<=o&&t.push({key:n,value:n,text:n+" kbps "+a.label})}),(0===t.length||!s&&1.5*e>o)&&t.push({key:o,value:o,text:o+" kbps Limit"}),t},a.onopen=function(e){var t=this;(this.devMode&&console.log("components/Camera wsConnection.onopen ",this.wsConnection.readyState,e,this.state),this.wsMessaged=!1,this.props.appStateUpdate({wsOpen:!0,wsComponent:"Camera onopen"}),1==this.wsConnection.readyState)&&(this.peerConnection=new RTCPeerConnection(this.peerConnectionConfig),this.peerConnection.onicecandidate=this.onicecandidate,this.peerConnection.onsignalingstatechange=this.onsignalingstatechange.bind(this),this.peerConnection.oniceconnectionstatechange=this.oniceconnectionstatechange.bind(this),this.localStream.getAudioTracks().forEach(function(e){return t.peerConnection.addTrack(e,t.localStream)}),this.localStream.getVideoTracks().forEach(function(e){return t.peerConnection.addTrack(e,t.localStream)}),this.peerConnection.createOffer(this.offerOptions).then(this.gotDescription.bind(this),this.errorHandler),this.devMode&&console.log("components/Camera wsConnection.onopen setting wsMessagedCheck"),setTimeout(function(){return t.wsMessagedCheck()},6e3))},a.wsMessagedCheck=function(){a.devMode&&console.log("components/Camera wsConnection wsMessagedCheck",a.wsMessaged),a.wsMessaged||(a.setState({buttonDisabled:!1,buttonContent:a.txt("Broadcast"),statusInfo:"Websocked did not reply"}),console.log("components/Camera wsMessagedCheck","Websocked did not reply with ice candidates",a.wsConnection),a.retryIfTimeoutSet||a.retryIfTimeout())},a.onmessage=function(e){a.wsMessaged=!0,a.devMode&&console.log("components/Camera wsConnection.onmessage",e);var t=JSON.parse(e.data),o=Number(t.status);t.command;if(200!=o)console.log("components/Camera wsConnection.onmessage error sdp:",t.statusDescription),a.stopPublisher(),a.setState({buttonDisabled:!1,buttonContent:a.txt("Broadcast"),statusInfo:t.statusDescription,connecting:!1,connected:!1}),a.props.appStateUpdate({cameraStatus:"error"}),a.retriesLeft=0;else{var n=t.sdp;void 0!==n&&(a.devMode&&console.log("components/Camera wsConnection.onmessage 200 sdp:",t.sdp),a.peerConnection.setRemoteDescription(n).then(function(){}).catch(a.errorHandler.bind(Object(x.a)(Object(x.a)(a)))));var s=t.iceCandidates;if(a.devMode&&console.log("components/Camera wsConnection msgJSON iceCandidates: ",s),void 0!==s){for(var i in s)a.devMode&&console.log("components/Camera wsConnection iceCandidate: "+s[i]),a.peerConnection.addIceCandidate(new RTCIceCandidate(s[i])).then(function(){return a.onAddIceCandidateSuccess(a.peerConnection)},function(e){return a.onAddIceCandidateError(a.peerConnection,e)});null!=a.wsConnection&&a.wsConnection.close()}}},a.setMediaBitrateSDP=function(e,t,o){var n="AS",s=!1;navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&(s=!0),s&&(o=1e3*(o>>>0),n="TIAS"),o=Math.round(o);for(var i=e.split("\n"),r=-1,c=0;c<i.length;c++)if(0===i[c].indexOf("m="+t)){r=c;break}if(-1===r)return e;for(r++;0===i[r].indexOf("i=")||0===i[r].indexOf("c=");)r++;if(0===i[r].indexOf("b"))return i[r]="b="+n+":"+o,i.join("\n");var l=i.slice(0,r);return l.push("b="+n+":"+o),l=l.concat(i.slice(r,i.length)),a.devMode&&console.log("components/Camera setMediaBitrateSDP",t,o,l.join("\n")),l.join("\n")},a.devMode=e.appState.devMode,a.devMode&&console.log("components/Camera constructor",e),a.tChecked=!1,a.retriesLeft=5,a.retryTimeout=5500,a.retryIfTimeoutSet=!1,a.wsConnection=null,a.peerConnection=null,a.peerConnectionConfig={iceServers:[],optional:[{googSuspendBelowMinBitrate:!1,googImprovedWifiBwe:!0}]},a.localStream=null,a.streamInfo=null,a.userData=null,a.SDPOutput={},a.offerOptions={offerToReceiveAudio:1,offerToReceiveVideo:1},a.localVideo=n.a.createRef(),a.stats={video:{timestamp:0,bandwidth:0},audio:{timestamp:0,bandwidth:0}},a.videoIndex=-1,a.audioIndex=-1,a.changedBy="",a.enhanceData={},a.tWarn="",a.resolutions={"4K":{label:"4K",width:3840,height:2160,ratio:"16:9",bitrate:12e3},"1440p":{label:"1440p",width:2560,height:1440,ratio:"16:9",bitrate:6e3},"1080p":{label:"1080p",width:1920,height:1080,ratio:"16:9",bitrate:3e3},"720p":{label:"720p",width:1280,height:720,ratio:"16:9",bitrate:1800},SVGA:{label:"SVGA",width:800,height:600,ratio:"4:3",bitrate:800},"480p":{label:"480p",width:858,height:480,ratio:"16:9",bitrate:750},VGA:{label:"VGA",width:640,height:480,ratio:"4:3",bitrate:600},"360p":{label:"360p",width:640,height:360,ratio:"16:9",bitrate:400},"240p":{label:"240p",width:426,height:240,ratio:"16:9",bitrate:220},CIF:{label:"CIF",width:352,height:288,ratio:"4:3",bitrate:200},QVGA:{label:"QVGA",width:320,height:240,ratio:"4:3",bitrate:180},"180p":{label:"180p",width:320,height:180,ratio:"16:9",bitrate:160},"90p":{label:"90p",width:160,height:90,ratio:"16:9",bitrate:100}},a.state={revealed:!0,tapRequired:!1,connected:!1,connecting:!1,settingsActive:!1,statusInfo:"Connecting...",buttonContent:"Connecting",buttonDisabled:!0,bitrateInfo:n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:"eye slash"}),"Detecting"),videoWidth:640,videoHeight:360,videoAspectRatio:1.77,camera:null,cameraOptions:[],videoSource:null,microphone:null,microphoneOptions:[],audioSource:null,maxBitrate:750,maxResolutionHeight:480,bitrate:600,bitrateOptions:[],resolution:"360p",resolutionOptions:[]},a.onChange=a.onChange.bind(Object(x.a)(Object(x.a)(a))),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.devMode&&console.log("components/Camera componentDidMount"),this._isMounted=!0,Object(V.a)(Object(w.a)(t.prototype),"componentDidMount",this).call(this),this.interfaceReady()}},{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Camera componentWillUnmount"),this.props.serverUpdate({task:"media",connected:!1}),this._isMounted=!1,this.stopPublisher();this.state;this.localStream&&this.localStream.getTracks().forEach(function(e){return e.stop()}),Object(V.a)(Object(w.a)(t.prototype),"componentWillUnmount",this).call(this)}},{key:"timerStart",value:function(){this.stats.video.bitrate=0,this.stats.audio.bitrate=0,this.stats.video.qualityLimitationReason="none",this.timer=setInterval(this.timerTick.bind(this),2e3)}},{key:"timerStop",value:function(){clearInterval(this.timer)}},{key:"timerTick",value:function(){var e=this;if(this.props.appState.publishRequired&&(this.state.connected||"1"==this.props.config.cameraAutoBroadcast)&&(this.devMode&&console.log("components/Camera timerTick publishRequired"),this.props.appStateUpdate({publishRequired:!1}),this.setState({buttonDisabled:!0,buttonContent:this.txt("Closing")}),this.stopPublisher(),this.setState({buttonDisabled:!0,buttonContent:this.txt("Restarting Broadcast"),statusInfo:this.txt("Restarting Broadcast"),connecting:!0,connected:!1}),this.buildStream()),this.state.connected&&this.peerConnection){this.peerConnection.getSenders().forEach(function(t){t.getStats().then(function(t){t.forEach(function(t){if("outbound-rtp"===t.type&&!t.isRemote){var a=t.kind;if(void 0===a&&(a=t.mediaType),"video"===a||"audio"===a){var o=t.timestamp-e.stats[a].timestamp;o>0&&o<5e3&&t.bytesSent>=e.stats[a].bytesSent&&(e.stats[a].bitrate=8*(t.bytesSent-e.stats[a].bytesSent)/o),e.stats[a].timestamp=t.timestamp,e.stats[a].bytesSent=t.bytesSent,e.stats[a].qualityLimitationReason=t.qualityLimitationReason}}})})});var t="";this.props.room.audioOnly||this.props.appState.audioMode||"Way2Screen"==this.props.appState.screen&&this.props.appState.revealMode&&!this.props.appState.revealed||(t=n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:"video camera"}),Math.round(this.stats.video.bitrate)," kbps ","none"!==this.stats.video.qualityLimitationReason&&void 0!==this.stats.video.qualityLimitationReason?"(limited: "+this.stats.video.qualityLimitationReason+")":""," ",this.state.videoWidth,"x",this.state.videoHeight)),this.connectionInfo=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"broken chain"}),"Socket Not Connected"),this.wsConnection&&(this.connectionInfo=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"chain"}),this.wsConnection.readyState)),this.peerInfo=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"stop circle"}),"Peer Not Connected"),this.peerConnection&&(this.peerInfo=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"play circle"}),this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState));var a=n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:"wait"}),"Measuring...");(this.stats.video.bitrate>0||this.stats.audio.bitrate>0)&&(a=n.a.createElement("div",null,t,n.a.createElement(D.a,{name:"microphone"}),Math.round(this.stats.audio.bitrate)," kbps",this.connectionInfo," ",this.peerInfo)),this.state.settingsActive&&this.setState({bitrateInfo:a})}}},{key:"render",value:function(){var e=this,t=this.state,a=this.props,o=this.onChange;this.devMode=a.appState.devMode;var s=t.videoWidth,i=t.videoHeight,r=0,c=0;t.width&&t.aspectRatio&&t.videoAspectRatio&&(t.videoAspectRatio>t.aspectRatio?(i=(s=t.width)/t.videoAspectRatio,c=(t.height-i)/2):(s=(i=t.height)*t.videoAspectRatio,r=(t.width-s)/2));var l={position:"absolute",left:r,top:c,width:s,height:i},d="";t.tapRequired&&(d=n.a.createElement(q.a.Field,null,n.a.createElement(I.a,{inverted:!0,name:"tap",content:"Tap to Show",onClick:this.onClick.bind(this)}),n.a.createElement(T.a,{pointing:"left",color:"black"},"Gesture is required to show preview")));var p,m="",u="",h="microphone";a.room.audioOnly||a.appState.audioMode||"Way2Screen"==a.appState.screen&&a.appState.revealMode&&!a.appState.revealed||(h="video",m=n.a.createElement(q.a.Field,null,n.a.createElement(G.a,(p={className:"inverted tiny",name:"camera",value:t.camera,onChange:o,placeholder:"Camera",selection:!0},Object(_.a)(p,"onChange",this.onChange),Object(_.a)(p,"options",t.cameraOptions),p))),u=n.a.createElement(n.a.Fragment,null,n.a.createElement(q.a.Field,null,n.a.createElement(G.a,{className:"inverted tiny",name:"resolution",value:t.resolution,onChange:o,placeholder:"Video Resolution",selection:!0,options:t.resolutionOptions})),n.a.createElement(q.a.Field,null,n.a.createElement(G.a,{className:"inverted tiny",name:"bitrate",value:t.bitrate,onChange:o,placeholder:"Video Bitrate",selection:!0,options:t.bitrateOptions}))));this.tChecked||this.updateBitrates();var v,f="";t.settingsActive?(this.connectionInfo=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"broken chain"}),"Socket Not Connected"),this.wsConnection&&(this.connectionInfo=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"chain"}),this.wsConnection.readyState)),this.peerInfo=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"stop circle"}),"Peer Not Connected"),this.peerConnection&&(this.peerInfo=n.a.createElement(n.a.Fragment,null," ",n.a.createElement(D.a,{name:"play circle"}),this.peerConnection.iceConnectionState,"/",this.peerConnection.iceGatheringState,"/",this.peerConnection.signalingState)),f=n.a.createElement("div",{className:"controlsBottom"},n.a.createElement(T.a,{size:"tiny",color:"black"},this.tWarn),m,n.a.createElement(q.a.Field,null,n.a.createElement(G.a,(v={key:"microphone",className:"inverted tiny",name:"microphone",value:t.microphone,onChange:o,placeholder:"Microphone",selection:!0},Object(_.a)(v,"onChange",this.onChange),Object(_.a)(v,"options",t.microphoneOptions),v))),u,n.a.createElement(q.a.Field,null,n.a.createElement(I.a,{inverted:!0,name:"broadcast",content:t.buttonContent,onClick:this.onClick.bind(this),disabled:t.buttonDisabled}),n.a.createElement(T.a,{pointing:"left",color:"black"},t.statusInfo)),d,n.a.createElement(T.a,{color:"black"},t.connected?t.bitrateInfo:n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:("microphone"==h?"microphone":"eye")+" slash"}),"Not Broadcasting ",this.connectionInfo," ",this.peerInfo," ")))):this.tWarn.length>0&&(f=n.a.createElement("div",{className:"controlsBottom"},n.a.createElement(T.a,{size:"tiny",pointing:"left",color:"black"},this.tWarn)));var g=n.a.createElement(D.a,{inverted:!0,color:"black",name:("microphone"==h?"microphone":"eye")+" slash",size:"large"});return t.connecting&&(g=n.a.createElement(D.a,{inverted:!0,loading:!0,name:"spinner",size:"large"})),t.connected&&(g=n.a.createElement(D.a,{inverted:!0,name:h,size:"large"})),n.a.createElement("div",{className:"panel",ref:function(t){return e.state.container=t}},n.a.createElement("div",{className:"backgroundVideo"},n.a.createElement("video",{poster:a.config.cameraSnapshot?a.config.cameraSnapshot:a.room.snapshot,style:l,id:"localVideo",ref:this.localVideo,className:"localVideo",autoPlay:!0,playsInline:!0,muted:!0,onLoadedMetadata:function(){e.updateVideoSize("loadedmetadata"),e.videoPlay()}})),n.a.createElement("div",{className:"controlsIcons"},g,n.a.createElement(I.a,{name:"settings",size:"small",inverted:!0,icon:!0,toggle:!0,active:t.settingsActive,onClick:this.onClick.bind(this),"data-tooltip":"Toggle Controls","data-position":"bottom center"},n.a.createElement(D.a,{name:"settings"}))),f)}},{key:"onChange",value:function(e,t){var a=t.name,o=t.value;this.setState(Object(_.a)({},a,o)),this.changedBy=a,this.devMode&&console.log("components/Camera onChange",a,o,e),navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this))}},{key:"onClick",value:function(e,a){var o=a.name,n=a.value,s=this.txt;if(this.devMode&&console.log("components/Camera onClick",o,n,e),"tap"===o&&this.videoPlay(),"broadcast"===o)switch(this.state.buttonContent){case s("Broadcast"):this.retriesLeft=5,this.setState({buttonDisabled:!0,buttonContent:s("Starting Broadcast"),statusInfo:s("Starting Broadcast"),connecting:!0,connected:!1}),this.buildStream();break;case s("Stop Broadcast"):this.retriesLeft=0,this.setState({buttonDisabled:!0,buttonContent:s("Ending"),statusInfo:s("Ending")}),this.stopPublisher(),this.setState({buttonDisabled:!1,buttonContent:s("Broadcast"),statusInfo:s("Stopped Broadcast"),connecting:!1,connected:!1})}Object(V.a)(Object(w.a)(t.prototype),"onClick",this).call(this,e,{name:o,value:n})}},{key:"retryIfTimeout",value:function(){if(this.devMode)return console.log("components/Camera retryIfTimeout skipped on devMode"),void(this.retryIfTimeoutSet=!1);this.state.connected||this.retriesLeft>0&&(this.retriesLeft--,this.stopPublisher(),this.setState({buttonDisabled:!0,buttonContent:this.txt("Auto Retry"),statusInfo:this.txt("Auto Retry"),connecting:!0,connected:!1}),this.buildStream()),this.retryIfTimeoutSet=!1}},{key:"updateBitrates",value:function(){var e=this.props;if(this.bitrate=Number(e.config.bitrate),this.bitrate||(this.bitrate=750),this.resolutionHeight=Number(e.config.resolutionHeight),this.resolutionHeight||(this.resolutionHeight=480),this.videoBitrate=Number(e.config.videoBitrate),this.maxBitrate=Number(e.config.maxBitrate),this.videoBitrate<this.maxBitrate&&(this.maxBitrate=this.videoBitrate),this.maxBitrate||(this.maxBitrate=0),this.maxResolutionHeight=Number(e.config.maxResolutionHeight),this.maxResolutionHeight||(this.maxResolutionHeight=0),this.tWarn="",(!e.appState.checked||e.appState.checked&&e.appState.mode.text)&&(this.resolutionHeight>480&&(this.resolutionHeight=480),this.bitrate>750&&(this.bitrate=750),this.maxResolutionHeight>480&&(this.maxResolutionHeight=480),this.maxResolutionHeight||(this.maxResolutionHeight=480),this.maxBitrate>750&&(this.maxBitrate=750),this.maxBitrate||(this.maxBitrate=750),this.bitrate>this.maxBitrate&&(this.bitrate=this.maxBitrate),this.resolutionHeight>this.maxResolutionHeight&&(this.resolutionHeight=this.maxResolutionHeight),this.tWarn="Free Mode: Broadcasting Bitrate & Resolution Limited"),this.state.maxBitrate=this.maxBitrate,this.state.maxResolutionHeight=this.maxResolutionHeight,this.resolutionOptions=[{key:"res-title",text:n.a.createElement("span",null,n.a.createElement("strong",null,this.txt("Video Resolution")),this.state.maxResolutionHeight?" <"+this.state.maxResolutionHeight+"p":""),disabled:!0}],this.resolutions)for(var t in this.resolutions)(0===this.maxBitrate||.35*this.resolutions[t].bitrate<=this.maxBitrate)&&(0===this.maxResolutionHeight||this.resolutions[t].height<=this.maxResolutionHeight)&&this.resolutionOptions.push({key:t,value:t,text:this.resolutions[t].label+" "+this.resolutions[t].width+"x"+this.resolutions[t].height+" "+this.resolutions[t].ratio});this.state.resolutionOptions=this.resolutionOptions,this.state.bitrateOptions=this.bitrateOptions(this.bitrate),this.state.resolution=this.resolutionHeight.toString()+"p",this.state.maxBitrate=this.maxBitrate,this.state.bitrate=this.bitrate,e.appState.checked&&(this.tChecked=!0)}},{key:"interfaceReady",value:function(){var e=this;this.state,this.props;setTimeout(function(){return e.props.serverUpdate({task:"media",connected:!1})},500),this.updateBitrates(),this.setState({resolutionOptions:this.resolutionOptions,resolution:this.resolutionHeight.toString()+"p",bitrateOptions:this.bitrateOptions(this.bitrate),maxBitrate:this.maxBitrate,bitrate:this.bitrate,settingsActive:"1"==this.props.config.cameraControls});var t=this.props.config.cameraAutoBroadcast,a=this.txt;if(!navigator.mediaDevices)return this.devMode&&console.log("components/Camera interfaceReady navigator.mediaDevices",navigator.mediaDevices),void this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:a("Broadcast"),statusInfo:"Navigator media devices not available!",connecting:!1,connected:!1});if("1"!=t||this.props.appState.external){var o=a("Make a selection to start!");this.props.appState.external&&(o=a("External broadcast detected.")),navigator.mediaDevices.enumerateDevices().then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)),this.setState({buttonDisabled:!1,buttonContent:a("Broadcast"),statusInfo:o,connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"off"})}else navigator.mediaDevices.enumerateDevices().then(this.gotDevicesPublish.bind(this)).catch(this.handleError.bind(this)),this.setState({statusInfo:"Connecting...",connecting:!0,connected:!1}),this.props.appStateUpdate({cameraStatus:"pending"});this.devMode&&console.log("components/Camera interfaceReady ",t,this.maxBitrate,this.maxResolutionHeight)}},{key:"videoPlay",value:function(){var e=this,t=this.localVideo.current,a=this.state,o=!1,n=t.play();void 0!==n&&n.catch(function(t){o=!0,console.log("components/Camera Auto play error:"+t,t),e.setState({tapRequired:!0,settingsActive:!0})}).then(function(){o||(e.setState({tapRequired:!1}),a.connected&&e.setState({settingsActive:!1}))})}},{key:"buildStream",value:function(){if(this._isMounted){var e=this.state,t=this.props;for(var a in window.stream&&window.stream.getTracks().forEach(function(e){e.stop()}),this.localVideo.current.srcObject=null,this.resolutions)a==e.resolution&&(e.videoWidth=this.resolutions[a].width,e.videoHeight=this.resolutions[a].height,"bitrate"!==this.changedBy&&(0===e.maxBitrate||this.resolutions[a].bitrate<=e.maxBitrate?e.bitrate=this.resolutions[a].bitrate:e.bitrate=e.maxBitrate),e.bitrateOptions=this.bitrateOptions(this.resolutions[a].bitrate));var o={};"_disabled"!=e.audioSource?o.audio={deviceId:e.audioSource?{ideal:e.audioSource}:void 0}:o.audio=!1,t.room.audioOnly||t.appState.audioMode||"Way2Screen"==t.appState.screen&&t.appState.revealMode&&!t.appState.revealed?o.video=!1:"_disabled"!=e.videoSource?o.video={deviceId:e.videoSource?{ideal:e.videoSource}:void 0,width:{ideal:e.videoWidth},height:{ideal:e.videoHeight}}:o.video=!1,"_disabled"!=e.audioSource||"_disabled"!=e.videoSource?navigator.mediaDevices.getUserMedia(o).then(this.gotStream.bind(this)).then(this.gotDevices.bind(this)).catch(this.handleError.bind(this)):console.log("Camera/buildStream NO SOURCE",e.videoSource,e.audioSource),this.devMode&&console.log("components/Camera /buildStream videoSource: ",e.videoSource,"  constraints=",o,t.appState)}else console.log("components/Camera buildStream not mounted")}},{key:"handleError",value:function(e){if(console.log("components/Camera navigator.mediaDevices handleError: ",e," this._isMounted="+this._isMounted),this._isMounted){var t="";switch(e.name){case"OverconstrainedError":t=" ("+e.constraint+")"}this.setState({settingsActive:!0,statusInfo:"Media Error: "+e.name+t,buttonDisabled:!1,buttonContent:this.txt("Broadcast"),connecting:!1,connected:!1}),this.props.appStateUpdate({cameraStatus:"error"})}}},{key:"gotStream",value:function(e){return this.localVideo.current.srcObject=e,this.devMode&&console.log("components/Camera after getUserMedia",e),this.localStream=e,null!=this.localStream&&this.stopPublisher(),this.startPublisher(),navigator.mediaDevices.enumerateDevices()}},{key:"startPublisher",value:function(){this.devMode&&console.log("components/Camera startPublisher",this.props),this.wsConnect(),this.timerStart()}},{key:"stopPublisher",value:function(){this.timerStop(),null!=this.peerConnection&&this.peerConnection.close(),null!=this.wsConnection&&this.wsConnection.close(),this.devMode&&console.log("stopPublisher")}},{key:"gotDevices",value:function(e){for(var t=this.state,a=[{key:"cam-title",text:n.a.createElement("span",null,"Select ",n.a.createElement("strong",null,"Camera"),":"),disabled:!0},{text:"No Camera",value:"_disabled"}],o=[{key:"mic-title",text:n.a.createElement("span",null,"Select ",n.a.createElement("strong",null,"Microphone"),":"),disabled:!0}],s=!1,i=!1,r=0;r!==e.length;++r){var c=e[r],l={value:c.deviceId};"audioinput"===c.kind?(l.text=c.label||"microphone ".concat(o.length+1),o.push(l),t.microphone||(t.microphone=c.deviceId),c.deviceId===t.microphone&&(i=!0)):"videoinput"===c.kind&&(l.text=c.label||"camera ".concat(a.length+1),a.push(l),t.camera||(t.camera=c.deviceId),c.deviceId===t.camera&&(s=!0))}(s||"_disabled"===t.camera)&&(t.videoSource=t.camera),(i||"_disabled"===t.microphone)&&(t.audioSource=t.microphone),t.camera===t.videoSource&&t.microphone===t.audioSource||s&&i||(this.devMode&&console.log("components/Camera gotDevices: deviceID changed videoValid:"+t.camera+" videoSelected: "+t.microphone+" audioValid:"+i),this.setState({settingsActive:!0,statusInfo:"Media DeviceID changed: Please select again!",buttonDisabled:!1,buttonContent:this.txt("Broadcast")})),this.devMode&&console.log("gotDevices: verified videoSource: "+t.videoSource+" changed videoValid: "+s),this._isMounted&&this.setState({cameraOptions:a,microphoneOptions:o})}},{key:"gotDevicesPublish",value:function(e){this.gotDevices(e),this.buildStream()}},{key:"updateVideoSize",value:function(e){var t,a=this.localVideo.current,o=this.state;a.videoHeight&&(o.videoWidth===a.videoWidth&&o.videoHeight===a.videoHeight||(o.videoWidth=a.videoWidth,o.videoHeight=a.videoHeight,o.videoHeight||(o.videoHeight=1)),t=a.videoWidth/a.videoHeight,o.videoAspectRatio!==t&&this.setState({videoAspectRatio:t}))}},{key:"wsConnect",value:function(){var e=this,t=this.props;this.state;if(this.props.appState.wsOpen)return this.devMode&&console.log("components/Camera wsConnection websocket busy, retrying later",this.props.appState.wsComponent),this.wsConnection&&this.wsConnection.close(),void setTimeout(function(){return e.wsConnect()},1e3);this.props.appStateUpdate({wsOpen:!0,wsComponent:"Camera"}),this.SDPOutput={};var a=this.localStream.getVideoTracks(),o=this.localStream.getAudioTracks();a.length>0&&this.devMode&&console.log("components/Camera wsConnect Using Video device: ".concat(a[0].label)),o.length>0&&this.devMode&&console.log("components/Camera wsConnect Using Audio device: ".concat(o[0].label)),this.streamInfo={applicationName:t.config.application,streamName:t.room.streamBroadcast,sessionId:"[empty]"},this.userData={param1:"value1",videowhisper:"webrtc-broadcast"},this.devMode&&console.log("components/Camera wsConnect","_isMounted="+this._isMounted,this.streamInfo,this.userData,this.props,this.state),this.wsConnection&&(console.log("components/Camera wsConnect previous websocket (close)",this.wsConnection),this.wsConnection.close()),this.wsConnection=new WebSocket(t.config.wss),this.wsConnection.binaryType="arraybuffer",this.wsConnection.onopen=this.onopen.bind(this),this.wsMessaged=!1,this.wsConnection.onmessage=function(t){return e.onmessage(t)},this.wsConnection.onclose=function(){e.devMode&&console.log("components/Camera wsConnection.onclose"),e.props.appStateUpdate({wsOpen:!1})},this.wsConnection.onerror=function(t){console.log("components/Camera wsConnection.onerror: ",t),e.props.appStateUpdate({cameraStatus:"error"}),e.wsConnection.close(),e.props.appStateUpdate({wsOpen:!1}),e.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:e.txt("Broadcast"),connecting:!1,connected:!1,bitrateInfo:n.a.createElement(D.a,{name:"eye slash"})})}}},{key:"onAddIceCandidateSuccess",value:function(e){this.devMode&&console.log("components/Camera onAddIceCandidateSuccess success.",e)}},{key:"onAddIceCandidateError",value:function(e){console.log("components/Camera onAddIceCandidateError: ".concat(e.toString()))}},{key:"gotDescription",value:function(e){var t=this,a=this.props,o=this.state,n=this.txt;this.devMode&&console.log("components/Camera gotDescription: original",e,this.wsConnection),this.enhanceData={},void 0!==a.config.audioBitrate&&(this.enhanceData.audioBitrate=Number(a.config.audioBitrate)),void 0!==o.bitrate&&(this.enhanceData.videoBitrate=Number(o.bitrate)),void 0!==a.videoFrameRate&&(this.enhanceData.videoFrameRate=Number(a.videoFrameRate)),e.sdp=this.enhanceSDP(e.sdp,this.enhanceData),this.peerConnection||console.log("components/Camera gotDescription: Error no this.peerConnection",o),this.peerConnection.setLocalDescription(e).then(function(){t.wsConnection.send('{"direction":"publish", "command":"sendOffer", "streamInfo":'+JSON.stringify(t.streamInfo)+', "sdp":'+JSON.stringify(e)+', "userData":'+JSON.stringify(t.userData)+"}")}).catch(function(a){console.log("components/Camera gotDescription, setLocalDescription error, description.sdp",a,e.sdp),t.setState({statusInfo:"Stream setup error: Retry!",settingsActive:!0,buttonDisabled:!1,buttonContent:n("Broadcast"),connecting:!1,connected:!1}),t.props.appStateUpdate({cameraStatus:"error"})})}},{key:"addAudio",value:function(e,t){var a=e.split(/\r\n/),o="",n=!1;for(var s in a){var i=a[s];i.length<=0||(o+=i,o+="\r\n",0=="a=rtcp-mux".localeCompare(i)&&0==n&&(o+=t,n=!0))}return o}},{key:"addVideo",value:function(e,t){var a=e.split(/\r\n/),o="",n=!1,s=!1;for(var i in a){(r=a[i]).length<=0||(r.includes("a=rtcp-rsize")&&(s=!0),r.includes("a=rtcp-mux")&&!0)}for(var i in a){var r;o+=r=a[i],o+="\r\n",0=="a=rtcp-rsize".localeCompare(r)&&0==n&&1==s&&(o+=t,n=!0),0=="a=rtcp-mux".localeCompare(r)&&1==n&&0==s&&(o+=t,n=!0),0=="a=rtcp-mux".localeCompare(r)&&0==n&&0==s&&(n=!0)}return o}},{key:"enhanceSDP",value:function(e,t){var a,o=this.props.config,n=e.split(/\r\n/),s="header",i=!1,r="";if(!e.includes("THIS_IS_SDPARTA")||o.videoCodec.includes("VP9")){for(var c in n){if(!((p=n[c]).length<=0))if(!p.includes("urn:3gpp:video-orientation"))this.checkLine(p)&&(r+=p,r+="\r\n")}r=this.addAudio(r,this.deliverCheckLine(o.audioCodec,"audio")),n=(e=r=this.addVideo(r,this.deliverCheckLine(o.videoCodec,"video"))).split(/\r\n/),r=""}var l=!1,d=!1;for(var c in n){var p;if(!((p=n[c]).length<=0))if(0!=p.indexOf("m=audio")||-1==this.audioindex)if(0!=p.indexOf("m=video")||-1==this.videoIndex){if(r+=p,0===p.indexOf("m=audio")?(s="audio",i=!1):0===p.indexOf("m=video")?(s="video",i=!1):0==p.indexOf("a=rtpmap")&&(s="bandwidth",i=!1),(0===p.indexOf("a=mid:")||0==p.indexOf("a=rtpmap"))&&!i)if(0=="audio".localeCompare(s))void 0!==t.audioBitrate&&(r+="\r\nb=CT:"+t.audioBitrate,r+="\r\nb=AS:"+t.audioBitrate),i=!0;else if(0=="video".localeCompare(s))void 0!==t.videoBitrate&&(r+="\r\nb=CT:"+t.videoBitrate,r+="\r\nb=AS:"+t.videoBitrate,void 0!==t.videoFrameRate&&(r+="\r\na=framerate:"+t.videoFrameRate)),i=!0;else if(0=="bandwidth".localeCompare(s)){var m;if(null!==(m=this.getrtpMapID(p))){var u=m[2].toLowerCase();0!="vp9".localeCompare(u)&&0!="vp8".localeCompare(u)&&0!="h264".localeCompare(u)&&0!="red".localeCompare(u)&&0!="ulpfec".localeCompare(u)&&0!="rtx".localeCompare(u)||void 0===t.videoBitrate||l||(r+="\r\na=fmtp:"+m[1]+" x-google-min-bitrate=64000;x-google-start-bitrate="+1250*t.videoBitrate+";x-google-max-bitrate="+1250*t.videoBitrate,l=!0),0!="opus".localeCompare(u)&&0!="isac".localeCompare(u)&&0!="g722".localeCompare(u)&&0!="pcmu".localeCompare(u)&&0!="pcma".localeCompare(u)&&0!="cn".localeCompare(u)||void 0===t.audioBitrate||d||(r+="\r\na=fmtp:"+m[1]+" x-google-min-bitrate=16000;x-google-start-bitrate="+1250*t.audioBitrate+";x-google-max-bitrate="+1250*t.audioBitrate,d=!0)}}r+="\r\n"}else r+=(a=p.split(" "))[0]+" "+a[1]+" "+a[2]+" "+this.videoIndex+"\r\n";else r+=(a=p.split(" "))[0]+" "+a[1]+" "+a[2]+" "+this.audioindex+"\r\n"}if(void 0!==t.videoBitrate&&t.videoBitrate>0&&(r=this.setMediaBitrateSDP(r,"video",t.videoBitrate)),void 0!==t.audioBitrate&&t.audioBitrate>0&&(r=this.setMediaBitrateSDP(r,"audio",t.audioBitrate)),navigator.userAgent.toLowerCase().indexOf("safari/")>-1)r=r.replace(/UDP\/TLS\/RTP\/SAVPF/gi,"RTP/SAVPF");return this.devMode&&console.log("components/Camera Resulting SDP: "+r,o.videoCodec,t.videoBitrate,o.audioCodec,t.audioBitrate),r}},{key:"deliverCheckLine",value:function(e,t){var a="";for(var o in this.SDPOutput){var n=this.SDPOutput[o];if(a+=o,n.includes(e)){if(e.includes("VP9")||e.includes("VP8")){var s="",i=n.split(/\r\n/);for(var r in i){var c=i[r];-1===c.indexOf("transport-cc")&&-1===c.indexOf("goog-remb")&&-1===c.indexOf("nack")&&(s+=c,s+="\r\n")}return t.includes("audio")&&(this.audioindex=o),t.includes("video")&&(this.videoIndex=o),s}return t.includes("audio")&&(this.audioindex=o),t.includes("video")&&(this.videoIndex=o),n}}return a}},{key:"checkLine",value:function(e){if(e.startsWith("a=rtpmap")||e.startsWith("a=rtcp-fb")||e.startsWith("a=fmtp")){var t=e.split(":");if(t.length>1){var a=t[1].split(" ");if(!isNaN(a[0])&&!a[1].startsWith("http")&&!a[1].startsWith("ur")){var o=this.SDPOutput[a[0]];return o||(o=""),o+=e+"\r\n",this.SDPOutput[a[0]]=o,!1}}}return!0}},{key:"getrtpMapID",value:function(e){var t=new RegExp("a=rtpmap:(\\d+) (\\w+)/(\\d+)"),a=e.match(t);return a&&a.length>=3?a:null}},{key:"errorHandler",value:function(e){this.devMode&&console.log("components/Camera ",e)}},{key:"onicecandidate",value:function(e){null!=e.candidate&&this.devMode&&console.log("components/Camera gotIceCandidate: "+JSON.stringify({ice:e.candidate}))}},{key:"onsignalingstatechange",value:function(){var e,t=this,a=this.txt;this.peerConnection&&(e=this.peerConnection.signalingState,this.devMode&&console.log("components/Camera onsignalingstatechange state, peerConnection, wsConnection  ".concat(e),this.peerConnection.signalingState,this.peerConnection.readyState,this.peerConnection,this.wsConnection),"have-local-offer"==e&&"new"==this.peerConnection.iceConnectionState&&(this.setState({buttonDisabled:!1,buttonContent:a("Stop Broadcast"),statusInfo:a("Broadcasting")}),this.props.appStateUpdate({cameraStatus:"pending"}),this.retryIfTimeoutSet||(setTimeout(function(){return t.retryIfTimeout()},this.retryTimeout),this.retryIfTimeoutSet=!0)))}},{key:"oniceconnectionstatechange",value:function(){var e,t=this,a=this.props,o=this.txt;this.peerConnection&&(e=this.peerConnection.iceConnectionState,this.devMode&&console.log("components/Camera oniceconnectionstatechange peerConnection.iceConnectionState ".concat(e),this.peerConnection.iceConnectionState,this.peerConnection.iceGatheringState,this.peerConnection.readyState),"completed"!==e&&"connected"!==e||(this.setState({settingsActive:!1,buttonDisabled:!1,buttonContent:o("Stop Broadcast"),statusInfo:o("Broadcasting"),connecting:!1,connected:!0,bitrateInfo:n.a.createElement(D.a,{name:"clock"})}),a.serverUpdate({task:"media",connected:!0}),a.appStateUpdate({publishRequired:!1,cameraStatus:"live"}),this.peerConnection&&this.peerConnection.getSenders().forEach(function(e){if(e.track){var a=e.getParameters();a.encodings||(a.encodings=[{}]),"audio"==e.track.kind&&t.enhanceData.audioBitrate&&(a.encodings[0].maxBitrate=1e3*t.enhanceData.audioBitrate),"video"==e.track.kind&&t.enhanceData.videoBitrate&&(a.encodings[0].maxBitrate=1e3*t.enhanceData.videoBitrate),e.setParameters(a),t.devMode&&console.log("components/Camera oniceconnectionstatechange ",e.track.kind,a)}})),"failed"!==e&&"disconnected"!==e&&"closed"!==e||(this.setState({settingsActive:!0,buttonDisabled:!1,buttonContent:o("Broadcast"),statusInfo:e,connecting:!1,connected:!1,bitrateInfo:n.a.createElement(D.a,{name:"eye slash"})}),a.serverUpdate({task:"media",connected:!1}),a.appStateUpdate({cameraStatus:"off"})))}}]),t}(H);J.propTypes={appState:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired,user:F.a.object.isRequired,serverUpdate:F.a.func.isRequired,appStateUpdate:F.a.func.isRequired};a(419);var K=a(297),Q=a(553),Y=a(299),Z=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).txt=function(e){var t=Object(x.a)(Object(x.a)(a)).props;return t.config&&e in t.config.text?t.config.text[e]:e},a.onSubmit=function(e){if(e.preventDefault(),a.devMode&&console.log("ChatInput onSubmit",a.state),a.state){var t=a.state.message;if(0!==t.length){switch(t){case"/vws dev":a.props.appStateUpdate({devMode:!0}),console.log("components/ChatInput devMode Enabled",a.state)}var o={userID:a.props.user.ID,userName:a.props.user.name,userAvatar:a.props.user.avatar,notification:!1,text:t,time:(new Date).valueOf(),ID:(new Date).valueOf()};a.props.sendMessage(o),a.setState({message:""})}}},a.emojiModalClose=function(){return a.setState({emojiModalShow:!1})},a.onEmojiButton=function(){a.setState({emojiModalShow:!0})},a.addEmoji=function(e){console.log("components/ChatInput addEmoji",e);var t=a.state.message;e&&e.native&&(t+=e.native),a.setState({emojiModalShow:!1,message:t})},a.devMode=e.appState.devMode,a.state={message:"",container:null,emojiModalShow:!1},a.onChange=a.onChange.bind(Object(x.a)(Object(x.a)(a))),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){}},{key:"onChange",value:function(e){var t=e.target,a="checkbox"===t.type?t.checked:t.value,o=t.name;this.setState(Object(_.a)({},o,a))}},{key:"render",value:function(){var e,t=this,a=this.props,o=this.onSubmit,s=this.state,i=this.onChange,r=this.txt;return e=n.a.createElement(R.a,{key:"emojiModal",closeIcon:!0,open:s.emojiModalShow,onClose:this.emojiModalClose,size:"small",basic:a.appState.darkMode,fluid:!0},n.a.createElement(U.a,{icon:"smile",content:r("Emoji")}),n.a.createElement(R.a.Content,null,n.a.createElement(K.a,{onSelect:this.addEmoji,darkMode:a.appState.darkMode,native:!0,perLine:16})),n.a.createElement(R.a.Actions,null,n.a.createElement(I.a,{inverted:a.appState.darkMode,color:"red",onClick:this.emojiModalClose},n.a.createElement(D.a,{name:"remove"})," ",r("Nevermind")))),n.a.createElement("div",{className:"panel",style:{backgroundColor:a.appState.backgroundColor},ref:function(e){return t.state.container=e}},n.a.createElement("div",{className:"controlsBottom"},n.a.createElement(q.a,{onSubmit:o,className:a.appState.className},n.a.createElement(q.a.Group,{inline:!0,unstackable:!0},n.a.createElement(Q.a,{inverted:a.appState.darkMode,attached:"left",fluid:!0,focus:!0,name:"message",value:s.message,onChange:i,type:"text",placeholder:r("Type your message")},n.a.createElement(Y.a,{src:a.user.avatar,verticalAlign:"middle",avatar:!0,"data-tooltip":a.user.name})," ",n.a.createElement("label",null,n.a.createElement("small",null,a.user.name),"\xa0"),n.a.createElement(I.a,{compact:!0,icon:!0,type:"button",color:"yellow","data-tooltip":r("Emoticons"),onClick:this.onEmojiButton,inverted:a.appState.darkMode},n.a.createElement(D.a,{name:"smile"})),n.a.createElement("input",null),n.a.createElement(I.a,{compact:!0,primary:!0,icon:!0,type:"submit","data-tooltip":r("Send"),inverted:a.appState.darkMode},n.a.createElement(D.a,{name:"send"})))))),e)}}]),t}(o.Component),X=function(e){function t(){return Object(C.a)(this,t),Object(M.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props,t=e.message,a=t.userID===e.userID,o=t.notification,s=e.previousUser===t.userID,i=t.time-e.previousTime<6e4,r=t.userAvatar?n.a.createElement(Y.a,{src:t.userAvatar,avatar:!0,verticalAlign:"middle"}):"",c=new Date(t.time),l=c.toLocaleDateString()+" at "+c.toLocaleTimeString(),d="chatMessage "+(e.darkMode?"dark ":"")+(o?"notification":"user")+" "+(a?"own ":"")+(t.automated?"automated":""),p=s||o?"":n.a.createElement("strong",null," ",r," ",t.userName," (",t.userID,")"),m=s&&i?"":n.a.createElement("i",null,l),u=p||m?n.a.createElement(n.a.Fragment,null,p," ",m,":",n.a.createElement("br",null)):"",h="";return t.image&&(h=n.a.createElement(Y.a,{src:t.image,size:"mini",rounded:!0,verticalAlign:"middle"})),n.a.createElement("li",{className:d,key:t.ID},u,h,n.a.createElement("label",null,t.text.split("\n").map(function(e,t){return n.a.createElement("div",{key:t},e)}),t.url?n.a.createElement(I.a,{className:e.darkMode?"inverted ":"",target:"_blank",href:t.url,compact:!0,icon:!0},n.a.createElement(D.a,{name:"linkify"})):""))}}]),t}(o.Component),$=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).onScroll=function(){Object(x.a)(Object(x.a)(a)).refs.messageList.scrollTop},a.scrollToBottom=function(){var e=a.refs.messageList,t=e.scrollHeight-e.clientHeight;i.a.findDOMNode(e).scrollTop=t>0?t:0},a.devMode=e.appState.devMode,a.state={container:null},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(){this.scrollToBottom()}},{key:"render",value:function(){var e,t=this,a=this.props,o=this.onScroll,s=!1;(!a.appState.checked||a.appState.checked&&a.appState.mode.text)&&(s=!0);var i=0,r=0,c=0;return e=a.messages.length>0?n.a.createElement("ul",{className:"chatMessageList",ref:"messageList",onScroll:o},a.messages.map(function(e){s&&e.modeText&&(e.text=a.appState.tooltip,e.url=a.appState.tooltipURL,e.image=a.appState.tooltipImage);var t=n.a.createElement(X,{darkMode:a.appState.darkMode,userID:a.user.ID,message:e,key:e.ID,previousUser:i,previousTime:r});return i=e.userID,r=e.time,e.modeText&&!s?"":c===e.ID?"":(c=e.ID,t)})):n.a.createElement("ul",{className:"chatMessageList",ref:"messageList",onScroll:o},n.a.createElement("li",{className:"chatMessage",key:"0"},n.a.createElement("span",null,"No Messages."))),n.a.createElement("div",{className:"panel",style:{backgroundColor:a.appState.backgroundColor},ref:function(e){return t.state.container=e}},n.a.createElement("div",{className:"controls"},e))}}]),t}(o.Component),ee=a(559),te=a(562),ae=a(563),oe=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).txt=function(e){var t=Object(x.a)(Object(x.a)(a)).props;return e in t.config.text?t.config.text[e]:e},a.privateModalClose=function(){return a.setState({privateModalShow:!1})},a.fullscreenModalClose=function(){return a.setState({fullscreenRecommended:!0})},a.handleFullscreenChange=function(e){var t=!1;(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(t=!0),a.setState({fullscreen:t})},a.toHHMMSS=function(e){var t=Math.floor(e/3600),a=Math.floor((e-3600*t)/60),o=e-3600*t-60*a;return t<10&&(t="0"+t),a<10&&(a="0"+a),o<10&&(o="0"+o),t+":"+a+":"+o},a.state={tipLast:0,fullpage:!1,fullscreenRecommended:!1,fullscreen:!1,tipsOpen:!1,privateModalShow:!1,privateLoading:!1,requestModalShow:!1,requestDetails:"Details for request modal: No action meta info!",requestAction:{ID:0},displayTime:"00:00"},a.devMode=e.appState.devMode,a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"updateTime",value:function(e){this.setState({displayTime:this.toHHMMSS(Math.floor(e/1e3))})}},{key:"onClick",value:function(e,t){var a,o=t.name,n=t.value,s=this.state,i=this.props;switch(this.devMode&&console.log("components/Actions onClick",o,n,e,"props:",i),o){case"fullpage":this.state.fullpage=!s.fullpage,this.setState({fullpage:this.state.fullpage}),this.fullpage();break;case"sfx":var r=!i.appState.sfx;r&&i.appSfx("message",null,!0),i.appStateUpdate({sfx:r}),i.serverUpdate({task:"options",name:"h5v_sfx",value:r});break;case"darkMode":var c=!i.appState.darkMode;i.appStateUpdate({darkMode:c}),i.serverUpdate({task:"options",name:"h5v_dark",value:c});break;case"fullscreenRecommended":i.config.actionFullpage&&(this.setState({fullpage:!0}),this.fullpage());case"fullscreen":if(this.state.fullscreenRecommended=!0,s.fullscreen)this.exitFullscreen();else{var l=document.getElementById("videowhisperVideochat");this.requestFullscreen(l)}break;case"tip":if("undefined"===typeof n)break;var d=parseInt(n);if(i.room.tips&&i.room.tipOptions.length>0&&i.room.tipOptions.length>d){var p=i.room.tipOptions[d];i.serverUpdate({task:"tip",tip:p,tipsURL:i.room.tipsURL,targetID:i.room.performerID}),this.setState({tipsOpen:!1,tipLast:Date.now()}),console.log("components/Actions sending tip",p,d)}break;case"next":i.serverUpdate({task:"next",targetID:i.room.performerID});break;case"party_return":i.serverUpdate({task:"party_return"});break;case"party_leave":i.serverUpdate({task:"party_leave"});break;case"reveal":i.appStateUpdate({revealed:!0,publishRequired:!0});break;case"private":this.setState({privateModalShow:!0});break;case"privateClose":a={action:"privateRequest",ID:i.room.actionID,privateUID:i.room.privateUID,status:7},i.serverUpdate({task:"interaction-close",interaction:a});break;case"privateRequest":this.setState({privateLoading:!0,privateModalShow:!1});var m={userName:i.user.name};a={action:"privateRequest",userID:i.user.ID,roomID:i.room.ID,targetID:i.room.performerID,meta:m},i.serverUpdate({task:"interaction",interaction:a});break;case"declineRequest":this.setState({requestModalShow:!1}),a={ID:s.requestAction.ID,answer:0,status:2},i.serverUpdate({task:"interaction-answer",interaction:a});break;case"acceptRequest":this.setState({requestModalShow:!1}),a={ID:s.requestAction.ID,answer:1,status:2},i.serverUpdate({task:"interaction-answer",interaction:a});break;default:console.log("components/Actions onClick UNHANDLED",o,n,e)}}},{key:"fullpage",value:function(){var e=document.getElementById("videowhisperVideochat");this.state.fullpage?(e.style.position="fixed",e.style.top="0",e.style.left="0"):e.style.position="absolute",console.log("components/Actions fullpage",this.state.fullpage,e.style.position)}},{key:"componentDidMount",value:function(){document.addEventListener("webkitfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("mozfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("msfullscreenchange",this.handleFullscreenChange,!1),document.addEventListener("MSFullscreenChange",this.handleFullscreenChange,!1),document.addEventListener("fullscreenchange",this.handleFullscreenChange,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("webkitfullscreenchange",this.handleFullscreenChange),document.removeEventListener("mozfullscreenchange",this.handleFullscreenChange),document.removeEventListener("msfullscreenchange",this.handleFullscreenChange),document.removeEventListener("MSFullscreenChange",this.handleFullscreenChange),document.removeEventListener("fullscreenchange",this.handleFullscreenChange)}},{key:"requestFullscreen",value:function(e){var t=!0;this.state.fullscreen=t,e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():(console.log("components/Video Fullscreen API is not supported."),t=!1,this.state.fullscreen=!1),this.setState({fullscreen:t})}},{key:"exitFullscreen",value:function(){this.setState({fullscreen:!1}),(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen?document.msExitFullscreen():console.log("components/Actions Fullscreen API is not supported."))}},{key:"componentDidUpdate",value:function(e){e.actions!==this.props.actions&&this.processActions()}},{key:"processActions",value:function(){var e=this,t=this.props,a=this.state;t.actions.length>0&&t.actions.forEach(function(o){if(o)if(o.userID===t.user.ID){if("privateRequest"===o.action){if(3===o.status&&1===o.answer){o={ID:a.requestAction.ID,status:5};t.serverUpdate({task:"interaction-confirm",interaction:o})}o.status>=3&&o.status<7&&o.answer}}else if("privateRequest"===o.action){if(o.status<2&&t.room.privateUID!==o.userID&&(t.appSfx("call"),a.requestModalShow=!0,o.meta&&e.setState({requestDetails:'User "'+o.meta.userName+'" requested starting a private call.'}),a.requestAction=o),2===o.status&&1===o.answer){o={ID:a.requestAction.ID,status:3};t.serverUpdate({task:"interaction-answer",interaction:o})}o.status>=3&&o.status<7&&o.answer}})}},{key:"componentWillReceiveProps",value:function(e){}},{key:"render",value:function(){var e=this,t=this.props,a=this.state,o=this.txt,s=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,i=[];if(s||a.fullscreenRecommended||window.innerWidth<800&&i.push(n.a.createElement(R.a,{key:"recommendFullscreen",closeIcon:!0,open:!0,onClose:this.fullscreenModalClose,size:"small"},n.a.createElement(U.a,{icon:"star",content:"FullScreen Recommended"}),n.a.createElement(R.a.Content,null,n.a.createElement("h3",null,"When available space is small, fullscreen is recommended to access interface more easily.")),n.a.createElement(R.a.Actions,null,n.a.createElement(I.a,{color:"orange",onClick:this.fullscreenModalClose},n.a.createElement(D.a,{name:"remove"})," Nevermind"),n.a.createElement(I.a,{color:"green",name:"fullscreenRecommended",onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:"expand"})," Go Fullscreen")))),t.config.siteMenu){var r=[],c=[],l=null;t.config.siteMenu.forEach(function(e){e.parentID?c.push(n.a.createElement(G.a.Item,{key:e.ID,href:e.url,target:"_blank"}," ",e.title," ")):(c.length?(r.push(n.a.createElement(G.a,{className:t.appState.className,item:!0,key:l.ID,text:l.title},n.a.createElement(G.a.Menu,null,c))),c=[]):l&&r.push(n.a.createElement(ee.a.Item,{key:l.ID,href:l.url,target:"_blank"}," ",l.title," ")),l=e)}),i.push(n.a.createElement(te.a,{className:t.appState.className,key:"siteMenu",trigger:n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small"},n.a.createElement(D.a,{name:"align justify"})),flowing:!0,hoverable:!0},n.a.createElement(ee.a,{vertical:!0,className:t.appState.className},n.a.createElement(ee.a.Item,{header:!0},o("Site Menu")),r)))}if(i.push(n.a.createElement(I.a,{className:t.appState.className,size:"small",key:"balance",name:"balance",as:"div",labelPosition:"right"},n.a.createElement(I.a,{className:t.appState.className,size:"small",color:"green",target:"_balance",href:t.config.balanceURL},n.a.createElement(D.a,{name:"money"})),n.a.createElement(T.a,{className:t.appState.className,as:"a",color:t.appState.darkMode?"black":"grey",pointing:"left",target:"_balance",href:t.config.balanceURL},t.user.balance))),t.room.tips&&t.room.tipOptions.length>0){var d=0,p=n.a.createElement(n.a.Fragment,null,t.room.tipOptions.map(function(a,s){if("TIP"===a.tag&&"custom"!==a.attributes.AMOUNT)return d++,n.a.createElement(ae.a.Column,{className:t.appState.className,key:"tip"+s,textAlign:"center"},n.a.createElement(U.a,{as:"h4",className:t.appState.className},n.a.createElement(Y.a,{src:t.room.tipsURL+a.attributes.IMAGE,size:"mini",rounded:!0,verticalAlign:"middle"})," ",a.attributes.AMOUNT),n.a.createElement("b",null,a.attributes.LABEL),n.a.createElement("div",null,a.attributes.NOTE),n.a.createElement("div",null,n.a.createElement(I.a,{compact:!0,className:t.appState.className,size:"small",color:"olive",name:"tip",value:s,onClick:e.onClick.bind(e)},o("Gift"))))}));i.push(n.a.createElement(te.a,{className:t.appState.className,key:"tipsPopup",trigger:n.a.createElement(I.a,{className:t.appState.className,size:"small",key:"tipsButton",name:"tipsButton",color:"olive",disabled:Date.now()-a.tipLast<5e3}," ",n.a.createElement(D.a,{name:"box"})," ",o("Gifts")),flowing:!0,hoverable:!0,open:this.state.tipsOpen,onOpen:function(){return e.setState({tipsOpen:!0})},onClose:function(){return e.setState({tipsOpen:!1})}},n.a.createElement(ae.a,{className:t.appState.className,stackable:!0,centered:!0,divided:!0,columns:d,style:{overflow:"auto",maxHeight:180,maxWidth:480}},p)))}var m=!0,u=o("Request Private 2 Way Videochat Show");if(t.room.actionPrivateDisable)u=o("Performer Disabled Private Requests");else if(t.room.actionPrivateBusy)u=o("Performer is Busy in Private");else if(t.room.users){t.room.users[t.room.performerID]?m=!1:u=o("Performer is Not Online")}if(t.room.actionPrivate&&i.push(n.a.createElement("span",{key:"private","data-tooltip":u},n.a.createElement(I.a,{className:t.appState.className,size:"small",name:"private",color:"orange",loading:a.privateLoading,disabled:a.privateLoading||m,onClick:this.onClick.bind(this)}," ",n.a.createElement(D.a,{name:"star"})," ",o("Request Private")))),t.room.actionPrivateClose&&i.push(n.a.createElement(I.a,{className:t.appState.className,size:"small",key:"privateClose",name:"privateClose",color:"red",onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:"window close"})," ",o("Close Private"))),i.push(n.a.createElement(R.a,{key:"privateModal",closeIcon:!0,open:a.privateModalShow,onClose:this.privateModalClose,size:"small"},n.a.createElement(U.a,{icon:"star",content:o("Request Private 2 Way Videochat Show")}),n.a.createElement(R.a.Content,null,n.a.createElement("h3",null,t.room.performer)),n.a.createElement(R.a.Actions,null,n.a.createElement(I.a,{color:"red",onClick:this.privateModalClose},n.a.createElement(D.a,{name:"remove"})," ",o("Nevermind")),n.a.createElement(I.a,{color:"green",name:"privateRequest",onClick:this.onClick.bind(this),loading:a.privateLoading,disabled:a.privateLoading},n.a.createElement(D.a,{name:"star"})," ",o("Request Private"))))),i.push(n.a.createElement(R.a,{key:"requestModal",open:a.requestModalShow,closeOnEscape:!1,closeOnDimmerClick:!1,size:"small"},n.a.createElement(U.a,{icon:"star",content:"Answer Private Show Request"}),n.a.createElement(R.a.Content,null,n.a.createElement("h3",null,a.requestDetails)),n.a.createElement(R.a.Actions,null,n.a.createElement(I.a,{color:"red",name:"declineRequest",onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:"remove"})," ",o("Decline")),n.a.createElement(I.a,{color:"green",name:"acceptRequest",onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:"star"})," ",o("Accept"))))),t.room.next&&i.push(n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",key:"next",name:"next",color:"teal","data-tooltip":o("Next: Random Videochat Room"),onClick:this.onClick.bind(this),disabled:t.appState.roomLoading},o("Next")," ",n.a.createElement(D.a,{name:"arrow right"}))),t.room.partyHost?i.push(n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",key:"party_return",name:"party_return",color:"teal","data-tooltip":o("Return Party to Start Room"),onClick:this.onClick.bind(this),disabled:t.appState.roomLoading},o("Return")," ",n.a.createElement(D.a,{name:"arrow circle left"}))):t.room.party&&i.push(n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",key:"party_leave",name:"party_leave",color:"teal","data-tooltip":o("Leave Party"),onClick:this.onClick.bind(this),disabled:t.appState.roomLoading},o("Leave")," ",n.a.createElement(D.a,{name:"close"}))),t.appState.revealMode&&!t.appState.audioMode&&!t.room.audioOnly&&!t.appState.revealed&&"Way2Screen"==t.appState.screen){var h=t.appState.revealWarmup-t.appState.screenTime,v=!0;h<=0?(h="",v=!1):h=n.a.createElement(n.a.Fragment,null,n.a.createElement(D.a,{name:"clock"})," ",h," "),i.push(n.a.createElement("span",{"data-tooltip":o("Reveal Webcam")},n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",key:"reveal",name:"reveal",color:"olive",onClick:this.onClick.bind(this),disabled:v},n.a.createElement(D.a,{name:"video"})," ",o("Reveal")," ",h)))}if(s||t.config.actionFullscreen&&i.push(n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",floated:"right",key:"fullscreen",name:"fullscreen",color:"grey","data-tooltip":a.fullscreen?o("Exit Fullscreen"):o("Enter Fullscreen"),onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:a.fullscreen?"compress":"expand"}))),t.config.actionFullpage&&i.push(n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",floated:"right",key:"fullpage",name:"fullpage",color:"grey","data-tooltip":a.fullpage?"Zoom Out of Full Page":"Zoom Into Full Page",onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:a.fullpage?"zoom-out":"zoom-in"}))),i.push(n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",floated:"right",key:"sfx",name:"sfx",color:t.appState.sfxError?"red":t.appState.sfx?"green":"yellow","data-tooltip":t.appState.sfxError?o("Tap to Play"):t.appState.sfx?o("Sfx On"):o("Sfx Off"),onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:t.appState.sfxError?"deaf":t.appState.sfx?"bell":"bell slash"}))),i.push(n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",floated:"right",key:"darkMode",name:"darkMode",color:t.appState.darkMode?"yellow":"grey","data-tooltip":t.appState.darkMode?o("Lights On"):o("Dark Mode"),onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:t.appState.darkMode?"sun":"moon"}))),(!t.appState.checked||t.appState.checked&&t.appState.mode.text)&&i.push(n.a.createElement(I.a,{className:t.appState.className,size:"small",floated:"right",key:"videowhisper",name:"videowhisper",color:"blue",target:"_videowhisper",href:t.appState.tooltipURL,"data-tooltip":t.appState.tooltip},n.a.createElement(D.a,{name:"eye"})," Free")),i.push(n.a.createElement(I.a,{className:t.appState.className,size:"small",floated:"right",key:"time",name:"time",as:"div",labelPosition:"right"},n.a.createElement(I.a,{className:t.appState.className,size:"small",color:"yellow"},n.a.createElement(D.a,{name:"time"})),n.a.createElement(T.a,{className:t.appState.className,as:"a",color:t.appState.darkMode?"black":"grey",pointing:"left"},a.displayTime))),t.room.actionButtons)for(var f in t.room.actionButtons){var g=t.room.actionButtons[f];i.push(n.a.createElement(I.a,{className:t.appState.className,icon:!0,size:"small",floated:g.floated,key:g.name,name:g.name,color:g.color,target:"_"+g.target,href:g.url,"data-tooltip":g.tooltip},n.a.createElement(D.a,{name:g.icon})," ",g.text))}return n.a.createElement("div",{className:"panel",style:{backgroundColor:t.appState.backgroundColor},ref:function(t){return e.state.container=t}},n.a.createElement("div",{className:"controlsBottom"},i))}}]),t}(o.Component),ne=function(e){function t(){return Object(C.a)(this,t),Object(M.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return this.componentActions=n.a.createRef(),n.a.createElement("div",{className:"layoutWay2",style:{backgroundColor:e.appState.backgroundColor}},n.a.createElement("div",{className:"layVideo"},n.a.createElement(z,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room})),n.a.createElement("div",{className:"layCamera"},n.a.createElement(J,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})),n.a.createElement("div",{className:"layHistory"},n.a.createElement($,{config:e.config,appState:e.appState,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),n.a.createElement("div",{className:"layActions"},n.a.createElement(oe,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),n.a.createElement("div",{className:"laySend"},n.a.createElement(Z,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}]),t}(o.Component),se=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).componentActions=n.a.createRef(),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return n.a.createElement("div",{className:"layoutBroadcast",style:{backgroundColor:e.appState.backgroundColor}},n.a.createElement("div",{className:"layCamera"},n.a.createElement(J,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})),n.a.createElement("div",{className:"layActions"},n.a.createElement(oe,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),n.a.createElement("div",{className:"layHistory"},n.a.createElement($,{config:e.config,appState:e.appState,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),n.a.createElement("div",{className:"laySend"},n.a.createElement(Z,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}]),t}(o.Component),ie=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).componentActions=n.a.createRef(),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return n.a.createElement("div",{className:"layoutPlayback",style:{backgroundColor:e.appState.backgroundColor}},n.a.createElement("div",{className:"layVideo"},n.a.createElement(z,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room})),n.a.createElement("div",{className:"layActions"},n.a.createElement(oe,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),n.a.createElement("div",{className:"layHistory"},n.a.createElement($,{config:e.config,appState:e.appState,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),n.a.createElement("div",{className:"laySend"},n.a.createElement(Z,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}]),t}(o.Component),re=a(129),ce=a.n(re),le=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).playerError=function(e){console.log("containers/Media playerError",e)},a.state={placement:e.placement,meta:e.meta,panelType:"Media",mediaWidth:0,mediaHeight:1,mediaStyle:{position:"absolute",width:"100%",height:"100%"},mediaAspectRatio:1},a.devMode=e.appState.devMode,a.mediaContent=n.a.createRef(),a.extensionsImg=["jpg","jpeg","jfif","pjpeg","pjp","gif","ico","cur","bmp","png","svg"],a.extensionsVideo=["mp4","webm","ogg"],a.extensionsAudio=["mp3"],a.devMode&&console.log("containers/Media constructor",e),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"updateMediaSize",value:function(e){var t=this.state;t.mediaHeight||(t.mediaHeight=1),t.mediaAspectRatio=t.mediaWidth/t.mediaHeight;var a=t.mediaWidth,o=t.mediaHeight,n=0,s=0;t.width&&t.aspectRatio&&t.mediaAspectRatio&&(t.mediaAspectRatio>t.aspectRatio?(o=(a=t.width)/t.mediaAspectRatio,s=(t.height-o)/2):(a=(o=t.height)*t.mediaAspectRatio,n=(t.width-a)/2));var i={position:"absolute",left:n,top:s,width:a,height:o,border:"solid 1px #555"};this.setState({mediaStyle:i}),this.devMode&&console.log("containers/Media updateMediaSize",e,t.aspectRatio,t.mediaAspectRatio,i,t)}},{key:"onImgLoad",value:function(e){var t=e.target;this.state.mediaWidth=t.naturalWidth,this.state.mediaHeight=t.naturalHeight,this.devMode&&console.log("containers/Media onImgLoad",t.naturalWidth,t.naturalHeight),this.updateMediaSize("img")}},{key:"onVideoLoadedMetadata",value:function(e){var t=e.target;this.state.mediaWidth=t.videoWidth,this.state.mediaHeight=t.videoHeight,this.devMode&&console.log("containers/Media onVideoLoadedMetadata",t.videoWidth,t.videoHeight),this.updateMediaSize("video")}},{key:"render",value:function(){var e=this,t=this.state,a=this.props,o=n.a.createElement(N.a,{className:a.appState.className},a.placement," / ",a.type," - No Content.");if(a.placement&&a.appState.media){var s=a.appState.media[a.placement];if(s)switch(s.placement=a.meta+" "+a.placement,s.type){case"user":if(a.room.users){var i,r=!1;(i=a.content?a.room.users[s.userID]:a.room.users[a.room.streamUID])&&i.meta&&i.meta.external&&(r=!0,i.meta.connected&&i.meta.connectedUpdate>i.meta.external&&(r=!1)),r&&(o=i.hls?n.a.createElement(ce.a,{style:t.mediaStyle,ref:this.mediaContent,url:i.hls,muted:a.appState.muted,playing:!0,controls:!0,playsinline:!0,width:"100%",height:"100%",onError:this.playerError.bind(this)}):n.a.createElement(N.a,Object(_.a)({className:a.appState.className},"className",a.appState.className),a.placement," - HLS not available for user #",s.userID)),r||(o=n.a.createElement(z,{appState:a.appState,appStateUpdate:a.appStateUpdate,config:a.config,room:a.room,content:s,meta:a.meta}))}break;case"stream":case"video":o=n.a.createElement(z,{appState:a.appState,appStateUpdate:a.appStateUpdate,config:a.config,room:a.room,content:s,meta:a.meta});break;case"file":o=this.extensionsImg.includes(s.ext)?n.a.createElement("img",{style:t.mediaStyle,ref:this.mediaContent,onLoad:this.onImgLoad.bind(this),src:s.url}):this.extensionsVideo.includes(s.ext)||this.extensionsAudio.includes(s.ext)?n.a.createElement(ce.a,{style:t.mediaStyle,ref:this.mediaContent,url:s.url,playing:!0,controls:!0,playsinline:!0,loop:!0,onError:this.playerError.bind(this),width:"100%",height:"100%"}):n.a.createElement(N.a,{className:a.appState.className},this.txt("File"),": ",n.a.createElement("b",null,s.name)," (",s.userName,")",n.a.createElement(W.a,null)," ",n.a.createElement(I.a,{className:a.appState.className,icon:!0,labelPosition:"right",target:"_blank",href:s.url}," ",this.txt("Open")," ",n.a.createElement(D.a,{size:"large",name:"folder open"})," ")," ");break;case"hls":o=n.a.createElement(ce.a,{url:s.url,playing:!0});break;case"empty":o=n.a.createElement(N.a,{className:a.appState.className},n.a.createElement(U.a,null,a.placement,": Empty Content Area")," Room owner can assign content or adjust number of content areas.");break;default:o=n.a.createElement(N.a,{className:a.appState.className},a.placement," - Unknown type: ",s.type," / ",a.type)}}return n.a.createElement("div",{className:"panel",ref:function(t){return e.state.container=t}},o)}}]),t}(H);le.propTypes={placement:F.a.string.isRequired,meta:F.a.string.isRequired,type:F.a.string.isRequired,appState:F.a.object.isRequired,appStateUpdate:F.a.func.isRequired,user:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired};var de=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).state={panelType:"Multimedia"},a.devMode=e.appState.devMode,a.mediaItems=1,a.devMode&&console.log("containers/Multimedia constructor",e),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this,t=this.state,a=this.props,o=[],s=Object.keys(this.props.appState.media).length,i=0;for(var r in this.props.appState.media){var c=a.appState.media[a.placement],l="none";if(c&&(l=c.type),"user"==l&&a.room.users){var d=a.room.users[c.userID],p=!1;d&&d.meta&&d.meta.external&&(p=!0,d.meta.connected&&d.meta.connectedUpdate>d.meta.external&&(p=!1)),p&&(l="hls")}o.push(n.a.createElement("div",{className:"slot"+i,key:"slot_"+r},n.a.createElement(le,{appState:a.appState,appStateUpdate:a.appStateUpdate,config:a.config,room:a.room,user:a.user,placement:r,type:l,meta:i+"/"+s}))),i++}this.mediaItems=i;var m="V";t.aspectRatio>1.77&&(m="H");var u="panel split0";return this.mediaItems>1&&(u="panel split"+m+this.mediaItems),n.a.createElement("div",{className:u,ref:function(t){return e.state.container=t}},o)}}]),t}(H);de.propTypes={appState:F.a.object.isRequired,appStateUpdate:F.a.func.isRequired,user:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired};var pe=function(e){function t(){return Object(C.a)(this,t),Object(M.a)(this,Object(w.a)(t).apply(this,arguments))}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return n.a.createElement("div",{className:"layoutChat",key:"layoutChat",style:{backgroundColor:e.appState.backgroundColor}},n.a.createElement("div",{className:"layHistory"},n.a.createElement($,{config:e.config,appState:e.appState,appSfx:e.appSfx,user:e.user,messages:e.messages,fetchHistory:e.fetchHistory})),n.a.createElement("div",{className:"laySend"},n.a.createElement(Z,{config:e.config,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,sendMessage:e.sendMessage})))}}]),t}(o.Component),me=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).copyToClipboard=function(e){console.log("components/Broadcast copyToClipboard",e.target.value),e.target.select(),navigator.clipboard&&navigator.clipboard.writeText&&navigator.clipboard.writeText(e.target.value)},a.state={},a.devMode=e.appState.devMode,a.devMode&&console.log("components/Broadcast constructor room:",e.room),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Broadcast componentWillUnmount")}},{key:"onClick",value:function(e,t){var a=t.name,o=t.value;this.devMode&&console.log("components/Broadcast onClick",a,o,e);this.state,this.props;switch(a){case"closed":this.props.serverUpdate({task:"external",external:!1})}}},{key:"render",value:function(){var e=this.props,t=this.txt,a=[];if(e.room.broadcastSettings){for(var o in e.room.broadcastSettings)if("meta"!==o){var s=e.room.broadcastSettings[o],i=[];for(var r in s.fields){var c=s.fields[r];switch(c.type){case"text":i.push(n.a.createElement(q.a.Field,{key:c.name},n.a.createElement("label",null,c.description),n.a.createElement(Q.a,{fluid:!0,readOnly:!0,onClick:this.copyToClipboard,iconPosition:"left",defaultValue:c.value},n.a.createElement(D.a,{name:"copy"}),n.a.createElement("input",null)),n.a.createElement("br",null),n.a.createElement("small",null,c.details)));break;case"link":i.push(n.a.createElement(q.a.Field,{key:c.name},n.a.createElement(I.a,{className:e.appState.className,size:"small",name:c.name,color:c.color?c.color:"blue",target:"_blank",href:c.url},n.a.createElement(D.a,{name:c.icon?c.icon:"cloud download"})," ",c.description),n.a.createElement("br",null),n.a.createElement("small",null,c.details)))}}a.push(n.a.createElement("div",{key:o},n.a.createElement(U.a,{className:e.appState.className,as:"h4"},s.name),s.details,n.a.createElement(W.a,null),n.a.createElement(q.a,{className:e.appState.className},i),n.a.createElement(W.a,{hidden:!0})))}}else a.push(n.a.createElement("p",null,"No broadcast settings available"));var l="User list not available.",d=!1;if(e.room.users){var p;e.room?(p=e.room.users[e.user.ID],l="User info available."):l="Not in user list.";var m=t("Not Available");p&&p.meta&&p.meta.external&&(m="Started",d=!0,p.meta.connected&&p.meta.connectedUpdate>p.meta.externalUpdate&&(d=!1,m="Web Broadcast More Recent")),d&&(l=p.hls?t("Streaming"):"HLS not available."),d||(l=m)}var u=d?n.a.createElement("div",{key:"closed"}," ",n.a.createElement(I.a,{className:e.appState.className,icon:!0,size:"small",name:"closed",color:"red",onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:"close"})," ",t("Closed"))," ",n.a.createElement("small",null,t("Use after ending external broadcast, to faster restore web based webcam interface."))," "):"";return n.a.createElement("div",{className:"layoutScrollable",key:"layoutBroadcastScroll",style:{backgroundColor:e.appState.backgroundColor}},n.a.createElement("div",{className:"layScrollable",key:"layBroadcast",ref:this.scrollableRef},n.a.createElement(N.a,{className:e.appState.className},n.a.createElement(U.a,{className:e.appState.className,as:"h4"},t("External Broadcast")),n.a.createElement(T.a,{color:d?"green":"yellow"},l),u,n.a.createElement("small",null,n.a.createElement("br",null),e.room.broadcastSettings.meta.description?e.room.broadcastSettings.meta.description:t("External Broadcast")),n.a.createElement(W.a,null),a)))}}]),t}(H);me.propTypes={appState:F.a.object.isRequired,user:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired,serverUpdate:F.a.func.isRequired};var ue=a(558),he=a(40),ve=a.n(he),fe=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).userClick=function(e){return function(t,o){if(console.log("components/User userClick",e,o,t),e&&o.action)switch(o.action){case"profile":var n={file:e.url};window.open(n.file);break;case"presentation":a.props.serverUpdate({task:"user_presentation",userID:e.userID,userName:e.userName,placement:o.placement});break;case"kick":a.props.serverUpdate({task:"user_kick",userID:e.userID,userName:e.userName});break;case"ban":a.props.serverUpdate({task:"user_ban",userID:e.userID,userName:e.userName})}}},a.state={},a.devMode=e.appState.devMode,a.data=[],a.usersLeft=[],a.usersJoined=[],a.userCount=0,a.scrollableRef=n.a.createRef(),e.room.users&&(a.data=ve.a.sortBy(e.room.users,"order")),a.devMode&&console.log("components/Users constructor room:",e.room),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){console.log("components/Users componentWillUnmount")}},{key:"shouldComponentUpdate",value:function(e,t){return ve.a.isEqual(e.room.users,this.props.room.users)||(this.data=ve.a.sortBy(e.room.users,"order")),!0}},{key:"render",value:function(){var e,t,a=this.props,o=(this.state,this.txt);this.devMode=a.appState.devMode;var s=[],i=0;if(t=this.props.room.usersMenu?n.a.createElement(N.a,{className:a.appState.className},"Users Menu"):"",this.data){for(var r in this.data)if(this.data.hasOwnProperty(r)){var c=this.data[r];if(c&&c.userName&&!c.hide){i++;var l=[];if(l.push({key:"usermenuProfile_"+r,onClick:this.userClick(c),icon:"address card",text:o("Profile"),action:"profile"}),this.props.room.usersPresentation)for(var d in this.props.appState.media)l.push({key:"usermenuPresentation_"+d+r,onClick:this.userClick(c),icon:"pointing left",text:o("Show")+": "+d,action:"presentation",placement:d});var p=n.a.createElement(G.a,{compact:!0,key:"usermenu"+r,text:c.userName,options:l,className:a.appState.className});this.props.room.usersModerator&&(l.push({key:"usermenuKick_"+r,onClick:this.userClick(c),icon:"sign-out",text:o("Kick"),action:"kick"}),l.push({key:"usermenuBan_"+r,onClick:this.userClick(c),icon:"ban",text:o("Ban"),action:"ban"}));var m=n.a.createElement(n.a.Fragment,null,n.a.createElement(Y.a,{src:c.avatar,rounded:!0,size:"mini",verticalAlign:"middle"}),c.userID===a.room.performerID?n.a.createElement(D.a,{name:"star"}):"",c.meta.connected?n.a.createElement(D.a,{name:"video"}):"",p);s.push(n.a.createElement(ue.a.Row,{key:"userRow"+r},n.a.createElement(ue.a.Cell,null,m)))}}}else s=n.a.createElement(ue.a.Row,{key:"No_Users"},n.a.createElement(ue.a.Cell,{colSpan:"1",warning:!0},"No users."));return e=n.a.createElement(ue.a,{celled:!0,selectable:!0,sortable:!0,key:"User_Pane",className:a.appState.className},n.a.createElement(ue.a.Body,null,s)),this.userCount=i,n.a.createElement("div",{className:"layoutList",key:"layoutList",style:{backgroundColor:a.appState.backgroundColor}},n.a.createElement("div",{className:"layScrollable",key:"layScrollable",ref:this.scrollableRef},e),n.a.createElement("div",{className:"layMenu"},t))}},{key:"componentDidUpdate",value:function(e,t,a){}}]),t}(H);fe.propTypes={appState:F.a.object.isRequired,appStateUpdate:F.a.func.isRequired,appSfx:F.a.func.isRequired,user:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired,serverUpdate:F.a.func.isRequired};var ge=a(298),be=a(296),Se=a.n(be),ye=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).handleSort=function(e){return function(){a.sortBy(e,!1)}},a.fileClick=function(e){return function(t,o){if(console.log("components/Files fileClick",e,o,t),e&&o.action)switch(o.action){case"open":var n={file:e.url};window.open(n.file);break;case"delete":a.props.serverUpdate({task:"file_delete",file_name:e.name});break;case"presentation":a.props.serverUpdate({task:"file_presentation",file_name:e.name,placement:o.placement})}}},a.onDrop=function(e){var t=Object(x.a)(Object(x.a)(a)).props;if(t.config.serverURL){var o=Se.a.post(t.config.serverURL);o.field("task","file_upload"),o.field("VideoWhisper[userID]",t.user.ID),o.field("VideoWhisper[sessionID]",t.user.sessionID),o.field("VideoWhisper[sessionKey]",t.user.sessionKey),t.room.ID?(o.field("VideoWhisper[roomID]",t.room.ID),o.field("VideoWhisper[privateUID]",t.room.privateUID)):console.log("components/Files onDrop room",t.room,t.user,t.config.serverURL);var n=[];e.forEach(function(e){o.attach(e.name,e,e.name),n.push(e.name)}),o.field("files[]",n),o.then(a.uploadCompleted.bind(Object(x.a)(Object(x.a)(a)))),console.log("components/Files onDrop",e,o),a.setState({uploading:!0})}else console.log("components/Files onDrop missing serverURL",t.config.serverURL,t.config)},a.state={column:null,data:null,direction:null,uploading:!1},a.devMode=e.appState.devMode,a.scrollableRef=n.a.createRef(),a.fileInputRef=n.a.createRef(),e.room.files&&(a.state.data=e.room.files),a.devMode&&console.log("components/Files constructor room:",e.room),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"sortBy",value:function(e,t){t&&(this.state.column=null,this.state.direction=null);var a=this.state,o=a.column,n=a.data,s=a.direction;if(n){var i="age"==e?"time":e;console.log("components/Files handleSort",e,i,s,t),o===e?this.setState({data:"descending"===s?ve.a.sortBy(n,[i]):ve.a.sortBy(n,[i]).reverse(),direction:"ascending"===s?"descending":"ascending"}):this.setState({column:e,data:ve.a.sortBy(n,[i]).reverse(),direction:"descending"})}}},{key:"componentDidMount",value:function(){this.sortBy("age",!0)}},{key:"componentWillUnmount",value:function(){console.log("components/Files  componentWillUnmount")}},{key:"shouldComponentUpdate",value:function(e,t){return ve.a.isEqual(e.room.files,this.props.room.files)||(this.state.data=e.room.files,this.sortBy("age",!0)),!0}},{key:"uploadCompleted",value:function(e){console.log("components/Files uploadCompleted",e),this.props.serverUpdate({task:"update",update:"files"}),this.setState({uploading:!1})}},{key:"render",value:function(){var e,t,a,o=this,s=this.props,i=this.state,r=this.txt,c=this.state,l=c.column,d=c.data,p=c.direction;return a=this.props.room.filesUpload?n.a.createElement(ge.a,{onDrop:this.onDrop},function(e){var t=e.getRootProps,a=e.getInputProps;return n.a.createElement(N.a,{className:s.appState.className},n.a.createElement("div",t(),n.a.createElement("input",a()),n.a.createElement("p",null,n.a.createElement(D.a,{name:"upload",loading:i.uploading})," ",i.uploading?r("Uploading. Please wait..."):r("Upload: Drag and drop files here, or click to select files"))))}):"",t=d?d.map(function(e){var t=[];if(t.push({key:"filemenuOpen_"+e.name,onClick:o.fileClick(e),icon:"file",text:r("Open"),action:"open"}),o.props.room.filesDelete&&t.push({key:"filemenuDelete_"+e.name,onClick:o.fileClick(e),icon:"trash",text:r("Delete"),action:"delete"}),o.props.room.filesPresentation)for(var a in o.props.appState.media)t.push({key:"filemenuPresentation_"+a+e.name,onClick:o.fileClick(e),icon:"pointing left",text:r("Show")+": "+a,action:"presentation",placement:a});var i=n.a.createElement(G.a,{key:"filemenu"+e.name,text:e.name,options:t,className:s.appState.className});return n.a.createElement(ue.a.Row,{key:e.name},n.a.createElement(ue.a.Cell,null,i),n.a.createElement(ue.a.Cell,null,e.size),n.a.createElement(ue.a.Cell,null,e.age))}):n.a.createElement(ue.a.Row,{key:"No_Files"},n.a.createElement(ue.a.Cell,{colSpan:"3",warning:!0},"No files.")),e=n.a.createElement(ue.a,{celled:!0,selectable:!0,striped:!0,sortable:!0,key:"File_Pane",className:s.appState.className},n.a.createElement(ue.a.Header,null,n.a.createElement(ue.a.Row,null,n.a.createElement(ue.a.HeaderCell,{sorted:"name"===l?p:null,onClick:this.handleSort("name")},r("Name")),n.a.createElement(ue.a.HeaderCell,{sorted:"size"===l?p:null,onClick:this.handleSort("size")},r("Size")),n.a.createElement(ue.a.HeaderCell,{sorted:"age"===l?p:null,onClick:this.handleSort("age")},r("Age")))),n.a.createElement(ue.a.Body,null,t)),n.a.createElement("div",{className:"layoutList",key:"layoutList",style:{backgroundColor:s.appState.backgroundColor}},n.a.createElement("div",{className:"layScrollable",key:"layScrollable",ref:this.scrollableRef},e),n.a.createElement("div",{className:"layMenu"},a))}}]),t}(H);ye.propTypes={appState:F.a.object.isRequired,user:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired,serverUpdate:F.a.func.isRequired};var ke=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).state={},a.devMode=e.appState.devMode,a.devMode&&console.log("components/Presentation constructor room:",e.room),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Presentation  componentWillUnmount")}},{key:"removeMedia",value:function(e,t){var a=t.name,o=t.value;this.devMode&&console.log("components/Presentation removeMedia",a,o,e),this.props.serverUpdate({task:"presentation_remove",placement:o})}},{key:"render",value:function(){var e=this.props,t=this.txt,a=[];if(e.appState.media)for(var o in e.appState.media){var s=e.appState.media[o],i="";if("stream"===s.type){var r=this.props.room.users[s.userID];r?r.meta&&(r.meta.connected||(i="Not Broadcasting")):i="Not Available"}a.push(n.a.createElement("div",{key:"presentationPlacement"+o},s.default?n.a.createElement(T.a,{pointing:"right"},t("Default")):"empty"===s.type?n.a.createElement(T.a,{pointing:"right"},t("Empty")):n.a.createElement(I.a,{className:e.appState.className,size:"tiny",compact:!0,key:"removeMedia"+o,name:"removeMedia"+o,value:o,color:"red",onClick:this.removeMedia.bind(this)}," ",n.a.createElement(D.a,{name:"window close"}),"Remove"),n.a.createElement("b",null,o),": ",s.type," ",n.a.createElement("i",null,s.name)," ",i))}return n.a.createElement("div",{className:"layScrollable",key:"layPresentation",style:{backgroundColor:e.appState.backgroundColor},ref:this.scrollableRef},n.a.createElement(N.a,{className:e.appState.className},n.a.createElement(U.a,{className:e.appState.className,as:"h4"},t("Media Displayed"),": ",e.room.name),n.a.createElement(W.a,null),a))}}]),t}(H);ke.propTypes={appState:F.a.object.isRequired,user:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired,serverUpdate:F.a.func.isRequired};var Ce=a(552),Ee=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).state={panelType:"Options",time:0,updating:!1},a.devMode=e.appState.devMode,a.devMode&&console.log("components/Options constructor room:",e.room),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("components/Options componentWillUnmount")}},{key:"onChange",value:function(e,t){var a,o="checkbox"===t.type?t.checked:t.value,n=t.name;this.devMode&&console.log("Components/Options onChange",n,o,t),this.props.serverUpdate({task:"options",name:n,value:o}),n&&this.setState((a={},Object(_.a)(a,n,o),Object(_.a)(a,"updating",!0),a))}},{key:"render",value:function(){var e=this,t=this.props,a=this.state,o=[];if(t.room.options){for(var s in t.room.options)if("meta"!==s){var i=t.room.options[s],r=[];for(var c in i.fields){var l=i.fields[c];switch(l.type){case"toggle":r.push(n.a.createElement(q.a.Field,{key:l.name},n.a.createElement("label",null,l.description),n.a.createElement(Ce.a,{name:l.name,"data-position":"right center",toggle:!0,disabled:a.updating,checked:a[l.name],onChange:function(t,a){return e.onChange(t,a)}}),n.a.createElement("br",null),n.a.createElement("small",null,l.details)));break;case"dropdown":r.push(n.a.createElement(q.a.Group,{key:l.name},n.a.createElement(q.a.Field,null,n.a.createElement("label",null,l.description),n.a.createElement(G.a,{name:l.name,selection:!0,compact:!0,className:t.appState.className,"data-position":"right center",value:a[l.name],disabled:a.updating,options:l.options,onChange:function(t,a){return e.onChange(t,a)}}),n.a.createElement("br",null),n.a.createElement("small",null,l.details))));break;default:r.push(n.a.createElement("p",{key:"noFields"},l.name," Unknown Type: ",l.type))}}o.push(n.a.createElement("div",{key:s},n.a.createElement(U.a,{className:t.appState.className,as:"h4"},i.name),n.a.createElement(W.a,null),n.a.createElement(q.a,{className:t.appState.className},r),n.a.createElement(W.a,{hidden:!0})))}}else o.push(n.a.createElement("p",null,"No options"));return n.a.createElement("div",{className:"layoutScrollable",key:"layoutOptionsScroll",style:{backgroundColor:t.appState.backgroundColor}},n.a.createElement("div",{className:"layScrollable",key:"layOptions",ref:this.scrollableRef},n.a.createElement(N.a,{className:t.appState.className},o)))}}],[{key:"getDerivedStateFromProps",value:function(e,a){return e.room.options&&e.room.options.meta&&e.room.options.meta.time>a.time?(e.appState.devMode&&console.log("components/Options getDerivedStateFromProps",a),t.propsToOptions(e)):null}},{key:"propsToOptions",value:function(e){var t={};if(e.room.options)for(var a in e.room.options)if("meta"!==a){var o=e.room.options[a];for(var n in o.fields){var s=o.fields[n];s&&s.name&&(t[s.name]=s.value)}}return e.room.options&&e.room.options.meta&&(t.time=e.room.options.meta.time),t.updating=!1,e.appState.devMode&&console.log("components/Options propsToOptions",t),t}}]),t}(H);Ee.propTypes={appState:F.a.object.isRequired,user:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired,serverUpdate:F.a.func.isRequired};var Me=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).devMode=e.appState.devMode,a.devMode&&console.log("containers/Tabs constructor",e),a.state={menus:[],panes:[],selected:""},a.updatePanes(e),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){this.devMode&&console.log("containers/Tabs componentWillUnmount")}},{key:"updatePanes",value:function(e){var t=this.state,a=this.txt,o=[],s=[],i="";if(this.state.selected||(this.state.selected=a("Chat")),e.appState.publishRequired&&e.room.panelCamera&&(this.state.selected=a("Cam")),e.appState.external&&this.state.selected==a("Cam")&&(this.state.selected=a("Broadcast")),this.state.selected==a("Chat")&&this.props.appState.chatNew&&this.props.appStateUpdate({chatNew:!1}),i=a("Chat"),o.push({key:i,active:t.selected==i,name:i,content:n.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":n.a.createElement(D.a,{name:"chat"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",this.props.appState.chatNew?n.a.createElement(D.a,{size:"tiny",name:"star",color:"green"}):"")}),s.push(n.a.createElement("div",{key:"paneChat",className:t.selected==i?"paneActive":"paneInactive"},n.a.createElement(pe,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage}))),e.room.panelCamera&&!e.appState.external){var r="video";i=a("Cam"),(e.room.audioOnly||e.appState.audioMode)&&(i=a("Mic"),r="microphone",this.state.selected==a("Cam")&&(this.state.selected=a("Mic")));var c={off:n.a.createElement(D.a,{size:"tiny",name:"stop"}),pending:n.a.createElement(D.a,{size:"tiny",color:"orange",name:"sync"}),live:n.a.createElement(D.a,{size:"tiny",color:"green",name:"circle"}),error:n.a.createElement(D.a,{size:"tiny",color:"red",name:"exclamation triangle"})}[e.appState.cameraStatus];o.push({key:i,active:t.selected==i,name:i,content:n.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":n.a.createElement(D.a,{name:r}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",c)}),s.push(n.a.createElement("div",{key:"paneCamera",className:t.selected==i?"paneActive":"paneInactive"},n.a.createElement(J,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,serverUpdate:e.serverUpdate})))}e.room.panelBroadcast&&(i=a("Broadcast"),o.push({key:i,active:t.selected==i,name:i,content:n.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":n.a.createElement(D.a,{name:"rss"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i)}),t.selected==i&&s.push(n.a.createElement("div",{key:"paneBroadcast",className:t.selected==i?"paneActive":"paneInactive"},n.a.createElement(me,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelUsers&&(i=a("Users"),o.push({key:i,active:t.selected==i,name:i,content:n.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":n.a.createElement(D.a,{name:"users"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i," ",n.a.createElement(T.a,{className:e.appState.className,size:"tiny",pointing:"left"},e.appState.userCount))}),t.selected==i&&s.push(n.a.createElement("div",{key:"paneUsers",className:t.selected==i?"paneActive":"paneInactive"},n.a.createElement(fe,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelFiles&&(i=a("Files"),o.push({key:i,active:t.selected==i,name:i,content:n.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":n.a.createElement(D.a,{name:"file"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i)}),t.selected==i&&s.push(n.a.createElement("div",{key:"paneFiles",className:t.selected==i?"paneActive":"paneInactive"},n.a.createElement(ye,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})))),e.room.panelPresentation&&(i=a("Presentation"),o.push({key:i,active:t.selected==i,name:i,content:n.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":n.a.createElement(D.a,{name:"hand point left"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i)}),t.selected==i&&s.push(n.a.createElement("div",{key:"panePresentation",className:t.selected==i?"paneActive":"paneInactive"},n.a.createElement(ke,{appState:e.appState,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "))),e.room.panelOptions&&(i=a("Options"),o.push({key:i,active:t.selected==i,name:i,content:n.a.createElement("div",{"data-tooltip":i,"data-position":"bottom center"}," ",e.config.tabMenu&&"icon"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":n.a.createElement(D.a,{name:"settings"}),e.config.tabMenu&&"text"!==e.config.tabMenu&&"full"!==e.config.tabMenu?"":i)}),t.selected==i&&s.push(n.a.createElement("div",{key:"paneOptions",className:t.selected==i?"paneActive":"paneInactive"},n.a.createElement(Ee,{appState:e.appState,user:e.user,config:e.config,room:e.room,serverUpdate:e.serverUpdate})," "))),this.state.menus=o,this.state.panes=s}},{key:"onClick",value:function(e,t){this.devMode&&console.log("containers/Tabs onClick",t),this.state.selected!=t.name&&(this.state.selected=t.name,this.updatePanes(this.props),this.setState({selected:t.name}))}},{key:"render",value:function(){var e=this.state,t=this.props;return this.updatePanes(t),n.a.createElement("div",{className:"layoutTabs",style:{backgroundColor:t.appState.backgroundColor}},n.a.createElement("div",{className:"layMenu"},n.a.createElement(ee.a,{className:t.appState.className,items:e.menus,onItemClick:this.onClick.bind(this)})),n.a.createElement("div",{className:"layPane"},e.panes))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return e.room&&!t.selected&&e.room.panelCamera?{selected:"Cam"}:null}}]),t}(H);Me.propTypes={appState:F.a.object.isRequired,appStateUpdate:F.a.func.isRequired,appSfx:F.a.func.isRequired,user:F.a.object.isRequired,config:F.a.object.isRequired,room:F.a.object.isRequired,fetchHistory:F.a.func.isRequired,sendMessage:F.a.func.isRequired,serverUpdate:F.a.func.isRequired};var we=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).componentActions=n.a.createRef(),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentWillUnmount",value:function(){console.log("containers/CollaborationScreen componentWillUnmount")}},{key:"render",value:function(){var e=this.props;return n.a.createElement("div",{className:"layoutCollaboration",style:{backgroundColor:e.appState.backgroundColor}},n.a.createElement("div",{className:"layVideo"},n.a.createElement(de,{appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,room:e.room,user:e.user})),n.a.createElement("div",{className:"layActions"},n.a.createElement(oe,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})),n.a.createElement("div",{className:"layTabs"},n.a.createElement(Me,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,user:e.user,config:e.config,room:e.room,messages:e.messages,fetchHistory:e.fetchHistory,sendMessage:e.sendMessage,serverUpdate:e.serverUpdate})))}}]),t}(o.Component),Oe=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).devMode=e.appState.devMode,a.state={privateUnavailable:!0,requestStatus:"Not available"},a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"componentDidMount",value:function(){this.props,this.state;this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidMount")}},{key:"componentDidUpdate",value:function(e,t,a){var o=this.txt,n=!0,s=o("Waiting for user to accept call");if(e.room)if(e.room.actionPrivateDisable)s=o("User disabled private requests");else if(e.room.actionPrivateBusy)s=o("User is currently busy in private");else if(e.room.users){e.room.users[e.appState.requestUID]?n=!1:s=o("User is not online, yet")}else s=o("User list is not available");else s=o("Room is not ready");if(e.appState.requestAID&&(s=o("Private call ended.")),this.state.requestStatus=s,t.privateUnavailable&&!n&&(this.state.privateUnavailable=!1,!e.room.privateUID&&!e.appState.requestAID))if(e.room.privateUID!==e.appState.requestUID){var i={userName:e.user.name},r={action:"privateRequest",userID:e.user.ID,roomID:e.room.ID,targetID:e.appState.requestUID,meta:i};e.serverUpdate({task:"interaction",interaction:r}),this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidUpdate Available",e.room)}else this.devMode&&console.log("VideoWhisper/containers/LobbyScreen componentDidUpdate Available but requestAID",e.appState.requestAID)}},{key:"render",value:function(){var e=this.props,t=this.txt,a=this.state;return n.a.createElement(N.a,{className:e.appState.className},n.a.createElement(U.a,null,t("Private Call")),n.a.createElement("p",null,e.user.name," - ",e.appState.requestUsername," (#",e.appState.requestUID,") / ",e.room.name," ",n.a.createElement("br",null)," ",n.a.createElement("b",null,a.requestStatus)),n.a.createElement(I.a,{className:e.appState.className,size:"small",key:"exit",name:"videowhisper",color:"red",target:"_top",href:e.config.exitURL},n.a.createElement("i",{class:"arrow alternate circle left icon"})," ",t("Exit")))}}]),t}(H);Oe.propTypes={user:F.a.object.isRequired,room:F.a.object.isRequired,config:F.a.object.isRequired,appState:F.a.object.isRequired,serverUpdate:F.a.func.isRequired};var xe=function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).componentActions=n.a.createRef(),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"render",value:function(){var e=this.props;return n.a.createElement("div",{className:"layoutList",key:"layoutList",style:{backgroundColor:e.appState.backgroundColor}},n.a.createElement("div",{className:"layScrollable",key:"layScrollable"},n.a.createElement(Oe,{appState:e.appState,appStateUpdate:e.appStateUpdate,appSfx:e.appSfx,config:e.config,room:e.room,user:e.user,actions:e.actions,serverUpdate:e.serverUpdate})),n.a.createElement("div",{className:"layMenu",key:"layMenu"},n.a.createElement(oe,{ref:this.componentActions,appState:e.appState,appStateUpdate:e.appStateUpdate,config:e.config,user:e.user,room:e.room,actions:e.actions,serverUpdate:e.serverUpdate})))}}]),t}(o.Component),Ie=a(181),De=a.n(Ie),Re=a(182),Ue=a.n(Re),Ne=(a(541),a(542),a(543),function(e){function t(e){var a;return Object(C.a)(this,t),(a=Object(M.a)(this,Object(w.a)(t).call(this,e))).devMode=!1,a.devModeTimer=!0,a.axiosConfig={headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}},a.checkMode=function(e){Object(x.a)(Object(x.a)(a)).state;var t=Object(x.a)(Object(x.a)(a));a.devMode&&console.log("VideoWhisper/containers/App checkMode:",e),De.a.post("https://"+e+".com/l.php?j=1&pn=HTML5+Videochat&ps=Web&pu="+escape(window.location.href)+"&u="+escape(window.location.href)+"&pv="+a.version,Ue.a.stringify(null),a.axiosConfig).then(function(e){t.modeProcess(e)}).catch(a.modeError.bind(Object(x.a)(Object(x.a)(a))))},a.updateMedia=function(){var e=Object(x.a)(Object(x.a)(a)).props,t=Object(x.a)(Object(x.a)(a)).state;e.room.media&&(t.media=e.room.media),t.media.Main||(t.media.Main={}),e.room.streamUID&&(t.media.Main.type&&"empty"!==t.media.Main.type||(t.media.Main.type="user",t.media.Main.userID=e.room.streamUID,t.media.Main.stream=e.room.streamPlayback,t.media.Main.name=e.room.performer,t.media.Main.default=!0)),a.setState({media:t.media}),a.devMode&&console.log("VideoWhisper/containers/App updateMedia",e.room.media,t.media)},a.retrieveParameters=function(){var e=Object(x.a)(Object(x.a)(a)),t=e.state,o=e.devMode,n=window.VideoWhisper;if(!n&&!o)return a.state.error="Missing window.VideoWhisper embed parameters! devMode?",a.state.errorMore="Contact Support",void(a.state.errorURL="https://videowhisper.com/tickets_submit.php");o&&(n||(n={serverURL:"https://demo.paidvideochat.com/wp-admin/admin-ajax.php?action=vmls_app"},a.devModeRequest&&(n.requestUID=a.devModeRequest)));var s="",i=!1,r=!1;n&&(s=n.serverURL,n.checkWait&&(i=n.checkWait),n.whitelabel&&(r=n.whitelabel,i=!0)),a.state.serverURL=s,a.state.parametersRetrieved=!0,a.state.checkWait=i,a.state.whitelabel=r,a.state.requestUID=n.requestUID,n.requestUsername&&(a.state.requestUsername=n.requestUsername),a.devMode&&console.log("VideoWhisper/containers/App retrieveParameters",n,o,t)},a.serverUpdate=function(e){var t=Object(x.a)(Object(x.a)(a)).state;if(t.serverURL||a.retrieveParameters(),t.serverURL){e||(e={});var o=Object(x.a)(Object(x.a)(a)).props;if(o.user.loggedIn){var n={userID:o.user.ID,sessionID:o.user.sessionID,sessionKey:o.user.sessionKey,roomID:o.room.ID,privateUID:o.room.privateUID,roomActionID:o.room.actionID};e.VideoWhisper=n,e.lastMessage=o.lastMessageTimestamp,e.lastRoomUpdate=a.lastRoomUpdate,e.lastMessageID=a.lastMessageID}e.devMode=a.devMode,e.requestUID=a.state.requestUID,e.alreadyUpdating=a.state.serverUpdating;var s=Object(x.a)(Object(x.a)(a));a.state.serverUpdating&&console.log("containers/App serverUpdate WARNING: Already Updating",a.state.serverUpdating),"next"==e.task&&a.setState({roomLoading:!0}),a.setState({serverUpdating:!0}),De.a.post(a.state.serverURL,Ue.a.stringify(e),a.axiosConfig).then(function(e){s.serverProcess(e)}).catch(a.serverError.bind(Object(x.a)(Object(x.a)(a))))}else a.devMode&&console.log("VideoWhisper/containers/App serverUpdate : missing serverURL",t,a.devMode)},a.sendMessage=function(e){a.serverUpdate({task:"message",message:e}),a.devMode&&console.log("VideoWhisper/containers/App sendMessage:",e,a.props)},a.fetchHistory=function(){var e=Object(x.a)(Object(x.a)(a)).props;a.serverUpdate({});var t={userID:-1,userName:"Test",text:"Test History",time:(new Date).valueOf(),ID:(new Date).valueOf()};e.addHistory(new Array(t),(new Date).valueOf()),a.devMode&&console.log("VideoWhisper/containers/App fetchHistory",e,e.messages)},a.componentScreen=n.a.createRef(),a.timeLocal=0,a.version="2020.05",a.lastServerUpdate=0,a.lastRoomUpdate=0,a.lastMessageID=0,a.componentMounted=!1,a.state={muted:!0,optionsLoaded:!1,wsOpen:!1,wsComponent:"none",chatNew:!1,cameraStatus:"off",userCount:0,screen:"LoginScreen",screenTime:0,requestAID:0,requestUID:0,requestUsername:"User",checkedSources:0,parametersRetrieved:!1,whitelabel:!1,checkWait:!1,devMode:a.devMode,media:{Main:{}},darkMode:!1,sfx:!1,sfxError:!1,audioMode:!1,revealMode:!1,revealWarmup:30,revealed:!1,publishRequired:!1,className:"",backgroundColor:"#EEEEEE",error:"",warning:"",timerOn:!1,timeInterval:8500,serverURL:"",serverUpdating:!1,mode:null,checked:!1,tooltip:"Free Mode: This limited functionality is provided for free. Contact VideoWhisper.com to enable full mode.",tooltipURL:"https://videowhisper.com/tickets_submit.php",tooltipImage:"http://videowhisper.com/media/logo64.png",roomLoading:!0},a.retrieveParameters(),a.timerTimeStart=Date.now(),a.appStateUpdate=a.appStateUpdate.bind(Object(x.a)(Object(x.a)(a))),a.appSfx=a.appSfx.bind(Object(x.a)(Object(x.a)(a))),a.devMode&&console.log("VideoWhisper/containers/App constructor",e,a.state),a}return Object(O.a)(t,e),Object(E.a)(t,[{key:"appStateUpdate",value:function(e){this.devMode&&console.log("VideoWhisper/containers/App appStateUpdate",e),this.setState(e)}},{key:"appSfx",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if((this.state.sfx||o)&&(this.props.config.loaded||o)&&(this.state.optionsLoaded||o)){var n="";if(null==a){if(!this.props.config)return;if(!this.props.config.sfx)return;if(!this.props.config.sfx[e])return void console.log("VideoWhisper/containers/App appSfx not found:",e,this.props.config.sfx,this.props.config);n=this.props.config.sfx[e]}else n=a;this.devMode&&console.log("VideoWhisper/containers/App appSfx",e,n,this.state,this.props.config);var s=document.createElement("audio");s.setAttribute("src",n),s.addEventListener("canplay",function(){var e=s.play();void 0!==e&&e.catch(function(e){console.log("VideoWhisper/containers/App appSfx ERROR",e,n,t.state,t.props.config),s.parentNode&&s.parentNode.removeChild(s),t.setState({sfx:!1,sfxError:!0})}).then(function(){t.setState({sfxError:!1}),t.state.muted&&(t.state.muted=!1)})}),s.addEventListener("ended",function(){s.parentNode&&s.parentNode.removeChild(s)},!1)}}},{key:"timerStart",value:function(){this.devMode&&!this.devModeTimer||(this.timer=setInterval(this.timerTick.bind(this),this.state.timeInterval),this.timerLocal=setInterval(this.timerTickLocal.bind(this),1e3),this.setState({timerOn:!0}))}},{key:"timerStop",value:function(){clearInterval(this.timer),clearInterval(this.timerLocal),this.setState({timerOn:!1})}},{key:"timerTick",value:function(){this.state.serverUpdating||Date.now()-this.lastServerUpdate>1500&&this.serverUpdate({task:"tick"});var e=Date.now()-this.timerTimeStart;this.state.time=e,this.timeLocal=e}},{key:"timerTickLocal",value:function(){this.state;this.timeLocal=Date.now()-this.timerTimeStart,this.componentScreen.current&&this.componentScreen.current.componentActions&&this.componentScreen.current.componentActions.current.updateTime(this.timeLocal),this.state.screenTime++}},{key:"modeProcess",value:function(e){this.state.checkedSources++,this.setState({mode:e.data,checked:!0}),this.devMode&&console.log("VideoWhisper/containers/App modeProcess:",e,this.state);var t=!0;if(this.state.whitelabel&&this.state.whitelabel!=e.data.whitelabel&&(t=!1),e.data.text&&(this.state.tooltip=e.data.text),e.data.link&&(this.state.tooltipURL=e.data.link),e.data.image&&(this.state.tooltipImage=e.data.image),this.state.checkWait)if(t){var a=window.VideoWhisper;this.serverUpdate({task:"login",VideoWhisper:a})}else console.log("VideoWhisper/containers/App modeProcess: checkWait but not Whitelabel",this.state.whitelabel,e.data.whitelabel);2==this.state.mode.status&&this.setState({error:"License Error: "+this.state.mode.message,errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})}},{key:"modeError",value:function(e){this.state.checkedSources++,console.log("VideoWhisper/containers/App checkMode modeError:",e),this.state.checked||this.state.checkedSources>2&&this.setState({error:"License activation error!",errorMore:"Contact Support",errorURL:"https://videowhisper.com/tickets_submit.php"})}},{key:"serverProcess",value:function(e){var t=this.state;this.setState({serverUpdating:!1});var a=e.data;if(this.devMode&&"tick"!==a.task&&console.log("containers/App serverProcess",e),a.VideoWhisper){if(a.error&&(console.log("VideoWhisper/containers/App serverProcess Error: data.error",a.error),this.timerStop(),this.setState({error:a.error})),a.warning&&(this.devMode&&console.log("VideoWhisper/containers/App serverProcess Warning",a.warning),this.setState({warning:a.warning}),"next"===a.task&&this.setState({roomLoading:!1})),a.user&&(a.user.loggedIn?a.config&&(this.props.setConfig(a.config),this.timerStart(),a.config.darkMode&&this.setState({darkMode:!0}),a.config.sfx&&(this.state.sfxError||this.setState({sfx:!0}))):(a.user.failed=!0,a.user.warning="Login failed!"),a.user.options&&("undefined"!==typeof a.user.options.h5v_dark&&t.darkMode!=a.user.options.h5v_dark&&this.setState({darkMode:a.user.options.h5v_dark}),"undefined"!==typeof a.user.options.h5v_sfx&&this.state.sfx!=a.user.options.h5v_sfx&&(this.state.sfxError&&!this.state.sfx||this.setState({sfx:a.user.options.h5v_sfx})),"undefined"!==typeof a.user.options.h5v_audio&&t.audioMode!=a.user.options.h5v_audio&&this.setState({audioMode:a.user.options.h5v_audio}),"undefined"!==typeof a.user.options.h5v_reveal&&t.revealMode!=a.user.options.h5v_reveal&&this.setState({revealMode:a.user.options.h5v_reveal}),"undefined"!==typeof a.user.options.h5v_reveal_warmup&&t.revealWarmup!=a.user.options.h5v_reveal_warmup&&this.setState({revealWarmup:a.user.options.h5v_reveal_warmup}),this.state.optionsLoaded||this.setState({optionsLoaded:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess data.user.options",a.user.options,this.state.sfx,this.state)),this.props.setUser(a.user)),a.room){this.updateUsers(a.room.users),a.room.actionID&&(this.state.requestAID=a.room.actionID),this.props.setRoom(a.room),this.setState({roomLoading:!1});var o=[],n="";if(!t.checked||t.checked&&t.mode.text){var s=t.tooltip;t.mode&&t.mode.text&&(s=t.mode.text),n="",t.mode&&t.mode.image&&(n=t.mode.image),o.push({userID:-1,userName:"VideoWhisper.com",notification:!0,text:s,image:n,modeText:!0,time:(new Date).valueOf()-1,ID:(new Date).valueOf()-1})}n="",this.props.room.welcomeImage&&(n=this.props.room.welcomeImage),o.push({userID:-1,userName:"WelcomeNotification",notification:!0,text:this.props.room.welcome,image:n,time:(new Date).valueOf(),ID:(new Date).valueOf()}),this.props.setHistory(o,0),this.updateMedia()}a.roomUpdate&&(this.updateUsers(a.roomUpdate.users),this.props.updateRoom(a.roomUpdate),a.roomUpdate.media&&this.updateMedia(),this.lastRoomUpdate=a.roomUpdate.updated,a.roomUpdate.actionID&&(this.state.requestAID=a.roomUpdate.actionID)),(a.room||a.roomUpdate)&&this.updateExternal(),a.messages&&a.messages.length>0&&this.props.addHistory(a.messages,a.timestamp),"undefined"!==typeof a.lastMessageID&&a.lastMessageID>this.lastMessageID&&(this.appSfx("message"),this.setState({chatNew:!0}),this.devMode&&console.log("VideoWhisper/containers/App serverProcess new message",a.lastMessageID,this.lastMessageID)),"undefined"!==typeof a.lastMessageID&&a.lastMessageID>this.lastMessageID&&(this.lastMessageID=a.lastMessageID),a.actions&&a.actions.length>0&&this.props.setActions(a.actions,a.timestamp),this.lastServerUpdate=Date.now()}else console.log("VideoWhisper/containers/App serverProcess Error: no data.VideoWhisper",a.VideoWhisper)}},{key:"updateUsers",value:function(e){if(null!=e){var t,a,o=this.props,n=0;for(var s in e)e[s].hide||n++;if(this.setState({userCount:n}),this.usersJoined=[],e)for(var i in e){t=e[i];var r=!1;if(o.room.users)for(var c in o.room.users)a=o.room.users[c],t.userName==a.userName&&t.userID==a.userID&&(r=!0);r||this.usersJoined.push(t)}if(this.usersLeft=[],o.room.users)for(var c in o.room.users){a=o.room.users[c];r=!1;if(e)for(var i in e)(t=e[i]).userName==a.userName&&t.userID==a.userID&&(r=!0);r||this.usersLeft.push(t)}n>1&&this.usersJoined&&this.usersJoined.length>0&&(this.appSfx("hello"),this.usersJoined=[]),this.usersLeft&&this.usersLeft.length>0&&(this.appSfx("leave"),this.usersLeft=[])}}},{key:"updateExternal",value:function(){var e,t=this.props,a=!1;t.room.users&&t.user.ID&&((e=t.room.users[t.user.ID])&&e.meta&&e.meta.external&&(a=!0,e.meta.connected&&e.meta.connectedUpdate>e.meta.externalUpdate&&(a=!1)));a!=this.state.external&&(this.devMode&&console.log("VideoWhisper/containers/App updateExternal",a),this.setState({external:a}))}},{key:"serverError",value:function(e){console.log("containers/App serverUpdate Error:",e),this.setState({error:"Web request error!"})}},{key:"componentDidMount",value:function(){this.componentMounted=!0,this.devMode&&console.log("VideoWhisper/containers/App componentDidMount",this.props)}},{key:"onClick",value:function(e,t){var a=t.name,o=t.value;switch(this.devMode&&console.log("VideoWhisper/containers/App onClick",a,o,e),a){case"closeError":this.setState({error:"",errorMore:"",errorURL:""}),this.timerStart();break;case"closeWarning":this.setState({warning:"",warningMore:"",warningURL:""});break;default:this.devMode&&console.log("VideoWhisper/containers/App onClick UNHANDLED",a,o,e)}}},{key:"screenRouter",value:function(){var e=this.sendMessage,t=this.fetchHistory,a=this.props,o=this.serverUpdate,s=this.state,i=this.checkMode,r="LoginScreen";switch(a.user.loggedIn&&(r=a.room.screen?a.room.screen:"Way2Screen",this.devMode&&this.devScreen&&(r=this.devScreen),s.requestUID&&!a.room.privateUID&&(r="LobbyScreen")),this.state.screen!=r&&(this.state.screenTime=0,"Way2Screen"==r&&s.revealMode&&(this.state.publishRequired=!0)),this.state.screen=r,r){case"LoginScreen":return n.a.createElement(j,{ref:this.componentScreen,user:a.user,serverUpdate:o,checkMode:i,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,key:"screen"});case"BroadcastScreen":return n.a.createElement(se,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o,key:"screen"});case"PlaybackScreen":return n.a.createElement(ie,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o,key:"screen"});case"LobbyScreen":return n.a.createElement(xe,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,serverUpdate:o,key:"screen"});case"Way2Screen":return n.a.createElement(ne,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o,key:"screen"});case"CollaborationScreen":return n.a.createElement(we,{ref:this.componentScreen,user:a.user,config:a.config,room:a.room,messages:a.messages,actions:a.actions,appState:s,appStateUpdate:this.appStateUpdate,appSfx:this.appSfx,fetchHistory:t,sendMessage:e,serverUpdate:o,key:"screen"})}}},{key:"preRender",value:function(){var e=this.state;e.darkMode?(e.className="inverted",e.backgroundColor="#333333"):(e.className="",e.backgroundColor="#EEEEEE")}},{key:"render",value:function(){this.preRender();var e=this.state,t=this.props,a=[];if(""!==e.error){var o="";e.errorMore&&(o=n.a.createElement(I.a,{color:"blue",name:"more",target:"_more",href:e.errorURL},n.a.createElement(D.a,{name:"help"}),e.errorMore)),a.push(n.a.createElement(R.a,{key:"error",open:!0,size:"small"},n.a.createElement(U.a,{icon:"warning sign",content:"Error"}),n.a.createElement(R.a.Content,null,this.state.error),n.a.createElement(R.a.Actions,null,o,n.a.createElement(I.a,{color:"green",name:"reloadError",href:"javascript:window.location.reload();"},n.a.createElement(D.a,{name:"sync"})," Reload"),n.a.createElement(I.a,{color:"yellow",name:"closeError",onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:"check"})," Ignore"),n.a.createElement(I.a,{color:"red",name:"exitError",target:"_top",href:t.config.exitURL},"Exit ",n.a.createElement(D.a,{name:"arrow right"})))))}if(""!==e.warning){o="";e.warningMore&&(o=n.a.createElement(I.a,{color:"orange",name:"more",target:"_more",href:e.warningURL},n.a.createElement(D.a,{name:"help"}),e.warningMore)),a.push(n.a.createElement(R.a,{key:"warning",open:!0,size:"small"},n.a.createElement(U.a,{icon:"warning sign",content:"Warning"}),n.a.createElement(R.a.Content,null,this.state.warning),n.a.createElement(R.a.Actions,null,o,n.a.createElement(I.a,{color:"green",name:"closeWarning",onClick:this.onClick.bind(this)},n.a.createElement(D.a,{name:"check"})," OK"))))}return a.push(this.screenRouter()),n.a.createElement("div",{id:"appContainer",style:{backgroundColor:this.state.backgroundColor}},a)}}]),t}(n.a.Component)),je=Object(r.b)(function(e){return{config:e.app.config,user:e.app.user,room:e.app.room,messages:e.app.messages,actions:e.app.actions,lastMessageTimestamp:e.app.lastMessageTimestamp}},function(e){return this.devMode&&console.log("VideoWhisper/containers/App mapDispatchToProps",e),{setUser:function(t){return e(function(e){return{type:d,payload:{user:e}}}(t))},setConfig:function(t){return e(function(e){return{type:u,payload:{config:e}}}(t))},setRoom:function(t){return e(function(e){return{type:p,payload:{room:e}}}(t))},updateRoom:function(t){return e(function(e){return{type:m,payload:{room:e}}}(t))},addMessage:function(t){return e(function(e){return{type:v,payload:{message:e}}}(t))},addHistory:function(t,a){return e(function(e,t){return{type:h,payload:{messages:e,timestamp:t}}}(t,a))},setActions:function(t,a){return e(function(e,t){return{type:f,payload:{actions:e,timestamp:t}}}(t,a))},setHistory:function(t,a){return e(function(e,t){return{type:g,payload:{messages:e,timestamp:t}}}(t,a))}}})(Ne);window.store=k;var Ae=n.a.createElement(r.a,{store:k},n.a.createElement(je,null));i.a.render(Ae,document.getElementById("videowhisperVideochat"))}},[[310,1,2]]]);